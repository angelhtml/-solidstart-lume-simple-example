/*! For license information please see global.js.LICENSE.txt */
(()=>{var __webpack_modules__={924:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";var _utils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(832),__WEBPACK_DEFAULT_EXPORT__=null,supportsSpread=isSyntaxSupported("Object(...[{}])"),supportsClass=isSyntaxSupported("class Test {}"),supportsNewTarget=isSyntaxSupported("new.target"),TRUE_CONSTRUCTOR=Symbol?Symbol("trueConstructor"):"__newlessTrueConstructor__",setPrototype=Object.setPrototypeOf||function(e,t){e.__proto__=t},construct=Reflect&&Reflect.construct||function(){if(supportsClass)return Function("constructor, args, target",`\n                'use strict';\n\n                if (arguments.length === 3 && typeof target !== 'function')\n                    throw new TypeError(target + ' is not a constructor');\n\n                target = target || constructor;\n\n                // extend target so the right prototype is constructed (or nearly the\n                // right one; ideally we'd do instantiator.prototype = target.prototype,\n                // but a class's prototype property is not writable)\n                class instantiator extends target {};\n                // but ensure the *logic* is 'constructor' for ES2015-compliant engines\n                Object.setPrototypeOf(instantiator, constructor);\n                // ...and for Safari 9\n                instantiator.prototype.constructor = constructor;\n\n                // The spread operator is *dramatically faster, so use it if we can:\n                // http://jsperf.com/new-via-spread-vs-dynamic-function/4\n                ${supportsSpread?"\n\n                    var value = new instantiator(...([].slice.call(args)));\n\n                ":"\n\n                    // otherwise, create a dynamic function in order to use 'new'\n                    // Note using 'function.bind' would be simpler, but is much slower:\n                    // http://jsperf.com/new-operator-with-dynamic-function-vs-bind\n                    var argList = '';\n                    for (var i = 0, len = args.length; i < len; i++) {\n                    if (i > 0) argList += ',';\n                    argList += 'args[' + i + ']';\n                    }\n                    var constructCall = Function('constructor, args',\n                    'return new constructor( ' + argList + ' );'\n                    );\n                    var value = constructCall(constructor, args);\n\n                    args = Array.prototype.slice.call(args);\n                    args = [null].concat(args);\n                    var value = new constructor.bind.apply(constructor, args);\n\n                "}\n\n                // fix up the prototype so it matches the intended one, not one who's\n                // prototype is the intended one :P\n                Object.setPrototypeOf(value, target.prototype);\n                return value;\n            `);var e=function(){};return function(t,n,r){if(3===arguments.length&&"function"!=typeof r)throw new TypeError(r+" is not a constructor");e.prototype=(r||t).prototype;var i=new e,o=t.apply(i,n);return"object"==typeof o&&o?(o.__proto__=(r||t).prototype,o):i}}(),SKIP_PROPERTIES=null;function copyProperties(e,t){if(Object.getOwnPropertyNames&&Object.defineProperty){var n=Object.getOwnPropertyNames(e);Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e)));for(var r=n.length-1;r>=0;r--)-1===SKIP_PROPERTIES.indexOf(n[r])&&Object.defineProperty(t,n[r],Object.getOwnPropertyDescriptor(e,n[r]))}else for(var i in e)t[i]=e[i]}function newless(constructor){var name=constructor.name,usesClassSyntax="class"===constructor.toString().substr(0,5),requiresNew=!!usesClassSyntax||null,newlessConstructor=(()=>function(){if(!requiresNew&&this instanceof newlessConstructor){if(!1===requiresNew){const e=constructor.apply(this,arguments);return"object"==typeof e&&e||this}try{requiresNew=!1;const e=constructor.apply(this,arguments);return"object"==typeof e&&e||this}catch(e){if(!(e instanceof TypeError&&(/class constructor/i.test(e.message)||/use the 'new' operator/i.test(e.message))))throw e instanceof Error&&/Illegal constructor/i.test(e.message)&&Object.create(constructor.prototype)instanceof Node&&console.error(`The following error can happen if a Custom Element is called\nwith 'new' before being defined. The constructor was ${constructor.name}: `,constructor),e;requiresNew=!0}}var newTarget,hasNewTarget=!1;supportsNewTarget&&(eval("newTarget = new.target"),newTarget&&(hasNewTarget=!0)),supportsNewTarget&&hasNewTarget||(newTarget=this instanceof newlessConstructor?this.constructor:constructor);const returnValue=construct(constructor,arguments,newTarget);return this instanceof newlessConstructor&&setPrototype(this,returnValue),returnValue})();if(name){const e=getFunctionBody(newlessConstructor);newlessConstructor=Function("constructor, construct, setPrototype, requiresNew, supportsNewTarget",`\n      var newlessConstructor = function ${name}() { ${e} };\n      return newlessConstructor\n    `)(constructor,construct,setPrototype,requiresNew,supportsNewTarget)}return constructor.length&&setDescriptor(newlessConstructor,"length",{value:constructor.length}),newlessConstructor.prototype=Object.create(constructor.prototype),newlessConstructor.prototype.constructor=newlessConstructor,constructor.prototype.constructor=constructor,newlessConstructor[TRUE_CONSTRUCTOR]=constructor,copyProperties(constructor,newlessConstructor),setPrototype(newlessConstructor,constructor),newlessConstructor}function isSyntaxSupported(e,t=!0){try{return!!Function("",(t?"'use strict';":"")+e)}catch(e){return!1}}},832:(e,t,n)=>{"use strict";n.d(t,{Ie:()=>r,Sh:()=>i,q$:()=>s,uh:()=>l,ld:()=>u,yA:()=>h,nk:()=>d,Gm:()=>p,Md:()=>f,U8:()=>m});class r{constructor(){this.m=new WeakMap}set(e,t){this.m.set(e,t),this.m.set(t,e)}get(e){return this.m.get(e)}has(e){return this.m.has(e)}}function i(e){const t=e.toString().split("\n");return t.shift(),t.pop(),t.join("\n")}const o={enumerable:!0,configurable:!0};function s(e,t,n,r=!1){n=c(r?u(e,t):Object.getOwnPropertyDescriptor(e,t),n),Object.defineProperty(e,t,n)}function a(e,t){let n,r;const i=Object.getOwnPropertyDescriptors(e);for(const e in t)n=t[e],r=i[e],t[e]=c(r,n);Object.defineProperties(e,t)}function c(e,t){if(("get"in t||"set"in t)&&("value"in t||"writable"in t))throw new TypeError("cannot specify both accessors and a value or writable attribute");return e&&("get"in t||"set"in t?(delete e.value,delete e.writable):("value"in t||"writable"in t)&&(delete e.get,delete e.set)),{...o,...e,...t}}function l(e,t,n=!0){let r,i=!1;return r=1===arguments.length?e:n?u(e,t):Object.getOwnPropertyDescriptor(e,t),r&&(r.get||r.set)&&(i=!0),i}function u(e,t){let n,r=e;for(;r;){if(n=Object.getOwnPropertyDescriptor(r,t),n)return n.owner=r,n;r=r.__proto__}}function h(e){let t=e,n=[];for(;t;)n=n.concat(Object.getOwnPropertyNames(t)),t=t.__proto__;return n=Array.from(new Set(n)),n}function d(e,t){let n=e.__proto__;do{if(t===n)return!0;n=n.__proto__}while(n);return!1}function p(e,t,n){const r=Object.getOwnPropertyNames(e);let i=r.length;for(;i--;){const o=r[i],s=Object.getOwnPropertyDescriptor(e,o);n&&n(s),Object.defineProperty(t,o,s)}}function f(e,{defaultClassDescriptor:{writable:t,enumerable:n,configurable:r}}){const i=Object.getOwnPropertyDescriptors(e);let o;for(const e in i)o=i[e],("value"in o||"writable"in o)&&(o.writable=t),o.enumerable=n,o.configurable=r;a(e,i)}function m(e,{defaultClassDescriptor:{writable:t,enumerable:n,configurable:r}},i){const o=Object.getOwnPropertyDescriptors(e);let s;for(const e in o)i&&i.includes(e)?delete o[e]:(s=o[e],("value"in s||"writable"in s)&&(s.writable=t),s.enumerable=n,s.configurable=r);a(e,o)}},495:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";var _utils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(63),__WEBPACK_DEFAULT_EXPORT__=null,supportsSpread=isSyntaxSupported("Object(...[{}])"),supportsClass=isSyntaxSupported("class Test {}"),supportsNewTarget=isSyntaxSupported("new.target"),TRUE_CONSTRUCTOR=Symbol?Symbol("trueConstructor"):"__newlessTrueConstructor__",setPrototype=Object.setPrototypeOf||function(e,t){e.__proto__=t},construct=Reflect&&Reflect.construct||function(){if(supportsClass)return Function("constructor, args, target",`\n                'use strict';\n\n                if (arguments.length === 3 && typeof target !== 'function')\n                    throw new TypeError(target + ' is not a constructor');\n\n                target = target || constructor;\n\n                // extend target so the right prototype is constructed (or nearly the\n                // right one; ideally we'd do instantiator.prototype = target.prototype,\n                // but a class's prototype property is not writable)\n                class instantiator extends target {};\n                // but ensure the *logic* is 'constructor' for ES2015-compliant engines\n                Object.setPrototypeOf(instantiator, constructor);\n                // ...and for Safari 9\n                instantiator.prototype.constructor = constructor;\n\n                // The spread operator is *dramatically faster, so use it if we can:\n                // http://jsperf.com/new-via-spread-vs-dynamic-function/4\n                ${supportsSpread?"\n\n                    var value = new instantiator(...([].slice.call(args)));\n\n                ":"\n\n                    // otherwise, create a dynamic function in order to use 'new'\n                    // Note using 'function.bind' would be simpler, but is much slower:\n                    // http://jsperf.com/new-operator-with-dynamic-function-vs-bind\n                    var argList = '';\n                    for (var i = 0, len = args.length; i < len; i++) {\n                    if (i > 0) argList += ',';\n                    argList += 'args[' + i + ']';\n                    }\n                    var constructCall = Function('constructor, args',\n                    'return new constructor( ' + argList + ' );'\n                    );\n                    var value = constructCall(constructor, args);\n\n                    args = Array.prototype.slice.call(args);\n                    args = [null].concat(args);\n                    var value = new constructor.bind.apply(constructor, args);\n\n                "}\n\n                // fix up the prototype so it matches the intended one, not one who's\n                // prototype is the intended one :P\n                Object.setPrototypeOf(value, target.prototype);\n                return value;\n            `);var e=function(){};return function(t,n,r){if(3===arguments.length&&"function"!=typeof r)throw new TypeError(r+" is not a constructor");e.prototype=(r||t).prototype;var i=new e,o=t.apply(i,n);return"object"==typeof o&&o?(o.__proto__=(r||t).prototype,o):i}}(),SKIP_PROPERTIES=null;function copyProperties(e,t){if(Object.getOwnPropertyNames&&Object.defineProperty){var n=Object.getOwnPropertyNames(e);Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e)));for(var r=n.length-1;r>=0;r--)-1===SKIP_PROPERTIES.indexOf(n[r])&&Object.defineProperty(t,n[r],Object.getOwnPropertyDescriptor(e,n[r]))}else for(var i in e)t[i]=e[i]}function newless(constructor){var name=constructor.name,usesClassSyntax="class"===constructor.toString().substr(0,5),requiresNew=!!usesClassSyntax||null,newlessConstructor=(()=>function(){if(!requiresNew&&this instanceof newlessConstructor){if(!1===requiresNew){const e=constructor.apply(this,arguments);return"object"==typeof e&&e||this}try{requiresNew=!1;const e=constructor.apply(this,arguments);return"object"==typeof e&&e||this}catch(e){if(!(e instanceof TypeError&&(/class constructor/i.test(e.message)||/use the 'new' operator/i.test(e.message))))throw e instanceof Error&&/Illegal constructor/i.test(e.message)&&Object.create(constructor.prototype)instanceof Node&&console.error(`The following error can happen if a Custom Element is called\nwith 'new' before being defined. The constructor was ${constructor.name}: `,constructor),e;requiresNew=!0}}var newTarget,hasNewTarget=!1;supportsNewTarget&&(eval("newTarget = new.target"),newTarget&&(hasNewTarget=!0)),supportsNewTarget&&hasNewTarget||(newTarget=this instanceof newlessConstructor?this.constructor:constructor);const returnValue=construct(constructor,arguments,newTarget);return this instanceof newlessConstructor&&setPrototype(this,returnValue),returnValue})();if(name){const e=getFunctionBody(newlessConstructor);newlessConstructor=Function("constructor, construct, setPrototype, requiresNew, supportsNewTarget",`\n      var newlessConstructor = function ${name}() { ${e} };\n      return newlessConstructor\n    `)(constructor,construct,setPrototype,requiresNew,supportsNewTarget)}return constructor.length&&setDescriptor(newlessConstructor,"length",{value:constructor.length}),newlessConstructor.prototype=Object.create(constructor.prototype),newlessConstructor.prototype.constructor=newlessConstructor,constructor.prototype.constructor=constructor,newlessConstructor[TRUE_CONSTRUCTOR]=constructor,copyProperties(constructor,newlessConstructor),setPrototype(newlessConstructor,constructor),newlessConstructor}function isSyntaxSupported(e,t=!0){try{return!!Function("",(t?"'use strict';":"")+e)}catch(e){return!1}}},63:(e,t,n)=>{"use strict";n.d(t,{Ie:()=>r,Sh:()=>i,q$:()=>s,uh:()=>l,ld:()=>u,yA:()=>h,v_:()=>d,nk:()=>p,Gm:()=>f,Md:()=>m,U8:()=>g});class r{constructor(){this.m=new WeakMap}set(e,t){this.m.set(e,t),this.m.set(t,e)}get(e){return this.m.get(e)}has(e){return this.m.has(e)}}function i(e){const t=e.toString().split("\n");return t.shift(),t.pop(),t.join("\n")}const o={enumerable:!0,configurable:!0};function s(e,t,n,r=!1){n=c(r?u(e,t):Object.getOwnPropertyDescriptor(e,t),n),Object.defineProperty(e,t,n)}function a(e,t){let n,r;const i=Object.getOwnPropertyDescriptors(e);for(const e in t)n=t[e],r=i[e],t[e]=c(r,n);Object.defineProperties(e,t)}function c(e,t){if(("get"in t||"set"in t)&&("value"in t||"writable"in t))throw new TypeError("cannot specify both accessors and a value or writable attribute");return e&&("get"in t||"set"in t?(delete e.value,delete e.writable):("value"in t||"writable"in t)&&(delete e.get,delete e.set)),{...o,...e,...t}}function l(e,t,n=!0){let r,i=!1;return r=1===arguments.length?e:n?u(e,t):Object.getOwnPropertyDescriptor(e,t),r&&(r.get||r.set)&&(i=!0),i}function u(e,t){let n,r=e;for(;r;){if(n=Object.getOwnPropertyDescriptor(r,t),n)return n.owner=r,n;r=r.__proto__}}function h(e){let t=e,n=[];for(;t;)n=n.concat(Object.getOwnPropertyNames(t)),t=t.__proto__;return n=Array.from(new Set(n)),n}function d(e){return e}function p(e,t){let n=e.__proto__;do{if(t===n)return!0;n=n.__proto__}while(n);return!1}function f(e,t,n){const r=Object.getOwnPropertyNames(e);let i=r.length;for(;i--;){const o=r[i],s=Object.getOwnPropertyDescriptor(e,o);n&&n(s),Object.defineProperty(t,o,s)}}function m(e,{defaultClassDescriptor:{writable:t,enumerable:n,configurable:r}}){const i=Object.getOwnPropertyDescriptors(e);let o;for(const e in i)o=i[e],("value"in o||"writable"in o)&&(o.writable=t),o.enumerable=n,o.configurable=r;a(e,i)}function g(e,{defaultClassDescriptor:{writable:t,enumerable:n,configurable:r}},i){const o=Object.getOwnPropertyDescriptors(e);let s;for(const e in o)i&&i.includes(e)?delete o[e]:(s=o[e],("value"in s||"writable"in s)&&(s.writable=t),s.enumerable=n,s.configurable=r);a(e,o)}},768:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";var _utils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(662),__WEBPACK_DEFAULT_EXPORT__=null,supportsSpread=isSyntaxSupported("Object(...[{}])"),supportsClass=isSyntaxSupported("class Test {}"),supportsNewTarget=isSyntaxSupported("new.target"),TRUE_CONSTRUCTOR=Symbol?Symbol("trueConstructor"):"__newlessTrueConstructor__",setPrototype=Object.setPrototypeOf||function(e,t){e.__proto__=t},construct=Reflect&&Reflect.construct||function(){if(supportsClass)return Function("constructor, args, target",`\n                'use strict';\n\n                if (arguments.length === 3 && typeof target !== 'function')\n                    throw new TypeError(target + ' is not a constructor');\n\n                target = target || constructor;\n\n                // extend target so the right prototype is constructed (or nearly the\n                // right one; ideally we'd do instantiator.prototype = target.prototype,\n                // but a class's prototype property is not writable)\n                class instantiator extends target {};\n                // but ensure the *logic* is 'constructor' for ES2015-compliant engines\n                Object.setPrototypeOf(instantiator, constructor);\n                // ...and for Safari 9\n                instantiator.prototype.constructor = constructor;\n\n                // The spread operator is *dramatically faster, so use it if we can:\n                // http://jsperf.com/new-via-spread-vs-dynamic-function/4\n                ${supportsSpread?"\n\n                    var value = new instantiator(...([].slice.call(args)));\n\n                ":"\n\n                    // otherwise, create a dynamic function in order to use 'new'\n                    // Note using 'function.bind' would be simpler, but is much slower:\n                    // http://jsperf.com/new-operator-with-dynamic-function-vs-bind\n                    var argList = '';\n                    for (var i = 0, len = args.length; i < len; i++) {\n                    if (i > 0) argList += ',';\n                    argList += 'args[' + i + ']';\n                    }\n                    var constructCall = Function('constructor, args',\n                    'return new constructor( ' + argList + ' );'\n                    );\n                    var value = constructCall(constructor, args);\n\n                    args = Array.prototype.slice.call(args);\n                    args = [null].concat(args);\n                    var value = new constructor.bind.apply(constructor, args);\n\n                "}\n\n                // fix up the prototype so it matches the intended one, not one who's\n                // prototype is the intended one :P\n                Object.setPrototypeOf(value, target.prototype);\n                return value;\n            `);var e=function(){};return function(t,n,r){if(3===arguments.length&&"function"!=typeof r)throw new TypeError(r+" is not a constructor");e.prototype=(r||t).prototype;var i=new e,o=t.apply(i,n);return"object"==typeof o&&o?(o.__proto__=(r||t).prototype,o):i}}(),SKIP_PROPERTIES=null;function copyProperties(e,t){if(Object.getOwnPropertyNames&&Object.defineProperty){var n=Object.getOwnPropertyNames(e);Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e)));for(var r=n.length-1;r>=0;r--)-1===SKIP_PROPERTIES.indexOf(n[r])&&Object.defineProperty(t,n[r],Object.getOwnPropertyDescriptor(e,n[r]))}else for(var i in e)t[i]=e[i]}function newless(constructor){var name=constructor.name,usesClassSyntax="class"===constructor.toString().substr(0,5),requiresNew=!!usesClassSyntax||null,newlessConstructor=(()=>function(){if(!requiresNew&&this instanceof newlessConstructor){if(!1===requiresNew){const e=constructor.apply(this,arguments);return"object"==typeof e&&e||this}try{requiresNew=!1;const e=constructor.apply(this,arguments);return"object"==typeof e&&e||this}catch(e){if(!(e instanceof TypeError&&(/class constructor/i.test(e.message)||/use the 'new' operator/i.test(e.message))))throw e instanceof Error&&/Illegal constructor/i.test(e.message)&&Object.create(constructor.prototype)instanceof Node&&console.error(`The following error can happen if a Custom Element is called\nwith 'new' before being defined. The constructor was ${constructor.name}: `,constructor),e;requiresNew=!0}}var newTarget,hasNewTarget=!1;supportsNewTarget&&(eval("newTarget = new.target"),newTarget&&(hasNewTarget=!0)),supportsNewTarget&&hasNewTarget||(newTarget=this instanceof newlessConstructor?this.constructor:constructor);const returnValue=construct(constructor,arguments,newTarget);return this instanceof newlessConstructor&&setPrototype(this,returnValue),returnValue})();if(name){const e=getFunctionBody(newlessConstructor);newlessConstructor=Function("constructor, construct, setPrototype, requiresNew, supportsNewTarget",`\n      var newlessConstructor = function ${name}() { ${e} };\n      return newlessConstructor\n    `)(constructor,construct,setPrototype,requiresNew,supportsNewTarget)}return constructor.length&&setDescriptor(newlessConstructor,"length",{value:constructor.length}),newlessConstructor.prototype=Object.create(constructor.prototype),newlessConstructor.prototype.constructor=newlessConstructor,constructor.prototype.constructor=constructor,newlessConstructor[TRUE_CONSTRUCTOR]=constructor,copyProperties(constructor,newlessConstructor),setPrototype(newlessConstructor,constructor),newlessConstructor}function isSyntaxSupported(e,t=!0){try{return!!Function("",(t?"'use strict';":"")+e)}catch(e){return!1}}},662:(e,t,n)=>{"use strict";n.d(t,{Ie:()=>r,Sh:()=>i,q$:()=>s,uh:()=>l,ld:()=>u,yA:()=>h,nk:()=>d,Gm:()=>p,Md:()=>f,U8:()=>m});class r{constructor(){this.m=new WeakMap}set(e,t){this.m.set(e,t),this.m.set(t,e)}get(e){return this.m.get(e)}has(e){return this.m.has(e)}}function i(e){const t=e.toString().split("\n");return t.shift(),t.pop(),t.join("\n")}const o={enumerable:!0,configurable:!0};function s(e,t,n,r=!1){n=c(r?u(e,t):Object.getOwnPropertyDescriptor(e,t),n),Object.defineProperty(e,t,n)}function a(e,t){let n,r;const i=Object.getOwnPropertyDescriptors(e);for(const e in t)n=t[e],r=i[e],t[e]=c(r,n);Object.defineProperties(e,t)}function c(e,t){if(("get"in t||"set"in t)&&("value"in t||"writable"in t))throw new TypeError("cannot specify both accessors and a value or writable attribute");return e&&("get"in t||"set"in t?(delete e.value,delete e.writable):("value"in t||"writable"in t)&&(delete e.get,delete e.set)),{...o,...e,...t}}function l(e,t,n=!0){let r,i=!1;return r=1===arguments.length?e:n?u(e,t):Object.getOwnPropertyDescriptor(e,t),r&&(r.get||r.set)&&(i=!0),i}function u(e,t){let n,r=e;for(;r;){if(n=Object.getOwnPropertyDescriptor(r,t),n)return n.owner=r,n;r=r.__proto__}}function h(e){let t=e,n=[];for(;t;)n=n.concat(Object.getOwnPropertyNames(t)),t=t.__proto__;return n=Array.from(new Set(n)),n}function d(e,t){let n=e.__proto__;do{if(t===n)return!0;n=n.__proto__}while(n);return!1}function p(e,t,n){const r=Object.getOwnPropertyNames(e);let i=r.length;for(;i--;){const o=r[i],s=Object.getOwnPropertyDescriptor(e,o);n&&n(s),Object.defineProperty(t,o,s)}}function f(e,{defaultClassDescriptor:{writable:t,enumerable:n,configurable:r}}){const i=Object.getOwnPropertyDescriptors(e);let o;for(const e in i)o=i[e],("value"in o||"writable"in o)&&(o.writable=t),o.enumerable=n,o.configurable=r;a(e,i)}function m(e,{defaultClassDescriptor:{writable:t,enumerable:n,configurable:r}},i){const o=Object.getOwnPropertyDescriptors(e);let s;for(const e in o)i&&i.includes(e)?delete o[e]:(s=o[e],("value"in s||"writable"in s)&&(s.writable=t),s.enumerable=n,s.configurable=r);a(e,o)}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Aliases:()=>et,AmbientLight:()=>MI,Assets:()=>Dt,AutoLayout:()=>WN,AutoLayoutNode:()=>uI,BasicMaterialBehavior:()=>LE,Behavior:()=>li,Box:()=>DI,BoxGeometryBehavior:()=>Vf,CameraRig:()=>PL,ChildProperties:()=>Qe,Class:()=>y,ClipPlane:()=>Rf,ClipPlanesBehavior:()=>Bf,ColladaModel:()=>HI,ColladaModelBehavior:()=>kA,Css3dRendererThree:()=>VO,CubeLayout:()=>gI,DeclarativeBase:()=>Qo,DefaultBehaviors:()=>Jo,DelegatedEvents:()=>nt,DirectionalLight:()=>II,Dynamic:()=>en,Element:()=>rn,ElementOperations:()=>ia,ErrorBoundary:()=>Ye,EventTypes:()=>Vi,Eventful:()=>k,Events:()=>Wi,FbxModel:()=>GI,FbxModelBehavior:()=>NR,FlickeringOrb:()=>uN,FlickeringOrbs:()=>dN,FlingRotation:()=>yL,For:()=>je,GeometryBehavior:()=>jf,GltfModel:()=>jI,GltfModelBehavior:()=>XR,HtmlNode:()=>Uh,HtmlScene:()=>zL,HydrationScript:()=>Dt,ImperativeBase:()=>Bh,Index:()=>Ve,InstancedMesh:()=>yf,LambertMaterialBehavior:()=>NE,Light:()=>_I,LoadingIcon:()=>mN,Match:()=>Xe,MaterialBehavior:()=>EE,Mesh:()=>Op,MeshBehavior:()=>bf,MixedPlane:()=>kI,MixedPlaneGeometryBehavior:()=>Wf,MixedPlaneMaterialBehavior:()=>IE,Mixin:()=>O,Motor:()=>_s,NoHydration:()=>kt,Node:()=>Vh,ObjModel:()=>VI,ObjModelBehavior:()=>cL,Object3DWithPivot:()=>oa,PerspectiveCamera:()=>FL,PhongMaterialBehavior:()=>HE,PhysicalMaterialBehavior:()=>ZE,Plane:()=>BI,PlaneGeometryBehavior:()=>WT,PlyGeometryBehavior:()=>GT,PointLight:()=>LI,Points:()=>zp,PointsMaterialBehavior:()=>KE,Portal:()=>Qt,ProjectedMaterialBehavior:()=>fA,PropAliases:()=>tt,PropReceiver:()=>Ur,Properties:()=>Ke,PushPaneLayout:()=>vI,RenderableBehavior:()=>Zh,RoundedRectangle:()=>UI,RoundedRectangleGeometryBehavior:()=>ZS,SVGElements:()=>rt,SVGNamespace:()=>it,Scene:()=>aN,ScrollFling:()=>EL,Settable:()=>Sh,ShaderMaterialBehavior:()=>TA,Shape:()=>FI,ShapeGeometryBehavior:()=>rE,Show:()=>We,Sizeable:()=>Bs,Sphere:()=>zI,SphereGeometryBehavior:()=>uE,StandardMaterialBehavior:()=>qE,Suspense:()=>$e,SuspenseList:()=>Je,Switch:()=>qe,THREE:()=>tz,Transformable:()=>Xs,TreeNode:()=>ns,WebglRendererThree:()=>FO,WithChildren:()=>Zo,XYZAnyValues:()=>qI,XYZNonNegativeValues:()=>os,XYZNumberValues:()=>qo,XYZSizeModeValues:()=>is,XYZStringValues:()=>rs,XYZValues:()=>Wo,_attribute:()=>Vn,_trackReactiveProperty:()=>Dn,addEventListener:()=>pt,applyMaterial:()=>eh,assign:()=>xt,attribute:()=>jn,autorun:()=>Nn,booleanAttribute:()=>Xn,circular:()=>Gn,clamp:()=>uL,classList:()=>ft,clearDelegatedEvents:()=>ut,createChildObserver:()=>jr,createComponent:()=>Be,css:()=>Zn,dashCase:()=>Jr,decoratorAbstraction:()=>zr,defer:()=>Xr,defineElements:()=>YI,delegateEvents:()=>lt,disposeMaterial:()=>Ju,disposeObject:()=>$u,disposeObjectTree:()=>Ku,documentBody:()=>Vr,dynamicProperty:()=>vt,effect:()=>se,element:()=>Yn,emits:()=>U,empty:()=>$r,epsilon:()=>Hr,escape:()=>Yt,generateHydrationScript:()=>Zt,getGlobal:()=>WI,getHydrationKey:()=>It,getNextElement:()=>_t,getNextMarker:()=>Mt,getNextMatch:()=>wt,getOwner:()=>de,hasShadow:()=>ts,html:()=>br,hydrate:()=>Kt,identity:()=>ei,innerHTML:()=>yt,insert:()=>bt,isDisposable:()=>oh,isOrthographicCamera:()=>ih,isPerspectiveCamera:()=>rh,isRenderItem:()=>Zu,isServer:()=>Jt,makeEnumFromClassProperties:()=>qi,memo:()=>ot,mergeProps:()=>He,numberAttribute:()=>qn,observeChildren:()=>Gr,pick:()=>Qr,quaternionApproximateEquals:()=>Qu,reactify:()=>Fn,reactive:()=>In,receiver:()=>Fr,releaseCSS3DRendererThree:()=>WO,releaseWebGLRendererThree:()=>zO,render:()=>at,renderToStream:()=>zt,renderToString:()=>Ut,renderToStringAsync:()=>Ft,resolveSSRNode:()=>Gt,runHydrationEvents:()=>Tt,setAttribute:()=>ht,setAttributeNS:()=>dt,setColorPhongMaterial:()=>nh,setRandomColorPhongMaterial:()=>th,spread:()=>gt,ssr:()=>Ht,ssrBoolean:()=>qt,ssrClassList:()=>jt,ssrHydrationKey:()=>Xt,ssrSpread:()=>Wt,ssrStyle:()=>Vt,stringAttribute:()=>Wn,style:()=>mt,template:()=>ct,thro:()=>Yr,toDegrees:()=>qr,toRadians:()=>Wr,trim:()=>Zr,unique:()=>Kr,untrack:()=>Hn,useDefaultNames:()=>ZI,variable:()=>On,version:()=>nz});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{ArcCurve:()=>YT,CatmullRomCurve3:()=>eS,CubicBezierCurve:()=>iS,CubicBezierCurve3:()=>oS,EllipseCurve:()=>XT,LineCurve:()=>sS,LineCurve3:()=>aS,QuadraticBezierCurve:()=>cS,QuadraticBezierCurve3:()=>lS,SplineCurve:()=>uS});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{BoxBufferGeometry:()=>$p,BoxGeometry:()=>Kp,CircleBufferGeometry:()=>WD,CircleGeometry:()=>qD,ConeBufferGeometry:()=>JD,ConeGeometry:()=>ZD,CylinderBufferGeometry:()=>XD,CylinderGeometry:()=>YD,DodecahedronBufferGeometry:()=>KD,DodecahedronGeometry:()=>QD,EdgesGeometry:()=>ik,ExtrudeBufferGeometry:()=>HS,ExtrudeGeometry:()=>jS,IcosahedronBufferGeometry:()=>ok,IcosahedronGeometry:()=>sk,LatheBufferGeometry:()=>ak,LatheGeometry:()=>ck,OctahedronBufferGeometry:()=>lk,OctahedronGeometry:()=>uk,ParametricBufferGeometry:()=>hk,ParametricGeometry:()=>dk,PlaneBufferGeometry:()=>jT,PlaneGeometry:()=>VT,PolyhedronBufferGeometry:()=>$D,PolyhedronGeometry:()=>pk,RingBufferGeometry:()=>fk,RingGeometry:()=>mk,ShapeBufferGeometry:()=>VS,ShapeGeometry:()=>WS,SphereBufferGeometry:()=>cE,SphereGeometry:()=>lE,TetrahedronBufferGeometry:()=>gk,TetrahedronGeometry:()=>vk,TextBufferGeometry:()=>yk,TextGeometry:()=>bk,TorusBufferGeometry:()=>xk,TorusGeometry:()=>_k,TorusKnotBufferGeometry:()=>wk,TorusKnotGeometry:()=>Mk,TubeBufferGeometry:()=>Tk,TubeGeometry:()=>Sk,WireframeGeometry:()=>Ek});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{LineBasicMaterial:()=>CD,LineDashedMaterial:()=>Pk,Material:()=>Fu,MeshBasicMaterial:()=>Bd,MeshDepthMaterial:()=>qP,MeshDistanceMaterial:()=>XP,MeshLambertMaterial:()=>CE,MeshMatcapMaterial:()=>Ck,MeshNormalMaterial:()=>Lk,MeshPhongMaterial:()=>Yu,MeshPhysicalMaterial:()=>jE,MeshStandardMaterial:()=>GE,MeshToonMaterial:()=>Rk,PointsMaterial:()=>Np,RawShaderMaterial:()=>oO,ShaderMaterial:()=>xA,ShadowMaterial:()=>Ak,SpriteMaterial:()=>tD});var r={};__webpack_require__.r(r),__webpack_require__.d(r,{ACESFilmicToneMapping:()=>oc,AddEquation:()=>Ra,AddOperation:()=>ec,AdditiveAnimationBlendMode:()=>Zl,AdditiveBlending:()=>Ta,AlphaFormat:()=>Fc,AlwaysDepth:()=>Wa,AlwaysStencilFunc:()=>Eu,AmbientLight:()=>wI,AmbientLightProbe:()=>wB,AnimationClip:()=>Wk,AnimationLoader:()=>Zk,AnimationMixer:()=>eU,AnimationObjectGroup:()=>KB,AnimationUtils:()=>Ok,ArcCurve:()=>YT,ArrayCamera:()=>KP,ArrowHelper:()=>VU,Audio:()=>NB,AudioAnalyser:()=>FB,AudioContext:()=>bB,AudioListener:()=>OB,AudioLoader:()=>xB,AxesHelper:()=>WU,AxisHelper:()=>MF,BackSide:()=>ya,BasicDepthPacking:()=>au,BasicShadowMap:()=>pa,BinaryTextureLoader:()=>RF,Bone:()=>ED,BooleanKeyframeTrack:()=>Uk,BoundingBoxHelper:()=>TF,Box2:()=>uU,Box3:()=>Jh,Box3Helper:()=>FU,BoxBufferGeometry:()=>$p,BoxGeometry:()=>Kp,BoxHelper:()=>UU,BufferAttribute:()=>Hd,BufferGeometry:()=>lp,BufferGeometryLoader:()=>lB,ByteType:()=>Rc,Cache:()=>hE,Camera:()=>uA,CameraHelper:()=>DU,CanvasRenderer:()=>PF,CanvasTexture:()=>jD,CatmullRomCurve3:()=>eS,CineonToneMapping:()=>ic,CircleBufferGeometry:()=>WD,CircleGeometry:()=>qD,ClampToEdgeWrapping:()=>mc,Clock:()=>EB,ClosedSplineCurve3:()=>xF,Color:()=>Xu,ColorKeyframeTrack:()=>Fk,CompressedTexture:()=>GD,CompressedTextureLoader:()=>Jk,ConeBufferGeometry:()=>JD,ConeGeometry:()=>ZD,CubeCamera:()=>oC,CubeGeometry:()=>Kp,CubeReflectionMapping:()=>cc,CubeRefractionMapping:()=>lc,CubeTexture:()=>sC,CubeTextureLoader:()=>$k,CubeUVReflectionMapping:()=>dc,CubeUVRefractionMapping:()=>pc,CubicBezierCurve:()=>iS,CubicBezierCurve3:()=>oS,CubicInterpolant:()=>Ik,CullFaceBack:()=>ua,CullFaceFront:()=>ha,CullFaceFrontBack:()=>da,CullFaceNone:()=>la,Curve:()=>qT,CurvePath:()=>hS,CustomBlending:()=>Aa,CustomToneMapping:()=>sc,CylinderBufferGeometry:()=>XD,CylinderGeometry:()=>YD,Cylindrical:()=>cU,DataTexture:()=>jL,DataTexture2DArray:()=>vC,DataTexture3D:()=>yC,DataTextureLoader:()=>Kk,DataUtils:()=>YU,DecrementStencilOp:()=>mu,DecrementWrapStencilOp:()=>vu,DefaultLoadingManager:()=>pE,DepthFormat:()=>Wc,DepthStencilFormat:()=>qc,DepthTexture:()=>VD,DirectionalLight:()=>PI,DirectionalLightHelper:()=>OU,DiscreteInterpolant:()=>kk,DodecahedronBufferGeometry:()=>KD,DodecahedronGeometry:()=>QD,DoubleSide:()=>ba,DstAlphaFactor:()=>Fa,DstColorFactor:()=>Ha,DynamicBufferAttribute:()=>uF,DynamicCopyUsage:()=>Iu,DynamicDrawUsage:()=>Ru,DynamicReadUsage:()=>Pu,EdgesGeometry:()=>ik,EdgesHelper:()=>SF,EllipseCurve:()=>XT,EqualDepth:()=>Ya,EqualStencilFunc:()=>_u,EquirectangularReflectionMapping:()=>uc,EquirectangularRefractionMapping:()=>hc,Euler:()=>lo,EventDispatcher:()=>co,ExtrudeBufferGeometry:()=>HS,ExtrudeGeometry:()=>jS,Face3:()=>kd,Face4:()=>ZU,FaceColors:()=>QU,FileLoader:()=>Yk,FlatShading:()=>xa,Float16BufferAttribute:()=>Zd,Float32Attribute:()=>yF,Float32BufferAttribute:()=>Jd,Float64Attribute:()=>bF,Float64BufferAttribute:()=>$d,FloatType:()=>Nc,Fog:()=>HL,FogExp2:()=>GL,Font:()=>mB,FontLoader:()=>vB,FrontSide:()=>va,Frustum:()=>qL,GLBufferAttribute:()=>rU,GLSL1:()=>ku,GLSL3:()=>Bu,GammaEncoding:()=>tu,Geometry:()=>Jp,GeometryUtils:()=>CF,GreaterDepth:()=>Ja,GreaterEqualDepth:()=>Za,GreaterEqualStencilFunc:()=>Su,GreaterStencilFunc:()=>Mu,GridHelper:()=>AU,Group:()=>QP,HalfFloatType:()=>Ic,HemisphereLight:()=>Qk,HemisphereLightHelper:()=>EU,HemisphereLightProbe:()=>_B,IcosahedronBufferGeometry:()=>ok,IcosahedronGeometry:()=>sk,ImageBitmapLoader:()=>fB,ImageLoader:()=>mE,ImageUtils:()=>vE,ImmediateRenderObject:()=>fU,IncrementStencilOp:()=>fu,IncrementWrapStencilOp:()=>gu,InstancedBufferAttribute:()=>cB,InstancedBufferGeometry:()=>aB,InstancedInterleavedBuffer:()=>nU,InstancedMesh:()=>Wp,Int16Attribute:()=>fF,Int16BufferAttribute:()=>Wd,Int32Attribute:()=>gF,Int32BufferAttribute:()=>Xd,Int8Attribute:()=>hF,Int8BufferAttribute:()=>Gd,IntType:()=>Pc,InterleavedBuffer:()=>KI,InterleavedBufferAttribute:()=>eD,Interpolant:()=>Nk,InterpolateDiscrete:()=>Gl,InterpolateLinear:()=>jl,InterpolateSmooth:()=>Vl,InvertStencilOp:()=>yu,JSONLoader:()=>OF,KeepStencilOp:()=>du,KeyframeTrack:()=>Bk,LOD:()=>bD,LatheBufferGeometry:()=>ak,LatheGeometry:()=>ck,Layers:()=>po,LensFlare:()=>IF,LessDepth:()=>qa,LessEqualDepth:()=>Xa,LessEqualStencilFunc:()=>wu,LessStencilFunc:()=>xu,Light:()=>yI,LightProbe:()=>iB,Line:()=>kD,Line3:()=>pU,LineBasicMaterial:()=>CD,LineCurve:()=>sS,LineCurve3:()=>aS,LineDashedMaterial:()=>Pk,LineLoop:()=>zD,LinePieces:()=>$U,LineSegments:()=>FD,LineStrip:()=>JU,LinearEncoding:()=>Ql,LinearFilter:()=>wc,LinearInterpolant:()=>Dk,LinearMipMapLinearFilter:()=>Ec,LinearMipMapNearestFilter:()=>Tc,LinearMipmapLinearFilter:()=>Sc,LinearMipmapNearestFilter:()=>Mc,LinearToneMapping:()=>nc,Loader:()=>fE,LoaderUtils:()=>sB,LoadingManager:()=>dE,LogLuvEncoding:()=>ru,LoopOnce:()=>Fl,LoopPingPong:()=>Hl,LoopRepeat:()=>zl,LuminanceAlphaFormat:()=>jc,LuminanceFormat:()=>Gc,MOUSE:()=>aa,Material:()=>Fu,MaterialLoader:()=>oB,Math:()=>Zi,MathUtils:()=>Zi,Matrix3:()=>fo,Matrix4:()=>eo,MaxEquation:()=>Oa,Mesh:()=>Ap,MeshBasicMaterial:()=>Bd,MeshDepthMaterial:()=>qP,MeshDistanceMaterial:()=>XP,MeshFaceMaterial:()=>tF,MeshLambertMaterial:()=>CE,MeshMatcapMaterial:()=>Ck,MeshNormalMaterial:()=>Lk,MeshPhongMaterial:()=>Yu,MeshPhysicalMaterial:()=>jE,MeshStandardMaterial:()=>GE,MeshToonMaterial:()=>Rk,MinEquation:()=>Pa,MirroredRepeatWrapping:()=>gc,MixOperation:()=>Qa,MultiMaterial:()=>nF,MultiplyBlending:()=>Ea,MultiplyOperation:()=>Ka,NearestFilter:()=>vc,NearestMipMapLinearFilter:()=>_c,NearestMipMapNearestFilter:()=>bc,NearestMipmapLinearFilter:()=>xc,NearestMipmapNearestFilter:()=>yc,NeverDepth:()=>Va,NeverStencilFunc:()=>bu,NoBlending:()=>wa,NoColors:()=>KU,NoToneMapping:()=>tc,NormalAnimationBlendMode:()=>Yl,NormalBlending:()=>Ma,NotEqualDepth:()=>$a,NotEqualStencilFunc:()=>Tu,NumberKeyframeTrack:()=>zk,Object3D:()=>Ro,ObjectLoader:()=>uB,ObjectSpaceNormalMap:()=>uu,OctahedronBufferGeometry:()=>lk,OctahedronGeometry:()=>uk,OneFactor:()=>Ia,OneMinusDstAlphaFactor:()=>za,OneMinusDstColorFactor:()=>Ga,OneMinusSrcAlphaFactor:()=>Ua,OneMinusSrcColorFactor:()=>ka,OrthographicCamera:()=>iO,PCFShadowMap:()=>fa,PCFSoftShadowMap:()=>ma,PMREMGenerator:()=>bO,ParametricBufferGeometry:()=>hk,ParametricGeometry:()=>dk,Particle:()=>iF,ParticleBasicMaterial:()=>aF,ParticleSystem:()=>oF,ParticleSystemMaterial:()=>cF,Path:()=>dS,PerspectiveCamera:()=>hA,Plane:()=>Td,PlaneBufferGeometry:()=>jT,PlaneGeometry:()=>VT,PlaneHelper:()=>zU,PointCloud:()=>rF,PointCloudMaterial:()=>sF,PointLight:()=>EI,PointLightHelper:()=>wU,Points:()=>Up,PointsMaterial:()=>Np,PolarGridHelper:()=>RU,PolyhedronBufferGeometry:()=>$D,PolyhedronGeometry:()=>pk,PositionalAudio:()=>UB,PropertyBinding:()=>$B,PropertyMixer:()=>zB,QuadraticBezierCurve:()=>cS,QuadraticBezierCurve3:()=>lS,Quaternion:()=>Ji,QuaternionKeyframeTrack:()=>Gk,QuaternionLinearInterpolant:()=>Hk,REVISION:()=>sa,RGBADepthPacking:()=>cu,RGBAFormat:()=>Hc,RGBAIntegerFormat:()=>Kc,RGBA_ASTC_10x10_Format:()=>_l,RGBA_ASTC_10x5_Format:()=>yl,RGBA_ASTC_10x6_Format:()=>bl,RGBA_ASTC_10x8_Format:()=>xl,RGBA_ASTC_12x10_Format:()=>wl,RGBA_ASTC_12x12_Format:()=>Ml,RGBA_ASTC_4x4_Format:()=>ul,RGBA_ASTC_5x4_Format:()=>hl,RGBA_ASTC_5x5_Format:()=>dl,RGBA_ASTC_6x5_Format:()=>pl,RGBA_ASTC_6x6_Format:()=>fl,RGBA_ASTC_8x5_Format:()=>ml,RGBA_ASTC_8x6_Format:()=>gl,RGBA_ASTC_8x8_Format:()=>vl,RGBA_BPTC_Format:()=>Tl,RGBA_ETC2_EAC_Format:()=>ll,RGBA_PVRTC_2BPPV1_Format:()=>sl,RGBA_PVRTC_4BPPV1_Format:()=>ol,RGBA_S3TC_DXT1_Format:()=>el,RGBA_S3TC_DXT3_Format:()=>tl,RGBA_S3TC_DXT5_Format:()=>nl,RGBDEncoding:()=>su,RGBEEncoding:()=>nu,RGBEFormat:()=>Vc,RGBFormat:()=>zc,RGBIntegerFormat:()=>$c,RGBM16Encoding:()=>ou,RGBM7Encoding:()=>iu,RGB_ETC1_Format:()=>al,RGB_ETC2_Format:()=>cl,RGB_PVRTC_2BPPV1_Format:()=>il,RGB_PVRTC_4BPPV1_Format:()=>rl,RGB_S3TC_DXT1_Format:()=>Qc,RGFormat:()=>Zc,RGIntegerFormat:()=>Jc,RawShaderMaterial:()=>oO,Ray:()=>xd,Raycaster:()=>iU,RectAreaLight:()=>nB,RedFormat:()=>Xc,RedIntegerFormat:()=>Yc,ReinhardToneMapping:()=>rc,RepeatWrapping:()=>fc,ReplaceStencilOp:()=>pu,ReverseSubtractEquation:()=>Ca,RingBufferGeometry:()=>fk,RingGeometry:()=>mk,SRGB8_ALPHA8_ASTC_10x10_Format:()=>kl,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Nl,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Il,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Dl,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Bl,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Ul,SRGB8_ALPHA8_ASTC_4x4_Format:()=>Sl,SRGB8_ALPHA8_ASTC_5x4_Format:()=>El,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Al,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Rl,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Ll,SRGB8_ALPHA8_ASTC_8x5_Format:()=>Cl,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Pl,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ol,Scene:()=>IR,SceneUtils:()=>NF,ShaderChunk:()=>ZL,ShaderLib:()=>$L,ShaderMaterial:()=>xA,ShadowMaterial:()=>Ak,Shape:()=>pS,ShapeBufferGeometry:()=>VS,ShapeGeometry:()=>WS,ShapePath:()=>$S,ShapeUtils:()=>US,ShortType:()=>Lc,Skeleton:()=>LD,SkeletonHelper:()=>xU,SkinnedMesh:()=>SD,SmoothShading:()=>_a,Sphere:()=>dd,SphereBufferGeometry:()=>cE,SphereGeometry:()=>lE,Spherical:()=>aU,SphericalHarmonics3:()=>rB,Spline:()=>wF,SplineCurve:()=>uS,SplineCurve3:()=>_F,SpotLight:()=>tB,SpotLightHelper:()=>gU,Sprite:()=>mD,SpriteMaterial:()=>tD,SrcAlphaFactor:()=>Ba,SrcAlphaSaturateFactor:()=>ja,SrcColorFactor:()=>Da,StaticCopyUsage:()=>Nu,StaticDrawUsage:()=>Au,StaticReadUsage:()=>Cu,StereoCamera:()=>SB,StreamCopyUsage:()=>Du,StreamDrawUsage:()=>Lu,StreamReadUsage:()=>Ou,StringKeyframeTrack:()=>jk,SubtractEquation:()=>La,SubtractiveBlending:()=>Sa,TOUCH:()=>ca,TangentSpaceNormalMap:()=>lu,TetrahedronBufferGeometry:()=>gk,TetrahedronGeometry:()=>vk,TextBufferGeometry:()=>yk,TextGeometry:()=>bk,Texture:()=>bE,TextureLoader:()=>_E,TorusBufferGeometry:()=>xk,TorusGeometry:()=>_k,TorusKnotBufferGeometry:()=>wk,TorusKnotGeometry:()=>Mk,Triangle:()=>Dd,TriangleFanDrawMode:()=>Kl,TriangleStripDrawMode:()=>$l,TrianglesDrawMode:()=>Jl,TubeBufferGeometry:()=>Tk,TubeGeometry:()=>Sk,UVMapping:()=>ac,Uint16Attribute:()=>mF,Uint16BufferAttribute:()=>qd,Uint32Attribute:()=>vF,Uint32BufferAttribute:()=>Yd,Uint8Attribute:()=>dF,Uint8BufferAttribute:()=>jd,Uint8ClampedAttribute:()=>pF,Uint8ClampedBufferAttribute:()=>Vd,Uniform:()=>tU,UniformsLib:()=>JL,UniformsUtils:()=>vA,UnsignedByteType:()=>Ac,UnsignedInt248Type:()=>Uc,UnsignedIntType:()=>Oc,UnsignedShort4444Type:()=>Dc,UnsignedShort5551Type:()=>kc,UnsignedShort565Type:()=>Bc,UnsignedShortType:()=>Cc,VSMShadowMap:()=>ga,Vector2:()=>zu,Vector3:()=>$i,Vector4:()=>Ud,VectorKeyframeTrack:()=>Vk,Vertex:()=>lF,VertexColors:()=>eF,VideoTexture:()=>HD,WebGL1Renderer:()=>$I,WebGLCubeRenderTarget:()=>aC,WebGLMultisampleRenderTarget:()=>JI,WebGLRenderTarget:()=>rC,WebGLRenderTargetCube:()=>LF,WebGLRenderer:()=>rO,WebGLUtils:()=>$P,WireframeGeometry:()=>Ek,WireframeHelper:()=>EF,WrapAroundEnding:()=>Xl,XHRLoader:()=>AF,ZeroCurvatureEnding:()=>Wl,ZeroFactor:()=>Na,ZeroSlopeEnding:()=>ql,ZeroStencilOp:()=>hu,sRGBEncoding:()=>eu});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{Aliases:()=>et,AmbientLight:()=>MI,Assets:()=>Dt,AutoLayout:()=>WN,AutoLayoutNode:()=>uI,BasicMaterialBehavior:()=>LE,Behavior:()=>li,Box:()=>DI,BoxGeometryBehavior:()=>Vf,CameraRig:()=>PL,ChildProperties:()=>Qe,Class:()=>y,ClipPlane:()=>Rf,ClipPlanesBehavior:()=>Bf,ColladaModel:()=>HI,ColladaModelBehavior:()=>kA,Css3dRendererThree:()=>VO,CubeLayout:()=>gI,DeclarativeBase:()=>Qo,DefaultBehaviors:()=>Jo,DelegatedEvents:()=>nt,DirectionalLight:()=>II,Dynamic:()=>en,Element:()=>rn,ElementOperations:()=>ia,ErrorBoundary:()=>Ye,EventTypes:()=>Vi,Eventful:()=>k,Events:()=>Wi,FbxModel:()=>GI,FbxModelBehavior:()=>NR,FlickeringOrb:()=>uN,FlickeringOrbs:()=>dN,FlingRotation:()=>yL,For:()=>je,GeometryBehavior:()=>jf,GltfModel:()=>jI,GltfModelBehavior:()=>XR,HtmlNode:()=>Uh,HtmlScene:()=>zL,HydrationScript:()=>Dt,ImperativeBase:()=>Bh,Index:()=>Ve,InstancedMesh:()=>yf,LambertMaterialBehavior:()=>NE,Light:()=>_I,LoadingIcon:()=>mN,Match:()=>Xe,MaterialBehavior:()=>EE,Mesh:()=>Op,MeshBehavior:()=>bf,MixedPlane:()=>kI,MixedPlaneGeometryBehavior:()=>Wf,MixedPlaneMaterialBehavior:()=>IE,Mixin:()=>O,Motor:()=>_s,NoHydration:()=>kt,Node:()=>Vh,ObjModel:()=>VI,ObjModelBehavior:()=>cL,Object3DWithPivot:()=>oa,PerspectiveCamera:()=>FL,PhongMaterialBehavior:()=>HE,PhysicalMaterialBehavior:()=>ZE,Plane:()=>BI,PlaneGeometryBehavior:()=>WT,PlyGeometryBehavior:()=>GT,PointLight:()=>LI,Points:()=>zp,PointsMaterialBehavior:()=>KE,Portal:()=>Qt,ProjectedMaterialBehavior:()=>fA,PropAliases:()=>tt,PropReceiver:()=>Ur,Properties:()=>Ke,PushPaneLayout:()=>vI,RenderableBehavior:()=>Zh,RoundedRectangle:()=>UI,RoundedRectangleGeometryBehavior:()=>ZS,SVGElements:()=>rt,SVGNamespace:()=>it,Scene:()=>aN,ScrollFling:()=>EL,Settable:()=>Sh,ShaderMaterialBehavior:()=>TA,Shape:()=>FI,ShapeGeometryBehavior:()=>rE,Show:()=>We,Sizeable:()=>Bs,Sphere:()=>zI,SphereGeometryBehavior:()=>uE,StandardMaterialBehavior:()=>qE,Suspense:()=>$e,SuspenseList:()=>Je,Switch:()=>qe,THREE:()=>tz,Transformable:()=>Xs,TreeNode:()=>ns,WebglRendererThree:()=>FO,WithChildren:()=>Zo,XYZAnyValues:()=>qI,XYZNonNegativeValues:()=>os,XYZNumberValues:()=>qo,XYZSizeModeValues:()=>is,XYZStringValues:()=>rs,XYZValues:()=>Wo,_attribute:()=>Vn,_trackReactiveProperty:()=>Dn,addEventListener:()=>pt,applyMaterial:()=>eh,assign:()=>xt,attribute:()=>jn,autorun:()=>Nn,booleanAttribute:()=>Xn,circular:()=>Gn,clamp:()=>uL,classList:()=>ft,clearDelegatedEvents:()=>ut,createChildObserver:()=>jr,createComponent:()=>Be,css:()=>Zn,dashCase:()=>Jr,decoratorAbstraction:()=>zr,defer:()=>Xr,defineElements:()=>YI,delegateEvents:()=>lt,disposeMaterial:()=>Ju,disposeObject:()=>$u,disposeObjectTree:()=>Ku,documentBody:()=>Vr,dynamicProperty:()=>vt,effect:()=>se,element:()=>Yn,emits:()=>U,empty:()=>$r,epsilon:()=>Hr,escape:()=>Yt,generateHydrationScript:()=>Zt,getGlobal:()=>WI,getHydrationKey:()=>It,getNextElement:()=>_t,getNextMarker:()=>Mt,getNextMatch:()=>wt,getOwner:()=>de,hasShadow:()=>ts,html:()=>br,hydrate:()=>Kt,identity:()=>ei,innerHTML:()=>yt,insert:()=>bt,isDisposable:()=>oh,isOrthographicCamera:()=>ih,isPerspectiveCamera:()=>rh,isRenderItem:()=>Zu,isServer:()=>Jt,makeEnumFromClassProperties:()=>qi,memo:()=>ot,mergeProps:()=>He,numberAttribute:()=>qn,observeChildren:()=>Gr,pick:()=>Qr,quaternionApproximateEquals:()=>Qu,reactify:()=>Fn,reactive:()=>In,receiver:()=>Fr,releaseCSS3DRendererThree:()=>WO,releaseWebGLRendererThree:()=>zO,render:()=>at,renderToStream:()=>zt,renderToString:()=>Ut,renderToStringAsync:()=>Ft,resolveSSRNode:()=>Gt,runHydrationEvents:()=>Tt,setAttribute:()=>ht,setAttributeNS:()=>dt,setColorPhongMaterial:()=>nh,setRandomColorPhongMaterial:()=>th,spread:()=>gt,ssr:()=>Ht,ssrBoolean:()=>qt,ssrClassList:()=>jt,ssrHydrationKey:()=>Xt,ssrSpread:()=>Wt,ssrStyle:()=>Vt,stringAttribute:()=>Wn,style:()=>mt,template:()=>ct,thro:()=>Yr,toDegrees:()=>qr,toRadians:()=>Wr,trim:()=>Zr,unique:()=>Kr,untrack:()=>Hn,useDefaultNames:()=>ZI,variable:()=>On,version:()=>nz});var o=__webpack_require__(63);const s=["subclass","extends",...Object.getOwnPropertyNames(new Function)],a=new WeakMap,c=new WeakMap,l=new o.Ie,u=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m={mode:"es5",nativeNaming:!1,prototypeWritable:!1,defaultClassDescriptor:{writable:!0,enumerable:!1,configurable:!0},setClassDescriptors:!0};class g extends Error{}class v extends Error{}const y=function(e){(e=e?{...m,...e}:m).defaultClassDescriptor={...m.defaultClassDescriptor,...e.defaultClassDescriptor};const{mode:t,prototypeWritable:n,setClassDescriptors:r,nativeNaming:i}=e;function l(...e){let t=!1;if("function"==typeof this&&(t=!0),e.length<=3){let n="",r=null,i=null;"string"==typeof e[0]?n=e[0]:"function"!=typeof e[0]&&"object"!=typeof e[0]||(r=e[0],i=e[1]),"function"!=typeof e[1]&&"object"!=typeof e[1]||(r=e[1],i=e[2]);const o=t?u.call(this,n,r,i):u(n,r,i);return o.extends=function(e,t,o){return t=t||r,o=o||i,u.call(e,n,t,o)},o}throw new TypeError("invalid args")}return l;function u(u,m,g){let v=this;if("string"!=typeof u)throw new TypeError("\n                You must specify a string for the 'className' argument.\n            ");let y=null;if(m&&"object"==typeof m)y=m;else if(!v&&(!m||"function"!=typeof m&&"object"!=typeof m)){let e;return i&&u?e=new Function(`return function ${u}() {}`)():(e=function(){},u&&(0,o.q$)(e,"name",{value:u})),e.prototype={__proto__:Object.prototype,constructor:e},(0,o.q$)(e,"subclass",{value:l,writable:!0,enumerable:!1,configurable:!1}),e}const _=g?void 0:new o.Ie;g&&(f.get(g)||f.set(g,new o.Ie));const w={className:u,get publicToPrivate(){return _||f.get(g)},classBrand:g=g||{brand:"lexical"},cachedPublicAccesses:new WeakMap,cachedProtectedAccesses:new WeakMap,cachedPrivateAccesses:new WeakMap},T=new WeakMap,S=R.bind(null,T,w),E=b.bind(null,w),A=x.bind(null,w),L=M.bind(null,w);if(E.prototype={},A.prototype={},L.prototype={},E.Public=E,E.Protected=A,E.Private=L,E.Super=S,A.Public=E,A.Protected=A,A.Private=L,A.Super=S,y=y||m&&m(E,A,L,S),y&&"object"!=typeof y&&"function"!=typeof y)throw new TypeError("\n                The return value of a class definer function, if any, should be\n                an object, or a class constructor.\n            ");let C,P=null;"function"==typeof y&&(P=y,y=y.prototype,v=P.prototype.__proto__.constructor),y&&(C=y.static,delete y.static,"function"==typeof y.public&&(y.public=y.public(A,L)),"function"==typeof y.protected&&(y.protected=y.protected(E,L)),"function"==typeof y.private&&(y.private=y.private(E,A))),v=v||Object;const O=v.prototype,N=y&&y.public||y||Object.create(O);N.__proto__!==O&&(N.__proto__=O);const I=function(e){let t,n=e;for(;n&&!t;)t=a.get(n),n=n.__proto__;return t||{}}(O),D=y&&y.protected||Object.create(I);D.__proto__!==I&&(D.__proto__=I),a.set(N,D);const k=function(e){let t,n=e;for(;n&&!t;)t=c.get(n),n=n.__proto__;return t||{}}(O),B=y&&y.private||Object.create(k);if(B.__proto__!==k&&(B.__proto__=k),c.set(N,B),h.get(g)||h.set(g,new Set),d.get(g)||d.set(g,new Set),p.get(g)||p.set(g,new Set),h.get(g).add(N),d.get(g).add(D),p.get(g).add(B),w.publicPrototype=N,w.privatePrototype=B,w.protectedPrototype=D,w.parentPublicPrototype=O,w.parentProtectedPrototype=I,w.parentPrivatePrototype=k,(0,o.Gm)(E.prototype,N),(0,o.Gm)(A.prototype,D),(0,o.Gm)(L.prototype,B),y&&(delete y.public,delete y.protected,delete y.private,y!==N&&(0,o.Gm)(y,N)),P)return C&&(0,o.Gm)(C,P),P;const U=N.hasOwnProperty("constructor")?N.constructor:null;let F,z=null;if("es5"!==t)throw new TypeError("\n                The lowclass \"mode\" option can only be 'es5' for now.\n            ");if(F=function(){let e=null,t=null;return t=U||v,t!==Object&&(e=t.apply(this,arguments)),!e||"object"!=typeof e&&"function"!=typeof e?this:e},z=N,u)if(i){const e=(0,o.Sh)(F),t=F.prototype;F=new Function(" userConstructor, ParentClass ",`\n                    return function ${u}() { ${e} }\n                `)(U,v),F.prototype=t}else(0,o.q$)(F,"name",{value:u});return U&&U.length&&(0,o.q$)(F,"length",{value:U.length}),F.__proto__=v,C&&(0,o.Gm)(C,F),(0,o.q$)(F,"subclass",{value:l,writable:!0,enumerable:!1,configurable:!1}),F.prototype=z,F.prototype.constructor=F,r&&((0,o.U8)(F,e,s),(0,o.q$)(F,"prototype",{writable:n}),(0,o.Md)(F.prototype,e),(0,o.Md)(D,e),(0,o.Md)(B,e)),w.constructor=F,F}}();function b(e,t){let n=e.cachedPublicAccesses.get(t);return n||(A(e,t)?e.cachedPublicAccesses.set(t,n=_(t).publicToPrivate.get(t)):E(e,t)?e.cachedPublicAccesses.set(t,n=l.get(t)):e.cachedPublicAccesses.set(t,n=t),n)}function x(e,t){let n=e.cachedProtectedAccesses.get(t);if(n)return n;if(S(e,t))e.cachedProtectedAccesses.set(t,n=l.get(t)||w(t));else if(A(e,t)){const r=_(t).publicToPrivate.get(t);e.cachedProtectedAccesses.set(t,n=l.get(r)||w(r))}else E(e,t)&&e.cachedProtectedAccesses.set(t,n=t);if(!n)throw new v("invalid access of protected member");return n}function _(e){return u.get(e)}function w(e){const t=function(e){let t=null,n=e.__proto__;for(;n;){if(t=a.get(n),t)return t;n=n.__proto__}return t}(e),n=Object.create(t);return l.set(e,n),n}function M(e,t){let n=e.cachedPrivateAccesses.get(t);if(n)return n;if(S(e,t))e.cachedPrivateAccesses.set(t,n=e.publicToPrivate.get(t)||T(e,t));else if(E(e,t)){const r=l.get(t);e.cachedPrivateAccesses.set(t,n=e.publicToPrivate.get(r)||T(e,r))}else A(e,t)&&e.cachedPrivateAccesses.set(t,n=t);if(!n)throw new v("invalid access of private member");return n}function T(e,t){const n=Object.create(e.privatePrototype);return e.publicToPrivate.set(t,n),u.set(n,e),n}function S(e,t,n=!0){if(!n)return(0,o.nk)(t,e.publicPrototype);for(const n of Array.from(h.get(e.classBrand)))if((0,o.nk)(t,n))return!0;return!1}function E(e,t,n=!0){if(!n)return(0,o.nk)(t,e.protectedPrototype);for(const n of Array.from(d.get(e.classBrand)))if((0,o.nk)(t,n))return!0;return!1}function A(e,t,n=!0){if(!n)return(0,o.nk)(t,e.privatePrototype);for(const n of Array.from(p.get(e.classBrand)))if((0,o.nk)(t,n))return!0;return!1}function R(e,t,n){const{parentPublicPrototype:r,parentProtectedPrototype:i,parentPrivatePrototype:o}=t;if(S(t,n,!1))return L(n,r,e);if(E(t,n,!1))return L(n,i,e);if(A(t,n,!1))return L(n,o,e);throw new g("invalid super access")}function L(e,t,n){let r=n.get(e);if(!r){n.set(e,r=Object.create(t));const i=(0,o.yA)(t);let s=i.length;for(;s--;){const n=i[s];(0,o.q$)(r,n,{get:function(){let r;const i=(0,o.ld)(t,n);if(i&&(0,o.uh)(i)){const t=i.get;t&&(r=t.call(e))}else r=t[n];return r&&r.call&&"function"==typeof r&&(r=r.bind(e)),r},set:function(r){const i=(0,o.ld)(t,n);if(i&&(0,o.uh)(i)){const t=i.set;t&&(r=t.call(e,r))}else e[n]=r}},!0)}}return r}const C=y;var P;!function(e){e.PROXIES_ON_INSTANCE_AND_PROTOTYPE="PROXIES_ON_INSTANCE_AND_PROTOTYPE",e.PROXIES_ON_PROTOTYPE="PROXIES_ON_PROTOTYPE",e.PROXY_AFTER_INSTANCE_AND_PROTOTYPE="PROXY_AFTER_INSTANCE_AND_PROTOTYPE"}(P||(P={})),P.PROXIES_ON_INSTANCE_AND_PROTOTYPE;new WeakMap;function O(e,t){var n,r;return e=function(e){const t=new WeakMap;return N(e.name,(n=>{let r=t.get(n);return r||t.set(n,r=e(n)),r}))}(e),e=function(e){let t;return N(e.name,(n=>{const r=e(n);return"undefined"!=typeof Symbol&&Symbol.hasInstance?(Object.getOwnPropertySymbols(r).includes(Symbol.hasInstance)||(t||(t=Symbol("instanceofSymbol")),r[t]=!0,Object.defineProperty(r,Symbol.hasInstance,{value:function(e){if(this!==r)return r.__proto__[Symbol.hasInstance].call(this,e);let n=e;for(;n;){const e=Object.getOwnPropertyDescriptor(n,"constructor");if(e&&e.value&&e.value.hasOwnProperty(t))return!0;n=n.__proto__}return!1}})),r):r}))}(e),e=function(e){const t=new WeakMap;return N(e.name,(n=>{if(function(e,t,n){for(;e;){if(n.get(e)===t)return!0;e=e.__proto__}return!1}(n,e,t))return n;const r=e(n);return t.set(r,e),r}))}(e),n=e,r=t||C(),(e=function(e){return e().mixin=e,e}(e=N(n.name,(e=>n(e=e||r)))))()}function N(e,t){try{Object.defineProperty(t,"name",{...Object.getOwnPropertyDescriptor(t,"name"),value:e})}catch(e){}return t}__webpack_require__(495);var I=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},D=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};function k(e=Object){var t,n;class r extends e{constructor(){super(...arguments),this[n]=B,t.set(this,null)}on(e,n,r){let i=I(this,t,"f");if("function"!=typeof n)throw new Error("Expected a function in callback argument of Eventful#on.");i||(i=D(this,t,new Map,"f"));let o=i.get(e);o||i.set(e,o=[]),o.push([n,r])}off(e,n,r){const i=I(this,t,"f");if(!i)return;const o=i.get(e);if(!o)return;const s=o.findIndex((e=>e[0]===n&&e[1]===r));-1!==s&&(o.splice(s,1),0===o.length&&i.delete(e),0===i.size&&D(this,t,null,"f"))}emit(e,n){const r=I(this,t,"f");if(!r)return;const i=r.get(e);if(!i)return;let o,s,a;for(let e=0,t=i.length;e<t;e+=1)o=i[e],s=o[0],a=o[1],s.call(a,n)}}return t=new WeakMap,n=B,r.prototype[B]=B,r}const B=Symbol("isEventful");function U(e){return(t,n,r)=>function(e,t,n,r){if(!(e instanceof k))throw new TypeError("The @emits decorator is only for use on properties of classes that extend from Eventful.");const i=Symbol("@emits: "+t);let o=!1;n||(o=!0,n=Object.getOwnPropertyDescriptor(e,t));let s,a,c,l,u=!1;if(n)if(n.get||n.set){if(u=!0,s=n.get,a=n.set,!a)return void console.warn('The `@emits` decorator was used on an accessor named "'+t+"\" which did not have a setter. This means an event will never be emitted because the value can not be set. In this case the decorator doesn't do anything.");delete n.get,delete n.set}else{if(c=n.value,l=n.writable,!l)return void console.warn('The `@emits` decorator was used on a property named "'+t+'" that is not writable. An event can not be emitted because the property can not be modified. In this case the decorator does not do anything.');delete n.value,delete n.writable}let h=!1;function d(){this.emit(r,t)}if(n={...n,configurable:!0,...u?s?{get(){return s.call(this)}}:{}:{get(){return h?this[i]:(h=!0,this[i]=c)}},...u?{set(e){a.call(this,e),Promise.resolve().then(d.bind(this))}}:{set(e){h||(h=!0),this[i]=e,Promise.resolve().then(d.bind(this))}}},!o)return n;Object.defineProperty(e,t,n)}(t,n,null!=r?r:void 0,e)}Object.defineProperty(k,Symbol.hasInstance,{value:e=>!!e&&!!e[B]});const F={};function z(e){F.context=e}const H=Symbol("solid-proxy"),G=(Symbol("solid-dev-component"),{equals:(e,t)=>e===t});let j=null,V=Te;const W={},q={owned:null,cleanups:null,context:null,owner:null},[X,Y]=ie(!1);var Z=null;let J,$=null,K=null,Q=null,ee=null,te=null,ne=0;function re(e,t){const n=K,r=Z,i=0===e.length?q:{owned:null,cleanups:null,context:null,owner:t||r};Z=i,K=null;try{return Me((()=>e((()=>Re(i)))),!0)}finally{K=n,Z=r}}function ie(e,t){t=t?Object.assign({},G,t):G;const n={value:e,observers:null,observerSlots:null,pending:W,comparator:t.equals||void 0};return[ve.bind(n),e=>("function"==typeof e&&(e=$&&$.running&&$.sources.has(n)?e(n.pending!==W?n.pending:n.tValue):e(n.pending!==W?n.pending:n.value)),ye(n,e))]}function oe(e,t,n){const r=_e(e,t,!0,1);be(r)}function se(e,t,n){const r=_e(e,t,!1,1);be(r)}function ae(e,t,n){V=Se;const r=_e(e,t,!1,1),i=J&&Pe(Z,J.id);i&&(r.suspense=i),r.user=!0,te?te.push(r):queueMicrotask((()=>be(r)))}function ce(e,t,n){n=n?Object.assign({},G,n):G;const r=_e(e,t,!0,0);return r.pending=W,r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,be(r),ve.bind(r)}function le(e){if(Q)return e();let t;const n=Q=[];try{t=e()}finally{Q=null}return Me((()=>{for(let e=0;e<n.length;e+=1){const t=n[e];if(t.pending!==W){const e=t.pending;t.pending=W,ye(t,e)}}}),!1),t}function ue(e){let t,n=K;return K=null,t=e(),K=n,t}function he(e){return null===Z||(null===Z.cleanups?Z.cleanups=[e]:Z.cleanups.push(e)),e}function de(){return Z}function pe(e){const t=Symbol("context");return{id:t,Provider:Ne(t),defaultValue:e}}function fe(e){let t;return void 0!==(t=Pe(Z,e.id))?t:e.defaultValue}function me(e){const t=ce(e);return ce((()=>Oe(t())))}function ge(){return J||(J=pe({}))}function ve(){const e=$&&$.running;if(this.sources&&(!e&&this.state||e&&this.tState)){const t=ee;ee=null,!e&&1===this.state||e&&1===this.tState?be(this):Ee(this),ee=t}if(K){const e=this.observers?this.observers.length:0;K.sources?(K.sources.push(this),K.sourceSlots.push(e)):(K.sources=[this],K.sourceSlots=[e]),this.observers?(this.observers.push(K),this.observerSlots.push(K.sources.length-1)):(this.observers=[K],this.observerSlots=[K.sources.length-1])}return e&&$.sources.has(this)?this.tValue:this.value}function ye(e,t,n){if(Q)return e.pending===W&&Q.push(e),e.pending=t,t;if(e.comparator)if($&&$.running&&$.sources.has(e)){if(e.comparator(e.tValue,t))return t}else if(e.comparator(e.value,t))return t;let r=!1;return $?(r=$.running,(r||!n&&$.sources.has(e))&&($.sources.add(e),e.tValue=t),r||(e.value=t)):e.value=t,e.observers&&e.observers.length&&Me((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];r&&$.disposed.has(n)||((r&&!n.tState||!r&&!n.state)&&(n.pure?ee.push(n):te.push(n),n.observers&&Ae(n)),r?n.tState=1:n.state=1)}if(ee.length>1e6)throw ee=[],new Error}),!1),t}function be(e){if(!e.fn)return;Re(e);const t=Z,n=K,r=ne;K=Z=e,xe(e,$&&$.running&&$.sources.has(e)?e.tValue:e.value,r),$&&!$.running&&$.sources.has(e)&&queueMicrotask((()=>{Me((()=>{$&&($.running=!0),xe(e,e.tValue,r)}),!1)})),K=n,Z=t}function xe(e,t,n){let r;try{r=e.fn(t)}catch(e){Ce(e)}(!e.updatedAt||e.updatedAt<=n)&&(e.observers&&e.observers.length?ye(e,r,!0):$&&$.running&&e.pure?($.sources.add(e),e.tValue=r):e.value=r,e.updatedAt=n)}function _e(e,t,n,r=1,i){const o={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Z,context:null,pure:n};return $&&$.running&&(o.state=0,o.tState=r),null===Z||Z!==q&&($&&$.running&&Z.pure?Z.tOwned?Z.tOwned.push(o):Z.tOwned=[o]:Z.owned?Z.owned.push(o):Z.owned=[o]),o}function we(e){const t=$&&$.running;if(!t&&0===e.state||t&&0===e.tState)return;if(!t&&2===e.state||t&&2===e.tState)return Ee(e);if(e.suspense&&ue(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ne);){if(t&&$.disposed.has(e))return;(!t&&e.state||t&&e.tState)&&n.push(e)}for(let r=n.length-1;r>=0;r--){if(e=n[r],t){let t=e,i=n[r+1];for(;(t=t.owner)&&t!==i;)if($.disposed.has(t))return}if(!t&&1===e.state||t&&1===e.tState)be(e);else if(!t&&2===e.state||t&&2===e.tState){const t=ee;ee=null,Ee(e,n[0]),ee=t}}}function Me(e,t){if(ee)return e();let n=!1;t||(ee=[]),te?n=!0:te=[],ne++;try{return e()}catch(e){Ce(e)}finally{!function(e){if(ee&&(Te(ee),ee=null),e)return;let t;if($&&$.running){if($.promises.size||$.queue.size)return $.running=!1,$.effects.push.apply($.effects,te),te=null,void Y(!0);const e=$.sources;t=$.resolve,te.forEach((e=>{"tState"in e&&(e.state=e.tState),delete e.tState})),$=null,le((()=>{e.forEach((e=>{if(e.value=e.tValue,e.owned)for(let t=0,n=e.owned.length;t<n;t++)Re(e.owned[t]);e.tOwned&&(e.owned=e.tOwned),delete e.tValue,delete e.tOwned,e.tState=0})),Y(!1)}))}te.length?le((()=>{V(te),te=null})):te=null,t&&t()}(n)}}function Te(e){for(let t=0;t<e.length;t++)we(e[t])}function Se(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:we(r)}const r=e.length;for(t=0;t<n;t++)we(e[t]);for(t=r;t<e.length;t++)we(e[t])}function Ee(e,t){const n=$&&$.running;n?e.tState=0:e.state=0;for(let r=0;r<e.sources.length;r+=1){const i=e.sources[r];i.sources&&(!n&&1===i.state||n&&1===i.tState?i!==t&&we(i):(!n&&2===i.state||n&&2===i.tState)&&Ee(i,t))}}function Ae(e){const t=$&&$.running;for(let n=0;n<e.observers.length;n+=1){const r=e.observers[n];(!t&&!r.state||t&&!r.tState)&&(t?r.tState=2:r.state=2,r.pure?ee.push(r):te.push(r),r.observers&&Ae(r))}}function Re(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){const e=r.pop(),i=t.observerSlots.pop();n<r.length&&(e.sourceSlots[i]=n,r[n]=e,t.observerSlots[n]=i)}}if($&&$.running&&e.pure){if(e.tOwned){for(t=0;t<e.tOwned.length;t++)Re(e.tOwned[t]);delete e.tOwned}Le(e,!0)}else if(e.owned){for(t=0;t<e.owned.length;t++)Re(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}$&&$.running?e.tState=0:e.state=0,e.context=null}function Le(e,t){if(t||(e.tState=0,$.disposed.add(e)),e.owned)for(let t=0;t<e.owned.length;t++)Le(e.owned[t])}function Ce(e){const t=j&&Pe(Z,j);if(!t)throw e;t.forEach((t=>t(e)))}function Pe(e,t){return e?e.context&&void 0!==e.context[t]?e.context[t]:Pe(e.owner,t):void 0}function Oe(e){if("function"==typeof e&&!e.length)return Oe(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=Oe(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Ne(e){return function(t){let n;return oe((()=>n=ue((()=>(Z.context={[e]:t.value},me((()=>t.children))))))),n}}const Ie=Symbol("fallback");function De(e){for(let t=0;t<e.length;t++)e[t]()}let ke=!1;function Be(e,t){if(ke&&F.context){const n=F.context;z({...F.context,id:`${F.context.id}${F.context.count++}-`,count:0});const r=ue((()=>e(t)));return z(n),r}return ue((()=>e(t)))}function Ue(){return!0}const Fe={get:(e,t,n)=>t===H?n:e.get(t),has:(e,t)=>e.has(t),set:Ue,deleteProperty:Ue,getOwnPropertyDescriptor:(e,t)=>({configurable:!0,enumerable:!0,get:()=>e.get(t),set:Ue,deleteProperty:Ue}),ownKeys:e=>e.keys()};function ze(e){return"function"==typeof e?e():e}function He(...e){return new Proxy({get(t){for(let n=e.length-1;n>=0;n--){const r=ze(e[n])[t];if(void 0!==r)return r}},has(t){for(let n=e.length-1;n>=0;n--)if(t in ze(e[n]))return!0;return!1},keys(){const t=[];for(let n=0;n<e.length;n++)t.push(...Object.keys(ze(e[n])));return[...new Set(t)]}},Fe)}let Ge;function je(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ce(function(e,t,n={}){let r=[],i=[],o=[],s=0,a=t.length>1?[]:null;return he((()=>De(o))),()=>{let c,l,u=e()||[];return ue((()=>{let e,t,d,p,f,m,g,v,y,b=u.length;if(0===b)0!==s&&(De(o),o=[],r=[],i=[],s=0,a&&(a=[])),n.fallback&&(r=[Ie],i[0]=re((e=>(o[0]=e,n.fallback()))),s=1);else if(0===s){for(i=new Array(b),l=0;l<b;l++)r[l]=u[l],i[l]=re(h);s=b}else{for(d=new Array(b),p=new Array(b),a&&(f=new Array(b)),m=0,g=Math.min(s,b);m<g&&r[m]===u[m];m++);for(g=s-1,v=b-1;g>=m&&v>=m&&r[g]===u[v];g--,v--)d[v]=i[g],p[v]=o[g],a&&(f[v]=a[g]);for(e=new Map,t=new Array(v+1),l=v;l>=m;l--)y=u[l],c=e.get(y),t[l]=void 0===c?-1:c,e.set(y,l);for(c=m;c<=g;c++)y=r[c],l=e.get(y),void 0!==l&&-1!==l?(d[l]=i[c],p[l]=o[c],a&&(f[l]=a[c]),l=t[l],e.set(y,l)):o[c]();for(l=m;l<b;l++)l in d?(i[l]=d[l],o[l]=p[l],a&&(a[l]=f[l],a[l](l))):i[l]=re(h);i=i.slice(0,s=b),r=u.slice(0)}return i}));function h(e){if(o[l]=e,a){const[e,n]=ie(l);return a[l]=n,t(u[l],e)}return t(u[l])}}}((()=>e.each),e.children,t||void 0))}function Ve(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ce(function(e,t,n={}){let r,i=[],o=[],s=[],a=[],c=0;return he((()=>De(s))),()=>{const l=e()||[];return ue((()=>{if(0===l.length)return 0!==c&&(De(s),s=[],i=[],o=[],c=0,a=[]),n.fallback&&(i=[Ie],o[0]=re((e=>(s[0]=e,n.fallback()))),c=1),o;for(i[0]===Ie&&(s[0](),s=[],i=[],o=[],c=0),r=0;r<l.length;r++)r<i.length&&i[r]!==l[r]?a[r]((()=>l[r])):r>=i.length&&(o[r]=re(u));for(;r<i.length;r++)s[r]();return c=a.length=s.length=l.length,i=l.slice(0),o=o.slice(0,c)}));function u(e){s[r]=e;const[n,i]=ie(l[r]);return a[r]=i,t(n,r)}}}((()=>e.each),e.children,t||void 0))}function We(e){let t=!1;const n=ce((()=>e.when),void 0,{equals:(e,n)=>t?e===n:!e==!n});return ce((()=>{const r=n();if(r){const n=e.children;return(t="function"==typeof n&&n.length>0)?ue((()=>n(r))):n}return e.fallback}))}function qe(e){let t=!1;const n=me((()=>e.children)),r=ce((()=>{let e=n();Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++){const n=e[t].when;if(n)return[t,n,e[t]]}return[-1]}),void 0,{equals:(e,n)=>e[0]===n[0]&&(t?e[1]===n[1]:!e[1]==!n[1])&&e[2]===n[2]});return ce((()=>{const[n,i,o]=r();if(n<0)return e.fallback;const s=o.children;return(t="function"==typeof s&&s.length>0)?ue((()=>s(i))):s}))}function Xe(e){return e}function Ye(e){let t;F.context&&F.load&&(t=F.load(F.context.id+F.context.count));const[n,r]=ie(t);let i;return Ge||(Ge=new Set),Ge.add(r),he((()=>Ge.delete(r))),ce((()=>{if(null!=(i=n())){const t=e.fallback;return"function"==typeof t&&t.length?ue((()=>t(i,(()=>r(null))))):t}var t;return t=r,j||(j=Symbol("error")),null===Z||(null===Z.context?Z.context={[j]:[t]}:Z.context[j]?Z.context[j].push(t):Z.context[j]=[t]),e.children}))}const Ze=pe();function Je(e){let t,n,r,i=0;const o=fe(Ze);if(o){const[e,i]=ie(!1);t=i,[n,r]=o.register(e)}const s=[],a=Be(Ze.Provider,{value:{register:e=>{const[t,n]=ie(!1),[r,o]=ie(!1);return s[i++]={inFallback:e,showContent:n,showFallback:o},[t,r]}},get children(){return e.children}});return oe((()=>{const i=e.revealOrder,o=e.tail,a=!n||n(),c=!r||r(),l="backwards"===i;if("together"===i){const e=s.every((e=>!e.inFallback()));return t&&t(!e),void s.forEach((t=>{t.showContent(e&&a),t.showFallback(c)}))}let u=!1;for(let e=0,n=s.length;e<n;e++){const r=l?n-e-1:e,i=s[r].inFallback();if(u||i){const e=!u;e&&t&&t(!0),!o||e&&"collapsed"===o?s[r].showFallback(c):s[r].showFallback(!1),u=!0,s[r].showContent(e)}else s[r].showContent(a),s[r].showFallback(c)}!u&&t&&t(!1)})),a}function $e(e){let t,n,r,i,o,s,a=0;const[c,l]=ie(!1),u=ge(),h={increment:()=>{1==++a&&l(!0)},decrement:()=>{0==--a&&l(!1)},inFallback:c,effects:[],resolved:!1},d=de();if(F.context){const e=F.context.id+F.context.count;if(i=F.load(e),i){"object"==typeof i&&"then"in i||(i=Promise.resolve(i));const[t,n]=ie(void 0,{equals:!1});o=t,i.then((t=>{if(s=t)return n();F.gather(e),z(r),n(),z()}))}}const p=fe(Ze);let f;return p&&([t,n]=p.register(h.inFallback)),he((()=>f&&f())),Be(u.Provider,{value:h,get children(){return ce((()=>{if(s)throw s;if(r=F.context,o)return o(),o=void 0;r&&void 0===i&&z();const a=ue((()=>e.children));return ce((()=>{const o=h.inFallback(),s=!t||t(),c=!n||n();return f&&f(),o&&void 0===i||!s?c?re((t=>(f=t,r&&(z({id:r.id+"f",count:0}),r=void 0),e.fallback)),d):void 0:(h.resolved=!0,r=i=void 0,l=h.effects,te.push.apply(te,l),l.length=0,a);var l}))}))}})}const Ke=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline","allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"]),Qe=new Set(["innerHTML","textContent","innerText","children"]),et={className:"class",htmlFor:"for"},tt={class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"},nt=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),rt=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),it={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function ot(e,t){return ce(e,void 0,t?void 0:{equals:t})}const st="_$DX_DELEGATE";function at(e,t,n){let r;return re((i=>{r=i,t===document?e():bt(t,e(),t.firstChild?null:void 0,n)})),()=>{r(),t.textContent=""}}function ct(e,t,n){const r=document.createElement("template");r.innerHTML=e;let i=r.content.firstChild;return n&&(i=i.firstChild),i}function lt(e,t=window.document){const n=t[st]||(t[st]=new Set);for(let r=0,i=e.length;r<i;r++){const i=e[r];n.has(i)||(n.add(i),t.addEventListener(i,At))}}function ut(e=window.document){if(e[st]){for(let t of e[st].keys())e.removeEventListener(t,At);delete e[st]}}function ht(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function dt(e,t,n,r){null==r?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,r)}function pt(e,t,n,r){r?Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n:Array.isArray(n)?e.addEventListener(t,(e=>n[0](n[1],e))):e.addEventListener(t,n)}function ft(e,t,n={}){const r=Object.keys(t||{}),i=Object.keys(n);let o,s;for(o=0,s=i.length;o<s;o++){const r=i[o];r&&"undefined"!==r&&!t[r]&&(St(e,r,!1),delete n[r])}for(o=0,s=r.length;o<s;o++){const i=r[o],s=!!t[i];i&&"undefined"!==i&&n[i]!==s&&s&&(St(e,i,!0),n[i]=s)}return n}function mt(e,t,n={}){const r=e.style;if(null==t||"string"==typeof t)return r.cssText=t;let i,o;for(o in"string"==typeof n&&(n={}),n)null==t[o]&&r.removeProperty(o),delete n[o];for(o in t)i=t[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function gt(e,t,n,r){"function"==typeof t?se((i=>Rt(e,t(),i,n,r))):Rt(e,t,void 0,n,r)}function vt(e,t){const n=e[t];return Object.defineProperty(e,t,{get:()=>n(),enumerable:!0}),e}function yt(e,t){!F.context&&(e.innerHTML=t)}function bt(e,t,n,r){if(void 0===n||r||(r=[]),"function"!=typeof t)return Lt(e,t,r,n);se((r=>Lt(e,t(),r,n)),r)}function xt(e,t,n,r,i={}){for(const r in i)if(!(r in t)){if("children"===r)continue;Et(e,r,null,i[r],n)}for(const o in t){if("children"===o){r||Lt(e,t.children);continue}const s=t[o];i[o]=Et(e,o,s,i[o],n)}}function _t(e){let t,n;return F.context&&(t=F.registry.get(n=It()))?(F.completed&&F.completed.add(t),F.registry.delete(n),t):e.cloneNode(!0)}function wt(e,t){for(;e&&e.localName!==t;)e=e.nextSibling;return e}function Mt(e){let t=e,n=0,r=[];if(F.context)for(;t;){if(8===t.nodeType){const e=t.nodeValue;if("#"===e)n++;else if("/"===e){if(0===n)return[t,r];n--}}r.push(t),t=t.nextSibling}return[t,r]}function Tt(){F.events&&!F.events.queued&&(queueMicrotask((()=>{const{completed:e,events:t}=F;for(t.queued=!1;t.length;){const[n,r]=t[0];if(!e.has(n))return;At(r),t.shift()}})),F.events.queued=!0)}function St(e,t,n){const r=t.trim().split(/\s+/);for(let t=0,i=r.length;t<i;t++)e.classList.toggle(r[t],n)}function Et(e,t,n,r,i){let o,s,a;if("style"===t)return mt(e,n,r);if("classList"===t)return ft(e,n,r);if(n===r)return r;if("ref"===t)n(e);else if("on:"===t.slice(0,3))e.addEventListener(t.slice(3),n);else if("oncapture:"===t.slice(0,10))e.addEventListener(t.slice(10),n,!0);else if("on"===t.slice(0,2)){const r=t.slice(2).toLowerCase(),i=nt.has(r);pt(e,r,n,i),i&&lt([r])}else if((a=Qe.has(t))||!i&&(tt[t]||(s=Ke.has(t)))||(o=e.nodeName.includes("-")))!o||s||a?e[tt[t]||t]=n:e[(c=t,c.toLowerCase().replace(/-([a-z])/g,((e,t)=>t.toUpperCase())))]=n;else{const r=i&&t.indexOf(":")>-1&&it[t.split(":")[0]];r?dt(e,r,t,n):ht(e,et[t]||t,n)}var c;return n}function At(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>n||document});null!==n;){const r=n[t];if(r&&!n.disabled){const i=n[`${t}Data`];if(void 0!==i?r(i,e):r(e),e.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function Rt(e,t,n={},r,i){return!i&&"children"in t&&se((()=>n.children=Lt(e,t.children,n.children))),se((()=>xt(e,t,r,!0,n))),n}function Lt(e,t,n,r,i){for(F.context&&!n&&(n=[...e.childNodes]);"function"==typeof n;)n=n();if(t===n)return n;const o=typeof t,s=void 0!==r;if(e=s&&n[0]&&n[0].parentNode||e,"string"===o||"number"===o){if(F.context)return n;if("number"===o&&(t=t.toString()),s){let i=n[0];i&&3===i.nodeType?i.data=t:i=document.createTextNode(t),n=Ot(e,n,r,i)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t}else if(null==t||"boolean"===o){if(F.context)return n;n=Ot(e,n,r)}else{if("function"===o)return se((()=>{let i=t();for(;"function"==typeof i;)i=i();n=Lt(e,i,n,r)})),()=>n;if(Array.isArray(t)){const o=[];if(Ct(o,t,i))return se((()=>n=Lt(e,o,n,r,!0))),()=>n;if(F.context)for(let e=0;e<o.length;e++)if(o[e].parentNode)return n=o;if(0===o.length){if(n=Ot(e,n,r),s)return n}else Array.isArray(n)?0===n.length?Pt(e,o,r):function(e,t,n){let r=n.length,i=t.length,o=r,s=0,a=0,c=t[i-1].nextSibling,l=null;for(;s<i||a<o;)if(t[s]!==n[a]){for(;t[i-1]===n[o-1];)i--,o--;if(i===s){const t=o<r?a?n[a-1].nextSibling:n[o-a]:c;for(;a<o;)e.insertBefore(n[a++],t)}else if(o===a)for(;s<i;)l&&l.has(t[s])||t[s].remove(),s++;else if(t[s]===n[o-1]&&n[a]===t[i-1]){const r=t[--i].nextSibling;e.insertBefore(n[a++],t[s++].nextSibling),e.insertBefore(n[--o],r),t[i]=n[o]}else{if(!l){l=new Map;let e=a;for(;e<o;)l.set(n[e],e++)}const r=l.get(t[s]);if(null!=r)if(a<r&&r<o){let c,u=s,h=1;for(;++u<i&&u<o&&null!=(c=l.get(t[u]))&&c===r+h;)h++;if(h>r-a){const i=t[s];for(;a<r;)e.insertBefore(n[a++],i)}else e.replaceChild(n[a++],t[s++])}else s++;else t[s++].remove()}}else s++,a++}(e,n,o):(n&&Ot(e),Pt(e,o));n=o}else if(t instanceof Node){if(F.context&&t.parentNode)return n=s?[t]:t;if(Array.isArray(n)){if(s)return n=Ot(e,n,r,t);Ot(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function Ct(e,t,n){let r=!1;for(let i=0,o=t.length;i<o;i++){let o,s=t[i];if(s instanceof Node)e.push(s);else if(null==s||!0===s||!1===s);else if(Array.isArray(s))r=Ct(e,s)||r;else if("string"==(o=typeof s))e.push(document.createTextNode(s));else if("function"===o)if(n){for(;"function"==typeof s;)s=s();r=Ct(e,Array.isArray(s)?s:[s])||r}else e.push(s),r=!0;else e.push(document.createTextNode(s.toString()))}return r}function Pt(e,t,n){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function Ot(e,t,n,r){if(void 0===n)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let r=!1;for(let o=t.length-1;o>=0;o--){const s=t[o];if(i!==s){const t=s.parentNode===e;r||o?t&&s.remove():t?e.replaceChild(i,s):e.insertBefore(i,n)}else r=!0}}else e.insertBefore(i,n);return[i]}function Nt(e,t){const n=e.querySelectorAll("*[data-hk]");for(let e=0;e<n.length;e++){const r=n[e],i=r.getAttribute("data-hk");t&&!i.startsWith(t)||F.registry.set(i,r)}}function It(){const e=F.context;return`${e.id}${e.count++}`}function Dt(){}function kt(e){return F.context?void 0:e.children}function Bt(e){const t=new Error(`${e.name} is not supported in the browser, returning undefined`);console.error(t)}function Ut(e,t){Bt(Ut)}function Ft(e,t){Bt(Ft)}function zt(e,t){Bt(zt)}function Ht(e,...t){}function Gt(e){}function jt(e){}function Vt(e){}function Wt(e){}function qt(e,t){}function Xt(){}function Yt(e){}function Zt(){}const Jt=!1;function $t(e,t=!1){return t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)}const Kt=(...e)=>(ke=!0,function(e,t,n={}){F.completed=globalThis._$HY.completed,F.events=globalThis._$HY.events,F.load=globalThis._$HY.load,F.gather=e=>Nt(t,e),F.registry=new Map,F.context={id:n.renderId||"",count:0},Nt(t,n.renderId);const r=at(e,t,[...t.childNodes]);return F.context=null,r}(...e));function Qt(e){const{useShadow:t}=e,n=document.createTextNode(""),r=e.mount||document.body;function i(){if(F.context){const[t,n]=ie(!1);return queueMicrotask((()=>n(!0))),()=>t()&&e.children}return()=>e.children}if(r instanceof HTMLHeadElement){const[e,t]=ie(!1),n=()=>t(!0);re((t=>bt(r,(()=>e()?t():i()()),null))),he((()=>{F.context?queueMicrotask(n):n()}))}else{const o=$t(e.isSVG?"g":"div",e.isSVG),s=t&&o.attachShadow?o.attachShadow({mode:"open"}):o;Object.defineProperty(o,"host",{get:()=>n.parentNode}),bt(s,i()),r.appendChild(o),e.ref&&e.ref(o),he((()=>r.removeChild(o)))}return n}function en(e){const[t,n]=function(e,...t){const n=new Set(t.flat()),r=Object.getOwnPropertyDescriptors(e),i=t.map((t=>{const n={};for(let i=0;i<t.length;i++){const o=t[i];Object.defineProperty(n,o,r[o]?r[o]:{get:()=>e[o],set:()=>!0})}return n}));return i.push(new Proxy({get:t=>n.has(t)?void 0:e[t],has:t=>!n.has(t)&&t in e,keys:()=>Object.keys(e).filter((e=>!n.has(e)))},Fe)),i}(e,["component"]);return ce((()=>{const e=t.component;switch(typeof e){case"function":return ue((()=>e(n)));case"string":const t=rt.has(e),r=F.context?_t():$t(e,t);return gt(r,n,t),r}}))}function tn(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0,enumerable:!0})}let nn;if(!("customElements"in window))throw new Error("\n\t\tYour browser does not support the Custom Elements v1 API. You'll\n\t\tneed to install a Custom Elements v1 polyfill.\n\t");class rn extends HTMLElement{constructor(){super(...arguments),this.___init___=(()=>{this.__handleInitialPropertyValuesIfAny()})(),this.hasShadow=!0,this.__root=null,this.__hasShadow=!0,this.__styleRootNode=null,this.__id=rn.__elementId++,this.__dynamicStyle=null}static defineElement(e){customElements.define(e||this.elementName,this)}__handleInitialPropertyValuesIfAny(){const e=Object.keys(this);this._preUpgradeValues=new Map;for(const n of e){const e=Object.getOwnPropertyDescriptor(this,n);"value"in e&&(delete this[n],this._preUpgradeValues.set(n,e.value),t=()=>{var t,r;if(null===(t=this.__propsSetAtLeastOnce__)||void 0===t?void 0:t.has(n))return;const i=n in this.__proto__,o=null===(r=this.__reactifiedProps__)||void 0===r?void 0:r.has(n);(i||o)&&(this[n]=e.value)},Promise.resolve().then(t))}var t}get root(){return this.hasShadow?this.__root?this.__root:this.shadowRoot?this.__root=this.shadowRoot:this.__root=this.attachShadow({mode:"open"}):this}set root(e){if(!this.hasShadow)throw new Error("Can not set root, element.hasShadow is false.");if(this.__root||this.shadowRoot)throw new Error("Element root can only be set once if there is no ShadowRoot.");this.__root=e}attachShadow(e){return this.__root&&console.warn("Element already has a root defined."),this.__root=super.attachShadow(e)}connectedCallback(){this.__hasShadow=this.root instanceof ShadowRoot,this.__setStyle();const e=this.template;e&&(this.__dispose=at("function"==typeof e?e.bind(this):()=>e,this.root))}disconnectedCallback(){this.__dispose&&this.__dispose(),this.__cleanupStyle()}__setStyle(){nn=this.constructor;const e="function"==typeof nn.css?nn.css=nn.css():nn.css||"",t="function"==typeof this.css?this.css():this.css||"";if(this.__hasShadow){const n=":host",r=document.createElement("style");r.innerHTML=`\n\t\t\t\t${n} { display: block; }\n\t\t\t\t${e}\n\t\t\t\t${t}\n\t\t\t`,this.root.appendChild(r)}else{const n=this.getRootNode();this.__styleRootNode=n===document?document.head:n;let r=rn.__styleRootNodeRefCountPerTagName.get(this.__styleRootNode);r||rn.__styleRootNodeRefCountPerTagName.set(this.__styleRootNode,r={});const i=r[this.tagName]||0;if(r[this.tagName]=i+1,0===i){const t=this.tagName.toLowerCase(),n=document.createElement("style");n.innerHTML=`\n\t\t\t\t\t${t} { display: block; }\n\t\t\t\t\t${e?e.replace(":host",t):e}\n\t\t\t\t`,n.id=this.tagName.toLowerCase(),this.__styleRootNode.appendChild(n)}if(t){const e=this.tagName.toLowerCase()+"-"+this.__id;this.setAttribute(e,"");const n=this.__dynamicStyle=document.createElement("style");n.id=e,n.innerHTML=t.replace(":host",`[${e}]`);const r=this.getRootNode();this.__styleRootNode=r===document?document.head:r,this.__styleRootNode.appendChild(n)}}}__cleanupStyle(){do{if(this.__hasShadow)break;const e=rn.__styleRootNodeRefCountPerTagName.get(this.__styleRootNode);if(!e)break;let t=e[this.tagName];if(void 0===t)break;if(e[this.tagName]=--t,0===t){delete e[this.tagName];const t=this.__styleRootNode.querySelector("#"+this.tagName);null==t||t.remove()}}while(0);this.__dynamicStyle&&this.__dynamicStyle.remove()}adoptedCallback(){}}rn.elementName="",rn.__styleRootNodeRefCountPerTagName=new WeakMap,rn.__elementId=0;var on=__webpack_require__(662);const sn=["subclass","extends",...Object.getOwnPropertyNames(new Function)],an=new WeakMap,cn=new WeakMap,ln=new on.Ie,un=new WeakMap,hn=new WeakMap,dn=new WeakMap,pn=new WeakMap,fn=new WeakMap,mn={mode:"es5",nativeNaming:!1,prototypeWritable:!1,defaultClassDescriptor:{writable:!0,enumerable:!1,configurable:!0},setClassDescriptors:!0};class gn extends Error{}class vn extends Error{}function yn(e,t){let n=e.cachedPublicAccesses.get(t);return n||(En(e,t)?e.cachedPublicAccesses.set(t,n=xn(t).publicToPrivate.get(t)):Sn(e,t)?e.cachedPublicAccesses.set(t,n=ln.get(t)):e.cachedPublicAccesses.set(t,n=t),n)}function bn(e,t){let n=e.cachedProtectedAccesses.get(t);if(n)return n;if(Tn(e,t))e.cachedProtectedAccesses.set(t,n=ln.get(t)||_n(t));else if(En(e,t)){const r=xn(t).publicToPrivate.get(t);e.cachedProtectedAccesses.set(t,n=ln.get(r)||_n(r))}else Sn(e,t)&&e.cachedProtectedAccesses.set(t,n=t);if(!n)throw new vn("invalid access of protected member");return n}function xn(e){return un.get(e)}function _n(e){const t=function(e){let t=null,n=e.__proto__;for(;n;){if(t=an.get(n),t)return t;n=n.__proto__}return t}(e),n=Object.create(t);return ln.set(e,n),n}function wn(e,t){let n=e.cachedPrivateAccesses.get(t);if(n)return n;if(Tn(e,t))e.cachedPrivateAccesses.set(t,n=e.publicToPrivate.get(t)||Mn(e,t));else if(Sn(e,t)){const r=ln.get(t);e.cachedPrivateAccesses.set(t,n=e.publicToPrivate.get(r)||Mn(e,r))}else En(e,t)&&e.cachedPrivateAccesses.set(t,n=t);if(!n)throw new vn("invalid access of private member");return n}function Mn(e,t){const n=Object.create(e.privatePrototype);return e.publicToPrivate.set(t,n),un.set(n,e),n}function Tn(e,t,n=!0){if(!n)return(0,on.nk)(t,e.publicPrototype);for(const n of Array.from(hn.get(e.classBrand)))if((0,on.nk)(t,n))return!0;return!1}function Sn(e,t,n=!0){if(!n)return(0,on.nk)(t,e.protectedPrototype);for(const n of Array.from(dn.get(e.classBrand)))if((0,on.nk)(t,n))return!0;return!1}function En(e,t,n=!0){if(!n)return(0,on.nk)(t,e.privatePrototype);for(const n of Array.from(pn.get(e.classBrand)))if((0,on.nk)(t,n))return!0;return!1}function An(e,t,n){const{parentPublicPrototype:r,parentProtectedPrototype:i,parentPrivatePrototype:o}=t;if(Tn(t,n,!1))return Rn(n,r,e);if(Sn(t,n,!1))return Rn(n,i,e);if(En(t,n,!1))return Rn(n,o,e);throw new gn("invalid super access")}function Rn(e,t,n){let r=n.get(e);if(!r){n.set(e,r=Object.create(t));const i=(0,on.yA)(t);let o=i.length;for(;o--;){const n=i[o];(0,on.q$)(r,n,{get:function(){let r;const i=(0,on.ld)(t,n);if(i&&(0,on.uh)(i)){const t=i.get;t&&(r=t.call(e))}else r=t[n];return r&&r.call&&"function"==typeof r&&(r=r.bind(e)),r},set:function(r){const i=(0,on.ld)(t,n);if(i&&(0,on.uh)(i)){const t=i.set;t&&(r=t.call(e,r))}else e[n]=r}},!0)}}return r}var Ln;!function(e){(e=e?{...mn,...e}:mn).defaultClassDescriptor={...mn.defaultClassDescriptor,...e.defaultClassDescriptor};const{mode:t,prototypeWritable:n,setClassDescriptors:r,nativeNaming:i}=e;function o(...e){let t=!1;if("function"==typeof this&&(t=!0),e.length<=3){let n="",r=null,i=null;"string"==typeof e[0]?n=e[0]:"function"!=typeof e[0]&&"object"!=typeof e[0]||(r=e[0],i=e[1]),"function"!=typeof e[1]&&"object"!=typeof e[1]||(r=e[1],i=e[2]);const o=t?s.call(this,n,r,i):s(n,r,i);return o.extends=function(e,t,o){return t=t||r,o=o||i,s.call(e,n,t,o)},o}throw new TypeError("invalid args")}return o;function s(s,a,c){let l=this;if("string"!=typeof s)throw new TypeError("\n                You must specify a string for the 'className' argument.\n            ");let u=null;if(a&&"object"==typeof a)u=a;else if(!l&&(!a||"function"!=typeof a&&"object"!=typeof a)){let e;return i&&s?e=new Function(`return function ${s}() {}`)():(e=function(){},s&&(0,on.q$)(e,"name",{value:s})),e.prototype={__proto__:Object.prototype,constructor:e},(0,on.q$)(e,"subclass",{value:o,writable:!0,enumerable:!1,configurable:!1}),e}const h=c?void 0:new on.Ie;c&&(fn.get(c)||fn.set(c,new on.Ie));const d={className:s,get publicToPrivate(){return h||fn.get(c)},classBrand:c=c||{brand:"lexical"},cachedPublicAccesses:new WeakMap,cachedProtectedAccesses:new WeakMap,cachedPrivateAccesses:new WeakMap},p=new WeakMap,f=An.bind(null,p,d),m=yn.bind(null,d),g=bn.bind(null,d),v=wn.bind(null,d);if(m.prototype={},g.prototype={},v.prototype={},m.Public=m,m.Protected=g,m.Private=v,m.Super=f,g.Public=m,g.Protected=g,g.Private=v,g.Super=f,u=u||a&&a(m,g,v,f),u&&"object"!=typeof u&&"function"!=typeof u)throw new TypeError("\n                The return value of a class definer function, if any, should be\n                an object, or a class constructor.\n            ");let y,b=null;"function"==typeof u&&(b=u,u=u.prototype,l=b.prototype.__proto__.constructor),u&&(y=u.static,delete u.static,"function"==typeof u.public&&(u.public=u.public(g,v)),"function"==typeof u.protected&&(u.protected=u.protected(m,v)),"function"==typeof u.private&&(u.private=u.private(m,g))),l=l||Object;const x=l.prototype,_=u&&u.public||u||Object.create(x);_.__proto__!==x&&(_.__proto__=x);const w=function(e){let t,n=e;for(;n&&!t;)t=an.get(n),n=n.__proto__;return t||{}}(x),M=u&&u.protected||Object.create(w);M.__proto__!==w&&(M.__proto__=w),an.set(_,M);const T=function(e){let t,n=e;for(;n&&!t;)t=cn.get(n),n=n.__proto__;return t||{}}(x),S=u&&u.private||Object.create(T);if(S.__proto__!==T&&(S.__proto__=T),cn.set(_,S),hn.get(c)||hn.set(c,new Set),dn.get(c)||dn.set(c,new Set),pn.get(c)||pn.set(c,new Set),hn.get(c).add(_),dn.get(c).add(M),pn.get(c).add(S),d.publicPrototype=_,d.privatePrototype=S,d.protectedPrototype=M,d.parentPublicPrototype=x,d.parentProtectedPrototype=w,d.parentPrivatePrototype=T,(0,on.Gm)(m.prototype,_),(0,on.Gm)(g.prototype,M),(0,on.Gm)(v.prototype,S),u&&(delete u.public,delete u.protected,delete u.private,u!==_&&(0,on.Gm)(u,_)),b)return y&&(0,on.Gm)(y,b),b;const E=_.hasOwnProperty("constructor")?_.constructor:null;let A=null,R=null;if("es5"!==t)throw new TypeError("\n                The lowclass \"mode\" option can only be 'es5' for now.\n            ");if(A=function(){let e=null,t=null;return t=E||l,t!==Object&&(e=t.apply(this,arguments)),!e||"object"!=typeof e&&"function"!=typeof e?this:e},R=_,s)if(i){const e=(0,on.Sh)(A),t=A.prototype;A=new Function(" userConstructor, ParentClass ",`\n                    return function ${s}() { ${e} }\n                `)(E,l),A.prototype=t}else(0,on.q$)(A,"name",{value:s});return E&&E.length&&(0,on.q$)(A,"length",{value:E.length}),A.__proto__=l,y&&(0,on.Gm)(y,A),(0,on.q$)(A,"subclass",{value:o,writable:!0,enumerable:!1,configurable:!1}),A.prototype=R,A.prototype.constructor=A,r&&((0,on.U8)(A,e,sn),(0,on.q$)(A,"prototype",{writable:n}),(0,on.Md)(A.prototype,e),(0,on.Md)(M,e),(0,on.Md)(S,e)),d.constructor=A,A}}(),function(e){e.PROXIES_ON_INSTANCE_AND_PROTOTYPE="PROXIES_ON_INSTANCE_AND_PROTOTYPE",e.PROXIES_ON_PROTOTYPE="PROXIES_ON_PROTOTYPE",e.PROXY_AFTER_INSTANCE_AND_PROTOTYPE="PROXY_AFTER_INSTANCE_AND_PROTOTYPE"}(Ln||(Ln={})),Ln.PROXIES_ON_INSTANCE_AND_PROTOTYPE;new WeakMap;function Cn(){return this()}function Pn(e){return this(e)}function On(e){const[t,n]=ie(e,{equals:!1}),r=e=>void 0===e?t():(n((()=>e)),e),i=Cn.bind(r),o=Pn.bind(r);return r.get=i,r.set=o,r[0]=i,r[1]=o,r[Symbol.iterator]=function*(){yield r[0],yield r[1]},r}function Nn(e){let t;return re((n=>{t=n,ae(e)})),t}function In(e,t,n){const r=1===arguments.length&&"kind"in e;if(r){const t=e;return"class"===t.kind?{...t,finisher:kn}:{...t,finisher(e){var n,r;return Dn(e,t.key),null!==(r=null===(n=t.finisher)||void 0===n?void 0:n.call(t,e))&&void 0!==r?r:e}}}if(1===arguments.length&&"function"==typeof e)return kn(e);const i=e.constructor;Dn(i,t)}function Dn(e,t){e.reactiveProperties&&e.hasOwnProperty("reactiveProperties")||(e.reactiveProperties=[]),e.reactiveProperties.includes(t)||e.reactiveProperties.push(t)}function kn(e){var t;return e.hasOwnProperty("__isReactive__")?e:((t=class extends e{constructor(...t){super(...t),Fn(this,e)}}).__isReactive__=!0,t)}function Bn(e,t){const n="v_"+t;let r,i,o,s=(0,on.ld)(e,t);if(s)if(r=s.get,i=s.set,r||i){if(!r||!i)return void console.warn('The `@reactive` decorator was used on an accessor named "'+t+'" which had a getter or a setter, but not both. Reactivity on accessors works only when accessors have both get and set. In this case the decorator does not do anything.');delete s.get,delete s.set}else{if(o=s.value,!s.writable)return void console.warn("The `@reactive` decorator was used on a property named "+t+" that is not writable. Reactivity is not enabled for non-writable properties.");delete s.value,delete s.writable}s={configurable:!0,enumerable:!0,...s,get:r?function(){return Un(this,n,o)(),r.call(this)}:function(){return Un(this,n,o)()},set:i?function(e){i.call(this,e),Un(this,n)(e),this.__propsSetAtLeastOnce__||(this.__propsSetAtLeastOnce__=new Set),this.__propsSetAtLeastOnce__.add(t)}:function(e){Un(this,n)(e),this.__propsSetAtLeastOnce__||(this.__propsSetAtLeastOnce__=new Set),this.__propsSetAtLeastOnce__.add(t)}},e.__reactifiedProps__||(e.__reactifiedProps__=new Set),e.__reactifiedProps__.add(t),Object.defineProperty(e,t,s)}function Un(e,t,n){let r=e[t];return r||(e[t]=r=On(n),r)}function Fn(e,t){if(function(e){return"function"==typeof e}(t)){const n=t.reactiveProperties;Array.isArray(n)&&zn(e,n)}else zn(e,t);return e}function zn(e,t){var n;for(const r of t){if(null===(n=e.__reactifiedProps__)||void 0===n?void 0:n.has(r))continue;const t=e[r];Bn(e,r),e[r]=t}}__webpack_require__(768);const Hn=ue;function Gn(e,t,n,r){let i=!0;const o=Nn((()=>{const t=e();i&&!(i=!1)?r(t):i=!0})),s=Nn((()=>{const e=n();i&&!(i=!1)?t(e):i=!0}));return function(){o(),s()}}function jn(e,t,n){if(e&&"kind"in e){const t=e;return{...t,finisher(e){var n;return Vn(e.prototype,t.key),null!==(n=t.finisher&&t.finisher(e))&&void 0!==n?n:e}}}if(e&&t)return Vn(e,t,n);const r=e;return(e,t,n)=>{if(e&&"kind"in e){const t=e;return{...t,finisher(e){var n;return Vn(e.prototype,t.key,void 0,r),null!==(n=t.finisher&&t.finisher(e))&&void 0!==n?n:e}}}return Vn(e,t,n,r)}}function Vn(e,t,n,r){const i=e.constructor;if(!i.observedAttributes||!i.hasOwnProperty("observedAttributes")){const e=i.__proto__.observedAttributes;if(e&&!Array.isArray(e))throw new TypeError("observedAttributes is in the wrong format. Maybe you forgot to decorate your custom element class with the `element` decorator.");tn(i,"observedAttributes",[...e||[]])}if(!Array.isArray(i.observedAttributes))throw new TypeError("observedAttributes is in the wrong format. Maybe you forgot to decorate your custom element class with the `element` decorator.");const o=t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase();if(i.observedAttributes.includes(o)||i.observedAttributes.push(o),i.reactiveProperties&&i.hasOwnProperty("reactiveProperties")||tn(i,"reactiveProperties",[...i.reactiveProperties||[]]),i.reactiveProperties.includes(t)||i.reactiveProperties.push(t),function(e,t,n,r){if(!e.__hasAttributeChangedCallback){e.__hasAttributeChangedCallback=!0;const t=e.attributeChangedCallback;e.attributeChangedCallback=function(n,r,i){var o,s;t?t.call(this,n,r,i):null===(s=null===(o=e.__proto__)||void 0===o?void 0:o.attributeChangedCallback)||void 0===s||s.call(this,n,r,i);const a=this.__attributesToProps&&this.__attributesToProps[n];if(a){const e=a.attributeHandler;this[a.name]=e&&e.from?e.from(i):i}}}e.hasOwnProperty("__attributesToProps")||Object.defineProperty(e,"__attributesToProps",{value:{__proto__:e.__attributesToProps||Object.prototype}}),e.__attributesToProps[t]&&console.warn('The `@attribute` decorator is overriding an already-existing attribute-to-property mapping for the "'+t+'" attribute.'),e.__attributesToProps[t]={name:n,attributeHandler:r}}(e,o,t,r),n)return n}function Wn(e=""){return jn(jn.string(e))}function qn(e=0){return jn(jn.number(e))}function Xn(e=!1){return jn(jn.boolean(e))}function Yn(e,t=!0){let n="";return"function"==typeof e?(t=!1,r(e)):(n=e,r);function r(e){return"kind"in e?{...e,finisher:i}:i(e)}function i(e){const r=e.observedAttributes;if(e.hasOwnProperty("elementName")?n=e.elementName||n:e.elementName=n,Array.isArray(r));else if(r&&"object"==typeof r){e.observedAttributes=void 0;for(const t in r)Vn(e.prototype,t,void 0,r[t])}const i=In(e);class o extends i{constructor(...e){if(super(...e),this instanceof rn)for(const[e,t]of this._preUpgradeValues){if(!(e in this))continue;this._preUpgradeValues.delete(e);const n=Object.getOwnPropertyDescriptor(this,e);n&&"value"in n&&delete this[e],this[e]=t}}}return n&&t&&customElements.define(n,o),o}}jn.string=(e="")=>({default:e,from(e){return null==e?this.default:e}}),jn.number=(e=0)=>({default:e,from(e){return null==e?this.default:+e}}),jn.boolean=(e=!1)=>({default:e,from(e){return null==e?this.default:"false"!==e}});const Zn=function(e,...t){let n="";for(let r=0;r<t.length;r++)n+=e[r]+String(t[r]);return n+e[e.length-1]};var Jn,$n,Kn,Qn,er,tr,nr,rr;tr=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,Jn=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,$n={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Kn=function(e){var t;t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]};const n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],($n[n[1].toLowerCase()]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0),t.name.startsWith("!--"))){const t=e.indexOf("--\x3e");return{type:"comment",comment:-1!==t?e.slice(4,t):""}}const r=new RegExp(Jn);let i=null;for(;i=r.exec(e),null!==i;)if(i[0].trim())if(i[1]){const e=i[1].trim();let n=[e,""];e.indexOf("=")>-1&&(n=e.split("=")),t.attrs[n[0]]=n[1],r.lastIndex--}else i[2]&&(t.attrs[i[2]]=i[3].trim().substring(1,i[3].length-1));return t},er=function(e,t,n){var r,i;i=t.indexOf("<",n),r=t.slice(n,-1===i?void 0:i),/^\s*$/.test(r)||e.push({type:"text",content:r})},Qn=function(e,t){var n;n=t.replace("\x3c!--","").replace("--\x3e",""),/^\s*$/.test(n)||e.push({type:"comment",content:n})},nr=function(e){var t,n;for(n in t=[],e)t.push(n+'="'+e[n]+'"');return t.length?" "+t.join(" "):""},rr=function(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?nr(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(rr,"")+"</"+t.name+">";case"comment":return e+"\x3c!--"+t.content+"--\x3e"}};const ir=new Map,or=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,sr=" \\f\\n\\r\\t",ar="[  \\f\\n\\r\\t]+[^  \\f\\n\\r\\t\\/>\"'=]+",cr="<([A-Za-z$#]+[A-Za-z0-9:_-]*)((?:",lr="(?:\\s*=\\s*(?:'[^']*?'|\"[^\"]*?\"|\\([^)]*?\\)|<[^>]*?>|[^  \\f\\n\\r\\t\\/>\"'=]+))?)",ur=new RegExp(cr+ar+lr+"+)([ "+sr+"]*/?>)","g"),hr=new RegExp("("+ar+"\\s*=\\s*)(['\"(]?)\x3c!--#--\x3e(['\")]?)","gi"),dr=new RegExp(cr+ar+lr+"*)([ "+sr+"]*/>)","g"),pr="\x3c!--#--\x3e",fr=new Set(["class","on","oncapture","style","use","prop","attr"]);function mr(e,t,n,r){return"<"+t+n.replace(hr,gr)+r}function gr(e,t,n,r){return t+(n||'"')+"###"+(r||'"')}function vr(e,t,n){return or.test(t)?e:"<"+t+n+"></"+t+">"}var yr=function(e,{delegateEvents:t=!0}={}){let n=1;function r(r,i,o,s,a){if("on"===i.slice(0,2))if(i.includes(":")){let e=i.startsWith("oncapture:");a.exprs.push(`${r}.addEventListener("${i.slice(e?10:3)}",exprs[${a.counter++}]${e?",true":""})`)}else{const n=i.slice(2).toLowerCase(),o=t&&e.DelegatedEvents.has(n);a.exprs.push(`r.addEventListener(${r},"${n}",exprs[${a.counter++}],${o})`),o&&a.delegatedEvents.add(n)}else if("ref"===i)a.exprs.push(`exprs[${a.counter++}](${r})`);else{const t=Object.assign({},a,{exprs:[]}),c=a.counter;!function(t,r,i,o,s){let a,c,l=s.counter++,u=`!doNotWrap ? exprs[${l}]() : exprs[${l}]`;(a=r.split(":"))&&a[1]&&fr.has(a[0])&&(r=a[1],c=a[0]);const h=e.ChildProperties.has(r),d=e.Properties.has(r);if("style"===r){const e="_$v"+n++;s.decl.push(`${e}={}`),s.exprs.push(`r.style(${t},${u},${e})`)}else if("classList"===r){const e="_$v"+n++;s.decl.push(`${e}={}`),s.exprs.push(`r.classList(${t},${u},${e})`)}else if("attr"!==c&&(h||!i&&(e.PropAliases[r]||d)||o||"prop"===c))!o||h||d||"prop"===c||(r=function(e){return e.toLowerCase().replace(/-([a-z])/g,((e,t)=>t.toUpperCase()))}(r)),s.exprs.push(`${t}.${e.PropAliases[r]||r} = ${u}`);else{const n=i&&r.indexOf(":")>-1&&e.SVGNamespace[r.split(":")[0]];n?s.exprs.push(`r.setAttributeNS(${t},"${n}","${r}",${u})`):s.exprs.push(`r.setAttribute(${t},"${e.Aliases[r]||r}",${u})`)}}(r,i,o,s,t),a.decl.push(`_fn${c} = doNotWrap => {\n${t.exprs.join(";\n")};\n}`),a.exprs.push(`typeof exprs[${c}] === "function" ? r.effect(_fn${c}) : _fn${c}(true)`),a.counter=t.counter,a.wrap=!1}}function i(e){let t=[];for(const n of e)if(Array.isArray(n)){if(!n.length)continue;t.push(`r.wrapProps({${n.join(",")||""}})`)}else t.push(n);return t.length>1?`r.mergeProps(${t.join(",")})`:t[0]}function o(e,t){let r=[];const o=Object.keys(e.attrs),a=[r],c=t.counter++;for(let n=0;n<o.length;n++){const i=o[n],s=e.attrs[i];"###"===i?(a.push(`exprs[${t.counter++}]`),a.push(r=[])):"###"===s?r.push(`${i}: exprs[${t.counter++}]`):r.push(`${i}: "${s}"`)}if(1===e.children.length&&"comment"===e.children[0].type&&"#"===e.children[0].content)r.push(`children: () => exprs[${t.counter++}]`);else if(e.children.length){const n={type:"fragment",children:e.children},i=Object.assign({},t,{first:!0,decl:[],exprs:[],parent:!1});s(n,i),r.push(`children: () => { ${i.exprs.join(";\n")}}`),t.templateId=i.templateId,t.counter=i.counter}let l;t.multi&&(l="_$el"+n++,t.decl.push(`${l} = ${t.path}.${t.first?"firstChild":"nextSibling"}`)),t.parent?t.exprs.push(`r.insert(${t.parent}, r.createComponent(exprs[${c}],${i(a)})${l?`, ${l}`:""})`):t.exprs.push(`${t.fragment?"":"return "}r.createComponent(exprs[${c}],${i(a)})`),t.path=l,t.first=!1}function s(t,i){if("fragment"===t.type){const e=[];t.children.forEach((t=>{if("tag"===t.type){if("###"===t.name){const n=Object.assign({},i,{first:!0,fragment:!0,decl:[],exprs:[]});return o(t,n),e.push(n.exprs[0]),i.counter=n.counter,void(i.templateId=n.templateId)}i.templateId++;const r=n,a=Object.assign({},i,{first:!0,decl:[],exprs:[]});i.templateNodes.push([t]),s(t,a),e.push(`function() { ${a.decl.join(",\n")+";\n"+a.exprs.join(";\n")+`;\nreturn _$el${r};\n`}}()`),i.counter=a.counter,i.templateId=a.templateId}else"text"===t.type?e.push(`"${t.content}"`):"comment"===t.type&&"#"===t.content&&e.push(`exprs[${i.counter++}]`)})),i.exprs.push(`return [${e.join(", \n")}]`)}else if("tag"===t.type){const a="_$el"+n++;i.decl.push(i.decl.length?`${a} = ${i.path}.${i.first?"firstChild":"nextSibling"}`:`const ${a} = tmpls[${i.templateId}].content.firstChild.cloneNode(true)`);const c=Object.keys(t.attrs),l=e.SVGElements.has(t.name),u=t.name.includes("-");for(let e=0;e<c.length;e++){const n=c[e];"###"===t.attrs[n]?(delete t.attrs[n],r(a,n,l,u,i)):"###"===n&&(delete t.attrs[n],i.exprs.push(`r.spread(${a},exprs[${i.counter++}],${l},${!!t.children.length})`))}i.path=a,i.first=!1,function(e,t){const n=Object.assign({},t,{first:!0,multi:!1,parent:t.path});if(e.children.length>1)for(let t=0;t<e.children.length;t++){const r=e.children[t];if("comment"===r.type&&"#"===r.content||"tag"===r.type&&"###"===r.name){n.multi=!0;break}}let r=0;for(;r<e.children.length;){const t=e.children[r];"###"!==t.name?(s(t,n),r++):(n.multi?(e.children[r]={type:"comment",content:"#"},r++):e.children.splice(r,1),o(t,n))}t.counter=n.counter,t.templateId=n.templateId}(t,i)}else if("text"===t.type){const e="_$el"+n++;i.decl.push(`${e} = ${i.path}.${i.first?"firstChild":"nextSibling"}`),i.path=e,i.first=!1}else if("comment"===t.type&&"#"===t.content){const e="_$el"+n++;i.decl.push(`${e} = ${i.path}.${i.first?"firstChild":"nextSibling"}`),i.multi?i.exprs.push(`r.insert(${i.parent}, exprs[${i.counter++}], ${e})`):i.exprs.push(`r.insert(${i.parent}, exprs[${i.counter++}])`),i.path=e,i.first=!1}}return e.wrapProps=t=>{const n=Object.getOwnPropertyDescriptors(t);for(const r in n)"function"!=typeof n[r].value||n[r].value.length||e.dynamicProperty(t,r);return t},function(t,...r){const i=ir.get(t)||function(t){let r=0,i="";for(;r<t.length-1;r++)i=i+t[r]+"\x3c!--#--\x3e";i+=t[r],i=i.replace(dr,vr).replace(/<(<!--#-->)/g,"<###").replace(/\.\.\.(<!--#-->)/g,"###").replace(ur,mr).replace(/>\n+\s*/g,">").replace(/\n+\s*</g,"<").replace(/\s+</g," <").replace(/>\s+/g,"> ");const[a,c]=function(t){const r={path:"",decl:[],exprs:[],delegatedEvents:new Set,counter:0,first:!0,multi:!1,templateId:0,templateNodes:[]},i=n,a=t;let c;return t.length>1&&(t=[{type:"fragment",children:t}]),"###"===t[0].name?(c=!0,o(t[0],r)):s(t[0],r),e.delegateEvents(Array.from(r.delegatedEvents)),[[a].concat(r.templateNodes).map((e=>e.reduce((function(e,t){return e+rr("",t)}),""))),new Function("tmpls","exprs","r",r.decl.join(",\n")+";\n"+r.exprs.join(";\n")+(c?"":`;\nreturn _$el${i};\n`))]}(function(e){var t,n,r,i,o;return o=[],r=void 0,i=-1,t=[],n={},e.replace(tr,(function(s,a){var c,l,u,h,d;l="/"!==s.charAt(1),c="\x3c!--"===s.slice(0,4),d=a+s.length,u=e.charAt(d),h=void 0,l&&!c&&(i++,!(r=Kn(s)).voidElement&&u&&"<"!==u&&er(r.children,e,d),n[r.tagName]=r,0===i&&o.push(r),(h=t[i-1])&&h.children.push(r),t[i]=r),c&&Qn(i<0?o:t[i].children,s),(c||!l||r.voidElement)&&(c||i--,"<"!==u&&u&&(h=-1===i?o:t[i].children,er(h,e,d)))})),o}(i)),l=[];for(let e=0;e<a.length;e++){l.push(document.createElement("template")),l[e].innerHTML=a[e];const t=l[e].content.querySelectorAll("script,style");for(let n=0;n<t.length;n++){const r=t[n].firstChild.data||"";if(r.indexOf(pr)>-1){const n=r.split(pr).reduce(((e,t,n)=>(n&&e.push(""),e.push(t),e)),[]);t[e].firstChild.replaceWith(...n)}}}return l[0].create=c,ir.set(t,l),l}(t);return i[0].create(i,r,e)}}({effect:se,style:mt,insert:bt,spread:gt,createComponent:Be,delegateEvents:lt,classList:ft,mergeProps:He,dynamicProperty:vt,setAttribute:ht,setAttributeNS:dt,addEventListener:pt,Aliases:et,PropAliases:tt,Properties:Ke,ChildProperties:Qe,DelegatedEvents:nt,SVGElements:rt,SVGNamespace:it});const br=yr,xr=Array.prototype.forEach;class _r{constructor(e){if(this.ownerDocument=e,this._attrMap=new Map,this._elementMap=new WeakMap,!e)throw new Error("Must be given a document");this._observe()}define(e,t){this._attrMap.set(e,t),this._upgradeAttr(e)}get(e,t){const n=this._elementMap.get(e);if(n)return n.get(t)}_getConstructor(e){return this._attrMap.get(e)}_observe(){const e=this.ownerDocument,t=this._elementDisconnected.bind(this),n=this._elementConnected.bind(this);this._observer=new MutationObserver((e=>{xr.call(e,(e=>{"attributes"===e.type?this._getConstructor(e.attributeName)&&this._handleChange(e.attributeName,e.target,e.oldValue):(xr.call(e.removedNodes,t),xr.call(e.addedNodes,n))}))})),this._observer.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0})}_upgradeAttr(e,t=this.ownerDocument){const n=t.querySelectorAll("["+e+"]");xr.call(n,(t=>this._handleChange(e,t,null)))}_elementConnected(e){1===e.nodeType&&(xr.call(e.attributes,(t=>{this._getConstructor(t.name)&&this._handleChange(t.name,e,null)})),this._attrMap.forEach(((t,n)=>this._upgradeAttr(n,e))))}_elementDisconnected(e){const t=this._elementMap.get(e);t&&(t.forEach((e=>{var t;return null===(t=e.disconnectedCallback)||void 0===t?void 0:t.call(e)}),this),this._elementMap.delete(e))}_handleChange(e,t,n){var r,i,o;let s=this._elementMap.get(t);s||this._elementMap.set(t,s=new Map);let a=s.get(e);const c=t.getAttribute(e);if(!a){if(a=new(this._getConstructor(e)),s.set(e,a),a.ownerElement=t,a.name=e,null==c)throw new Error("Not possible!");return a.value=c,void(null===(r=a.connectedCallback)||void 0===r||r.call(a))}if(null==c)null===(i=a.disconnectedCallback)||void 0===i||i.call(a),s.delete(e);else if(c!==a.value){if(a.value=c,null==n)throw new Error("Not possible!");null===(o=a.changedCallback)||void 0===o||o.call(a,n,c)}}}var wr;const Mr=window;let Tr;(null===(wr=Mr.$customAttributes)||void 0===wr?void 0:wr.skipPolyfill)||(Tr=new _r(document),Mr.customAttributes=Tr);const Sr=new Map,Er=window.elementBehaviors=new class{constructor(){this._definedBehaviors=new Map}define(e,t){if(this._definedBehaviors.has(e))throw new Error(`Behavior ${e} is already defined.`);this._definedBehaviors.set(e,t)}get(e){return this._definedBehaviors.get(e)}has(e){return this._definedBehaviors.has(e)}whenDefined(e){let t;const n=new Promise((e=>t=e));return this.has(e)?t():Sr.set(e,n),n}};class Ar extends Map{find(e){let t=null;for(const[n,r]of this)e(n,r)&&(t=r);return t}}const Rr=new WeakMap;Object.defineProperty(Element.prototype,"behaviors",{get(){let e=null;return Rr.has(this)?e=Rr.get(this):Rr.set(this,e=new Ar),e}});class Lr{constructor(){this.observers=new Map,this.connectedBehaviors=new Set,this.elementDefinedPromises=new Map}connectedCallback(){this.behaviors=this.ownerElement.behaviors,this.changedCallback("",this.value)}disconnectedCallback(){this.changedCallback(this.value,""),this.observers.clear(),this.connectedBehaviors.clear();for(const[,e]of this.elementDefinedPromises)e.cancel();this.elementDefinedPromises.clear(),delete this.behaviors}changedCallback(e,t){const n=this.getBehaviorNames(t),r=Array.from(this.behaviors.keys());if(0==n.length&&0==r.length)return;const{removed:i,added:o}=this.getDiff(r,n);this.handleDiff(i,o)}getBehaviorNames(e){return""==e.trim()?[]:e.split(/\s+/)}getDiff(e,t){const n={removed:[],added:t};for(let t=0,r=e.length;t<r;t+=1){const r=e[t];n.added.includes(r)?n.added.splice(n.added.indexOf(r),1):n.removed.push(r)}return n}handleDiff(e,t){for(const t of e)this.disconnectBehavior(t);for(const e of t)this.connectBehavior(e)}connectBehavior(e){const t=Er.get(e);if(!t)return;const n=new t(this.ownerElement);this.behaviors.set(e,n);const r=n.constructor.observedAttributes;if(this.ownerElement.isConnected){const t=this.ownerElement.tagName;if(n.awaitElementDefined&&t.includes("-")){const r=e+"_"+t;let i=this.elementDefinedPromises.get(r);i||(i=new Pr(customElements.whenDefined(t.toLowerCase()),{rejectOnCancel:!1}),this.elementDefinedPromises.set(r,i)),i.then((()=>{this.elementDefinedPromises.delete(r),this.connectedBehaviors.add(n),n.connectedCallback&&n.connectedCallback()}))}else this.connectedBehaviors.add(n),n.connectedCallback&&n.connectedCallback()}Array.isArray(r)&&r.length&&(this.fireInitialAttributeChangedCallbacks(n,r),this.createAttributeObserver(n))}disconnectBehavior(e){const t=this.behaviors.get(e);if(t){{this.connectedBehaviors.has(t)&&(t.disconnectedCallback&&t.disconnectedCallback(),this.connectedBehaviors.delete(t));const n=e+"_"+this.ownerElement.tagName,r=this.elementDefinedPromises.get(n);r&&(r.cancel(),this.elementDefinedPromises.delete(n))}this.destroyAttributeObserver(t),this.behaviors.delete(e)}}destroyAttributeObserver(e){const t=this.observers.get(e);t&&(t.disconnect(),this.observers.delete(e))}createAttributeObserver(e){const t=this.ownerElement,n=new MutationObserver((n=>{if(!e.attributeChangedCallback)return;let r,i={},o="";for(const t of n)"attributes"===t.type&&(o=t.attributeName,void 0!==i[o]?(e.attributeChangedCallback(o,i[o],t.oldValue),i[o]=t.oldValue):i[o]=t.oldValue);for(const n in i)r=t.attributes.getNamedItem(n),e.attributeChangedCallback(n,i[n],null===r?null:r.value)}));n.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:e.constructor.observedAttributes}),this.observers.set(e,n)}fireInitialAttributeChangedCallbacks(e,t){if(e.attributeChangedCallback)for(const n of t)this.ownerElement.hasAttribute(n)&&e.attributeChangedCallback(n,null,this.ownerElement.attributes.getNamedItem(n).value)}}const Cr=function(){const e=new WeakMap;return t=>{let n=e.get(t);return n||e.set(t,n={}),n}}();class Pr extends Promise{constructor(e,t){const n=!!t&&t.rejectOnCancel;let r;if(e instanceof Promise){const t=e;super(((e,n)=>{r=n,t.then((t=>{this.canceled||e(t)})).catch((e=>{this.canceled||n(e)}))}))}else super(((t,n)=>{r=n,e((e=>{this.canceled||t(e)}),(e=>{this.canceled||n(e)}))}));this.canceled=!1,Cr(this).originalReject=r,Cr(this).rejectOnCancel=n}cancel(){this.canceled=!0,Cr(this).rejectOnCancel&&Cr(this).originalReject(new Or("canceled"))}}class Or extends Error{}if(Tr.define("has",Lr),Element.prototype.attachShadow){const e=Element.prototype.attachShadow;Element.prototype.attachShadow=function(...t){const n=e.call(this,...t);return new _r(n).define("has",Lr),n}}const Nr=new WeakMap,Ir=new WeakMap;function Dr(e,t,n){let r;const i=n.inherited;if(!i)if(r=Ir.get(e),r){if(r.has(t))return}else Ir.set(e,r=new Set);const s=(0,o.ld)(e,t)||{value:void 0,writable:!0,configurable:!0,enumerable:!0},a=n.inherited&&s.owner||e;if(i)if(r=Ir.get(a),r){if(r.has(t))return}else Ir.set(a,r=new Set);let c,l;if(s.get||s.set){const t=s.get,n=s.set;c=t?()=>t.call(e):void 0,l=n?t=>n.call(e,t):void 0}else{let n=s.value;if(!s.writable)throw console.error(`Can not observe readonly property "${t}" with descriptor`,s,"of object:",e),new Error(`Can not observe readonly property "${t}" of object: ${e} (see above)`);delete s.value,delete s.writable,c=()=>n,l=e=>n=e}if(!l)throw new Error("Can not observe read-only property.");if(!c)throw new Error("Can not observe write-only property.");Object.defineProperty(a,t,{...s,get:c,set(n){l(n),function(e,t,n){const r=Nr.get(e).get(t);if(r)for(const e of r)e(t,n)}(e,t,c())}}),r.add(t)}var kr=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Br=Symbol();function Ur(e=Object){var t,n,r;class i extends e{constructor(...e){super(...e),t.add(this),this._propChangedCallback=this._propChangedCallback.bind(this)}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this.__forwardInitialProps(),kr(this,t,"m",n).call(this)}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),kr(this,t,"m",r).call(this)}get observedObject(){throw new TypeError("\n                The subclass using PropReceiver must define\n                'observedObject' to specify the object from which props\n                are received.\n            ")}_propChangedCallback(e,t){this[e]=t}__forwardedProps(){const e=this.constructor.receivedProperties||[];if(!Array.isArray(e))throw new TypeError("Expected protected static receivedProperties to be an array.");return e}__forwardInitialProps(){const e=this.observedObject;for(const t of this.__forwardedProps())t in e&&this._propChangedCallback(t,e[t])}}return t=new WeakSet,n=function(){!function(e,t,n,r={}){r.async=r.async||!1,r.inherited=r.inherited||!1;for(const i of t){let t=Nr.get(e);!t&&Nr.set(e,t=new Map);let o=t.get(i);o?o.includes(n)||o.push(n):(t.set(i,o=[]),o.push(n),Dr(e,i,r))}}(this.observedObject,this.__forwardedProps(),this._propChangedCallback,{}),this.__forwardedProps().includes("clipPlanes")},r=function(){!function(e,t,n){const r=Nr.get(e);if(r){if("function"==typeof t&&(n=t,t=Array.from(r.keys())),!n)throw new TypeError("callback not supplied");for(const e of t){const t=r.get(e);t.includes(n)&&(t.splice(t.indexOf(n),1),t.length||r.delete(e))}}else console.warn("the object is not observed, no need to unobserve:",e)}(this.observedObject,this.__forwardedProps(),this._propChangedCallback)},i[Br]=!0,i}function Fr(...e){return zr((function(e,t,n){const r=null==e?void 0:e.constructor;if(!r||!r[Br])throw new TypeError("@receiver must be used on a property of a class that extends PropReceiver");r.hasOwnProperty("receivedProperties")||(r.receivedProperties=[...r.receivedProperties||[]]),r.receivedProperties.push(t)}),...e)}function zr(e,t,n,r){if(t&&"kind"in t){const n=t;return{...n,finisher(t){var r,i;return e(t.prototype,n.key),null!==(i=null===(r=n.finisher)||void 0===r?void 0:r.call(n,t))&&void 0!==i?i:t}}}if(t&&n)return e(t,n,r);throw new TypeError("Invalid decorator")}function Hr(e){return Math.abs(e)<1e-6?0:e}function Gr(e,t,n,r){const i=jr(t,n,r);return i.observe(e,{childList:!0}),i}function jr(e,t,n=!1){return new MutationObserver((r=>{const i=new Map;for(let e=0,t=r.length;e<t;e+=1){const t=r[e];if("childList"!=t.type)continue;let n=i.get(t.target);n||i.set(t.target,n=new Map);const{addedNodes:o}=t;for(let e=o.length,t=0;t<e;t+=1)n.set(o[t],(n.get(o[t])||0)+1);const{removedNodes:s}=t;for(let e=s.length,t=0;t<e;t+=1)n.set(s[t],(n.get(s[t])||0)-1)}for(const r of Array.from(i)){const[i,o]=r;for(const r of Array.from(o)){const[o,s]=r;n&&(o instanceof Text||o instanceof Comment)||(s>0&&"function"==typeof e?e.call(i,o):s<0&&"function"==typeof t&&t.call(i,o))}}}))}function Vr(){return new Promise((e=>{if(document.body)return e();const t=new MutationObserver((()=>{document.body&&(e(),t.disconnect())}));t.observe(document.documentElement,{childList:!0})}))}function Wr(e){return e/180*Math.PI}function qr(e){return e/Math.PI*180}function Xr(e){return Promise.resolve().then(e)}function Yr(e){throw new Error(e)}function Zr(e){return e.split("\n").map((e=>e.trim())).join("\n")}function Jr(e){return"string"==typeof e?e.split(/([_A-Z])/).reduce(((e,t,n)=>`${e}${e&&n%2!=0?"-":""}${(t="_"===t?"":t).toLowerCase()}`)):e}function $r(e){return null==e}function Kr(e){return Array.from(new Set(e))}function Qr(e,t){let n={};return t.forEach((t=>{n[t]=e[t]})),n}function ei(e){return e}var ti,ni,ri,ii,oi,si,ai=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},ci=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class li extends(Ur()){constructor(e){super(),ti.add(this),this.awaitElementDefined=!0,ni.set(this,null),ri.set(this,!1),ii.set(this,!1),ai(this,ti,"m",si).call(this,e),this.element=e}requiredElementType(){return[Element]}get observedObject(){return this.element}__forwardInitialProps(){super.__forwardInitialProps(),ai(this,ti,"m",oi).call(this)}}ni=new WeakMap,ri=new WeakMap,ii=new WeakMap,ti=new WeakSet,oi=function(){if(ai(this,ii,"f"))return;const e=this.observedObject;if(function(e){return"_preUpgradeValues"in e}(e)){ci(this,ii,!0,"f");for(const t of this.__forwardedProps()){const n=e._preUpgradeValues.get(t);void 0!==n&&this._propChangedCallback(t,n)}}},si=async function(e){const t=this.requiredElementType();if(!e.nodeName.includes("-")){const n=`\n\t\t\t\tThe element you're using the mesh behavior on (<${e.tagName.toLowerCase()}>)\n\t\t\t\tis not an instance of one of the following classes:\n\t\t\t`;throw Xr((()=>console.error(n,t))),new Error(`${n}\n\n\t\t\t\t${t}\n\t\t\t`)}if(ci(this,ni,customElements.whenDefined(e.nodeName.toLowerCase()),"f"),ai(this,ni,"f").then((()=>{ci(this,ri,t.some((t=>e instanceof t)),"f"),ai(this,ti,"m",oi).call(this)})),await Promise.race([ai(this,ni,"f"),new Promise((e=>setTimeout(e,1e3)))]),!ai(this,ri,"f")){const n=`\n\t\t\t\t\tEither the element you're using the behavior on\n\t\t\t\t\t(<${e.tagName.toLowerCase()}>) is not an instance of one\n\t\t\t\t\tof the allowed classes, or there was a 1-second timeout waiting\n\t\t\t\t\tfor the element to be defined. Please make sure all elements\n\t\t\t\t\tyou intend to use are defined. The allowed classes are:\n\t\t\t\t`;throw Xr((()=>console.error(n,t))),new Error(`${n}\n\n\t\t\t\t\t${t}\n\t\t\t\t`)}};var ui=__webpack_require__(832);const hi=["subclass","extends",...Object.getOwnPropertyNames(new Function)],di=new WeakMap,pi=new WeakMap,fi=new ui.Ie,mi=new WeakMap,gi=new WeakMap,vi=new WeakMap,yi=new WeakMap,bi=new WeakMap,xi={mode:"es5",nativeNaming:!1,prototypeWritable:!1,defaultClassDescriptor:{writable:!0,enumerable:!1,configurable:!0},setClassDescriptors:!0};class _i extends Error{}class wi extends Error{}function Mi(e,t){let n=e.cachedPublicAccesses.get(t);return n||(Pi(e,t)?e.cachedPublicAccesses.set(t,n=Si(t).publicToPrivate.get(t)):Ci(e,t)?e.cachedPublicAccesses.set(t,n=fi.get(t)):e.cachedPublicAccesses.set(t,n=t),n)}function Ti(e,t){let n=e.cachedProtectedAccesses.get(t);if(n)return n;if(Li(e,t))e.cachedProtectedAccesses.set(t,n=fi.get(t)||Ei(t));else if(Pi(e,t)){const r=Si(t).publicToPrivate.get(t);e.cachedProtectedAccesses.set(t,n=fi.get(r)||Ei(r))}else Ci(e,t)&&e.cachedProtectedAccesses.set(t,n=t);if(!n)throw new wi("invalid access of protected member");return n}function Si(e){return mi.get(e)}function Ei(e){const t=function(e){let t=null,n=e.__proto__;for(;n;){if(t=di.get(n),t)return t;n=n.__proto__}return t}(e),n=Object.create(t);return fi.set(e,n),n}function Ai(e,t){let n=e.cachedPrivateAccesses.get(t);if(n)return n;if(Li(e,t))e.cachedPrivateAccesses.set(t,n=e.publicToPrivate.get(t)||Ri(e,t));else if(Ci(e,t)){const r=fi.get(t);e.cachedPrivateAccesses.set(t,n=e.publicToPrivate.get(r)||Ri(e,r))}else Pi(e,t)&&e.cachedPrivateAccesses.set(t,n=t);if(!n)throw new wi("invalid access of private member");return n}function Ri(e,t){const n=Object.create(e.privatePrototype);return e.publicToPrivate.set(t,n),mi.set(n,e),n}function Li(e,t,n=!0){if(!n)return(0,ui.nk)(t,e.publicPrototype);for(const n of Array.from(gi.get(e.classBrand)))if((0,ui.nk)(t,n))return!0;return!1}function Ci(e,t,n=!0){if(!n)return(0,ui.nk)(t,e.protectedPrototype);for(const n of Array.from(vi.get(e.classBrand)))if((0,ui.nk)(t,n))return!0;return!1}function Pi(e,t,n=!0){if(!n)return(0,ui.nk)(t,e.privatePrototype);for(const n of Array.from(yi.get(e.classBrand)))if((0,ui.nk)(t,n))return!0;return!1}function Oi(e,t,n){const{parentPublicPrototype:r,parentProtectedPrototype:i,parentPrivatePrototype:o}=t;if(Li(t,n,!1))return Ni(n,r,e);if(Ci(t,n,!1))return Ni(n,i,e);if(Pi(t,n,!1))return Ni(n,o,e);throw new _i("invalid super access")}function Ni(e,t,n){let r=n.get(e);if(!r){n.set(e,r=Object.create(t));const i=(0,ui.yA)(t);let o=i.length;for(;o--;){const n=i[o];(0,ui.q$)(r,n,{get:function(){let r;const i=(0,ui.ld)(t,n);if(i&&(0,ui.uh)(i)){const t=i.get;t&&(r=t.call(e))}else r=t[n];return r&&r.call&&"function"==typeof r&&(r=r.bind(e)),r},set:function(r){const i=(0,ui.ld)(t,n);if(i&&(0,ui.uh)(i)){const t=i.set;t&&(r=t.call(e,r))}else e[n]=r}},!0)}}return r}var Ii;!function(e){(e=e?{...xi,...e}:xi).defaultClassDescriptor={...xi.defaultClassDescriptor,...e.defaultClassDescriptor};const{mode:t,prototypeWritable:n,setClassDescriptors:r,nativeNaming:i}=e;function o(...e){let t=!1;if("function"==typeof this&&(t=!0),e.length<=3){let n="",r=null,i=null;"string"==typeof e[0]?n=e[0]:"function"!=typeof e[0]&&"object"!=typeof e[0]||(r=e[0],i=e[1]),"function"!=typeof e[1]&&"object"!=typeof e[1]||(r=e[1],i=e[2]);const o=t?s.call(this,n,r,i):s(n,r,i);return o.extends=function(e,t,o){return t=t||r,o=o||i,s.call(e,n,t,o)},o}throw new TypeError("invalid args")}return o;function s(s,a,c){let l=this;if("string"!=typeof s)throw new TypeError("\n                You must specify a string for the 'className' argument.\n            ");let u=null;if(a&&"object"==typeof a)u=a;else if(!l&&(!a||"function"!=typeof a&&"object"!=typeof a)){let e;return i&&s?e=new Function(`return function ${s}() {}`)():(e=function(){},s&&(0,ui.q$)(e,"name",{value:s})),e.prototype={__proto__:Object.prototype,constructor:e},(0,ui.q$)(e,"subclass",{value:o,writable:!0,enumerable:!1,configurable:!1}),e}const h=c?void 0:new ui.Ie;c&&(bi.get(c)||bi.set(c,new ui.Ie));const d={className:s,get publicToPrivate(){return h||bi.get(c)},classBrand:c=c||{brand:"lexical"},cachedPublicAccesses:new WeakMap,cachedProtectedAccesses:new WeakMap,cachedPrivateAccesses:new WeakMap},p=new WeakMap,f=Oi.bind(null,p,d),m=Mi.bind(null,d),g=Ti.bind(null,d),v=Ai.bind(null,d);if(m.prototype={},g.prototype={},v.prototype={},m.Public=m,m.Protected=g,m.Private=v,m.Super=f,g.Public=m,g.Protected=g,g.Private=v,g.Super=f,u=u||a&&a(m,g,v,f),u&&"object"!=typeof u&&"function"!=typeof u)throw new TypeError("\n                The return value of a class definer function, if any, should be\n                an object, or a class constructor.\n            ");let y,b=null;"function"==typeof u&&(b=u,u=u.prototype,l=b.prototype.__proto__.constructor),u&&(y=u.static,delete u.static,"function"==typeof u.public&&(u.public=u.public(g,v)),"function"==typeof u.protected&&(u.protected=u.protected(m,v)),"function"==typeof u.private&&(u.private=u.private(m,g))),l=l||Object;const x=l.prototype,_=u&&u.public||u||Object.create(x);_.__proto__!==x&&(_.__proto__=x);const w=function(e){let t,n=e;for(;n&&!t;)t=di.get(n),n=n.__proto__;return t||{}}(x),M=u&&u.protected||Object.create(w);M.__proto__!==w&&(M.__proto__=w),di.set(_,M);const T=function(e){let t,n=e;for(;n&&!t;)t=pi.get(n),n=n.__proto__;return t||{}}(x),S=u&&u.private||Object.create(T);if(S.__proto__!==T&&(S.__proto__=T),pi.set(_,S),gi.get(c)||gi.set(c,new Set),vi.get(c)||vi.set(c,new Set),yi.get(c)||yi.set(c,new Set),gi.get(c).add(_),vi.get(c).add(M),yi.get(c).add(S),d.publicPrototype=_,d.privatePrototype=S,d.protectedPrototype=M,d.parentPublicPrototype=x,d.parentProtectedPrototype=w,d.parentPrivatePrototype=T,(0,ui.Gm)(m.prototype,_),(0,ui.Gm)(g.prototype,M),(0,ui.Gm)(v.prototype,S),u&&(delete u.public,delete u.protected,delete u.private,u!==_&&(0,ui.Gm)(u,_)),b)return y&&(0,ui.Gm)(y,b),b;const E=_.hasOwnProperty("constructor")?_.constructor:null;let A=null,R=null;if("es5"!==t)throw new TypeError("\n                The lowclass \"mode\" option can only be 'es5' for now.\n            ");if(A=function(){let e=null,t=null;return t=E||l,t!==Object&&(e=t.apply(this,arguments)),!e||"object"!=typeof e&&"function"!=typeof e?this:e},R=_,s)if(i){const e=(0,ui.Sh)(A),t=A.prototype;A=new Function(" userConstructor, ParentClass ",`\n                    return function ${s}() { ${e} }\n                `)(E,l),A.prototype=t}else(0,ui.q$)(A,"name",{value:s});return E&&E.length&&(0,ui.q$)(A,"length",{value:E.length}),A.__proto__=l,y&&(0,ui.Gm)(y,A),(0,ui.q$)(A,"subclass",{value:o,writable:!0,enumerable:!1,configurable:!1}),A.prototype=R,A.prototype.constructor=A,r&&((0,ui.U8)(A,e,hi),(0,ui.q$)(A,"prototype",{writable:n}),(0,ui.Md)(A.prototype,e),(0,ui.Md)(M,e),(0,ui.Md)(S,e)),d.constructor=A,A}}(),function(e){e.PROXIES_ON_INSTANCE_AND_PROTOTYPE="PROXIES_ON_INSTANCE_AND_PROTOTYPE",e.PROXIES_ON_PROTOTYPE="PROXIES_ON_PROTOTYPE",e.PROXY_AFTER_INSTANCE_AND_PROTOTYPE="PROXY_AFTER_INSTANCE_AND_PROTOTYPE"}(Ii||(Ii={})),Ii.PROXIES_ON_INSTANCE_AND_PROTOTYPE;new WeakMap;function Di(){return this()}function ki(e){return this(e)}function Bi(e){let t;return re((n=>{t=n,ae(e)})),t}function Ui(e,t,n){const r=1===arguments.length&&"kind"in e;if(r){const t=e;return"class"===t.kind?{...t,finisher:zi}:{...t,finisher(e){var n,r;return Fi(e,t.key),null!==(r=null===(n=t.finisher)||void 0===n?void 0:n.call(t,e))&&void 0!==r?r:e}}}if(1===arguments.length&&"function"==typeof e)return zi(e);const i=e.constructor;Fi(i,t)}function Fi(e,t){e.reactiveProperties&&e.hasOwnProperty("reactiveProperties")||(e.reactiveProperties=[]),e.reactiveProperties.includes(t)||e.reactiveProperties.push(t)}function zi(e){var t;return e.hasOwnProperty("__isReactive__")?e:((t=class extends e{constructor(...t){super(...t),function(e,t){if(function(e){return"function"==typeof e}(t)){const n=t.reactiveProperties;Array.isArray(n)&&ji(e,n)}else ji(e,t)}(this,e)}}).__isReactive__=!0,t)}function Hi(e,t){const n="v_"+t;let r,i,o,s=(0,ui.ld)(e,t);if(s)if(r=s.get,i=s.set,r||i){if(!r||!i)return void console.warn('The `@reactive` decorator was used on an accessor named "'+t+'" which had a getter or a setter, but not both. Reactivity on accessors works only when accessors have both get and set. In this case the decorator does not do anything.');delete s.get,delete s.set}else{if(o=s.value,!s.writable)return void console.warn("The `@reactive` decorator was used on a property named "+t+" that is not writable. Reactivity is not enabled for non-writable properties.");delete s.value,delete s.writable}s={configurable:!0,enumerable:!0,...s,get:r?function(){return Gi(this,n,o)(),r.call(this)}:function(){return Gi(this,n,o)()},set:i?function(e){i.call(this,e),Gi(this,n)(e),this.__propsSetAtLeastOnce__||(this.__propsSetAtLeastOnce__=new Set),this.__propsSetAtLeastOnce__.add(t)}:function(e){Gi(this,n)(e),this.__propsSetAtLeastOnce__||(this.__propsSetAtLeastOnce__=new Set),this.__propsSetAtLeastOnce__.add(t)}},e.__reactifiedProps__||(e.__reactifiedProps__=new Set),e.__reactifiedProps__.add(t),Object.defineProperty(e,t,s)}function Gi(e,t,n){let r=e[t];return r||(e[t]=r=function(e){const[t,n]=ie(e,{equals:!1}),r=e=>void 0===e?t():(n((()=>e)),e),i=Di.bind(r),o=ki.bind(r);return r.get=i,r.set=o,r[0]=i,r[1]=o,r[Symbol.iterator]=function*(){yield r[0],yield r[1]},r}(n),r)}function ji(e,t){var n;for(const r of t){if(null===(n=e.__reactifiedProps__)||void 0===n?void 0:n.has(r))continue;const t=e[r];Hi(e,r),e[r]=t}}__webpack_require__(924);class Vi{constructor(e,t,n,r,i,o,s,a,c){this.GL_LOAD=e,this.GL_UNLOAD=t,this.CSS_LOAD=n,this.CSS_UNLOAD=r,this.BEHAVIOR_GL_LOAD=i,this.BEHAVIOR_GL_UNLOAD=o,this.MODEL_LOAD=s,this.MODEL_ERROR=a,this.PROGRESS=c}}const Wi=qi(Vi);function qi(e){const t={};for(const n in new e)t[n]=n;return Object.freeze(t)}const Xi=[];for(let e=0;e<256;e++)Xi[e]=(e<16?"0":"")+e.toString(16);let Yi=1234567;const Zi={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Xi[255&e]+Xi[e>>8&255]+Xi[e>>16&255]+Xi[e>>24&255]+"-"+Xi[255&t]+Xi[t>>8&255]+"-"+Xi[t>>16&15|64]+Xi[t>>24&255]+"-"+Xi[63&n|128]+Xi[n>>8&255]+"-"+Xi[n>>16&255]+Xi[n>>24&255]+Xi[255&r]+Xi[r>>8&255]+Xi[r>>16&255]+Xi[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Yi=e%2147483647),Yi=16807*Yi%2147483647,(Yi-1)/2147483646},degToRad:function(e){return e*Zi.DEG2RAD},radToDeg:function(e){return e*Zi.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((t+r)/2),u=s((t+r)/2),h=o((t-r)/2),d=s((t-r)/2),p=o((r-t)/2),f=s((r-t)/2);switch(i){case"XYX":e.set(a*u,c*h,c*d,a*l);break;case"YZY":e.set(c*d,a*u,c*h,a*l);break;case"ZXZ":e.set(c*h,c*d,a*u,a*l);break;case"XZX":e.set(a*u,c*f,c*p,a*l);break;case"YXY":e.set(c*p,a*u,c*f,a*l);break;case"ZYZ":e.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Ji{constructor(e=0,t=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return n.copy(e).slerp(t,r)}static slerpFlat(e,t,n,r,i,o,s){let a=n[r+0],c=n[r+1],l=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||c!==d||l!==p){let e=1-s;const t=a*h+c*d+l*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*e+h*i,c=c*e+d*i,l=l*e+p*i,u=u*e+f*i,e===1-s){const e=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=e,c*=e,l*=e,u*=e}}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const s=n[r],a=n[r+1],c=n[r+2],l=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return e[t]=s*p+l*u+a*d-c*h,e[t+1]=a*p+l*h+c*u-s*d,e[t+2]=c*p+l*d+s*h-a*u,e[t+3]=l*p-s*u-a*h-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case"XYZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"YXZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"ZXY":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"ZYX":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"YZX":this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p;break;case"XZY":this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],a=t[9],c=t[2],l=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(l-a)*e,this._y=(i-c)*e,this._z=(o-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(l-a)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+c)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-c)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(a+l)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-r)/e,this._x=(i+c)/e,this._y=(a+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Zi.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,c=t._z,l=t._w;return this._x=n*l+o*s+r*c-i*a,this._y=r*l+o*a+i*s-n*c,this._z=i*l+o*c+n*a-r*s,this._w=o*l-n*s-r*a-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),u=Math.sin((1-t)*l)/c,h=Math.sin(t*l)/c;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class $i{constructor(e=0,t=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Qi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Qi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,c=a*t+o*r-s*n,l=a*n+s*t-i*r,u=a*r+i*n-o*t,h=-i*t-o*n-s*r;return this.x=c*a+h*-i+l*-s-u*-o,this.y=l*a+h*-o+u*-i-c*-s,this.z=u*a+h*-s+c*-o-l*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ki.copy(this).projectOnVector(e),this.sub(Ki)}reflect(e){return this.sub(Ki.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Zi.clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Ki=new $i,Qi=new Ji;class eo{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new eo).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/to.setFromMatrixColumn(e,0).length(),i=1/to.setFromMatrixColumn(e,1).length(),o=1/to.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),c=Math.sin(r),l=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*l,n=o*u,r=s*l,i=s*u;t[0]=a*l,t[4]=-a*u,t[8]=c,t[1]=n+r*c,t[5]=e-i*c,t[9]=-s*a,t[2]=i-e*c,t[6]=r+n*c,t[10]=o*a}else if("YXZ"===e.order){const e=a*l,n=a*u,r=c*l,i=c*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=o*c,t[1]=o*u,t[5]=o*l,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*l,n=a*u,r=c*l,i=c*u;t[0]=e-i*s,t[4]=-o*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=o*l,t[9]=i-e*s,t[2]=-o*c,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*l,n=o*u,r=s*l,i=s*u;t[0]=a*l,t[4]=r*c-n,t[8]=e*c+i,t[1]=a*u,t[5]=i*c+e,t[9]=n*c-r,t[2]=-c,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*c,r=s*a,i=s*c;t[0]=a*l,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*l,t[9]=-s*l,t[2]=-c*l,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=o*a,n=o*c,r=s*a,i=s*c;t[0]=a*l,t[4]=-u,t[8]=c*l,t[1]=e*u+i,t[5]=o*l,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*l,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ro,e,io)}lookAt(e,t,n){const r=this.elements;return ao.subVectors(e,t),0===ao.lengthSq()&&(ao.z=1),ao.normalize(),oo.crossVectors(n,ao),0===oo.lengthSq()&&(1===Math.abs(n.z)?ao.x+=1e-4:ao.z+=1e-4,ao.normalize(),oo.crossVectors(n,ao)),oo.normalize(),so.crossVectors(ao,oo),r[0]=oo.x,r[4]=so.x,r[8]=ao.x,r[1]=oo.y,r[5]=so.y,r[9]=ao.y,r[2]=oo.z,r[6]=so.z,r[10]=ao.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],M=r[8],T=r[12],S=r[1],E=r[5],A=r[9],R=r[13],L=r[2],C=r[6],P=r[10],O=r[14],N=r[3],I=r[7],D=r[11],k=r[15];return i[0]=o*_+s*S+a*L+c*N,i[4]=o*w+s*E+a*C+c*I,i[8]=o*M+s*A+a*P+c*D,i[12]=o*T+s*R+a*O+c*k,i[1]=l*_+u*S+h*L+d*N,i[5]=l*w+u*E+h*C+d*I,i[9]=l*M+u*A+h*P+d*D,i[13]=l*T+u*R+h*O+d*k,i[2]=p*_+f*S+m*L+g*N,i[6]=p*w+f*E+m*C+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*T+f*R+m*O+g*k,i[3]=v*_+y*S+b*L+x*N,i[7]=v*w+y*E+b*C+x*I,i[11]=v*M+y*A+b*P+x*D,i[15]=v*T+y*R+b*O+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],c=e[13],l=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-r*c*u-i*s*h+n*c*h+r*s*d-n*a*d)+e[7]*(+t*a*d-t*c*h+i*o*h-r*o*d+r*c*l-i*a*l)+e[11]*(+t*c*u-t*s*d-i*o*u+n*o*d+i*s*l-n*c*l)+e[15]*(-r*s*l-t*a*u+t*s*h+r*o*u-n*o*h+n*a*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*c-f*h*c+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*c-l*m*c-p*a*d+o*m*d+l*a*g-o*h*g,b=l*f*c-p*u*c+p*s*d-o*f*d-l*s*g+o*u*g,x=p*u*a-l*f*a-p*s*h+o*f*h+l*s*m-o*u*m,_=t*v+n*y+r*b+i*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(s*m*i-f*a*i+f*r*c-n*m*c-s*r*g+n*a*g)*w,e[3]=(u*a*i-s*h*i-u*r*c+n*h*c+s*r*d-n*a*d)*w,e[4]=y*w,e[5]=(l*m*i-p*h*i+p*r*d-t*m*d-l*r*g+t*h*g)*w,e[6]=(p*a*i-o*m*i-p*r*c+t*m*c+o*r*g-t*a*g)*w,e[7]=(o*h*i-l*a*i+l*r*c-t*h*c-o*r*d+t*a*d)*w,e[8]=b*w,e[9]=(p*u*i-l*f*i-p*n*d+t*f*d+l*n*g-t*u*g)*w,e[10]=(o*f*i-p*s*i+p*n*c-t*f*c-o*n*g+t*s*g)*w,e[11]=(l*s*i-o*u*i-l*n*c+t*u*c+o*n*d-t*s*d)*w,e[12]=x*w,e[13]=(l*f*r-p*u*r+p*n*h-t*f*h-l*n*m+t*u*m)*w,e[14]=(p*s*r-o*f*r-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*r-l*s*r+l*n*a-t*u*a-o*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,c=i*o,l=i*s;return this.set(c*o+n,c*s-r*a,c*a+r*s,0,c*s+r*a,l*s+n,l*a-r*o,0,c*a-r*s,l*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,c=i+i,l=o+o,u=s+s,h=i*c,d=i*l,p=i*u,f=o*l,m=o*u,g=s*u,v=a*c,y=a*l,b=a*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-b)*_,r[5]=(1-(h+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=to.set(r[0],r[1],r[2]).length();const o=to.set(r[4],r[5],r[6]).length(),s=to.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],no.copy(this);const a=1/i,c=1/o,l=1/s;return no.elements[0]*=a,no.elements[1]*=a,no.elements[2]*=a,no.elements[4]*=c,no.elements[5]*=c,no.elements[6]*=c,no.elements[8]*=l,no.elements[9]*=l,no.elements[10]*=l,t.setFromRotationMatrix(no),n.x=i,n.y=o,n.z=s,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(t-e),c=2*i/(n-r),l=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,o){const s=this.elements,a=1/(t-e),c=1/(n-r),l=1/(o-i),u=(t+e)*a,h=(n+r)*c,d=(o+i)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const to=new $i,no=new eo,ro=new $i(0,0,0),io=new $i(1,1,1),oo=new $i,so=new $i,ao=new $i;function co(){}Object.assign(co.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}});class lo{constructor(e=0,t=0,n=0,r=lo.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const r=Zi.clamp,i=e.elements,o=i[0],s=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return uo.makeRotationFromQuaternion(e),this.setFromRotationMatrix(uo,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return ho.setFromEuler(this),this.setFromQuaternion(ho,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new $i(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}lo.DefaultOrder="XYZ",lo.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const uo=new eo,ho=new Ji;class po{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}class fo{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,c){const l=this.elements;return l[0]=e,l[1]=r,l[2]=s,l[3]=t,l[4]=i,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=o*f+s*v+a*x,i[3]=o*m+s*y+a*_,i[6]=o*g+s*b+a*w,i[1]=c*f+l*v+u*x,i[4]=c*m+l*y+u*_,i[7]=c*g+l*b+u*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*_,i[8]=h*g+d*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8];return t*o*l-t*s*c-n*i*l+n*s*a+r*i*c-r*o*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=l*o-s*c,h=s*a-l*i,d=c*i-o*a,p=t*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*c-l*n)*f,e[2]=(s*n-r*o)*f,e[3]=h*f,e[4]=(l*t-r*a)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*a-c*t)*f,e[8]=(o*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,s){const a=Math.cos(i),c=Math.sin(i);return this.set(n*a,n*c,-n*(a*o+c*s)+o+e,-r*c,r*a,-r*(-c*o+a*s)+s+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],c=r[4],l=r[7];return r[0]=t*i+n*a,r[3]=t*o+n*c,r[6]=t*s+n*l,r[1]=-n*i+t*a,r[4]=-n*o+t*c,r[7]=-n*s+t*l,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}let mo=0;const go=new $i,vo=new Ji,yo=new eo,bo=new $i,xo=new $i,_o=new $i,wo=new Ji,Mo=new $i(1,0,0),To=new $i(0,1,0),So=new $i(0,0,1),Eo={type:"added"},Ao={type:"removed"};function Ro(){Object.defineProperty(this,"id",{value:mo++}),this.uuid=Zi.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ro.DefaultUp.clone();const e=new $i,t=new lo,n=new Ji,r=new $i(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new eo},normalMatrix:{value:new fo}}),this.matrix=new eo,this.matrixWorld=new eo,this.matrixAutoUpdate=Ro.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new po,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}function Lo(e,...t){let n="",r="";const i=(e=[].slice.call(e.raw,0)).length-1;e[0].match(/^\//)&&(e[0]=e[0].replace(/^\//,""),r=e[i].match(/\/[gimuy]*$/),r=r[0].replace(/\//,""),e[i]=e[i].replace(/\/[gimuy]*$/,""));for(let r=0;r<t.length;r++)n+=e[r],n+=t[r]instanceof RegExp?t[r].source:t[r]?t[r].toString():"";return n+=e[i],new RegExp(n,r)}Ro.DefaultUp=new $i(0,1,0),Ro.DefaultMatrixAutoUpdate=!0,Ro.prototype=Object.assign(Object.create(co.prototype),{constructor:Ro,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return vo.setFromAxisAngle(e,t),this.quaternion.multiply(vo),this},rotateOnWorldAxis:function(e,t){return vo.setFromAxisAngle(e,t),this.quaternion.premultiply(vo),this},rotateX:function(e){return this.rotateOnAxis(Mo,e)},rotateY:function(e){return this.rotateOnAxis(To,e)},rotateZ:function(e){return this.rotateOnAxis(So,e)},translateOnAxis:function(e,t){return go.copy(e).applyQuaternion(this.quaternion),this.position.add(go.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Mo,e)},translateY:function(e){return this.translateOnAxis(To,e)},translateZ:function(e){return this.translateOnAxis(So,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(yo.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?bo.copy(e):bo.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),xo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?yo.lookAt(xo,bo,this.up):yo.lookAt(bo,xo,this.up),this.quaternion.setFromRotationMatrix(yo),r&&(yo.extractRotation(r.matrixWorld),vo.setFromRotationMatrix(yo),this.quaternion.premultiply(vo.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Eo)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ao)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Ao)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),yo.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),yo.multiply(e.parent.matrixWorld)),e.applyMatrix4(yo),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new $i),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Ji),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xo,e,_o),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new $i),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xo,wo,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new $i),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),c=o(e.skeletons),l=o(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}});const Co=Lo;Co.identifier=/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/,Co.identifierList=Co`(?:(${Co.identifier})+\s*,\s*)*(?:(${Co.identifier})+)?`,Co.functionHeader=Co`\bfunction\s*(${Co.identifier})?\s*\(\s*${Co.identifierList}\s*\)\s*{`,Co.classMethodHeader=Co`\s*(${Co.identifier})\s*\(\s*${Co.identifierList}\s*\)\s*{`,Co.digit=/\d/,Co.integer=Co`/${Co.digit}+/`,Co.number=Co`/(?:${Co.digit}*\.${Co.integer}|${Co.integer}\.${Co.digit}*|${Co.integer})/`,Co.escape=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const Po={};function Oo(e,t=","){let n=Po[t=t||","];return n||(n=Lo`/(?:\s*${Lo.escape(t)}\s*)|(?:\s+)/g`,Po[t]=n),e.trim().split(n)}var No,Io,Do,ko,Bo,Uo,Fo,zo=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Ho=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Go=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},jo=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Vo={x:void 0,y:void 0,z:void 0};let Wo=class extends(k()){constructor(e,t,n){super(),No.add(this),Io.set(this,void 0),Do.set(this,void 0),ko.set(this,void 0),Go(this,No,"m",Uo).call(this,e,t,n)}set x(e){"string"==typeof e&&(e=this.deserializeValue("x",e)),this.checkValue("x",e)&&(jo(this,Io,e,"f"),this.emit("valuechanged","x"))}get x(){return Go(this,Io,"f")}set y(e){"string"==typeof e&&(e=this.deserializeValue("y",e)),this.checkValue("y",e)&&(jo(this,Do,e,"f"),this.emit("valuechanged","y"))}get y(){return Go(this,Do,"f")}set z(e){"string"==typeof e&&(e=this.deserializeValue("z",e)),this.checkValue("z",e)&&(jo(this,ko,e,"f"),this.emit("valuechanged","z"))}get z(){return Go(this,ko,"f")}fromDefault(){return this.from(Go(this,No,"a",Bo)),this}from(e,t,n){return Go(this,No,"m",Uo).call(this,e,t,n)}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}fromArray(e){return this.set(e[0],e[1],e[2]),this}toArray(){return[this.x,this.y,this.z]}fromObject(e){return this.set(e.x,e.y,e.z),this}toObject(){return{x:this.x,y:this.y,z:this.z}}fromString(e,t=","){return this.fromArray(Go(this,No,"m",Fo).call(this,e,t)),this}toString(e=""){return e?`${this.x}${e} ${this.y}${e} ${this.z}`:`${this.x} ${this.y} ${this.z}`}deserializeValue(e,t){return t}checkValue(e,t){return!0}};Io=new WeakMap,Do=new WeakMap,ko=new WeakMap,No=new WeakSet,Bo=function(){return this.default||Vo},Uo=function(e,t,n){if(null==e&&void 0===t&&void 0===n)this.fromDefault();else if(Array.isArray(e))this.fromArray(e);else if("object"==typeof e&&null!==e){if(e===this)return this;this.fromObject(e)}else"string"==typeof e&&void 0===t&&void 0===n?this.fromString(e):this.set(e,t,n);return this},Fo=function(e,t=","){const n=Oo(e,t),r=[],i=n.length;return i>0&&(r[0]=this.deserializeValue("x",n[0])),i>1&&(r[1]=this.deserializeValue("y",n[1])),i>2&&(r[2]=this.deserializeValue("z",n[2])),r},zo([In,Ho("design:type",Object),Ho("design:paramtypes",[Object])],Wo.prototype,"x",null),zo([In,Ho("design:type",Object),Ho("design:paramtypes",[Object])],Wo.prototype,"y",null),zo([In,Ho("design:type",Object),Ho("design:paramtypes",[Object])],Wo.prototype,"z",null),Wo=zo([In,Ho("design:paramtypes",[Object,Object,Object])],Wo);class qo extends Wo{get default(){return{x:0,y:0,z:0}}deserializeValue(e,t){return Number(t)}checkValue(e,t){if(!super.checkValue(e,t))return!1;if(void 0===t)return!1;if("number"!=typeof t||isNaN(t)||!isFinite(t))throw new TypeError(`Expected ${e} to be a finite number. Received: ${t}`);return!0}}var Xo=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Yo=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};function Zo(e){var t,n,r,i,s,a,c;return c=class extends((0,o.v_)(e)){constructor(...e){super(...e),t.add(this),n.set(this,null),Xo(this,t,"m",r).call(this)}connectedCallback(){var e;null===(e=super.connectedCallback)||void 0===e||e.call(this),Xo(this,t,"m",s).call(this),Xo(this,t,"m",r).call(this)}disconnectedCallback(){var e;null===(e=super.disconnectedCallback)||void 0===e||e.call(this),Xo(this,t,"m",i).call(this)}},n=new WeakMap,t=new WeakSet,r=function(){Xo(this,n,"f")||Yo(this,n,Gr(this,(e=>{this.isConnected&&this.childConnectedCallback&&this.childConnectedCallback(e)}),(e=>{this.isConnected&&this.childDisconnectedCallback&&this.childDisconnectedCallback(e)}),!0),"f")},i=function(){Xo(this,n,"f")&&(Xo(this,n,"f").disconnect(),Yo(this,n,null,"f"))},s=function(){if(this.isConnected)for(let e=this.firstElementChild;e;e=e.nextElementSibling)Xo(this,t,"m",a).call(this,e)},a=function(e){var t;e.matches(":defined")?null===(t=this.childConnectedCallback)||void 0===t||t.call(this,e):customElements.whenDefined(e.tagName.toLowerCase()).then((()=>{var t;null===(t=this.childConnectedCallback)||void 0===t||t.call(this,e)}))},c}function Jo(e){var t,n,r;return r=class extends((0,o.v_)(e)){constructor(){super(...arguments),t.add(this)}connectedCallback(){super.connectedCallback&&super.connectedCallback(),function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,t,"m",n).call(this)}},t=new WeakSet,n=function(){let e=this.constructor.defaultBehaviors;if(!e)return;if(0==Object.keys(e).length)return;const t=this.getAttribute("has"),n=t&&t.split(" ")||[];if(0===n.length)e instanceof Array||(e=Object.keys(e)),this.setAttribute("has",`${this.getAttribute("has")||""} ${e.join(" ")}`);else{let t="";if(e instanceof Array)for(const r of e){let e=!1;for(const t of n)if(r==t){e=!0;break}e||(t&&(t+=" "),t+=r)}else if("object"==typeof e){const r=Object.keys(e);for(const i of r){const r=e[i];("function"==typeof r&&r(n)||"function"!=typeof r&&r)&&(t&&(t+=" "),t+=i)}}if(t){let e=this.getAttribute("has");e&&(e+=" "),this.setAttribute("has",e+t)}}},r.defaultBehaviors=[],r}const $o=new WeakMap;function Ko(e){return e.isNode}class Qo extends(Jo(Zo(rn))){constructor(){super(...arguments),this.isScene=!1,this.isNode=!1,this.__composedParent=null,this.__isPossiblyDistributedToShadowRoot=!1,this.__distributedParent=null,this.__shadowRootParent=null}static define(e){this.defineElement(e)}attachShadow(e){const t=super.attachShadow(e);if(this.isScene)return t;this.__shadowRoot=t;const n=Gr(t,this.__shadowRootChildAdded.bind(this),this.__shadowRootChildRemoved.bind(this),!0);$o.set(t,n);const r=Array.from(this.children);for(const e of r)e instanceof Qo&&(e.__isPossiblyDistributedToShadowRoot=!0,this.__triggerChildUncomposedCallback(e,"actual"));return t}childConnectedCallback(e){Ko(e)?!this.isScene&&this.__shadowRoot?e.__isPossiblyDistributedToShadowRoot=!0:this.__triggerChildComposedCallback(e,"actual"):e instanceof HTMLSlotElement&&(e.addEventListener("slotchange",this.__onChildSlotChange),Xr((()=>this.__handleDistributedChildren(e))))}childDisconnectedCallback(e){Ko(e)?!this.isScene&&this.__shadowRoot?e.__isPossiblyDistributedToShadowRoot=!1:this.__triggerChildUncomposedCallback(e,"actual"):e instanceof HTMLSlotElement&&(e.removeEventListener("slotchange",this.__onChildSlotChange,{capture:!0}),this.__handleDistributedChildren(e),this.__previousSlotAssignedNodes.delete(e))}setAttribute(e,t){super.setAttribute(e,t)}get _hasShadowRoot(){return!!this.__shadowRoot}get _isPossiblyDistributedToShadowRoot(){return this.__isPossiblyDistributedToShadowRoot}get _shadowRootParent(){return this.__shadowRootParent}get _shadowRootChildren(){return this.__shadowRoot?Array.from(this.__shadowRoot.children).filter((e=>e instanceof Qo)):[]}get _distributedShadowRootChildren(){var e;const t=[];for(const n of Array.from((null===(e=this.__shadowRoot)||void 0===e?void 0:e.children)||[]))if(n instanceof HTMLSlotElement&&!n.assignedSlot)for(const e of n.assignedElements({flatten:!0}))Ko(e)&&t.push(e);return t}get _distributedParent(){return this.__distributedParent}get _distributedChildren(){return this.__distributedChildren?[...this.__distributedChildren]:null}get composedParent(){let e=this.__composedParent;return e||(e=this.__getComposedParent()),e}__getComposedParent(){let e=this.parentElement;if(e&&e.isScene)return e;if(e=this.__distributedParent||this.__shadowRootParent,e)return e;if(e=this.parentNode,e instanceof HTMLSlotElement){const t=e;if(t.assignedElements({flatten:!0}).length)return null;const n=t.parentNode;return n instanceof ShadowRoot?n.host:t.parentElement}if(e instanceof ShadowRoot)return e.host;if(e instanceof HTMLElement){if(!ts(e))return e;const t=this.assignedSlot;if(!t)return null;const n=t.parentNode;return n instanceof ShadowRoot?n.host:t.parentElement}return null}get _composedChildren(){return!this.isScene&&this.__shadowRoot?[...this._distributedShadowRootChildren,...this._shadowRootChildren]:[...this.__distributedChildren||[],...Array.from(this.children).filter((e=>e instanceof Qo))]}get __previousSlotAssignedNodes(){return this.__prevAssignedNodes||(this.__prevAssignedNodes=new WeakMap),this.__prevAssignedNodes}__shadowRootChildAdded(e){e instanceof Qo?(e.__shadowRootParent=this,this.__triggerChildComposedCallback(e,"root")):e instanceof HTMLSlotElement&&(e.addEventListener("slotchange",this.__onChildSlotChange),this.__handleDistributedChildren(e))}__shadowRootChildRemoved(e){e instanceof Qo?(e.__shadowRootParent=null,this.__triggerChildUncomposedCallback(e,"root")):e instanceof HTMLSlotElement&&(e.removeEventListener("slotchange",this.__onChildSlotChange,{capture:!0}),this.__handleDistributedChildren(e),this.__previousSlotAssignedNodes.delete(e))}get __onChildSlotChange(){return this.__onChildSlotChange__||(this.__onChildSlotChange__=e=>{const t=e.currentTarget;this.__handleDistributedChildren(t)}),this.__onChildSlotChange__}__triggerChildComposedCallback(e,t){this.childComposedCallback&&(e.matches(":defined")?(e.__composedParent=this,this.childComposedCallback(e,t)):customElements.whenDefined(e.tagName.toLowerCase()).then((()=>{e.__composedParent=this,this.childComposedCallback(e,t)})))}__triggerChildUncomposedCallback(e,t){var n;e.__composedParent=null,null===(n=this.childUncomposedCallback)||void 0===n||n.call(this,e,t)}__handleDistributedChildren(e){const t=this.__getDistributedChildDifference(e),{added:n}=t;for(let e=n.length,t=0;t<e;t+=1){const e=n[t];if(!(e instanceof Qo))continue;const r=e.__distributedParent;if(r){const t=r.__distributedChildren;t&&(t.delete(e),t.size||(r.__distributedChildren=void 0))}e.__distributedParent=this,this.__distributedChildren||(this.__distributedChildren=new Set),this.__distributedChildren.add(e),this.__triggerChildComposedCallback(e,"slot")}const{removed:r}=t;for(let e=r.length,t=0;t<e;t+=1){const e=r[t];e instanceof Qo&&(e.__distributedParent=null,this.__distributedChildren.delete(e),this.__distributedChildren.size||(this.__distributedChildren=void 0),this.__triggerChildUncomposedCallback(e,"slot"))}}__getDistributedChildDifference(e){var t;const n=null!==(t=this.__previousSlotAssignedNodes.get(e))&&void 0!==t?t:[],r=!this.isScene&&e.assignedSlot?[]:e.assignedElements({flatten:!0});this.__previousSlotAssignedNodes.set(e,[...r]);const i={added:r,removed:[]};for(let e=0,t=n.length;e<t;e+=1){const t=n[e];r.indexOf(t)>=0?r.splice(e,1):i.removed.push(t)}return i}traverseComposed(e,t=!1){if(!t){for(const n of this._composedChildren)n.traverseComposed(e,t);return}let n=Promise.resolve();for(const r of this._composedChildren)n=r.matches(":defined")?n.then((()=>r.traverseComposed(e,t))):n.then((()=>customElements.whenDefined(r.tagName.toLowerCase()))).then((()=>r.traverseComposed(e,t)));return n}}const es=new WeakSet;{const e=Element.prototype.attachShadow;Element.prototype.attachShadow=function(...t){const n=e.apply(this,t);return es.add(this),n}}function ts(e){return es.has(e)}class ns extends(k(Qo)){get parentLumeElement(){return this.parentElement instanceof ns?this.parentElement:null}get lumeChildren(){return Array.prototype.filter.call(this.children,(e=>e instanceof ns))}get lumeChildCount(){return this.lumeChildren.length}}class rs extends Wo{get default(){return{x:"",y:"",z:""}}checkValue(e,t){if(!super.checkValue(e,t))return!1;if(void 0===t)return!1;if("string"!=typeof t)throw new TypeError(`Expected ${e} to be a string. Received: ${t}`);return!0}}class is extends rs{get default(){return{x:"literal",y:"literal",z:"literal"}}get allowedValues(){return["literal","proportional"]}checkValue(e,t){if(!super.checkValue(e,t))return!1;if(!this.allowedValues.includes(t))throw new TypeError(`Expected ${e} to be one of 'literal' or 'proportional'. Received: '${t}'`);return!0}}class os extends qo{checkValue(e,t){if(!super.checkValue(e,t))return!1;if(t<0)throw new TypeError(`Expected ${e} not to be negative. Received: ${t}`);return!0}}var ss,as,cs,ls,us,hs,ds,ps,fs,ms,gs,vs,ys,bs=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},xs=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};as=new WeakMap,cs=new WeakMap,ls=new WeakMap,us=new WeakMap,hs=new WeakMap,ds=new WeakMap,ps=new WeakMap,fs=new WeakMap,ss=new WeakSet,ms=async function(){if("loading"===document.readyState&&await new Promise((e=>setTimeout(e))),bs(this,as,"f"))return;xs(this,as,!0,"f");let e=performance.now();for(;bs(this,as,"f");){const t=await bs(this,ss,"m",gs).call(this),n=t-e;bs(this,ss,"m",vs).call(this,t,n),bs(this,ss,"m",ys).call(this,t,n),bs(this,us,"f").length||xs(this,as,!1,"f"),e=t}},gs=function(){return new Promise((e=>bs(this,fs,"f").call(this,e)))},vs=function(e,t){for(xs(this,cs,0,"f");bs(this,cs,"f")<bs(this,ls,"f");xs(this,cs,bs(this,cs,"f")+1,"f")){const n=bs(this,us,"f")[bs(this,cs,"f")];!1===n(e,t)&&this.removeRenderTask(n)}},ys=function(e,t){if(!bs(this,hs,"f").length)return;for(let n=0,r=bs(this,hs,"f").length;n<r;n+=1){const r=bs(this,hs,"f")[n];r.scene&&(r.update(e,t),r.getNearestAncestorThatShouldBeRendered()||bs(this,ps,"f").includes(r)||bs(this,ps,"f").push(r),bs(this,ds,"f").includes(r.scene)||bs(this,ds,"f").push(r.scene))}const n=bs(this,ps,"f");for(let e=0,t=n.length;e<t;e+=1)n[e].updateWorldMatrices();n.length=0;const r=bs(this,ds,"f");for(let e=0,t=r.length;e<t;e+=1)r[e].drawScene();r.length=0;const i=bs(this,hs,"f");for(let e=0,t=i.length;e<t;e+=1)i[e].__willBeRendered=!1;i.length=0};const _s=new class{constructor(){ss.add(this),as.set(this,!1),cs.set(this,0),ls.set(this,0),us.set(this,[]),hs.set(this,[]),ds.set(this,[]),ps.set(this,[]),fs.set(this,window.requestAnimationFrame.bind(window))}addRenderTask(e){if("function"!=typeof e)throw new Error("Render task must be a function.");return bs(this,us,"f").includes(e)||(bs(this,us,"f").push(e),xs(this,ls,bs(this,ls,"f")+1,"f"),bs(this,as,"f")||bs(this,ss,"m",ms).call(this)),e}removeRenderTask(e){const t=bs(this,us,"f").indexOf(e);-1!=t&&(bs(this,us,"f").splice(t,1),xs(this,ls,bs(this,ls,"f")-1,"f"),t<=bs(this,cs,"f")&&xs(this,cs,bs(this,cs,"f")-1,"f"))}once(e){return this.addRenderTask(((t,n)=>(e(t,n),!1)))}setNodeToBeRendered(e){bs(this,hs,"f").includes(e)||(bs(this,hs,"f").push(e),bs(this,ss,"m",ms).call(this))}setFrameRequester(e){xs(this,fs,e,"f")}};var ws,Ms,Ts,Ss,Es,As,Rs,Ls,Cs=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Ps=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Os=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Ns=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Is={},Ds=new WeakMap,ks=new WeakMap;let Bs=Ls=class extends ns{constructor(){super(),ws.add(this),this.__calculatedSize={x:0,y:0,z:0},this._stopFns=[],Ms.set(this,!1),Ts.set(this,null),Ss.set(this,!1),this.sizeMode.on("valuechanged",(()=>!this._isSettingProperty&&(this.sizeMode=this.sizeMode))),this.size.on("valuechanged",(()=>!this._isSettingProperty&&(this.size=this.size)))}set sizeMode(e){if("function"==typeof e)throw new TypeError("property functions are not allowed for sizeMode");Ds.has(this)||Ds.set(this,new is("literal","literal","literal")),this._setPropertyXYZ("sizeMode",Ds.get(this),e)}get sizeMode(){return Ds.has(this)||Ds.set(this,new is("literal","literal","literal")),Ds.get(this)}set size(e){ks.has(this)||ks.set(this,new os(0,0,0)),this._setPropertyXYZ("size",ks.get(this),e)}get size(){return ks.has(this)||ks.set(this,new os(0,0,0)),ks.get(this)}get calculatedSize(){var e;return{...null!==(e=this.__calculatedSize)&&void 0!==e?e:{x:0,y:0,z:0}}}connectedCallback(){super.connectedCallback()}disconnectedCallback(){var e;null===(e=super.disconnectedCallback)||void 0===e||e.call(this);for(const e of this._stopFns)e();this._stopFns.length=0}get composedLumeParent(){const e=this.composedParent;return e instanceof Ls?e:null}get composedLumeChildren(){return super._composedChildren}get parentSize(){var e,t;return null!==(t=null===(e=this.composedLumeParent)||void 0===e?void 0:e.calculatedSize)&&void 0!==t?t:{x:0,y:0,z:0}}_calcSize(){var e;const t=null!==(e=this.__calculatedSize)&&void 0!==e?e:{x:0,y:0,z:0};Object.assign(Is,t);const n=this.size,r=this.sizeMode,i=this.parentSize;"literal"==r.x?t.x=n.x:t.x=i.x*n.x,"literal"==r.y?t.y=n.y:t.y=i.y*n.y,"literal"==r.z?t.z=n.z:t.z=i.z*n.z,this.__calculatedSize=t,Is.x===t.x&&Is.y===t.y&&Is.z===t.z||this.emit("sizechange",{...t})}get _isSettingProperty(){return Os(this,Ms,"f")}_setPropertyXYZ(e,t,n){n!==t&&(Ns(this,Ms,!0,"f"),"function"==typeof n?Os(this,ws,"m",Es).call(this,n,e,t):(Os(this,Ss,"f")?Ns(this,Ss,!1,"f"):Os(this,ws,"m",Rs).call(this,e),Hn((()=>t.from(n)))),Ns(this,Ms,!1,"f"))}_setPropertySingle(e,t,n){Ns(this,Ms,!0,"f"),"function"==typeof n?Os(this,ws,"m",As).call(this,n,e):(Os(this,Ss,"f")?Ns(this,Ss,!1,"f"):Os(this,ws,"m",Rs).call(this,e),Hn((()=>t(n)))),Ns(this,Ms,!1,"f")}};Ms=new WeakMap,Ts=new WeakMap,Ss=new WeakMap,ws=new WeakSet,Es=function(e,t,n){Os(this,Ts,"f")||Ns(this,Ts,new Map,"f");const r=Os(this,Ts,"f").get(t);r&&_s.removeRenderTask(r),Os(this,Ts,"f").set(t,_s.addRenderTask(((r,i)=>{const o=e(n.x,n.y,n.z,r,i);if(!1===o)return Os(this,Ts,"f").delete(t),!1;Ns(this,Ss,!0,"f"),n.from(o)})))},As=function(e,t){Os(this,Ts,"f")||Ns(this,Ts,new Map,"f");const n=Os(this,Ts,"f").get(t);n&&_s.removeRenderTask(n),Os(this,Ts,"f").set(t,_s.addRenderTask((n=>{const r=e(this[t],n);if(!1===r)return Os(this,Ts,"f").delete(t),!1;Ns(this,Ss,!0,"f"),this[t]=r})))},Rs=function(e){if(!Os(this,Ts,"f"))return;const t=Os(this,Ts,"f").get(e);t&&(_s.removeRenderTask(t),Os(this,Ts,"f").delete(e),Os(this,Ts,"f").size||Ns(this,Ts,null,"f"))},Cs([Ui,Ps("design:type",Object)],Bs.prototype,"__calculatedSize",void 0),Cs([jn,U("propertychange"),Ps("design:type",Object),Ps("design:paramtypes",[Object])],Bs.prototype,"sizeMode",null),Cs([jn,U("propertychange"),Ps("design:type",Object),Ps("design:paramtypes",[Object])],Bs.prototype,"size",null),Bs=Ls=Cs([Yn,Ps("design:paramtypes",[])],Bs);var Us=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Fs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const zs=new WeakMap,Hs=new WeakMap,Gs=new WeakMap,js=new WeakMap,Vs=new WeakMap,Ws=new WeakMap,qs=new WeakMap;let Xs=class extends Bs{constructor(){super(),this.position.on("valuechanged",(()=>!this._isSettingProperty&&(this.position=this.position))),this.rotation.on("valuechanged",(()=>!this._isSettingProperty&&(this.rotation=this.rotation))),this.scale.on("valuechanged",(()=>!this._isSettingProperty&&(this.scale=this.scale))),this.origin.on("valuechanged",(()=>!this._isSettingProperty&&(this.origin=this.origin))),this.alignPoint.on("valuechanged",(()=>!this._isSettingProperty&&(this.alignPoint=this.alignPoint))),this.mountPoint.on("valuechanged",(()=>!this._isSettingProperty&&(this.mountPoint=this.mountPoint)))}set position(e){zs.has(this)||zs.set(this,new qo(0,0,0)),this._setPropertyXYZ("position",zs.get(this),e)}get position(){return zs.has(this)||zs.set(this,new qo(0,0,0)),zs.get(this)}set rotation(e){Hs.has(this)||Hs.set(this,new qo(0,0,0)),this._setPropertyXYZ("rotation",Hs.get(this),e)}get rotation(){return Hs.has(this)||Hs.set(this,new qo(0,0,0)),Hs.get(this)}set scale(e){Gs.has(this)||Gs.set(this,new qo(1,1,1)),this._setPropertyXYZ("scale",Gs.get(this),e)}get scale(){return Gs.has(this)||Gs.set(this,new qo(1,1,1)),Gs.get(this)}set origin(e){js.has(this)||js.set(this,new qo(.5,.5,.5)),this._setPropertyXYZ("origin",js.get(this),e)}get origin(){return js.has(this)||js.set(this,new qo(.5,.5,.5)),js.get(this)}set alignPoint(e){Vs.has(this)||Vs.set(this,new qo(0,0,0)),this._setPropertyXYZ("alignPoint",Vs.get(this),e)}get alignPoint(){return Vs.has(this)||Vs.set(this,new qo(0,0,0)),Vs.get(this)}set mountPoint(e){Ws.has(this)||Ws.set(this,new qo(0,0,0)),this._setPropertyXYZ("mountPoint",Ws.get(this),e)}get mountPoint(){return Ws.has(this)||Ws.set(this,new qo(0,0,0)),Ws.get(this)}set opacity(e){qs.has(this)||qs.set(this,1),this._setPropertySingle("opacity",(e=>qs.set(this,e)),e)}get opacity(){return qs.has(this)||qs.set(this,1),qs.get(this)}};Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"position",null),Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"rotation",null),Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"scale",null),Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"origin",null),Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"alignPoint",null),Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"mountPoint",null),Us([jn,U("propertychange"),Fs("design:type",Object),Fs("design:paramtypes",[Object])],Xs.prototype,"opacity",null),Xs=Us([Yn,Fs("design:paramtypes",[])],Xs);var Ys,Zs,Js,$s,Ks,Qs,ea,ta,na=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},ra=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};void 0===document.createElement("div").style.transform&&"undefined"!=typeof CSSStyleDeclaration&&Object.defineProperty(CSSStyleDeclaration.prototype,"transform",{set(e){this.webkitTransform=e},get(){return this.webkitTransform},enumerable:!0});class ia{constructor(e){Ys.add(this),Zs.set(this,void 0),Js.set(this,!1),na(this,Zs,e,"f")}connectChildElement(e){(!e.parentNode||e.parentElement&&e.parentElement!==ra(this,Zs,"f"))&&ra(this,Ys,"m",$s).call(this,e)}disconnectChildElement(e){e.parentNode&&ra(this,Ys,"m",Ks).call(this,e)}applyProperties(){ra(this,Js,"f")&&(ra(this,Ys,"m",ea).call(this),ra(this,Ys,"m",Qs).call(this))}set shouldRender(e){na(this,Js,e,"f"),requestAnimationFrame((()=>{ra(this,Ys,"m",ta).call(this,"display",e?"block":"none")}))}get shouldRender(){return ra(this,Js,"f")}}Zs=new WeakMap,Js=new WeakMap,Ys=new WeakSet,$s=function(e){ra(this,Zs,"f").appendChild(e)},Ks=function(e){e.parentNode===ra(this,Zs,"f")&&ra(this,Zs,"f").removeChild(e)},Qs=function(){const{x:e,y:t}=ra(this,Zs,"f").calculatedSize;ra(this,Ys,"m",ta).call(this,"width",`${e}px`),ra(this,Ys,"m",ta).call(this,"height",`${t}px`)},ea=function(){ra(this,Ys,"m",ta).call(this,"opacity",ra(this,Zs,"f").opacity.toString())},ta=function(e,t){ra(this,Zs,"f").style.setProperty(e,t)};class oa extends Ro{constructor(){super(...arguments),this.type="Object3DWithPivot"}get pivot(){return this.__pivot||(this.__pivot=new $i),this.__pivot}set pivot(e){this.__pivot=e}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const e=this.pivot;if(0!==e.x||0!==e.y||0!==e.z){const t=e.x,n=e.y,r=e.z,i=this.matrix.elements;i[12]+=t-i[0]*t-i[4]*n-i[8]*r,i[13]+=n-i[1]*t-i[5]*n-i[9]*r,i[14]+=r-i[2]*t-i[6]*n-i[10]*r}this.matrixWorldNeedsUpdate=!0}}Ro.prototype.updateMatrix=oa.prototype.updateMatrix,Object.defineProperty(Ro.prototype,"pivot",Object.getOwnPropertyDescriptor(oa.prototype,"pivot"));const sa="124",aa={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ca={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},la=0,ua=1,ha=2,da=3,pa=0,fa=1,ma=2,ga=3,va=0,ya=1,ba=2,xa=1,_a=2,wa=0,Ma=1,Ta=2,Sa=3,Ea=4,Aa=5,Ra=100,La=101,Ca=102,Pa=103,Oa=104,Na=200,Ia=201,Da=202,ka=203,Ba=204,Ua=205,Fa=206,za=207,Ha=208,Ga=209,ja=210,Va=0,Wa=1,qa=2,Xa=3,Ya=4,Za=5,Ja=6,$a=7,Ka=0,Qa=1,ec=2,tc=0,nc=1,rc=2,ic=3,oc=4,sc=5,ac=300,cc=301,lc=302,uc=303,hc=304,dc=306,pc=307,fc=1e3,mc=1001,gc=1002,vc=1003,yc=1004,bc=1004,xc=1005,_c=1005,wc=1006,Mc=1007,Tc=1007,Sc=1008,Ec=1008,Ac=1009,Rc=1010,Lc=1011,Cc=1012,Pc=1013,Oc=1014,Nc=1015,Ic=1016,Dc=1017,kc=1018,Bc=1019,Uc=1020,Fc=1021,zc=1022,Hc=1023,Gc=1024,jc=1025,Vc=Hc,Wc=1026,qc=1027,Xc=1028,Yc=1029,Zc=1030,Jc=1031,$c=1032,Kc=1033,Qc=33776,el=33777,tl=33778,nl=33779,rl=35840,il=35841,ol=35842,sl=35843,al=36196,cl=37492,ll=37496,ul=37808,hl=37809,dl=37810,pl=37811,fl=37812,ml=37813,gl=37814,vl=37815,yl=37816,bl=37817,xl=37818,_l=37819,wl=37820,Ml=37821,Tl=36492,Sl=37840,El=37841,Al=37842,Rl=37843,Ll=37844,Cl=37845,Pl=37846,Ol=37847,Nl=37848,Il=37849,Dl=37850,kl=37851,Bl=37852,Ul=37853,Fl=2200,zl=2201,Hl=2202,Gl=2300,jl=2301,Vl=2302,Wl=2400,ql=2401,Xl=2402,Yl=2500,Zl=2501,Jl=0,$l=1,Kl=2,Ql=3e3,eu=3001,tu=3007,nu=3002,ru=3003,iu=3004,ou=3005,su=3006,au=3200,cu=3201,lu=0,uu=1,hu=0,du=7680,pu=7681,fu=7682,mu=7683,gu=34055,vu=34056,yu=5386,bu=512,xu=513,_u=514,wu=515,Mu=516,Tu=517,Su=518,Eu=519,Au=35044,Ru=35048,Lu=35040,Cu=35045,Pu=35049,Ou=35041,Nu=35046,Iu=35050,Du=35042,ku="100",Bu="300 es";let Uu=0;function Fu(){Object.defineProperty(this,"id",{value:Uu++}),this.uuid=Zi.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=Ma,this.side=va,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Ba,this.blendDst=Ua,this.blendEquation=Ra,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Xa,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Eu,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=du,this.stencilZFail=du,this.stencilZPass=du,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Fu.prototype=Object.assign(Object.create(co.prototype),{constructor:Fu,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===xa;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Ma&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==va&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Fu.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class zu{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}const Hu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gu={h:0,s:0,l:0},ju={h:0,s:0,l:0};function Vu(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Wu(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function qu(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Xu{constructor(e,t,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Zi.euclideanModulo(e,1),t=Zi.clamp(t,0,1),n=Zi.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Vu(i,r,e+1/3),this.g=Vu(i,r,e),this.b=Vu(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Hu[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Wu(e.r),this.g=Wu(e.g),this.b=Wu(e.b),this}copyLinearToSRGB(e){return this.r=qu(e.r),this.g=qu(e.g),this.b=qu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let s,a;const c=(o+i)/2;if(o===i)s=0,a=0;else{const e=i-o;switch(a=c<=.5?e/(i+o):e/(2-i-o),i){case t:s=(n-r)/e+(n<r?6:0);break;case n:s=(r-t)/e+2;break;case r:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=c,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Gu),Gu.h+=e,Gu.s+=t,Gu.l+=n,this.setHSL(Gu.h,Gu.s,Gu.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpHSL(e,t){this.getHSL(Gu),e.getHSL(ju);const n=Zi.lerp(Gu.h,ju.h,t),r=Zi.lerp(Gu.s,ju.s,t),i=Zi.lerp(Gu.l,ju.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}function Yu(e){Fu.call(this),this.type="MeshPhongMaterial",this.color=new Xu(16777215),this.specular=new Xu(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lu,this.normalScale=new zu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ka,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Zu(e){return"geometry"in e&&"material"in e}function Ju(e){if(!Zu(e))return;const t=[].concat(e.material);for(const e of t)e.dispose()}function $u(e,t=!0,n=!0,r=!0){e&&(Zu(e)&&(e.geometry&&n&&e.geometry.dispose(),r&&Ju(e)),t&&Xr((()=>{e.parent&&e.parent.remove(e)})))}function Ku(e,t={}){e.traverse((e=>{$u(e,t.removeFromParent,t.destroyGeometry,t.destroyMaterial)}))}function Qu(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n&&Math.abs(e.w-t.w)<n}function eh(e,t,n=!0){Zu(e)&&(n&&e.material&&Ju(e),e.material=t)}function th(e,t,n){nh(e,5592405*Math.random()+5592405,t,n)}function nh(e,t,n,r=!0){const i=new Yu;i.color=new Xu(t),r?e.traverse((e=>eh(e,i,n))):eh(e,i,n)}function rh(e){return!!e.isPerspectiveCamera}function ih(e){return!!e.isOrthographicCamera}function oh(e){return!("object"!=typeof e||!e||!("dispose"in e))}Xu.NAMES=Hu,Xu.prototype.r=1,Xu.prototype.g=1,Xu.prototype.b=1,Yu.prototype=Object.create(Fu.prototype),Yu.prototype.constructor=Yu,Yu.prototype.isMeshPhongMaterial=!0,Yu.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};var sh,ah,ch,lh,uh,hh,dh,ph,fh,mh,gh=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},vh=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class yh extends oa{constructor(e){super(),this.element=e,this.type="CSS3DObjectNested",sh.set(this,requestAnimationFrame((()=>{this.element.style.position="absolute"})))}dispose(){cancelAnimationFrame(gh(this,sh,"f"))}}sh=new WeakMap;class bh extends yh{}class xh{constructor(){ah.add(this),ch.set(this,new eo),lh.set(this,{camera:{fov:0,style:""},objects:new WeakMap}),uh.set(this,0),hh.set(this,0),dh.set(this,0),ph.set(this,0),fh.set(this,void 0);const e=document.createElement("div");e.classList.add("CSS3DRendererNested"),e.style.overflow="hidden",this.domElement=e;const t=document.createElement("div");t.classList.add("cameraElement"),t.appendChild(document.createElement("slot")),t.style.transformStyle="preserve-3d",e.appendChild(t),vh(this,fh,t,"f")}getSize(){return{width:gh(this,uh,"f"),height:gh(this,hh,"f")}}setSize(e,t){vh(this,uh,e,"f"),vh(this,hh,t,"f"),vh(this,dh,e/2,"f"),vh(this,ph,t/2,"f"),this.domElement.style.width=e+"px",this.domElement.style.height=t+"px",gh(this,fh,"f").style.width=e+"px",gh(this,fh,"f").style.height=t+"px"}render(e,t){const n=t.projectionMatrix.elements[5]*gh(this,ph,"f");gh(this,lh,"f").camera.fov!==n&&(rh(t)&&(this.domElement.style.perspective=n+"px"),gh(this,lh,"f").camera.fov=n),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(void 0);let r=0,i=0;ih(t)&&(r=-(t.right+t.left)/2,i=(t.top+t.bottom)/2);const o=(ih(t)?"scale("+n+")translate("+Mh(r)+"px,"+Mh(i)+"px)"+_h(t.matrixWorldInverse):"translateZ("+n+"px)"+_h(t.matrixWorldInverse))+"translate("+gh(this,dh,"f")+"px,"+gh(this,ph,"f")+"px)";gh(this,lh,"f").camera.style!==o&&(gh(this,fh,"f").style.transform=o,gh(this,lh,"f").camera.style=o),gh(this,ah,"m",mh).call(this,e,t)}}function _h(e){const t=e.elements;return"matrix3d("+Mh(t[0])+","+Mh(-t[1])+","+Mh(t[2])+","+Mh(t[3])+","+Mh(t[4])+","+Mh(-t[5])+","+Mh(t[6])+","+Mh(t[7])+","+Mh(t[8])+","+Mh(-t[9])+","+Mh(t[10])+","+Mh(t[11])+","+Mh(t[12])+","+Mh(-t[13])+","+Mh(t[14])+","+Mh(t[15])+")"}function wh(e,t){const n=e.parent,r=n&&"Scene"===n.type,i=t.elements;return`${r?"translate(-50%, -50%)":""} ${"matrix3d("+Mh(i[0])+","+Mh(i[1])+","+Mh(i[2])+","+Mh(i[3])+","+Mh((r?-1:1)*i[4])+","+Mh((r?-1:1)*i[5])+","+Mh((r?-1:1)*i[6])+","+Mh((r?-1:1)*i[7])+","+Mh(i[8])+","+Mh(i[9])+","+Mh(i[10])+","+Mh(i[11])+","+Mh(i[12])+","+Mh((r?1:-1)*i[13])+","+Mh(i[14])+","+Mh(i[15])+")"}`}function Mh(e){return Math.abs(e)<1e-10?0:e}ch=new WeakMap,lh=new WeakMap,uh=new WeakMap,hh=new WeakMap,dh=new WeakMap,ph=new WeakMap,fh=new WeakMap,ah=new WeakSet,mh=function e(t,n){if(t instanceof yh){let e="";t instanceof bh?(gh(this,ch,"f").copy(n.matrixWorldInverse),gh(this,ch,"f").transpose(),gh(this,ch,"f").copyPosition(t.matrixWorld),gh(this,ch,"f").scale(t.scale),gh(this,ch,"f").elements[3]=0,gh(this,ch,"f").elements[7]=0,gh(this,ch,"f").elements[11]=0,gh(this,ch,"f").elements[15]=1,e=wh(t,gh(this,ch,"f"))):e=wh(t,t.matrix);const r=t.element,i=gh(this,lh,"f").objects.get(t);if(void 0===i||i.style!==e){r.style.transform=e;const n={style:e};gh(this,lh,"f").objects.set(t,n)}}for(let r=0,i=t.children.length;r<i;r++)gh(this,ah,"m",e).call(this,t.children[r],n)};const Th=Symbol();function Sh(e=Object){var t;class n extends e{constructor(){super(...arguments),this[t]=!0}set(e){return Object.assign(this,e),this}}return t=Th,n.prototype[Th]=!0,n}Object.defineProperty(Sh,Symbol.hasInstance,{value:e=>!!e&&!!e[Th]});var Eh,Ah=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Rh=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function Lh(e){return e.isNode}const Ch=[0,0,0],Ph=[0,0,0],Oh=[0,0,0],Nh=[0,0,0],Ih=new WeakMap,Dh=new WeakSet,kh=e=>Dh.has(e);let Bh=Eh=class extends(Sh(Xs)){constructor(){super(...arguments),this.isScene=!1,this.isNode=!1,this._scene=null,this._glLoaded=!1,this._cssLoaded=!1,this.__willBeRendered=!1,this._glStopFns=[],this._cssStopFns=[]}get glLoaded(){return this._glLoaded}get cssLoaded(){return this._cssLoaded}get scene(){return this._scene}get three(){return this.__three||(this.__three=this.__makeThreeObject3d()),this.__three}__makeThreeObject3d(){const e=this.makeThreeObject3d();return e.name=`${this.tagName}${this.id?"#"+this.id:""} (webgl, ${e.type})`,Dh.add(e),e}__disposeThree(){this.__three&&($u(this.__three),Dh.delete(this.__three),this.__three=void 0)}recreateThree(){var e;const t=null===(e=this.__three)||void 0===e?void 0:e.children;this.__disposeThree(),this._connectThree(),t&&t.length&&this.three.add(...t)}get threeCSS(){return this.__threeCSS||(this.__threeCSS=this.__makeThreeCSSObject()),this.__threeCSS}__makeThreeCSSObject(){const e=this.makeThreeCSSObject();return e.name=`${this.tagName}${this.id?"#"+this.id:""} (css3d, ${e.type})`,Dh.add(e),e}__disposeThreeCSS(){this.__threeCSS&&($u(this.__threeCSS),Dh.delete(this.__threeCSS),this.__threeCSS=void 0)}recreateThreeCSS(){var e;const t=null===(e=this.__threeCSS)||void 0===e?void 0:e.children;this.__disposeThreeCSS(),this._connectThreeCSS(),t&&t.length&&this.threeCSS.add(...t)}connectedCallback(){super.connectedCallback(),this._stopFns.push(Nn((()=>{this.scene,this.sizeMode,this.size,Hn((()=>{this._calcSize(),this.needsUpdate()}))})),Nn((()=>{this.scene&&(this.parentSize,Hn((()=>{"proportional"!==this.sizeMode.x&&"proportional"!==this.sizeMode.y&&"proportional"!==this.sizeMode.z&&0===this.alignPoint.x&&0===this.alignPoint.y&&0===this.alignPoint.z||(this._calcSize(),this.needsUpdate())})))})),Nn((()=>{this.position,this.rotation,this.scale,this.origin,this.alignPoint,this.mountPoint,this.opacity,this.needsUpdate()})))}disconnectedCallback(){super.disconnectedCallback(),this.__possiblyUnloadThree(this),this._scene=null}childComposedCallback(e,t){var n;if(!(e instanceof Eh))return;const r=null!==(n=this._scene)&&void 0!==n?n:this.isScene&&this;r&&this.__giveSceneToChildrenAndMaybeLoadThree(e,r)}childUncomposedCallback(e,t){e instanceof Eh&&(this.__possiblyUnloadThree(e),e._scene=null)}__giveSceneToChildrenAndMaybeLoadThree(e,t){e.traverseSceneGraph((n=>{e!==this&&(n._scene=t),this.__possiblyLoadThree(n)}))}traverseSceneGraph(e,t=!1){throw"Node and Scene implement this"}__possiblyLoadThree(e){Lh(e)&&(e._triggerLoadGL(),e._triggerLoadCSS())}__possiblyUnloadThree(e){Lh(e)&&(e._triggerUnloadGL(),e._triggerUnloadCSS())}get parentLumeElement(){const e=super.parentLumeElement;if(e&&!(e instanceof Eh))throw new TypeError("Parent must be type ImperativeBase.");return e}needsUpdate(){this.__willBeRendered=!0,_s.setNodeToBeRendered(this)}get _elementOperations(){return Ih.has(this)||Ih.set(this,new ia(this)),Ih.get(this)}get composedLumeChildren(){const e=[];for(const t of super.composedLumeChildren)Lh(t)&&e.push(t);return e}makeThreeObject3d(){return new Ro}makeThreeCSSObject(){if(!(this instanceof HTMLElement))throw"API available only in DOM environment.";return new yh(this)}_connectThree(){var e;null===(e=this.composedSceneGraphParent)||void 0===e||e.three.add(this.three);for(const e of this.composedLumeChildren)this.three.add(e.three);this.needsUpdate()}_connectThreeCSS(){var e;null===(e=this.composedSceneGraphParent)||void 0===e||e.threeCSS.add(this.threeCSS);for(const e of this.composedLumeChildren)this.threeCSS.add(e.threeCSS);this.needsUpdate()}get composedLumeParent(){const e=super.composedLumeParent;return e instanceof Eh?e:null}get composedSceneGraphParent(){var e;const t=this.composedLumeParent;return(null===(e=this.parentLumeElement)||void 0===e?void 0:e.isScene)?this.parentLumeElement:t}_loadGL(){return!(!this.scene||!this.scene.webgl||this._glLoaded||(this._glLoaded=!0,this.three.matrixAutoUpdate=!1,this._connectThree(),this.needsUpdate(),0))}_unloadGL(){if(!this._glLoaded)return!1;this._glLoaded=!1;for(const e of this._glStopFns)e();return this._glStopFns.length=0,this.__disposeThree(),this.needsUpdate(),!0}_loadCSS(){return!(!this.scene||!this.scene.enableCss||this._cssLoaded||(this._cssLoaded=!0,this.threeCSS.matrixAutoUpdate=!1,this._connectThreeCSS(),this.needsUpdate(),0))}_unloadCSS(){if(!this._cssLoaded)return!1;this._cssLoaded=!1;for(const e of this._cssStopFns)e();return this._cssStopFns.length=0,this.__disposeThreeCSS(),this.needsUpdate(),!0}_triggerLoadGL(){this._loadGL()&&(this.emit(Wi.BEHAVIOR_GL_LOAD,this),Xr((async()=>{await null,await null,this.emit(Wi.GL_LOAD,this)})))}_triggerUnloadGL(){this._unloadGL()&&(this.emit(Wi.BEHAVIOR_GL_UNLOAD,this),Xr((()=>this.emit(Wi.GL_UNLOAD,this))))}_triggerLoadCSS(){this._loadCSS()&&this.emit(Wi.CSS_LOAD,this)}_triggerUnloadCSS(){this._unloadCSS()&&this.emit(Wi.CSS_UNLOAD,this)}_calculateMatrix(){var e;const t=this.alignPoint,n=this.mountPoint,r=this.position,i=this.origin,o=this.calculatedSize;Ch[0]=o.x/2,Ch[1]=o.y/2,Ch[2]=o.z/2;const s=this.parentSize;Ch[0]+=-s.x/2,Ch[1]+=-s.y/2,Ch[2]+=-s.z/2,Ph[0]=s.x*t.x,Ph[1]=s.y*t.y,Ph[2]=s.z*t.z,Oh[0]=o.x*n.x,Oh[1]=o.y*n.y,Oh[2]=o.z*n.z,Nh[0]=r.x+Ph[0]-Oh[0],Nh[1]=r.y+Ph[1]-Oh[1],Nh[2]=r.z+Ph[2]-Oh[2],this.three.position.set(Nh[0]+Ch[0],-(Nh[1]+Ch[1]),Nh[2]+Ch[2]),(null===(e=this.composedSceneGraphParent)||void 0===e?void 0:e.isScene)?this.threeCSS.position.set(Nh[0]+Ch[0],-(Nh[1]+Ch[1]),Nh[2]+Ch[2]):this.threeCSS.position.set(Nh[0],-Nh[1],Nh[2]+Ch[2]),.5!==i.x||.5!==i.y||.5!==i.z?(this.three.pivot.set(i.x*o.x-o.x/2,-(i.y*o.y-o.y/2),i.z*o.z-o.z/2),this.threeCSS.pivot.set(i.x*o.x-o.x/2,-(i.y*o.y-o.y/2),i.z*o.z-o.z/2)):(this.three.pivot.set(0,0,0),this.threeCSS.pivot.set(0,0,0)),this.three.updateMatrix(),this.threeCSS.updateMatrix()}_updateRotation(){var e;const{x:t,y:n,z:r}=this.rotation;this.three.rotation.set(-Wr(t),Wr(n),-Wr(r));const i=null===(e=this.composedSceneGraphParent)||void 0===e?void 0:e.isScene;this.threeCSS.rotation.set((i?-1:1)*Wr(t),Wr(n),(i?-1:1)*Wr(r))}_updateScale(){const{x:e,y:t,z:n}=this.scale;this.three.scale.set(e,t,n),this.threeCSS.scale.set(e,t,n)}updateWorldMatrices(){this.three.updateWorldMatrix(!1,!1);for(const e of this.three.children)kh(e)||e.updateMatrixWorld(!0);this.threeCSS.updateWorldMatrix(!1,!1);for(const e of this.threeCSS.children)kh(e)||e.updateMatrixWorld(!0);this.traverseSceneGraph((e=>e!==this&&e.updateWorldMatrices()),!1),this.emit("worldMatrixUpdate")}update(e,t){this._updateRotation(),this._updateScale(),this._calculateMatrix(),this._elementOperations.applyProperties()}getNearestAncestorThatShouldBeRendered(){let e=this.composedSceneGraphParent;for(;e;){if(e.__willBeRendered)return e;e=e.composedSceneGraphParent}return null}};Ah([In,Rh("design:type",Object)],Bh.prototype,"_scene",void 0),Ah([In,Rh("design:type",Object)],Bh.prototype,"_cssLoaded",void 0),Bh=Eh=Ah([Yn],Bh),window.addEventListener("error",(e=>{const t=e.error;t&&/Illegal constructor/i.test(t.message)&&console.error("\n\t\t\tOne of the reasons the following error can happen is if a Custom\n\t\t\tElement is called with 'new' before being defined. Did you forget\n\t\t\tto call 'LUME.defineElements()'?  For other reasons, see:\n\t\t\thttps://www.google.com/search?q=chrome%20illegal%20constructor\n        ")}));class Uh extends Bh{constructor(){super(...arguments),this.hasShadow=!1}}var Fh,zh;Uh.css="\n\t\t:host {\n\t\t\t/*\n\t\t\t * All items of the scene graph are hidden until they are mounted in\n\t\t\t * a scene (this changes to display:block). This gets toggled\n\t\t\t * between \"none\" and \"block\" by ImperativeBase depending on if CSS\n\t\t\t * rendering is enabled.\n\t\t\t */\n\t\t\tdisplay: none;\n\n\t\t\t/*\n\t\t\tLayout of a node's CSS rectangle is never affected by anything\n\t\t\toutside of it. We don't contain paint because CSS content can\n\t\t\toverflow if desired, or size because eventually we'll add natural\n\t\t\tsizing to let the node be sized by its content.\n\t\t\t*/\n\t\t\tcontain: layout;\n\n\t\t\t/* TODO see how content-visibility affects CSS performance with nodes that are off-screen. */\n\t\t\t/* content-visibility: auto; implies contain:strict */\n\n\t\t\tbox-sizing: border-box;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\n\t\t\t/*\n\t\t\t * Defaults to [0.5,0.5,0.5] (the Z axis doesn't apply for DOM\n\t\t\t * elements, but does for 3D objects in WebGL that have any size\n\t\t\t * along Z.)\n\t\t\t */\n\t\t\ttransform-origin: 50% 50% 0; /* default */\n\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\t";const Hh=null!==(zh=null===(Fh=window.$LUME)||void 0===Fh?void 0:Fh.autoDefineElements)&&void 0!==zh&&zh;var Gh=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},jh=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Vh=class extends Uh{constructor(){super(),this.isNode=!0,this.visible=!0,this.composedLumeParent&&(this._calcSize(),Xr((()=>this.needsUpdate())))}get parentSize(){var e;const t=this.composedLumeParent;return this.scene&&this.scene===this.parentElement?this.scene.calculatedSize:null!==(e=null==t?void 0:t.calculatedSize)&&void 0!==e?e:{x:0,y:0,z:0}}traverseSceneGraph(e,t=!1){if(e(this),!t){for(const n of this.composedLumeChildren)n.traverseSceneGraph(e,t);return}let n=Promise.resolve();for(const r of this.composedLumeChildren)n=r.matches(":defined")?n.then((()=>r.traverseSceneGraph(e,t))):n.then((()=>customElements.whenDefined(r.tagName.toLowerCase()))).then((()=>r.traverseSceneGraph(e,t)));return n}_loadCSS(){return!!super._loadCSS()&&(this._cssStopFns.push(Nn((()=>{this._elementOperations.shouldRender=this.visible,this.needsUpdate()}))),!0)}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Nn((()=>{this.three.visible=this.visible,this.needsUpdate()}))),!0)}};Gh([Xn(!0),U("propertychange"),jh("design:type",Object)],Vh.prototype,"visible",void 0),Vh=Gh([Yn("lume-node",Hh),jh("design:paramtypes",[])],Vh),Vh.prototype.isNode=!0;var Wh,qh,Xh,Yh=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Zh extends li{constructor(){super(...arguments),Wh.add(this),this._glLoaded=!1,this._cssLoaded=!1,this._stopFns=[]}requiredElementType(){return[Vh]}connectedCallback(){super.connectedCallback(),Yh(this,Wh,"m",qh).call(this),this.element.on(Wi.BEHAVIOR_GL_LOAD,Yh(this,Wh,"m",qh),this),this.element.on(Wi.BEHAVIOR_GL_UNLOAD,Yh(this,Wh,"m",Xh),this)}disconnectedCallback(){super.disconnectedCallback(),Yh(this,Wh,"m",Xh).call(this),this.element.off(Wi.BEHAVIOR_GL_LOAD,Yh(this,Wh,"m",qh),this),this.element.off(Wi.BEHAVIOR_GL_UNLOAD,Yh(this,Wh,"m",Xh),this)}get glLoaded(){return this._glLoaded}get cssLoaded(){return this._cssLoaded}createEffect(e){this._stopFns.push(Bi(e))}stopEffects(){for(const e of this._stopFns)e();this._stopFns.length=0}}Wh=new WeakSet,qh=function(){var e;this.element.three&&(this._glLoaded||(this._glLoaded=!0,null===(e=this.loadGL)||void 0===e||e.call(this)))},Xh=function(){var e;this._glLoaded&&(this._glLoaded=!1,this.stopEffects(),null===(e=this.unloadGL)||void 0===e||e.call(this))};class Jh{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new $i(1/0,1/0,1/0),this.max=void 0!==t?t:new $i(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.length;a<c;a+=3){const c=e[a],l=e[a+1],u=e[a+2];c<t&&(t=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.count;a<c;a++){const c=e.getX(a),l=e.getY(a),u=e.getZ(a);c<t&&(t=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Qh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new $i),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new $i),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),ed.copy(t.boundingBox),ed.applyMatrix4(e.matrixWorld),this.union(ed));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new $i),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Qh),Qh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ad),cd.subVectors(this.max,ad),td.subVectors(e.a,ad),nd.subVectors(e.b,ad),rd.subVectors(e.c,ad),id.subVectors(nd,td),od.subVectors(rd,nd),sd.subVectors(td,rd);let t=[0,-id.z,id.y,0,-od.z,od.y,0,-sd.z,sd.y,id.z,0,-id.x,od.z,0,-od.x,sd.z,0,-sd.x,-id.y,id.x,0,-od.y,od.x,0,-sd.y,sd.x,0];return!!$h(t,td,nd,rd,cd)&&(t=[1,0,0,0,1,0,0,0,1],!!$h(t,td,nd,rd,cd)&&(ld.crossVectors(id,od),t=[ld.x,ld.y,ld.z],$h(t,td,nd,rd,cd)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new $i),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Qh.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Qh).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Kh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Kh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Kh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Kh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Kh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Kh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Kh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Kh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Kh)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function $h(e,t,n,r,i){for(let o=0,s=e.length-3;o<=s;o+=3){ud.fromArray(e,o);const s=i.x*Math.abs(ud.x)+i.y*Math.abs(ud.y)+i.z*Math.abs(ud.z),a=t.dot(ud),c=n.dot(ud),l=r.dot(ud);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}const Kh=[new $i,new $i,new $i,new $i,new $i,new $i,new $i,new $i],Qh=new $i,ed=new Jh,td=new $i,nd=new $i,rd=new $i,id=new $i,od=new $i,sd=new $i,ad=new $i,cd=new $i,ld=new $i,ud=new $i,hd=new Jh;class dd{constructor(e,t){this.center=void 0!==e?e:new $i,this.radius=void 0!==t?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):hd.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new $i),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Jh),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const pd=new $i,fd=new $i,md=new $i,gd=new $i,vd=new $i,yd=new $i,bd=new $i;class xd{constructor(e,t){this.origin=void 0!==e?e:new $i,this.direction=void 0!==t?t:new $i(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new $i),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,pd)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new $i),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=pd.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(pd.copy(this.direction).multiplyScalar(t).add(this.origin),pd.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){fd.copy(e).add(t).multiplyScalar(.5),md.copy(t).sub(e).normalize(),gd.copy(this.origin).sub(fd);const i=.5*e.distanceTo(t),o=-this.direction.dot(md),s=gd.dot(this.direction),a=-gd.dot(md),c=gd.lengthSq(),l=Math.abs(1-o*o);let u,h,d,p;if(l>0)if(u=o*a-s,h=o*s-a,p=i*l,u>=0)if(h>=-p)if(h<=p){const e=1/l;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+c}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+c):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(md).multiplyScalar(h).add(fd),d}intersectSphere(e,t){pd.subVectors(e.center,this.origin);const n=pd.dot(this.direction),r=pd.dot(pd)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),l>=0?(i=(e.min.y-h.y)*l,o=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,o=(e.min.y-h.y)*l),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,pd)}intersectTriangle(e,t,n,r,i){vd.subVectors(t,e),yd.subVectors(n,e),bd.crossVectors(vd,yd);let o,s=this.direction.dot(bd);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}gd.subVectors(this.origin,e);const a=o*this.direction.dot(yd.crossVectors(gd,yd));if(a<0)return null;const c=o*this.direction.dot(vd.cross(gd));if(c<0)return null;if(a+c>s)return null;const l=-o*gd.dot(bd);return l<0?null:this.at(l/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}const _d=new $i,wd=new $i,Md=new fo;class Td{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new $i(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=_d.subVectors(n,t).cross(wd.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new $i),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new $i);const n=e.delta(_d),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new $i),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Md.getNormalMatrix(e),r=this.coplanarPoint(_d).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const Sd=new $i,Ed=new $i,Ad=new $i,Rd=new $i,Ld=new $i,Cd=new $i,Pd=new $i,Od=new $i,Nd=new $i,Id=new $i;class Dd{constructor(e,t,n){this.a=void 0!==e?e:new $i,this.b=void 0!==t?t:new $i,this.c=void 0!==n?n:new $i}static getNormal(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new $i),r.subVectors(n,t),Sd.subVectors(e,t),r.cross(Sd);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Sd.subVectors(r,t),Ed.subVectors(n,t),Ad.subVectors(e,t);const o=Sd.dot(Sd),s=Sd.dot(Ed),a=Sd.dot(Ad),c=Ed.dot(Ed),l=Ed.dot(Ad),u=o*c-s*s;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new $i),0===u)return i.set(-2,-1,-1);const h=1/u,d=(c*a-s*l)*h,p=(o*l-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Rd),Rd.x>=0&&Rd.y>=0&&Rd.x+Rd.y<=1}static getUV(e,t,n,r,i,o,s,a){return this.getBarycoord(e,t,n,r,Rd),a.set(0,0),a.addScaledVector(i,Rd.x),a.addScaledVector(o,Rd.y),a.addScaledVector(s,Rd.z),a}static isFrontFacing(e,t,n,r){return Sd.subVectors(n,t),Ed.subVectors(e,t),Sd.cross(Ed).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Sd.subVectors(this.c,this.b),Ed.subVectors(this.a,this.b),.5*Sd.cross(Ed).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new $i),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Dd.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Td),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Dd.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return Dd.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Dd.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Dd.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new $i);const n=this.a,r=this.b,i=this.c;let o,s;Ld.subVectors(r,n),Cd.subVectors(i,n),Od.subVectors(e,n);const a=Ld.dot(Od),c=Cd.dot(Od);if(a<=0&&c<=0)return t.copy(n);Nd.subVectors(e,r);const l=Ld.dot(Nd),u=Cd.dot(Nd);if(l>=0&&u<=l)return t.copy(r);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),t.copy(n).addScaledVector(Ld,o);Id.subVectors(e,i);const d=Ld.dot(Id),p=Cd.dot(Id);if(p>=0&&d<=p)return t.copy(i);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return s=c/(c-p),t.copy(n).addScaledVector(Cd,s);const m=l*p-d*u;if(m<=0&&u-l>=0&&d-p>=0)return Pd.subVectors(i,r),s=(u-l)/(u-l+(d-p)),t.copy(r).addScaledVector(Pd,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(Ld,o).addScaledVector(Cd,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}class kd{constructor(e,t,n,r,i,o=0){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new $i,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new Xu,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}function Bd(e){Fu.call(this),this.type="MeshBasicMaterial",this.color=new Xu(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ka,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Bd.prototype=Object.create(Fu.prototype),Bd.prototype.constructor=Bd,Bd.prototype.isMeshBasicMaterial=!0,Bd.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};class Ud{constructor(e=0,t=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=.01,s=.1,a=e.elements,c=a[0],l=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(l-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(l+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(c+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(c+1)/2,a=(d+1)/2,v=(g+1)/2,y=(l+h)/4,b=(u+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=b/n):a>v?a<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=y/r,i=x/r):v<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=b/i,r=x/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-l)*(h-l));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-l)/v,this.w=Math.acos((c+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}const Fd=new $i,zd=new zu;function Hd(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Au,this.updateRange={offset:0,count:-1},this.version=0}function Gd(e,t,n){Hd.call(this,new Int8Array(e),t,n)}function jd(e,t,n){Hd.call(this,new Uint8Array(e),t,n)}function Vd(e,t,n){Hd.call(this,new Uint8ClampedArray(e),t,n)}function Wd(e,t,n){Hd.call(this,new Int16Array(e),t,n)}function qd(e,t,n){Hd.call(this,new Uint16Array(e),t,n)}function Xd(e,t,n){Hd.call(this,new Int32Array(e),t,n)}function Yd(e,t,n){Hd.call(this,new Uint32Array(e),t,n)}function Zd(e,t,n){Hd.call(this,new Uint16Array(e),t,n)}function Jd(e,t,n){Hd.call(this,new Float32Array(e),t,n)}function $d(e,t,n){Hd.call(this,new Float64Array(e),t,n)}Object.defineProperty(Hd.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Hd.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Xu),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this},copyVector2sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new zu),t[n++]=i.x,t[n++]=i.y}return this},copyVector3sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new $i),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this},copyVector4sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Ud),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)zd.fromBufferAttribute(this,t),zd.applyMatrix3(e),this.setXY(t,zd.x,zd.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Fd.fromBufferAttribute(this,t),Fd.applyMatrix3(e),this.setXYZ(t,Fd.x,Fd.y,Fd.z);return this},applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)Fd.x=this.getX(t),Fd.y=this.getY(t),Fd.z=this.getZ(t),Fd.applyMatrix4(e),this.setXYZ(t,Fd.x,Fd.y,Fd.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)Fd.x=this.getX(t),Fd.y=this.getY(t),Fd.z=this.getZ(t),Fd.applyNormalMatrix(e),this.setXYZ(t,Fd.x,Fd.y,Fd.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)Fd.x=this.getX(t),Fd.y=this.getY(t),Fd.z=this.getZ(t),Fd.transformDirection(e),this.setXYZ(t,Fd.x,Fd.y,Fd.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Gd.prototype=Object.create(Hd.prototype),Gd.prototype.constructor=Gd,jd.prototype=Object.create(Hd.prototype),jd.prototype.constructor=jd,Vd.prototype=Object.create(Hd.prototype),Vd.prototype.constructor=Vd,Wd.prototype=Object.create(Hd.prototype),Wd.prototype.constructor=Wd,qd.prototype=Object.create(Hd.prototype),qd.prototype.constructor=qd,Xd.prototype=Object.create(Hd.prototype),Xd.prototype.constructor=Xd,Yd.prototype=Object.create(Hd.prototype),Yd.prototype.constructor=Yd,Zd.prototype=Object.create(Hd.prototype),Zd.prototype.constructor=Zd,Zd.prototype.isFloat16BufferAttribute=!0,Jd.prototype=Object.create(Hd.prototype),Jd.prototype.constructor=Jd,$d.prototype=Object.create(Hd.prototype),$d.prototype.constructor=$d;class Kd{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,r,i;const o=e.faces;for(r=0;r<o.length;r++){const e=o[r];e.materialIndex!==i&&(i=e.materialIndex,void 0!==n&&(n.count=3*r-n.start,t.push(n)),n={start:3*r,materialIndex:i})}void 0!==n&&(n.count=3*r-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,r=e.faceVertexUvs,i=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=e.morphTargets,a=s.length;let c;if(a>0){c=[];for(let e=0;e<a;e++)c[e]={name:s[e].name,data:[]};this.morphTargets.position=c}const l=e.morphNormals,u=l.length;let h;if(u>0){h=[];for(let e=0;e<u;e++)h[e]={name:l[e].name,data:[]};this.morphTargets.normal=h}const d=e.skinIndices,p=e.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let e=0;e<t.length;e++){const g=t[e];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const e=g.normal;this.normals.push(e,e,e)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const e=g.color;this.colors.push(e,e,e)}if(!0===i){const t=r[0][e];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",e),this.uvs.push(new zu,new zu,new zu))}if(!0===o){const t=r[1][e];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",e),this.uvs2.push(new zu,new zu,new zu))}for(let e=0;e<a;e++){const t=s[e].vertices;c[e].data.push(t[g.a],t[g.b],t[g.c])}for(let t=0;t<u;t++){const n=l[t].vertexNormals[e];h[t].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}function Qd(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}const ep={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function tp(e,t){return new ep[e](t)}let np=1;const rp=new eo,ip=new Ro,op=new $i,sp=new Jh,ap=new Jh,cp=new $i;function lp(){Object.defineProperty(this,"id",{value:np+=2}),this.uuid=Zi.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}lp.prototype=Object.assign(Object.create(co.prototype),{constructor:lp,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(Qd(e)>65535?Yd:qd)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new fo).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return rp.makeRotationX(e),this.applyMatrix4(rp),this},rotateY:function(e){return rp.makeRotationY(e),this.applyMatrix4(rp),this},rotateZ:function(e){return rp.makeRotationZ(e),this.applyMatrix4(rp),this},translate:function(e,t,n){return rp.makeTranslation(e,t,n),this.applyMatrix4(rp),this},scale:function(e,t,n){return rp.makeScale(e,t,n),this.applyMatrix4(rp),this},lookAt:function(e){return ip.lookAt(e),ip.updateMatrix(),this.applyMatrix4(ip.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(op).negate(),this.translate(op.x,op.y,op.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const e=new Jd(3*t.vertices.length,3),n=new Jd(3*t.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const e=new Jd(t.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Jd(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}if(!0===t.verticesNeedUpdate){const e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){const e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){const e=this.attributes.color;void 0!==e&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Kd).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Hd(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const t=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Hd(t,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const t=new Float32Array(3*e.colors.length);this.setAttribute("color",new Hd(t,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const t=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Hd(t,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const t=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Hd(t,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const t in e.morphTargets){const n=[],r=e.morphTargets[t];for(let e=0,t=r.length;e<t;e++){const t=r[e],i=new Jd(3*t.data.length,3);i.name=t.name,n.push(i.copyVector3sArray(t.data))}this.morphAttributes[t]=n}if(e.skinIndices.length>0){const t=new Jd(4*e.skinIndices.length,4);this.setAttribute("skinIndex",t.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const t=new Jd(4*e.skinWeights.length,4);this.setAttribute("skinWeight",t.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Jh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new $i(-1/0,-1/0,-1/0),new $i(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];sp.setFromBufferAttribute(n),this.morphTargetsRelative?(cp.addVectors(this.boundingBox.min,sp.min),this.boundingBox.expandByPoint(cp),cp.addVectors(this.boundingBox.max,sp.max),this.boundingBox.expandByPoint(cp)):(this.boundingBox.expandByPoint(sp.min),this.boundingBox.expandByPoint(sp.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new dd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new $i,1/0);if(e){const n=this.boundingSphere.center;if(sp.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ap.setFromBufferAttribute(n),this.morphTargetsRelative?(cp.addVectors(sp.min,ap.min),sp.expandByPoint(cp),cp.addVectors(sp.max,ap.max),sp.expandByPoint(cp)):(sp.expandByPoint(ap.min),sp.expandByPoint(ap.max))}sp.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)cp.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(cp));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)cp.fromBufferAttribute(o,t),s&&(op.fromBufferAttribute(e,t),cp.add(op)),r=Math.max(r,n.distanceToSquared(cp))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Hd(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new $i,i=new $i,o=new $i,s=new $i,a=new $i,c=new $i,l=new $i,u=new $i;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),c.fromBufferAttribute(n,f),s.add(l),a.add(l),c.add(l),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],s=o.array,a=o.itemSize*t,c=Math.min(s.length,i.length-a);for(let e=0,t=a;e<c;e++,t++)i[t]=s[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)cp.fromBufferAttribute(e,t),cp.normalize(),e.setXYZ(t,cp.x,cp.y,cp.z)},toNonIndexed:function(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let s=0,a=0;for(let e=0,i=t.length;e<i;e++){s=t[e]*r;for(let e=0;e<r;e++)o[a++]=n[s++]}return new Hd(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new lp,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t],i=r.toJSON(e.data);""!==r.name&&(i.name=r.name),e.data.attributes[t]=i}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.toJSON(e.data);""!==r.name&&(i.name=r.name),o.push(i)}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e},clone:function(){return(new lp).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const up=new eo,hp=new xd,dp=new dd,pp=new $i,fp=new $i,mp=new $i,gp=new $i,vp=new $i,yp=new $i,bp=new $i,xp=new $i,_p=new $i,wp=new zu,Mp=new zu,Tp=new zu,Sp=new $i,Ep=new $i;function Ap(e=new lp,t=new Bd){Ro.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function Rp(e,t,n,r,i,o,s,a){let c;if(c=t.side===ya?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,t.side!==ba,a),null===c)return null;Ep.copy(a),Ep.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(Ep);return l<n.near||l>n.far?null:{distance:l,point:Ep.clone(),object:e}}function Lp(e,t,n,r,i,o,s,a,c,l,u,h){pp.fromBufferAttribute(i,l),fp.fromBufferAttribute(i,u),mp.fromBufferAttribute(i,h);const d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){bp.set(0,0,0),xp.set(0,0,0),_p.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=d[e],n=o[e];0!==t&&(gp.fromBufferAttribute(n,l),vp.fromBufferAttribute(n,u),yp.fromBufferAttribute(n,h),s?(bp.addScaledVector(gp,t),xp.addScaledVector(vp,t),_p.addScaledVector(yp,t)):(bp.addScaledVector(gp.sub(pp),t),xp.addScaledVector(vp.sub(fp),t),_p.addScaledVector(yp.sub(mp),t)))}pp.add(bp),fp.add(xp),mp.add(_p)}e.isSkinnedMesh&&(e.boneTransform(l,pp),e.boneTransform(u,fp),e.boneTransform(h,mp));const p=Rp(e,t,n,r,pp,fp,mp,Sp);if(p){a&&(wp.fromBufferAttribute(a,l),Mp.fromBufferAttribute(a,u),Tp.fromBufferAttribute(a,h),p.uv=Dd.getUV(Sp,pp,fp,mp,wp,Mp,Tp,new zu)),c&&(wp.fromBufferAttribute(c,l),Mp.fromBufferAttribute(c,u),Tp.fromBufferAttribute(c,h),p.uv2=Dd.getUV(Sp,pp,fp,mp,wp,Mp,Tp,new zu));const e=new kd(l,u,h);Dd.getNormal(pp,fp,mp,e.normal),p.face=e}return p}Ap.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Ap,isMesh:!0,copy:function(e){return Ro.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),dp.copy(n.boundingSphere),dp.applyMatrix4(i),!1===e.ray.intersectsSphere(dp))return;if(up.copy(i).invert(),hp.copy(e.ray).applyMatrix4(up),null!==n.boundingBox&&!1===hp.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=Lp(this,f,e,hp,s,a,c,l,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);o=Lp(this,r,e,hp,s,a,c,l,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3)o=Lp(this,p,e,hp,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}else for(let n=Math.max(0,d.start),i=Math.min(s.count,d.start+d.count);n<i;n+=3)o=Lp(this,r,e,hp,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(n.isGeometry){const i=Array.isArray(r),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,l=a.length;n<l;n++){const l=a[n],u=i?r[l.materialIndex]:r;if(void 0===u)continue;const h=s[l.a],d=s[l.b],p=s[l.c];if(o=Rp(this,u,e,hp,h,d,p,Sp),o){if(c&&c[n]){const e=c[n];wp.copy(e[0]),Mp.copy(e[1]),Tp.copy(e[2]),o.uv=Dd.getUV(Sp,h,d,p,wp,Mp,Tp,new zu)}o.face=l,o.faceIndex=n,t.push(o)}}}}});var Cp=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Pp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Op=class extends Vh{constructor(){super(...arguments),this.castShadow=!0,this.receiveShadow=!0}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Nn((()=>{this.three.castShadow=this.castShadow,this.needsUpdate()})),Nn((()=>{this.three.receiveShadow=this.receiveShadow,this.three.material.needsUpdate=!0,this.needsUpdate()}))),!0)}makeThreeObject3d(){return new Ap}};function Np(e){Fu.call(this),this.type="PointsMaterial",this.color=new Xu(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Op.defaultBehaviors={"box-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},Cp([Xn(!0),U("propertychange"),Pp("design:type",Object)],Op.prototype,"castShadow",void 0),Cp([Xn(!0),U("propertychange"),Pp("design:type",Object)],Op.prototype,"receiveShadow",void 0),Op=Cp([Yn("lume-mesh",Hh)],Op),Np.prototype=Object.create(Fu.prototype),Np.prototype.constructor=Np,Np.prototype.isPointsMaterial=!0,Np.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const Ip=new eo,Dp=new xd,kp=new dd,Bp=new $i;function Up(e=new lp,t=new Np){Ro.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function Fp(e,t,n,r,i,o,s){const a=Dp.distanceSqToPoint(e);if(a<n){const n=new $i;Dp.closestPointToPoint(e,n),n.applyMatrix4(r);const c=i.ray.origin.distanceTo(n);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}Up.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Up,isPoints:!0,copy:function(e){return Ro.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),kp.copy(n.boundingSphere),kp.applyMatrix4(r),kp.radius+=i,!1===e.ray.intersectsSphere(kp))return;Ip.copy(r).invert(),Dp.copy(e.ray).applyMatrix4(Ip);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];Bp.fromBufferAttribute(o,a),Fp(Bp,a,s,r,e,t,this)}}else for(let n=0,i=o.count;n<i;n++)Bp.fromBufferAttribute(o,n),Fp(Bp,n,s,r,e,t,this)}else{const i=n.vertices;for(let n=0,o=i.length;n<o;n++)Fp(i[n],n,s,r,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});let zp=class extends Vh{makeThreeObject3d(){return new Up}};zp.defaultBehaviors={"box-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"points-material":e=>!e.some((e=>e.endsWith("-material")))},zp=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-points",Hh)],zp);const Hp=new eo,Gp=new eo,jp=[],Vp=new Ap;function Wp(e,t,n){Ap.call(this,e,t),this.instanceMatrix=new Hd(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}Wp.prototype=Object.assign(Object.create(Ap.prototype),{constructor:Wp,isInstancedMesh:!0,copy:function(e){return Ap.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const n=this.matrixWorld,r=this.count;if(Vp.geometry=this.geometry,Vp.material=this.material,void 0!==Vp.material)for(let i=0;i<r;i++){this.getMatrixAt(i,Hp),Gp.multiplyMatrices(n,Hp),Vp.matrixWorld=Gp,Vp.raycast(e,jp);for(let e=0,n=jp.length;e<n;e++){const n=jp[e];n.instanceId=i,n.object=this,t.push(n)}jp.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new Hd(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});let qp=0;const Xp=new eo,Yp=new Ro,Zp=new $i;function Jp(){Object.defineProperty(this,"id",{value:qp+=2}),this.uuid=Zi.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Jp.prototype=Object.assign(Object.create(co.prototype),{constructor:Jp,isGeometry:!0,applyMatrix4:function(e){const t=(new fo).getNormalMatrix(e);for(let t=0,n=this.vertices.length;t<n;t++)this.vertices[t].applyMatrix4(e);for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];n.normal.applyMatrix3(t).normalize();for(let e=0,r=n.vertexNormals.length;e<r;e++)n.vertexNormals[e].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Xp.makeRotationX(e),this.applyMatrix4(Xp),this},rotateY:function(e){return Xp.makeRotationY(e),this.applyMatrix4(Xp),this},rotateZ:function(e){return Xp.makeRotationZ(e),this.applyMatrix4(Xp),this},translate:function(e,t,n){return Xp.makeTranslation(e,t,n),this.applyMatrix4(Xp),this},scale:function(e,t,n){return Xp.makeScale(e,t,n),this.applyMatrix4(Xp),this},lookAt:function(e){return Yp.lookAt(e),Yp.updateMatrix(),this.applyMatrix4(Yp.matrix),this},fromBufferGeometry:function(e){const t=this,n=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=r.position,o=r.normal,s=r.color,a=r.uv,c=r.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let e=0;e<i.count;e++)t.vertices.push((new $i).fromBufferAttribute(i,e)),void 0!==s&&t.colors.push((new Xu).fromBufferAttribute(s,e));function l(e,n,r,i){const l=void 0===s?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],u=void 0===o?[]:[(new $i).fromBufferAttribute(o,e),(new $i).fromBufferAttribute(o,n),(new $i).fromBufferAttribute(o,r)],h=new kd(e,n,r,u,l,i);t.faces.push(h),void 0!==a&&t.faceVertexUvs[0].push([(new zu).fromBufferAttribute(a,e),(new zu).fromBufferAttribute(a,n),(new zu).fromBufferAttribute(a,r)]),void 0!==c&&t.faceVertexUvs[1].push([(new zu).fromBufferAttribute(c,e),(new zu).fromBufferAttribute(c,n),(new zu).fromBufferAttribute(c,r)])}const u=e.groups;if(u.length>0)for(let e=0;e<u.length;e++){const t=u[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)void 0!==n?l(n.getX(e),n.getX(e+1),n.getX(e+2),t.materialIndex):l(e,e+1,e+2,t.materialIndex)}else if(void 0!==n)for(let e=0;e<n.count;e+=3)l(n.getX(e),n.getX(e+1),n.getX(e+2));else for(let e=0;e<i.count;e+=3)l(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zp).negate(),this.translate(Zp.x,Zp.y,Zp.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new eo;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){const e=new $i,t=new $i;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],i=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,o),t.subVectors(i,o),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e=!0){const t=new Array(this.vertices.length);for(let e=0,n=this.vertices.length;e<n;e++)t[e]=new $i;if(e){const e=new $i,n=new $i;for(let r=0,i=this.faces.length;r<i;r++){const i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),n.subVectors(o,s),e.cross(n),t[i.a].add(e),t[i.b].add(e),t[i.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let e=0,n=this.vertices.length;e<n;e++)t[e].normalize();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(t[n.a]),r[1].copy(t[n.b]),r[2].copy(t[n.c])):(r[0]=t[n.a].clone(),r[1]=t[n.b].clone(),r[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=t.vertexNormals;3===n.length?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,n=t.vertexNormals.length;e<n;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}const e=new Jp;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,r=this.faces.length;t<r;t++){const t=new $i,r={a:new $i,b:new $i,c:new $i};e.push(t),n.push(r)}}const n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],r=n.faceNormals[e],i=n.vertexNormals[e];r.copy(t.normal),i.a.copy(t.vertexNormals[0]),i.b.copy(t.vertexNormals[1]),i.c.copy(t.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Jh),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new dd),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let r;const i=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,c=e.faces,l=this.colors,u=e.colors;void 0!==t&&(r=(new fo).getNormalMatrix(t));for(let e=0,n=s.length;e<n;e++){const n=s[e].clone();void 0!==t&&n.applyMatrix4(t),o.push(n)}for(let e=0,t=u.length;e<t;e++)l.push(u[e].clone());for(let e=0,t=c.length;e<t;e++){const t=c[e];let o,s;const l=t.vertexNormals,u=t.vertexColors,h=new kd(t.a+i,t.b+i,t.c+i);h.normal.copy(t.normal),void 0!==r&&h.normal.applyMatrix3(r).normalize();for(let e=0,t=l.length;e<t;e++)o=l[e].clone(),void 0!==r&&o.applyMatrix3(r).normalize(),h.vertexNormals.push(o);h.color.copy(t.color);for(let e=0,t=u.length;e<t;e++)s=u[e],h.vertexColors.push(s.clone());h.materialIndex=t.materialIndex+n,a.push(h)}for(let t=0,n=e.faceVertexUvs.length;t<n;t++){const n=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,r=n.length;e<r;e++){const r=n[e],i=[];for(let e=0,t=r.length;e<t;e++)i.push(r[e].clone());this.faceVertexUvs[t].push(i)}}},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(e=4){const t={},n=[],r=[],i=Math.pow(10,e);for(let e=0,o=this.vertices.length;e<o;e++){const o=this.vertices[e],s=Math.round(o.x*i)+"_"+Math.round(o.y*i)+"_"+Math.round(o.z*i);void 0===t[s]?(t[s]=e,n.push(this.vertices[e]),r[e]=n.length-1):r[e]=r[t[s]]}const o=[];for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.a=r[t.a],t.b=r[t.b],t.c=r[t.c];const n=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(n[t]===n[(t+1)%3]){o.push(e);break}}for(let e=o.length-1;e>=0;e--){const t=o[e];this.faces.splice(t,1);for(let e=0,n=this.faceVertexUvs.length;e<n;e++)this.faceVertexUvs[e].splice(t,1)}const s=this.vertices.length-n.length;return this.vertices=n,s},setFromPoints:function(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];this.vertices.push(new $i(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let i,o;n&&n.length===t&&(i=[]),r&&r.length===t&&(o=[]);for(let s=0;s<t;s++){const t=e[s]._id;i&&i.push(n[t]),o&&o.push(r[t])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const t=[];for(let e=0;e<this.vertices.length;e++){const n=this.vertices[e];t.push(n.x,n.y,n.z)}const n=[],r=[],i={},o=[],s={},a=[],c={};for(let e=0;e<this.faces.length;e++){const t=this.faces[e],r=!0,i=!1,o=void 0!==this.faceVertexUvs[0][e],s=t.normal.length()>0,a=t.vertexNormals.length>0,c=1!==t.color.r||1!==t.color.g||1!==t.color.b,p=t.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,r),f=l(f,2,i),f=l(f,3,o),f=l(f,4,s),f=l(f,5,a),f=l(f,6,c),f=l(f,7,p),n.push(f),n.push(t.a,t.b,t.c),n.push(t.materialIndex),o){const t=this.faceVertexUvs[0][e];n.push(d(t[0]),d(t[1]),d(t[2]))}if(s&&n.push(u(t.normal)),a){const e=t.vertexNormals;n.push(u(e[0]),u(e[1]),u(e[2]))}if(c&&n.push(h(t.color)),p){const e=t.vertexColors;n.push(h(e[0]),h(e[1]),h(e[2]))}}function l(e,t,n){return n?e|1<<t:e&~(1<<t)}function u(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==i[t]||(i[t]=r.length/3,r.push(e.x,e.y,e.z)),i[t]}function h(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==s[t]||(s[t]=o.length,o.push(e.getHex())),s[t]}function d(e){const t=e.x.toString()+e.y.toString();return void 0!==c[t]||(c[t]=a.length/2,a.push(e.x,e.y)),c[t]}return e.data={},e.data.vertices=t,e.data.normals=r,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=n,e},clone:function(){return(new Jp).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let e=0,n=t.length;e<n;e++)this.vertices.push(t[e].clone());const n=e.colors;for(let e=0,t=n.length;e<t;e++)this.colors.push(n[e].clone());const r=e.faces;for(let e=0,t=r.length;e<t;e++)this.faces.push(r[e].clone());for(let t=0,n=e.faceVertexUvs.length;t<n;t++){const n=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,r=n.length;e<r;e++){const r=n[e],i=[];for(let e=0,t=r.length;e<t;e++){const t=r[e];i.push(t.clone())}this.faceVertexUvs[t].push(i)}}const i=e.morphTargets;for(let e=0,t=i.length;e<t;e++){const t={};if(t.name=i[e].name,void 0!==i[e].vertices){t.vertices=[];for(let n=0,r=i[e].vertices.length;n<r;n++)t.vertices.push(i[e].vertices[n].clone())}if(void 0!==i[e].normals){t.normals=[];for(let n=0,r=i[e].normals.length;n<r;n++)t.normals.push(i[e].normals[n].clone())}this.morphTargets.push(t)}const o=e.morphNormals;for(let e=0,t=o.length;e<t;e++){const t={};if(void 0!==o[e].vertexNormals){t.vertexNormals=[];for(let n=0,r=o[e].vertexNormals.length;n<r;n++){const r=o[e].vertexNormals[n],i={};i.a=r.a.clone(),i.b=r.b.clone(),i.c=r.c.clone(),t.vertexNormals.push(i)}}if(void 0!==o[e].faceNormals){t.faceNormals=[];for(let n=0,r=o[e].faceNormals.length;n<r;n++)t.faceNormals.push(o[e].faceNormals[n].clone())}this.morphNormals.push(t)}const s=e.skinWeights;for(let e=0,t=s.length;e<t;e++)this.skinWeights.push(s[e].clone());const a=e.skinIndices;for(let e=0,t=a.length;e<t;e++)this.skinIndices.push(a[e].clone());const c=e.lineDistances;for(let e=0,t=c.length;e<t;e++)this.lineDistances.push(c[e]);const l=e.boundingBox;null!==l&&(this.boundingBox=l.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class $p extends lp{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],c=[],l=[],u=[];let h=0,d=0;function p(e,t,n,r,i,o,p,f,m,g,v){const y=o/m,b=p/g,x=o/2,_=p/2,w=f/2,M=m+1,T=g+1;let S=0,E=0;const A=new $i;for(let o=0;o<T;o++){const s=o*b-_;for(let a=0;a<M;a++){const h=a*y-x;A[e]=h*r,A[t]=s*i,A[n]=w,c.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,l.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),S+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+M*e,r=h+t+M*(e+1),i=h+(t+1)+M*(e+1),o=h+(t+1)+M*e;a.push(n,r,o),a.push(r,i,o),E+=6}s.addGroup(d,E,v),d+=E,h+=S}p("z","y","x",-1,-1,n,t,e,o,i,0),p("z","y","x",1,-1,n,t,-e,o,i,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new Jd(c,3)),this.setAttribute("normal",new Jd(l,3)),this.setAttribute("uv",new Jd(u,2))}}class Kp extends Jp{constructor(e,t,n,r,i,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new $p(e,t,n,r,i,o)),this.mergeVertices()}}function Qp(e,t){"string"==typeof e&&(e=Oo(e).map((e=>parseFloat(e))));for(let n=0,r=e.length;n<r;n+=1)if(isNaN(e[n]))throw new TypeError(`Array for property "${t}" should have numbers only.`);return e}var ef,tf,nf,rf,of,sf=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},af=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cf=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},lf=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const uf=new Ji,hf=new $i,df=new $i,pf=new $i,ff=new eo,mf=new lo,gf=new Xu,vf=[0,0,0];let yf=class extends Op{constructor(){super(...arguments),this.count=10,ef.set(this,this.count),tf.set(this,[]),nf.set(this,[]),rf.set(this,[]),of.set(this,[])}get rotations(){return cf(this,tf,"f")}set rotations(e){lf(this,tf,Qp(e,"rotations"),"f")}get positions(){return cf(this,nf,"f")}set positions(e){lf(this,nf,Qp(e,"positions"),"f")}get scales(){return cf(this,rf,"f")}set scales(e){lf(this,rf,Qp(e,"scales"),"f")}get colors(){return cf(this,of,"f")}set colors(e){lf(this,of,Qp(e,"colors"),"f")}makeThreeObject3d(){let e=null,t=null;for(const[n,r]of this.behaviors)n.endsWith("-geometry")?e=r:n.endsWith("-material")&&(t=r);const n=new Wp((null==e?void 0:e.meshComponent)||new Kp,(null==t?void 0:t.meshComponent)||new Yu,cf(this,ef,"f"));n.instanceMatrix.setUsage(Ru);const r=n.setColorAt;return n.setColorAt=function(e,t){r.call(n,e,t),n.instanceColor.setUsage(Ru)},n}updateInstances(){var e,t,n,r,i,o,s,a,c,l,u,h;const d=this.three;for(let p=0,f=this.count;p<f;p+=1){const f=3*p;mf.set(null!==(e=this.rotations[f+0])&&void 0!==e?e:0,null!==(t=this.rotations[f+1])&&void 0!==t?t:0,null!==(n=this.rotations[f+2])&&void 0!==n?n:0),uf.setFromEuler(mf),hf.set(null!==(r=this.positions[f+0])&&void 0!==r?r:0,null!==(i=this.positions[f+1])&&void 0!==i?i:0,null!==(o=this.positions[f+2])&&void 0!==o?o:0),df.set(null!==(s=this.scales[f+0])&&void 0!==s?s:1,null!==(a=this.scales[f+1])&&void 0!==a?a:1,null!==(c=this.scales[f+2])&&void 0!==c?c:1),this._calculateInstanceMatrix(),d.setMatrixAt(p,ff),gf.setRGB(null!==(l=this.colors[f+0])&&void 0!==l?l:1,null!==(u=this.colors[f+1])&&void 0!==u?u:1,null!==(h=this.colors[f+2])&&void 0!==h?h:1),d.setColorAt(p,gf)}}_calculateInstanceMatrix(){const e=hf,t=new $i(.5,.5,.5),n=this.calculatedSize;vf[0]=e.x,vf[1]=e.y,vf[2]=e.z,e.set(vf[0],-vf[1],vf[2]),.5!==t.x||.5!==t.y||.5!==t.z?pf.set(t.x*n.x-n.x/2,-(t.y*n.y-n.y/2),t.z*n.z-n.z/2):pf.set(0,0,0),ff.compose(e,uf,df);const r=pf;if(0!==r.x||0!==r.y||0!==r.z){const e=r.x,t=r.y,n=r.z,i=ff.elements;i[12]+=e-i[0]*e-i[4]*t-i[8]*n,i[13]+=t-i[1]*e-i[5]*t-i[9]*n,i[14]+=n-i[2]*e-i[6]*t-i[10]*n}}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Nn((()=>{this.count>cf(this,ef,"f")&&(lf(this,ef,this.count,"f"),Hn((()=>this.recreateThree()))),Hn((()=>this.three.count=this.count)),this.needsUpdate()})),Nn((()=>{this.rotations,this.needsUpdate()})),Nn((()=>{this.positions,this.needsUpdate()}))),!0)}needsUpdate(){this.three.instanceMatrix.needsUpdate=!0,this.three.instanceColor&&(this.three.instanceColor.needsUpdate=!0),super.needsUpdate()}update(e,t){super.update(e,t),this.updateInstances()}};ef=new WeakMap,tf=new WeakMap,nf=new WeakMap,rf=new WeakMap,of=new WeakMap,yf.defaultBehaviors={"box-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},sf([qn(10),af("design:type",Object)],yf.prototype,"count",void 0),sf([Wn(""),af("design:type",Object),af("design:paramtypes",[Object])],yf.prototype,"rotations",null),sf([Wn(""),af("design:type",Array),af("design:paramtypes",[Array])],yf.prototype,"positions",null),sf([Wn(""),af("design:type",Array),af("design:paramtypes",[Array])],yf.prototype,"scales",null),sf([Wn(""),af("design:type",Array),af("design:paramtypes",[Array])],yf.prototype,"colors",null),yf=sf([Yn("lume-instanced-mesh",Hh)],yf);class bf extends Zh{requiredElementType(){return[Op,zp,yf]}_createComponent(){throw new Error("`_createComponent()` is not implemented by subclass.")}}function xf(e,t,n){let r=jn;return 1===arguments.length?(r=jn(e),(e,t,n)=>zr(i,e,t,n)):(r=jn,zr(i,e,t,n));function i(e,t,n){return Fr(e,t,n=r(e,t,n))}}function _f(e=""){return xf(xf.string(e))}function wf(e=0){return xf(xf.number(e))}function Mf(e=!1){return xf(xf.boolean(e))}xf.string=jn.string,xf.number=jn.number,xf.boolean=jn.boolean;var Tf,Sf,Ef=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Af=[0,0,-1];let Rf=class extends Vh{constructor(){super(...arguments),Tf.set(this,ie(null)),Sf.set(this,ie(null))}get clip(){return Ef(this,Tf,"f")[0]()}get inverseClip(){return Ef(this,Sf,"f")[0]()}_loadGL(){return!!super._loadGL()&&(Ef(this,Tf,"f")[1](new Td(new $i(...Af))),Ef(this,Sf,"f")[1](new Td(new $i(...Af).negate())),!0)}_unloadGL(){return!!super._unloadGL()&&(Ef(this,Tf,"f")[1](null),Ef(this,Sf,"f")[1](null),!0)}updateWorldMatrices(){super.updateWorldMatrices();const e=Ef(this,Tf,"f")[0](),t=Ef(this,Sf,"f")[0]();e&&t&&(e.normal.set(...Af),e.constant=0,t.normal.set(...Af).negate(),t.constant=0,e.applyMatrix4(this.three.matrixWorld),t.applyMatrix4(this.three.matrixWorld))}};Tf=new WeakMap,Sf=new WeakMap,Rf=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-clip-plane",Hh)],Rf);var Lf,Cf,Pf,Of=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Nf=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},If=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Df=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let kf=0,Bf=class extends bf{constructor(){super(...arguments),this.clipShadows=!0,Lf.set(this,[]),Cf.set(this,[]),this.flipClip=!1,this.clipDisabled=!1,Pf.set(this,null)}get clipPlanes(){return If(this,Lf,"f")}set clipPlanes(e){Df(this,Cf,e,"f");let t=[];if("string"==typeof e)t=e.split(",").filter((e=>!!e.trim()));else{if(!Array.isArray(e))throw new TypeError("Invalid value for clipPlanes");t=e}Df(this,Lf,[],"f");for(const e of t){if("string"!=typeof e){If(this,Lf,"f").push(e);continue}let t=this.element.getRootNode();for(;t;){const n=t.querySelector(e);if(n){n instanceof Rf&&n.scene&&If(this,Lf,"f").push(n);break}t=t instanceof ShadowRoot?t.host.getRootNode():null}}}get material(){return this.element.behaviors.find((e=>e.endsWith("-material"))).meshComponent}loadGL(){kf||(this.element.scene.__localClipping=!0),kf++,Df(this,Pf,new MutationObserver((()=>{this.clipPlanes=If(this,Cf,"f")})),"f"),If(this,Pf,"f").observe(this.element.getRootNode(),{childList:!0,subtree:!0}),this.createEffect((()=>{const{clipPlanes:e,clipShadows:t,flipClip:n}=this,r=this.material;if(r){if(this.element.needsUpdate(),!e.length||this.clipDisabled)return r.clippingPlanes=null,void(r.clipShadows=!1);r.clippingPlanes||(r.clippingPlanes=[]),r.clippingPlanes.length=0,r.clipShadows=t;for(const t of e)t.clip&&r.clippingPlanes.push(n?t.inverseClip:t.clip)}}))}unloadGL(){var e;kf--,kf||(this.element.scene.__localClipping=!1),null===(e=If(this,Pf,"f"))||void 0===e||e.disconnect(),Df(this,Pf,null,"f")}};Lf=new WeakMap,Cf=new WeakMap,Pf=new WeakMap,Of([Mf(!0),Nf("design:type",Object)],Bf.prototype,"clipShadows",void 0),Of([_f(""),Nf("design:type",Object),Nf("design:paramtypes",[Object])],Bf.prototype,"clipPlanes",null),Of([Mf(!1),Nf("design:type",Object)],Bf.prototype,"flipClip",void 0),Of([Mf(!1),Nf("design:type",Object)],Bf.prototype,"clipDisabled",void 0),Bf=Of([In],Bf),elementBehaviors.has("clip-planes")||elementBehaviors.define("clip-planes",Bf);var Uf,Ff,zf,Hf=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Gf extends bf{constructor(){super(...arguments),Uf.add(this)}loadGL(){this.resetMeshComponent(),this.element.needsUpdate()}unloadGL(){Hf(this,Uf,"m",Ff).call(this),this.element.needsUpdate()}resetMeshComponent(){Hf(this,Uf,"m",Ff).call(this),Hf(this,Uf,"m",zf).call(this),this.element.needsUpdate()}_createComponent(){throw new Error("`_createComponent()` is not implemented by subclass.")}}Uf=new WeakSet,Ff=function(){var e;null===(e=this.meshComponent)||void 0===e||e.dispose(),this.meshComponent=void 0},zf=function(){const e=this._createComponent();this.element.three[this.type]=e,this.meshComponent=e};class jf extends Gf{constructor(){super(...arguments),this.type="geometry"}get size(){return this.element.size}set size(e){this.element.size=e}get sizeMode(){return this.element.sizeMode}set sizeMode(e){this.element.sizeMode=e}get geometry(){return this.meshComponent}_createComponent(){return new Jp}loadGL(){super.loadGL(),this.createEffect((()=>{this.size,this.sizeMode,this.resetMeshComponent()}))}}class Vf extends jf{_createComponent(){return new Kp(this.element.calculatedSize.x,this.element.calculatedSize.y,this.element.calculatedSize.z)}}elementBehaviors.has("box-geometry")||elementBehaviors.define("box-geometry",Vf);class Wf extends jf{_createComponent(){return new Kp(this.element.calculatedSize.x,this.element.calculatedSize.y,1)}}elementBehaviors.has("mixedplane-geometry")||elementBehaviors.define("mixedplane-geometry",Wf);const qf=100,Xf=1e3,Yf=1001,Zf=1002,Jf=1003,$f=1004,Kf=1005,Qf=1006,em=1008,tm=1012,nm=1014,rm=1015,im=1016,om=1020,sm=1022,am=1023,cm=1026,lm=1027,um=2300,hm=2301,dm=2302,pm=2400,fm=2401,mm=2402,gm=3e3,vm=3001,ym=7680,bm=35044,xm=35048,_m="300 es";function wm(){}Object.assign(wm.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}});const Mm=[];for(let e=0;e<256;e++)Mm[e]=(e<16?"0":"")+e.toString(16);let Tm=1234567;const Sm={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Mm[255&e]+Mm[e>>8&255]+Mm[e>>16&255]+Mm[e>>24&255]+"-"+Mm[255&t]+Mm[t>>8&255]+"-"+Mm[t>>16&15|64]+Mm[t>>24&255]+"-"+Mm[63&n|128]+Mm[n>>8&255]+"-"+Mm[n>>16&255]+Mm[n>>24&255]+Mm[255&r]+Mm[r>>8&255]+Mm[r>>16&255]+Mm[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Tm=e%2147483647),Tm=16807*Tm%2147483647,(Tm-1)/2147483646},degToRad:function(e){return e*Sm.DEG2RAD},radToDeg:function(e){return e*Sm.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((t+r)/2),u=s((t+r)/2),h=o((t-r)/2),d=s((t-r)/2),p=o((r-t)/2),f=s((r-t)/2);switch(i){case"XYX":e.set(a*u,c*h,c*d,a*l);break;case"YZY":e.set(c*d,a*u,c*h,a*l);break;case"ZXZ":e.set(c*h,c*d,a*u,a*l);break;case"XZX":e.set(a*u,c*f,c*p,a*l);break;case"YXY":e.set(c*p,a*u,c*f,a*l);break;case"ZYZ":e.set(c*f,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Em{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Am{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,c){const l=this.elements;return l[0]=e,l[1]=r,l[2]=s,l[3]=t,l[4]=i,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=o*f+s*v+a*x,i[3]=o*m+s*y+a*_,i[6]=o*g+s*b+a*w,i[1]=c*f+l*v+u*x,i[4]=c*m+l*y+u*_,i[7]=c*g+l*b+u*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*_,i[8]=h*g+d*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8];return t*o*l-t*s*c-n*i*l+n*s*a+r*i*c-r*o*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=l*o-s*c,h=s*a-l*i,d=c*i-o*a,p=t*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*c-l*n)*f,e[2]=(s*n-r*o)*f,e[3]=h*f,e[4]=(l*t-r*a)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*a-c*t)*f,e[8]=(o*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,s){const a=Math.cos(i),c=Math.sin(i);return this.set(n*a,n*c,-n*(a*o+c*s)+o+e,-r*c,r*a,-r*(-c*o+a*s)+s+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],c=r[4],l=r[7];return r[0]=t*i+n*a,r[3]=t*o+n*c,r[6]=t*s+n*l,r[1]=-n*i+t*a,r[4]=-n*o+t*c,r[7]=-n*s+t*l,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}let Rm;const Lm={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Rm&&(Rm=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Rm.width=e.width,Rm.height=e.height;const n=Rm.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Rm}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let Cm=0;function Pm(e=Pm.DEFAULT_IMAGE,t=Pm.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,s=1023,a=1009,c=1,l=3e3){Object.defineProperty(this,"id",{value:Cm++}),this.uuid=Sm.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Em(0,0),this.repeat=new Em(1,1),this.center=new Em(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Am,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}function Om(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Lm.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Pm.DEFAULT_IMAGE=void 0,Pm.DEFAULT_MAPPING=300,Pm.prototype=Object.assign(Object.create(wm.prototype),{constructor:Pm,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Sm.generateUUID()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(Om(r[e].image)):t.push(Om(r[e]))}else t=Om(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Xf:e.x=e.x-Math.floor(e.x);break;case Yf:e.x=e.x<0?0:1;break;case Zf:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Xf:e.y=e.y-Math.floor(e.y);break;case Yf:e.y=e.y<0?0:1;break;case Zf:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Pm.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class Nm{constructor(e=0,t=0,n=0,r=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=.01,s=.1,a=e.elements,c=a[0],l=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(l-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(l+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(c+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(c+1)/2,a=(d+1)/2,v=(g+1)/2,y=(l+h)/4,b=(u+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=b/n):a>v?a<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=y/r,i=x/r):v<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=b/i,r=x/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-l)*(h-l));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-l)/v,this.w=Math.acos((c+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function Im(e,t,n){this.width=e,this.height=t,this.scissor=new Nm(0,0,e,t),this.scissorTest=!1,this.viewport=new Nm(0,0,e,t),n=n||{},this.texture=new Pm(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Qf,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Dm(e,t,n){Im.call(this,e,t,n),this.samples=4}Im.prototype=Object.assign(Object.create(wm.prototype),{constructor:Im,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Dm.prototype=Object.assign(Object.create(Im.prototype),{constructor:Dm,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Im.prototype.copy.call(this,e),this.samples=e.samples,this}});class km{constructor(e=0,t=0,n=0,r=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return n.copy(e).slerp(t,r)}static slerpFlat(e,t,n,r,i,o,s){let a=n[r+0],c=n[r+1],l=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(u!==f||a!==h||c!==d||l!==p){let e=1-s;const t=a*h+c*d+l*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*e+h*i,c=c*e+d*i,l=l*e+p*i,u=u*e+f*i,e===1-s){const e=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=e,c*=e,l*=e,u*=e}}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const s=n[r],a=n[r+1],c=n[r+2],l=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return e[t]=s*p+l*u+a*d-c*h,e[t+1]=a*p+l*h+c*u-s*d,e[t+2]=c*p+l*d+s*h-a*u,e[t+3]=l*p-s*u-a*h-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case"XYZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"YXZ":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"ZXY":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"ZYX":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"YZX":this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p;break;case"XZY":this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],a=t[9],c=t[2],l=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(l-a)*e,this._y=(i-c)*e,this._z=(o-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(l-a)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+c)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-c)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(a+l)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-r)/e,this._x=(i+c)/e,this._y=(a+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Sm.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,c=t._z,l=t._w;return this._x=n*l+o*s+r*c-i*a,this._y=r*l+o*a+i*s-n*c,this._z=i*l+o*c+n*a-r*s,this._w=o*l-n*s-r*a-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),u=Math.sin((1-t)*l)/c,h=Math.sin(t*l)/c;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class Bm{constructor(e=0,t=0,n=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Fm.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Fm.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,c=a*t+o*r-s*n,l=a*n+s*t-i*r,u=a*r+i*n-o*t,h=-i*t-o*n-s*r;return this.x=c*a+h*-i+l*-s-u*-o,this.y=l*a+h*-o+u*-i-c*-s,this.z=u*a+h*-s+c*-o-l*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Um.copy(this).projectOnVector(e),this.sub(Um)}reflect(e){return this.sub(Um.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Sm.clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Um=new Bm,Fm=new km;class zm{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new Bm(1/0,1/0,1/0),this.max=void 0!==t?t:new Bm(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.length;a<c;a+=3){const c=e[a],l=e[a+1],u=e[a+2];c<t&&(t=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.count;a<c;a++){const c=e.getX(a),l=e.getY(a),u=e.getZ(a);c<t&&(t=c),l<n&&(n=l),u<r&&(r=u),c>i&&(i=c),l>o&&(o=l),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=jm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Bm),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Bm),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Vm.copy(t.boundingBox),Vm.applyMatrix4(e.matrixWorld),this.union(Vm));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Bm),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,jm),jm.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter($m),Km.subVectors(this.max,$m),Wm.subVectors(e.a,$m),qm.subVectors(e.b,$m),Xm.subVectors(e.c,$m),Ym.subVectors(qm,Wm),Zm.subVectors(Xm,qm),Jm.subVectors(Wm,Xm);let t=[0,-Ym.z,Ym.y,0,-Zm.z,Zm.y,0,-Jm.z,Jm.y,Ym.z,0,-Ym.x,Zm.z,0,-Zm.x,Jm.z,0,-Jm.x,-Ym.y,Ym.x,0,-Zm.y,Zm.x,0,-Jm.y,Jm.x,0];return!!Hm(t,Wm,qm,Xm,Km)&&(t=[1,0,0,0,1,0,0,0,1],!!Hm(t,Wm,qm,Xm,Km)&&(Qm.crossVectors(Ym,Zm),t=[Qm.x,Qm.y,Qm.z],Hm(t,Wm,qm,Xm,Km)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Bm),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return jm.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(jm).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Gm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gm)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function Hm(e,t,n,r,i){for(let o=0,s=e.length-3;o<=s;o+=3){eg.fromArray(e,o);const s=i.x*Math.abs(eg.x)+i.y*Math.abs(eg.y)+i.z*Math.abs(eg.z),a=t.dot(eg),c=n.dot(eg),l=r.dot(eg);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>s)return!1}return!0}const Gm=[new Bm,new Bm,new Bm,new Bm,new Bm,new Bm,new Bm,new Bm],jm=new Bm,Vm=new zm,Wm=new Bm,qm=new Bm,Xm=new Bm,Ym=new Bm,Zm=new Bm,Jm=new Bm,$m=new Bm,Km=new Bm,Qm=new Bm,eg=new Bm,tg=new zm;class ng{constructor(e,t){this.center=void 0!==e?e:new Bm,this.radius=void 0!==t?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):tg.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Bm),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new zm),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const rg=new Bm,ig=new Bm,og=new Bm,sg=new Bm,ag=new Bm,cg=new Bm,lg=new Bm;class ug{constructor(e,t){this.origin=void 0!==e?e:new Bm,this.direction=void 0!==t?t:new Bm(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Bm),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rg)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Bm),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=rg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rg.copy(this.direction).multiplyScalar(t).add(this.origin),rg.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){ig.copy(e).add(t).multiplyScalar(.5),og.copy(t).sub(e).normalize(),sg.copy(this.origin).sub(ig);const i=.5*e.distanceTo(t),o=-this.direction.dot(og),s=sg.dot(this.direction),a=-sg.dot(og),c=sg.lengthSq(),l=Math.abs(1-o*o);let u,h,d,p;if(l>0)if(u=o*a-s,h=o*s-a,p=i*l,u>=0)if(h>=-p)if(h<=p){const e=1/l;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+c}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+c):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+c);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(og).multiplyScalar(h).add(ig),d}intersectSphere(e,t){rg.subVectors(e.center,this.origin);const n=rg.dot(this.direction),r=rg.dot(rg)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),l>=0?(i=(e.min.y-h.y)*l,o=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,o=(e.min.y-h.y)*l),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,rg)}intersectTriangle(e,t,n,r,i){ag.subVectors(t,e),cg.subVectors(n,e),lg.crossVectors(ag,cg);let o,s=this.direction.dot(lg);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}sg.subVectors(this.origin,e);const a=o*this.direction.dot(cg.crossVectors(sg,cg));if(a<0)return null;const c=o*this.direction.dot(ag.cross(sg));if(c<0)return null;if(a+c>s)return null;const l=-o*sg.dot(lg);return l<0?null:this.at(l/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class hg{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new hg).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/dg.setFromMatrixColumn(e,0).length(),i=1/dg.setFromMatrixColumn(e,1).length(),o=1/dg.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),c=Math.sin(r),l=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*l,n=o*u,r=s*l,i=s*u;t[0]=a*l,t[4]=-a*u,t[8]=c,t[1]=n+r*c,t[5]=e-i*c,t[9]=-s*a,t[2]=i-e*c,t[6]=r+n*c,t[10]=o*a}else if("YXZ"===e.order){const e=a*l,n=a*u,r=c*l,i=c*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=o*c,t[1]=o*u,t[5]=o*l,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*l,n=a*u,r=c*l,i=c*u;t[0]=e-i*s,t[4]=-o*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=o*l,t[9]=i-e*s,t[2]=-o*c,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*l,n=o*u,r=s*l,i=s*u;t[0]=a*l,t[4]=r*c-n,t[8]=e*c+i,t[1]=a*u,t[5]=i*c+e,t[9]=n*c-r,t[2]=-c,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*c,r=s*a,i=s*c;t[0]=a*l,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*l,t[9]=-s*l,t[2]=-c*l,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=o*a,n=o*c,r=s*a,i=s*c;t[0]=a*l,t[4]=-u,t[8]=c*l,t[1]=e*u+i,t[5]=o*l,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*l,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(fg,e,mg)}lookAt(e,t,n){const r=this.elements;return yg.subVectors(e,t),0===yg.lengthSq()&&(yg.z=1),yg.normalize(),gg.crossVectors(n,yg),0===gg.lengthSq()&&(1===Math.abs(n.z)?yg.x+=1e-4:yg.z+=1e-4,yg.normalize(),gg.crossVectors(n,yg)),gg.normalize(),vg.crossVectors(yg,gg),r[0]=gg.x,r[4]=vg.x,r[8]=yg.x,r[1]=gg.y,r[5]=vg.y,r[9]=yg.y,r[2]=gg.z,r[6]=vg.z,r[10]=yg.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],M=r[8],T=r[12],S=r[1],E=r[5],A=r[9],R=r[13],L=r[2],C=r[6],P=r[10],O=r[14],N=r[3],I=r[7],D=r[11],k=r[15];return i[0]=o*_+s*S+a*L+c*N,i[4]=o*w+s*E+a*C+c*I,i[8]=o*M+s*A+a*P+c*D,i[12]=o*T+s*R+a*O+c*k,i[1]=l*_+u*S+h*L+d*N,i[5]=l*w+u*E+h*C+d*I,i[9]=l*M+u*A+h*P+d*D,i[13]=l*T+u*R+h*O+d*k,i[2]=p*_+f*S+m*L+g*N,i[6]=p*w+f*E+m*C+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*T+f*R+m*O+g*k,i[3]=v*_+y*S+b*L+x*N,i[7]=v*w+y*E+b*C+x*I,i[11]=v*M+y*A+b*P+x*D,i[15]=v*T+y*R+b*O+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],c=e[13],l=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-r*c*u-i*s*h+n*c*h+r*s*d-n*a*d)+e[7]*(+t*a*d-t*c*h+i*o*h-r*o*d+r*c*l-i*a*l)+e[11]*(+t*c*u-t*s*d-i*o*u+n*o*d+i*s*l-n*c*l)+e[15]*(-r*s*l-t*a*u+t*s*h+r*o*u-n*o*h+n*a*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*c-f*h*c+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*c-l*m*c-p*a*d+o*m*d+l*a*g-o*h*g,b=l*f*c-p*u*c+p*s*d-o*f*d-l*s*g+o*u*g,x=p*u*a-l*f*a-p*s*h+o*f*h+l*s*m-o*u*m,_=t*v+n*y+r*b+i*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(s*m*i-f*a*i+f*r*c-n*m*c-s*r*g+n*a*g)*w,e[3]=(u*a*i-s*h*i-u*r*c+n*h*c+s*r*d-n*a*d)*w,e[4]=y*w,e[5]=(l*m*i-p*h*i+p*r*d-t*m*d-l*r*g+t*h*g)*w,e[6]=(p*a*i-o*m*i-p*r*c+t*m*c+o*r*g-t*a*g)*w,e[7]=(o*h*i-l*a*i+l*r*c-t*h*c-o*r*d+t*a*d)*w,e[8]=b*w,e[9]=(p*u*i-l*f*i-p*n*d+t*f*d+l*n*g-t*u*g)*w,e[10]=(o*f*i-p*s*i+p*n*c-t*f*c-o*n*g+t*s*g)*w,e[11]=(l*s*i-o*u*i-l*n*c+t*u*c+o*n*d-t*s*d)*w,e[12]=x*w,e[13]=(l*f*r-p*u*r+p*n*h-t*f*h-l*n*m+t*u*m)*w,e[14]=(p*s*r-o*f*r-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*r-l*s*r+l*n*a-t*u*a-o*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,c=i*o,l=i*s;return this.set(c*o+n,c*s-r*a,c*a+r*s,0,c*s+r*a,l*s+n,l*a-r*o,0,c*a-r*s,l*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,c=i+i,l=o+o,u=s+s,h=i*c,d=i*l,p=i*u,f=o*l,m=o*u,g=s*u,v=a*c,y=a*l,b=a*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-b)*_,r[5]=(1-(h+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=dg.set(r[0],r[1],r[2]).length();const o=dg.set(r[4],r[5],r[6]).length(),s=dg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],pg.copy(this);const a=1/i,c=1/o,l=1/s;return pg.elements[0]*=a,pg.elements[1]*=a,pg.elements[2]*=a,pg.elements[4]*=c,pg.elements[5]*=c,pg.elements[6]*=c,pg.elements[8]*=l,pg.elements[9]*=l,pg.elements[10]*=l,t.setFromRotationMatrix(pg),n.x=i,n.y=o,n.z=s,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(t-e),c=2*i/(n-r),l=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,o){const s=this.elements,a=1/(t-e),c=1/(n-r),l=1/(o-i),u=(t+e)*a,h=(n+r)*c,d=(o+i)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const dg=new Bm,pg=new hg,fg=new Bm(0,0,0),mg=new Bm(1,1,1),gg=new Bm,vg=new Bm,yg=new Bm;class bg{constructor(e=0,t=0,n=0,r=bg.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const r=Sm.clamp,i=e.elements,o=i[0],s=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return xg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xg,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return _g.setFromEuler(this),this.setFromQuaternion(_g,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Bm(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}bg.DefaultOrder="XYZ",bg.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const xg=new hg,_g=new km;class wg{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Mg=0;const Tg=new Bm,Sg=new km,Eg=new hg,Ag=new Bm,Rg=new Bm,Lg=new Bm,Cg=new km,Pg=new Bm(1,0,0),Og=new Bm(0,1,0),Ng=new Bm(0,0,1),Ig={type:"added"},Dg={type:"removed"};function kg(){Object.defineProperty(this,"id",{value:Mg++}),this.uuid=Sm.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kg.DefaultUp.clone();const e=new Bm,t=new bg,n=new km,r=new Bm(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new hg},normalMatrix:{value:new Am}}),this.matrix=new hg,this.matrixWorld=new hg,this.matrixAutoUpdate=kg.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new wg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}kg.DefaultUp=new Bm(0,1,0),kg.DefaultMatrixAutoUpdate=!0,kg.prototype=Object.assign(Object.create(wm.prototype),{constructor:kg,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Sg.setFromAxisAngle(e,t),this.quaternion.multiply(Sg),this},rotateOnWorldAxis:function(e,t){return Sg.setFromAxisAngle(e,t),this.quaternion.premultiply(Sg),this},rotateX:function(e){return this.rotateOnAxis(Pg,e)},rotateY:function(e){return this.rotateOnAxis(Og,e)},rotateZ:function(e){return this.rotateOnAxis(Ng,e)},translateOnAxis:function(e,t){return Tg.copy(e).applyQuaternion(this.quaternion),this.position.add(Tg.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Pg,e)},translateY:function(e){return this.translateOnAxis(Og,e)},translateZ:function(e){return this.translateOnAxis(Ng,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Eg.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?Ag.copy(e):Ag.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Rg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Eg.lookAt(Rg,Ag,this.up):Eg.lookAt(Ag,Rg,this.up),this.quaternion.setFromRotationMatrix(Eg),r&&(Eg.extractRotation(r.matrixWorld),Sg.setFromRotationMatrix(Eg),this.quaternion.premultiply(Sg.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ig)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Dg)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Dg)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),Eg.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Eg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Eg),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Bm),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new km),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rg,e,Lg),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Bm),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rg,Cg,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Bm),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),c=o(e.skeletons),l=o(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}});const Bg=new Bm,Ug=new Bm,Fg=new Am;class zg{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new Bm(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Bg.subVectors(n,t).cross(Ug.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Bm),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Bm);const n=e.delta(Bg),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Bm),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Fg.getNormalMatrix(e),r=this.coplanarPoint(Bg).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const Hg=new Bm,Gg=new Bm,jg=new Bm,Vg=new Bm,Wg=new Bm,qg=new Bm,Xg=new Bm,Yg=new Bm,Zg=new Bm,Jg=new Bm;class $g{constructor(e,t,n){this.a=void 0!==e?e:new Bm,this.b=void 0!==t?t:new Bm,this.c=void 0!==n?n:new Bm}static getNormal(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Bm),r.subVectors(n,t),Hg.subVectors(e,t),r.cross(Hg);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Hg.subVectors(r,t),Gg.subVectors(n,t),jg.subVectors(e,t);const o=Hg.dot(Hg),s=Hg.dot(Gg),a=Hg.dot(jg),c=Gg.dot(Gg),l=Gg.dot(jg),u=o*c-s*s;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Bm),0===u)return i.set(-2,-1,-1);const h=1/u,d=(c*a-s*l)*h,p=(o*l-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Vg),Vg.x>=0&&Vg.y>=0&&Vg.x+Vg.y<=1}static getUV(e,t,n,r,i,o,s,a){return this.getBarycoord(e,t,n,r,Vg),a.set(0,0),a.addScaledVector(i,Vg.x),a.addScaledVector(o,Vg.y),a.addScaledVector(s,Vg.z),a}static isFrontFacing(e,t,n,r){return Hg.subVectors(n,t),Gg.subVectors(e,t),Hg.cross(Gg).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Hg.subVectors(this.c,this.b),Gg.subVectors(this.a,this.b),.5*Hg.cross(Gg).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Bm),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $g.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new zg),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $g.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return $g.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return $g.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $g.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Bm);const n=this.a,r=this.b,i=this.c;let o,s;Wg.subVectors(r,n),qg.subVectors(i,n),Yg.subVectors(e,n);const a=Wg.dot(Yg),c=qg.dot(Yg);if(a<=0&&c<=0)return t.copy(n);Zg.subVectors(e,r);const l=Wg.dot(Zg),u=qg.dot(Zg);if(l>=0&&u<=l)return t.copy(r);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),t.copy(n).addScaledVector(Wg,o);Jg.subVectors(e,i);const d=Wg.dot(Jg),p=qg.dot(Jg);if(p>=0&&d<=p)return t.copy(i);const f=d*c-a*p;if(f<=0&&c>=0&&p<=0)return s=c/(c-p),t.copy(n).addScaledVector(qg,s);const m=l*p-d*u;if(m<=0&&u-l>=0&&d-p>=0)return Xg.subVectors(i,r),s=(u-l)/(u-l+(d-p)),t.copy(r).addScaledVector(Xg,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(Wg,o).addScaledVector(qg,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Kg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qg={h:0,s:0,l:0},ev={h:0,s:0,l:0};function tv(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function nv(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function rv(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class iv{constructor(e,t,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Sm.euclideanModulo(e,1),t=Sm.clamp(t,0,1),n=Sm.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=tv(i,r,e+1/3),this.g=tv(i,r,e),this.b=tv(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Kg[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=nv(e.r),this.g=nv(e.g),this.b=nv(e.b),this}copyLinearToSRGB(e){return this.r=rv(e.r),this.g=rv(e.g),this.b=rv(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let s,a;const c=(o+i)/2;if(o===i)s=0,a=0;else{const e=i-o;switch(a=c<=.5?e/(i+o):e/(2-i-o),i){case t:s=(n-r)/e+(n<r?6:0);break;case n:s=(r-t)/e+2;break;case r:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=c,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Qg),Qg.h+=e,Qg.s+=t,Qg.l+=n,this.setHSL(Qg.h,Qg.s,Qg.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpHSL(e,t){this.getHSL(Qg),e.getHSL(ev);const n=Sm.lerp(Qg.h,ev.h,t),r=Sm.lerp(Qg.s,ev.s,t),i=Sm.lerp(Qg.l,ev.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}iv.NAMES=Kg,iv.prototype.r=1,iv.prototype.g=1,iv.prototype.b=1;class ov{constructor(e,t,n,r,i,o=0){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new Bm,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new iv,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let sv=0;function av(){Object.defineProperty(this,"id",{value:sv++}),this.uuid=Sm.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=qf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ym,this.stencilZFail=ym,this.stencilZPass=ym,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function cv(e){av.call(this),this.type="MeshBasicMaterial",this.color=new iv(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}av.prototype=Object.assign(Object.create(wm.prototype),{constructor:av,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(av.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),cv.prototype=Object.create(av.prototype),cv.prototype.constructor=cv,cv.prototype.isMeshBasicMaterial=!0,cv.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const lv=new Bm,uv=new Em;function hv(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=bm,this.updateRange={offset:0,count:-1},this.version=0}function dv(e,t,n){hv.call(this,new Int8Array(e),t,n)}function pv(e,t,n){hv.call(this,new Uint8Array(e),t,n)}function fv(e,t,n){hv.call(this,new Uint8ClampedArray(e),t,n)}function mv(e,t,n){hv.call(this,new Int16Array(e),t,n)}function gv(e,t,n){hv.call(this,new Uint16Array(e),t,n)}function vv(e,t,n){hv.call(this,new Int32Array(e),t,n)}function yv(e,t,n){hv.call(this,new Uint32Array(e),t,n)}function bv(e,t,n){hv.call(this,new Uint16Array(e),t,n)}function xv(e,t,n){hv.call(this,new Float32Array(e),t,n)}function _v(e,t,n){hv.call(this,new Float64Array(e),t,n)}Object.defineProperty(hv.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(hv.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new iv),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this},copyVector2sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Em),t[n++]=i.x,t[n++]=i.y}return this},copyVector3sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Bm),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this},copyVector4sArray:function(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Nm),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)uv.fromBufferAttribute(this,t),uv.applyMatrix3(e),this.setXY(t,uv.x,uv.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)lv.fromBufferAttribute(this,t),lv.applyMatrix3(e),this.setXYZ(t,lv.x,lv.y,lv.z);return this},applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)lv.x=this.getX(t),lv.y=this.getY(t),lv.z=this.getZ(t),lv.applyMatrix4(e),this.setXYZ(t,lv.x,lv.y,lv.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)lv.x=this.getX(t),lv.y=this.getY(t),lv.z=this.getZ(t),lv.applyNormalMatrix(e),this.setXYZ(t,lv.x,lv.y,lv.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)lv.x=this.getX(t),lv.y=this.getY(t),lv.z=this.getZ(t),lv.transformDirection(e),this.setXYZ(t,lv.x,lv.y,lv.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),dv.prototype=Object.create(hv.prototype),dv.prototype.constructor=dv,pv.prototype=Object.create(hv.prototype),pv.prototype.constructor=pv,fv.prototype=Object.create(hv.prototype),fv.prototype.constructor=fv,mv.prototype=Object.create(hv.prototype),mv.prototype.constructor=mv,gv.prototype=Object.create(hv.prototype),gv.prototype.constructor=gv,vv.prototype=Object.create(hv.prototype),vv.prototype.constructor=vv,yv.prototype=Object.create(hv.prototype),yv.prototype.constructor=yv,bv.prototype=Object.create(hv.prototype),bv.prototype.constructor=bv,bv.prototype.isFloat16BufferAttribute=!0,xv.prototype=Object.create(hv.prototype),xv.prototype.constructor=xv,_v.prototype=Object.create(hv.prototype),_v.prototype.constructor=_v;class wv{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let n,r,i;const o=e.faces;for(r=0;r<o.length;r++){const e=o[r];e.materialIndex!==i&&(i=e.materialIndex,void 0!==n&&(n.count=3*r-n.start,t.push(n)),n={start:3*r,materialIndex:i})}void 0!==n&&(n.count=3*r-n.start,t.push(n)),this.groups=t}fromGeometry(e){const t=e.faces,n=e.vertices,r=e.faceVertexUvs,i=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=e.morphTargets,a=s.length;let c;if(a>0){c=[];for(let e=0;e<a;e++)c[e]={name:s[e].name,data:[]};this.morphTargets.position=c}const l=e.morphNormals,u=l.length;let h;if(u>0){h=[];for(let e=0;e<u;e++)h[e]={name:l[e].name,data:[]};this.morphTargets.normal=h}const d=e.skinIndices,p=e.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let e=0;e<t.length;e++){const g=t[e];this.vertices.push(n[g.a],n[g.b],n[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const e=g.normal;this.normals.push(e,e,e)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const e=g.color;this.colors.push(e,e,e)}if(!0===i){const t=r[0][e];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",e),this.uvs.push(new Em,new Em,new Em))}if(!0===o){const t=r[1][e];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",e),this.uvs2.push(new Em,new Em,new Em))}for(let e=0;e<a;e++){const t=s[e].vertices;c[e].data.push(t[g.a],t[g.b],t[g.c])}for(let t=0;t<u;t++){const n=l[t].vertexNormals[e];h[t].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}function Mv(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}const Tv={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Sv(e,t){return new Tv[e](t)}let Ev=1;const Av=new hg,Rv=new kg,Lv=new Bm,Cv=new zm,Pv=new zm,Ov=new Bm;function Nv(){Object.defineProperty(this,"id",{value:Ev+=2}),this.uuid=Sm.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Nv.prototype=Object.assign(Object.create(wm.prototype),{constructor:Nv,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(Mv(e)>65535?yv:gv)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Am).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Av.makeRotationX(e),this.applyMatrix4(Av),this},rotateY:function(e){return Av.makeRotationY(e),this.applyMatrix4(Av),this},rotateZ:function(e){return Av.makeRotationZ(e),this.applyMatrix4(Av),this},translate:function(e,t,n){return Av.makeTranslation(e,t,n),this.applyMatrix4(Av),this},scale:function(e,t,n){return Av.makeScale(e,t,n),this.applyMatrix4(Av),this},lookAt:function(e){return Rv.lookAt(e),Rv.updateMatrix(),this.applyMatrix4(Rv.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Lv).negate(),this.translate(Lv.x,Lv.y,Lv.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const e=new xv(3*t.vertices.length,3),n=new xv(3*t.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const e=new xv(t.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new xv(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}if(!0===t.verticesNeedUpdate){const e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){const e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){const e=this.attributes.color;void 0!==e&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new wv).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new hv(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const t=new Float32Array(3*e.normals.length);this.setAttribute("normal",new hv(t,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const t=new Float32Array(3*e.colors.length);this.setAttribute("color",new hv(t,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const t=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new hv(t,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const t=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new hv(t,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const t in e.morphTargets){const n=[],r=e.morphTargets[t];for(let e=0,t=r.length;e<t;e++){const t=r[e],i=new xv(3*t.data.length,3);i.name=t.name,n.push(i.copyVector3sArray(t.data))}this.morphAttributes[t]=n}if(e.skinIndices.length>0){const t=new xv(4*e.skinIndices.length,4);this.setAttribute("skinIndex",t.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const t=new xv(4*e.skinWeights.length,4);this.setAttribute("skinWeight",t.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new zm);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Bm(-1/0,-1/0,-1/0),new Bm(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Cv.setFromBufferAttribute(n),this.morphTargetsRelative?(Ov.addVectors(this.boundingBox.min,Cv.min),this.boundingBox.expandByPoint(Ov),Ov.addVectors(this.boundingBox.max,Cv.max),this.boundingBox.expandByPoint(Ov)):(this.boundingBox.expandByPoint(Cv.min),this.boundingBox.expandByPoint(Cv.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ng);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Bm,1/0);if(e){const n=this.boundingSphere.center;if(Cv.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Pv.setFromBufferAttribute(n),this.morphTargetsRelative?(Ov.addVectors(Cv.min,Pv.min),Cv.expandByPoint(Ov),Ov.addVectors(Cv.max,Pv.max),Cv.expandByPoint(Ov)):(Cv.expandByPoint(Pv.min),Cv.expandByPoint(Pv.max))}Cv.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Ov.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Ov));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)Ov.fromBufferAttribute(o,t),s&&(Lv.fromBufferAttribute(e,t),Ov.add(Lv)),r=Math.max(r,n.distanceToSquared(Ov))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new hv(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Bm,i=new Bm,o=new Bm,s=new Bm,a=new Bm,c=new Bm,l=new Bm,u=new Bm;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),c.fromBufferAttribute(n,f),s.add(l),a.add(l),c.add(l),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),l.subVectors(o,i),u.subVectors(r,i),l.cross(u),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],s=o.array,a=o.itemSize*t,c=Math.min(s.length,i.length-a);for(let e=0,t=a;e<c;e++,t++)i[t]=s[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ov.fromBufferAttribute(e,t),Ov.normalize(),e.setXYZ(t,Ov.x,Ov.y,Ov.z)},toNonIndexed:function(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let s=0,a=0;for(let e=0,i=t.length;e<i;e++){s=t[e]*r;for(let e=0;e<r;e++)o[a++]=n[s++]}return new hv(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new Nv,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t],i=r.toJSON(e.data);""!==r.name&&(i.name=r.name),e.data.attributes[t]=i}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.toJSON(e.data);""!==r.name&&(i.name=r.name),o.push(i)}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e},clone:function(){return(new Nv).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Iv=new hg,Dv=new ug,kv=new ng,Bv=new Bm,Uv=new Bm,Fv=new Bm,zv=new Bm,Hv=new Bm,Gv=new Bm,jv=new Bm,Vv=new Bm,Wv=new Bm,qv=new Em,Xv=new Em,Yv=new Em,Zv=new Bm,Jv=new Bm;function $v(e=new Nv,t=new cv){kg.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function Kv(e,t,n,r,i,o,s,a){let c;if(c=1===t.side?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,2!==t.side,a),null===c)return null;Jv.copy(a),Jv.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(Jv);return l<n.near||l>n.far?null:{distance:l,point:Jv.clone(),object:e}}function Qv(e,t,n,r,i,o,s,a,c,l,u,h){Bv.fromBufferAttribute(i,l),Uv.fromBufferAttribute(i,u),Fv.fromBufferAttribute(i,h);const d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){jv.set(0,0,0),Vv.set(0,0,0),Wv.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=d[e],n=o[e];0!==t&&(zv.fromBufferAttribute(n,l),Hv.fromBufferAttribute(n,u),Gv.fromBufferAttribute(n,h),s?(jv.addScaledVector(zv,t),Vv.addScaledVector(Hv,t),Wv.addScaledVector(Gv,t)):(jv.addScaledVector(zv.sub(Bv),t),Vv.addScaledVector(Hv.sub(Uv),t),Wv.addScaledVector(Gv.sub(Fv),t)))}Bv.add(jv),Uv.add(Vv),Fv.add(Wv)}e.isSkinnedMesh&&(e.boneTransform(l,Bv),e.boneTransform(u,Uv),e.boneTransform(h,Fv));const p=Kv(e,t,n,r,Bv,Uv,Fv,Zv);if(p){a&&(qv.fromBufferAttribute(a,l),Xv.fromBufferAttribute(a,u),Yv.fromBufferAttribute(a,h),p.uv=$g.getUV(Zv,Bv,Uv,Fv,qv,Xv,Yv,new Em)),c&&(qv.fromBufferAttribute(c,l),Xv.fromBufferAttribute(c,u),Yv.fromBufferAttribute(c,h),p.uv2=$g.getUV(Zv,Bv,Uv,Fv,qv,Xv,Yv,new Em));const e=new ov(l,u,h);$g.getNormal(Bv,Uv,Fv,e.normal),p.face=e}return p}$v.prototype=Object.assign(Object.create(kg.prototype),{constructor:$v,isMesh:!0,copy:function(e){return kg.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),kv.copy(n.boundingSphere),kv.applyMatrix4(i),!1===e.ray.intersectsSphere(kv))return;if(Iv.copy(i).invert(),Dv.copy(e.ray).applyMatrix4(Iv),null!==n.boundingBox&&!1===Dv.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=Qv(this,f,e,Dv,s,a,c,l,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);o=Qv(this,r,e,Dv,s,a,c,l,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3)o=Qv(this,p,e,Dv,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}else for(let n=Math.max(0,d.start),i=Math.min(s.count,d.start+d.count);n<i;n+=3)o=Qv(this,r,e,Dv,s,a,c,l,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(n.isGeometry){const i=Array.isArray(r),s=n.vertices,a=n.faces;let c;const l=n.faceVertexUvs[0];l.length>0&&(c=l);for(let n=0,l=a.length;n<l;n++){const l=a[n],u=i?r[l.materialIndex]:r;if(void 0===u)continue;const h=s[l.a],d=s[l.b],p=s[l.c];if(o=Kv(this,u,e,Dv,h,d,p,Zv),o){if(c&&c[n]){const e=c[n];qv.copy(e[0]),Xv.copy(e[1]),Yv.copy(e[2]),o.uv=$g.getUV(Zv,h,d,p,qv,Xv,Yv,new Em)}o.face=l,o.faceIndex=n,t.push(o)}}}}});class ey extends Nv{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],c=[],l=[],u=[];let h=0,d=0;function p(e,t,n,r,i,o,p,f,m,g,v){const y=o/m,b=p/g,x=o/2,_=p/2,w=f/2,M=m+1,T=g+1;let S=0,E=0;const A=new Bm;for(let o=0;o<T;o++){const s=o*b-_;for(let a=0;a<M;a++){const h=a*y-x;A[e]=h*r,A[t]=s*i,A[n]=w,c.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,l.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),S+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+M*e,r=h+t+M*(e+1),i=h+(t+1)+M*(e+1),o=h+(t+1)+M*e;a.push(n,r,o),a.push(r,i,o),E+=6}s.addGroup(d,E,v),d+=E,h+=S}p("z","y","x",-1,-1,n,t,e,o,i,0),p("z","y","x",1,-1,n,t,-e,o,i,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new xv(c,3)),this.setAttribute("normal",new xv(l,3)),this.setAttribute("uv",new xv(u,2))}}function ty(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function ny(e){const t={};for(let n=0;n<e.length;n++){const r=ty(e[n]);for(const e in r)t[e]=r[e]}return t}const ry={clone:ty,merge:ny};function iy(e){av.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function oy(){kg.call(this),this.type="Camera",this.matrixWorldInverse=new hg,this.projectionMatrix=new hg,this.projectionMatrixInverse=new hg}function sy(e=50,t=1,n=.1,r=2e3){oy.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}iy.prototype=Object.create(av.prototype),iy.prototype.constructor=iy,iy.prototype.isShaderMaterial=!0,iy.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ty(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},iy.prototype.toJSON=function(e){const t=av.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},oy.prototype=Object.assign(Object.create(kg.prototype),{constructor:oy,isCamera:!0,copy:function(e,t){return kg.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Bm),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){kg.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){kg.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),sy.prototype=Object.assign(Object.create(oy.prototype),{constructor:sy,isPerspectiveCamera:!0,copy:function(e,t){return oy.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Sm.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*Sm.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Sm.RAD2DEG*Math.atan(Math.tan(.5*Sm.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*Sm.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/s,r*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=kg.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const ay=90;function cy(e,t,n){if(kg.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new sy(ay,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Bm(1,0,0)),this.add(r);const i=new sy(ay,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Bm(-1,0,0)),this.add(i);const o=new sy(ay,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Bm(0,1,0)),this.add(o);const s=new sy(ay,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Bm(0,-1,0)),this.add(s);const a=new sy(ay,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Bm(0,0,1)),this.add(a);const c=new sy(ay,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Bm(0,0,-1)),this.add(c),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const l=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(u),e.xr.enabled=l}}function ly(e,t,n,r,i,o,s,a,c,l){e=void 0!==e?e:[],t=void 0!==t?t:301,s=void 0!==s?s:sm,Pm.call(this,e,t,n,r,i,o,s,a,c,l),this.flipY=!1,this._needsFlipEnvMap=!0}function uy(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),Im.call(this,e,e,t),t=t||{},this.texture=new ly(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}function hy(e,t,n,r,i,o,s,a,c,l,u,h){Pm.call(this,null,o,s,a,c,l,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==c?c:Jf,this.minFilter=void 0!==l?l:Jf,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}cy.prototype=Object.create(kg.prototype),cy.prototype.constructor=cy,ly.prototype=Object.create(Pm.prototype),ly.prototype.constructor=ly,ly.prototype.isCubeTexture=!0,Object.defineProperty(ly.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),uy.prototype=Object.create(Im.prototype),uy.prototype.constructor=uy,uy.prototype.isWebGLCubeRenderTarget=!0,uy.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=am,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",i="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",o=new ey(5,5,5),s=new iy({name:"CubemapFromEquirect",uniforms:ty(n),vertexShader:r,fragmentShader:i,side:1,blending:0});s.uniforms.tEquirect.value=t;const a=new $v(o,s),c=t.minFilter;return t.minFilter===em&&(t.minFilter=Qf),new cy(1,10,this).update(e,a),t.minFilter=c,a.geometry.dispose(),a.material.dispose(),this},uy.prototype.clear=function(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)},hy.prototype=Object.create(Pm.prototype),hy.prototype.constructor=hy,hy.prototype.isDataTexture=!0;const dy=new ng,py=new Bm;class fy{constructor(e,t,n,r,i,o){this.planes=[void 0!==e?e:new zg,void 0!==t?t:new zg,void 0!==n?n:new zg,void 0!==r?r:new zg,void 0!==i?i:new zg,void 0!==o?o:new zg]}set(e,t,n,r,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(s-r,u-a,f-h,y-m).normalize(),t[1].setComponents(s+r,u+a,f+h,y+m).normalize(),t[2].setComponents(s+i,u+c,f+d,y+g).normalize(),t[3].setComponents(s-i,u-c,f-d,y-g).normalize(),t[4].setComponents(s-o,u-l,f-p,y-v).normalize(),t[5].setComponents(s+o,u+l,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),dy.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(dy)}intersectsSprite(e){return dy.center.set(0,0,0),dy.radius=.7071067811865476,dy.applyMatrix4(e.matrixWorld),this.intersectsSphere(dy)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(py.x=r.normal.x>0?e.max.x:e.min.x,py.y=r.normal.y>0?e.max.y:e.min.y,py.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(py)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}function my(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function gy(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,s=e.createBuffer();e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(function(t,r,i){const o=r.array,s=r.updateRange;e.bindBuffer(i,t),-1===s.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class vy extends Nv{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,s=Math.floor(n),a=Math.floor(r),c=s+1,l=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<l;e++){const t=e*h-o;for(let n=0;n<c;n++){const r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+c*e,r=t+c*(e+1),i=t+1+c*(e+1),o=t+1+c*e;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new xv(p,3)),this.setAttribute("normal",new xv(f,3)),this.setAttribute("uv",new xv(m,2))}}const yy={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},by={common:{diffuse:{value:new iv(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Am},uv2Transform:{value:new Am},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Em(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new iv(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new iv(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Am}},sprite:{diffuse:{value:new iv(15658734)},opacity:{value:1},center:{value:new Em(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Am}}},xy={basic:{uniforms:ny([by.common,by.specularmap,by.envmap,by.aomap,by.lightmap,by.fog]),vertexShader:yy.meshbasic_vert,fragmentShader:yy.meshbasic_frag},lambert:{uniforms:ny([by.common,by.specularmap,by.envmap,by.aomap,by.lightmap,by.emissivemap,by.fog,by.lights,{emissive:{value:new iv(0)}}]),vertexShader:yy.meshlambert_vert,fragmentShader:yy.meshlambert_frag},phong:{uniforms:ny([by.common,by.specularmap,by.envmap,by.aomap,by.lightmap,by.emissivemap,by.bumpmap,by.normalmap,by.displacementmap,by.fog,by.lights,{emissive:{value:new iv(0)},specular:{value:new iv(1118481)},shininess:{value:30}}]),vertexShader:yy.meshphong_vert,fragmentShader:yy.meshphong_frag},standard:{uniforms:ny([by.common,by.envmap,by.aomap,by.lightmap,by.emissivemap,by.bumpmap,by.normalmap,by.displacementmap,by.roughnessmap,by.metalnessmap,by.fog,by.lights,{emissive:{value:new iv(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yy.meshphysical_vert,fragmentShader:yy.meshphysical_frag},toon:{uniforms:ny([by.common,by.aomap,by.lightmap,by.emissivemap,by.bumpmap,by.normalmap,by.displacementmap,by.gradientmap,by.fog,by.lights,{emissive:{value:new iv(0)}}]),vertexShader:yy.meshtoon_vert,fragmentShader:yy.meshtoon_frag},matcap:{uniforms:ny([by.common,by.bumpmap,by.normalmap,by.displacementmap,by.fog,{matcap:{value:null}}]),vertexShader:yy.meshmatcap_vert,fragmentShader:yy.meshmatcap_frag},points:{uniforms:ny([by.points,by.fog]),vertexShader:yy.points_vert,fragmentShader:yy.points_frag},dashed:{uniforms:ny([by.common,by.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yy.linedashed_vert,fragmentShader:yy.linedashed_frag},depth:{uniforms:ny([by.common,by.displacementmap]),vertexShader:yy.depth_vert,fragmentShader:yy.depth_frag},normal:{uniforms:ny([by.common,by.bumpmap,by.normalmap,by.displacementmap,{opacity:{value:1}}]),vertexShader:yy.normal_vert,fragmentShader:yy.normal_frag},sprite:{uniforms:ny([by.sprite,by.fog]),vertexShader:yy.sprite_vert,fragmentShader:yy.sprite_frag},background:{uniforms:{uvTransform:{value:new Am},t2D:{value:null}},vertexShader:yy.background_vert,fragmentShader:yy.background_frag},cube:{uniforms:ny([by.envmap,{opacity:{value:1}}]),vertexShader:yy.cube_vert,fragmentShader:yy.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yy.equirect_vert,fragmentShader:yy.equirect_frag},distanceRGBA:{uniforms:ny([by.common,by.displacementmap,{referencePosition:{value:new Bm},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yy.distanceRGBA_vert,fragmentShader:yy.distanceRGBA_frag},shadow:{uniforms:ny([by.lights,by.fog,{color:{value:new iv(0)},opacity:{value:1}}]),vertexShader:yy.shadow_vert,fragmentShader:yy.shadow_frag}};function _y(e,t,n,r,i){const o=new iv(0);let s,a,c=0,l=null,u=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),c=t,d(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,d(o,c)},render:function(n,i,p,f){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,c):m&&m.isColor&&(d(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||306===m.mapping)?(void 0===a&&(a=new $v(new ey(1,1,1),new iy({name:"BackgroundCubeMaterial",uniforms:ty(xy.cube.uniforms),vertexShader:xy.cube.vertexShader,fragmentShader:xy.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,l===m&&u===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,l=m,u=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new $v(new vy(2,2),new iy({name:"BackgroundMaterial",uniforms:ty(xy.background.uniforms),vertexShader:xy.background.vertexShader,fragmentShader:xy.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&u===m.version&&h===e.toneMapping||(s.material.needsUpdate=!0,l=m,u=m.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function wy(e,t,n,r){const i=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},c=d(null);let l=c;function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){const e=l.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,i){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function g(){const t=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,i,o,s,a){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,s,a):e.vertexAttribIPointer(t,n,i,s,a)}function y(){b(),l!==c&&(l=c,u(l.object))}function b(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,h,y,b){let x=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let c=a[t.id];void 0===c&&(c={},a[t.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let u=l[s];return void 0===u&&(u=d(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),l[s]=u),u}(y,h,c);l!==t&&(l=t,u(l.object)),x=function(e,t){const n=l.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return l.attributesNum!==i||l.index!==t}(y,b),x&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}l.attributes=n,l.attributesNum=i,l.index=t}(y,b)}else{const e=!0===c.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===e||(l.geometry=y.id,l.program=h.id,l.wireframe=e,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==b&&n.update(b,34963),x&&(function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const c=a.attributes,l=s.getAttributes(),u=o.defaultAttributeValues;for(const t in l){const r=l[t];if(r>=0){const o=c[t];if(void 0!==o){const t=o.normalized,i=o.itemSize,s=n.get(o);if(void 0===s)continue;const c=s.buffer,l=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),e.bindBuffer(34962,c),v(r,i,l,t,s*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(r),e.bindBuffer(34962,c),v(r,i,l,t,0,0)}else if("instanceMatrix"===t){const t=n.get(i.instanceMatrix);if(void 0===t)continue;const o=t.buffer,s=t.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r+0,4,s,!1,64,0),e.vertexAttribPointer(r+1,4,s,!1,64,16),e.vertexAttribPointer(r+2,4,s,!1,64,32),e.vertexAttribPointer(r+3,4,s,!1,64,48)}else if("instanceColor"===t){const t=n.get(i.instanceColor);if(void 0===t)continue;const o=t.buffer,s=t.type;m(r,1),e.bindBuffer(34962,o),e.vertexAttribPointer(r,3,s,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r,n);break;case 3:e.vertexAttrib3fv(r,n);break;case 4:e.vertexAttrib4fv(r,n);break;default:e.vertexAttrib1fv(r,n)}}}}g()}(i,c,h,y),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function My(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let c,l;if(i)c=e,l="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](o,r,s,a),n.update(s,o,a)}}function Ty(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function Sy(e){const t=this;let n=null,r=0,i=!1,o=!1;const s=new zg,a=new Am,c={value:null,needsUpdate:!1};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const o=null!==e?e.length:0;let l=null;if(0!==o){if(l=c.value,!0!==i||null===l){const t=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===l||l.length<t)&&(l=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(l,n),l[n+3]=s.constant}c.value=l,c.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const s=0!==e.length||t||0!==r||i;return i=t,n=u(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,l()},this.setState=function(t,s,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!i||null===h||0===h.length||o&&!p)o?u(null):l();else{const e=o?0:r,t=4*e;let i=f.clippingState||null;c.value=i,i=u(h,s,t,a);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Ey(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(303===o||304===o){if(t.has(i))return n(t.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const s=e.getRenderList(),a=e.getRenderTarget(),c=new uy(o.height/2);return c.fromEquirectangularTexture(e,i),t.set(i,c),e.setRenderTarget(a),e.setRenderList(s),i.addEventListener("dispose",r),n(c.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}function Ay(e){const t={};return{has:function(n){if(void 0!==t[n])return null!==t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,null!==r},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]}}}function Ry(e,t,n,r){const i=new WeakMap,o=new WeakMap;function s(e){const a=e.target,c=i.get(a);null!==c.index&&t.remove(c.index);for(const e in c.attributes)t.remove(c.attributes[e]);a.removeEventListener("dispose",s),i.delete(a);const l=o.get(c);l&&(t.remove(l),o.delete(c)),r.releaseStatesOfGeometry(c),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const a=new(Mv(n)>65535?yv:gv)(n,1);a.version=s;const c=o.get(e);c&&t.remove(c),o.set(e,a)}return{get:function(e,t){let r=i.get(t);return r||(t.addEventListener("dispose",s),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Nv).setFromObject(e)),r=t._bufferGeometry),i.set(t,r),n.memory.geometries++,r)},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const r=e.morphAttributes;for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Ly(e,t,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,s,t*a),n.update(r,o,1)},this.renderInstances=function(r,c,l){if(0===l)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,c,s,r*a,l),n.update(c,o,l)}}function Cy(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Py(e,t){return e[0]-t[0]}function Oy(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ny(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];return{update:function(i,o,s,a){const c=i.morphTargetInfluences,l=void 0===c?0:c.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<l;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<l;e++){const t=u[e];t[0]=e,t[1]=c[e]}u.sort(Oy);for(let e=0;e<8;e++)e<l&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(Py);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],s=t[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+e)!==h[i]&&o.setAttribute("morphTarget"+e,h[i]),d&&o.getAttribute("morphNormal"+e)!==d[i]&&o.setAttribute("morphNormal"+e,d[i]),n[e]=s,p+=s):(h&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),d&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",f),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Iy(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const s=r.render.frame,a=e.geometry,c=t.get(e,a);return i.get(c)!==s&&(a.isGeometry&&c.updateFromObject(e),t.update(c),i.set(c,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),c},dispose:function(){i=new WeakMap}}}function Dy(e=null,t=1,n=1,r=1){Pm.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=Jf,this.minFilter=Jf,this.wrapR=Yf,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function ky(e=null,t=1,n=1,r=1){Pm.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=Jf,this.minFilter=Jf,this.wrapR=Yf,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}xy.physical={uniforms:ny([xy.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Em(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new iv(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:yy.meshphysical_vert,fragmentShader:yy.meshphysical_frag},Dy.prototype=Object.create(Pm.prototype),Dy.prototype.constructor=Dy,Dy.prototype.isDataTexture2DArray=!0,ky.prototype=Object.create(Pm.prototype),ky.prototype.constructor=ky,ky.prototype.isDataTexture3D=!0;const By=new Pm,Uy=new Dy,Fy=new ky,zy=new ly,Hy=[],Gy=[],jy=new Float32Array(16),Vy=new Float32Array(9),Wy=new Float32Array(4);function qy(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=Hy[i];if(void 0===o&&(o=new Float32Array(i),Hy[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function Xy(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Yy(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Zy(e,t){let n=Gy[t];void 0===n&&(n=new Int32Array(t),Gy[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Jy(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function $y(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Xy(n,t))return;e.uniform2fv(this.addr,t),Yy(n,t)}}function Ky(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Xy(n,t))return;e.uniform3fv(this.addr,t),Yy(n,t)}}function Qy(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Xy(n,t))return;e.uniform4fv(this.addr,t),Yy(n,t)}}function eb(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Xy(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Yy(n,t)}else{if(Xy(n,r))return;Wy.set(r),e.uniformMatrix2fv(this.addr,!1,Wy),Yy(n,r)}}function tb(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Xy(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Yy(n,t)}else{if(Xy(n,r))return;Vy.set(r),e.uniformMatrix3fv(this.addr,!1,Vy),Yy(n,r)}}function nb(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Xy(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Yy(n,t)}else{if(Xy(n,r))return;jy.set(r),e.uniformMatrix4fv(this.addr,!1,jy),Yy(n,r)}}function rb(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||By,i)}function ib(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Uy,i)}function ob(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Fy,i)}function sb(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||zy,i)}function ab(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function cb(e,t){const n=this.cache;Xy(n,t)||(e.uniform2iv(this.addr,t),Yy(n,t))}function lb(e,t){const n=this.cache;Xy(n,t)||(e.uniform3iv(this.addr,t),Yy(n,t))}function ub(e,t){const n=this.cache;Xy(n,t)||(e.uniform4iv(this.addr,t),Yy(n,t))}function hb(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function db(e,t){e.uniform1fv(this.addr,t)}function pb(e,t){e.uniform1iv(this.addr,t)}function fb(e,t){e.uniform2iv(this.addr,t)}function mb(e,t){e.uniform3iv(this.addr,t)}function gb(e,t){e.uniform4iv(this.addr,t)}function vb(e,t){const n=qy(t,this.size,2);e.uniform2fv(this.addr,n)}function yb(e,t){const n=qy(t,this.size,3);e.uniform3fv(this.addr,n)}function bb(e,t){const n=qy(t,this.size,4);e.uniform4fv(this.addr,n)}function xb(e,t){const n=qy(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function _b(e,t){const n=qy(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function wb(e,t){const n=qy(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Mb(e,t,n){const r=t.length,i=Zy(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||By,i[e])}function Tb(e,t,n){const r=t.length,i=Zy(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||zy,i[e])}function Sb(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Jy;case 35664:return $y;case 35665:return Ky;case 35666:return Qy;case 35674:return eb;case 35675:return tb;case 35676:return nb;case 5124:case 35670:return ab;case 35667:case 35671:return cb;case 35668:case 35672:return lb;case 35669:case 35673:return ub;case 5125:return hb;case 35678:case 36198:case 36298:case 36306:case 35682:return rb;case 35679:case 36299:case 36307:return ob;case 35680:case 36300:case 36308:case 36293:return sb;case 36289:case 36303:case 36311:case 36292:return ib}}(t.type)}function Eb(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return db;case 35664:return vb;case 35665:return yb;case 35666:return bb;case 35674:return xb;case 35675:return _b;case 35676:return wb;case 5124:case 35670:return pb;case 35667:case 35671:return fb;case 35668:case 35672:return mb;case 35669:case 35673:return gb;case 35678:case 36198:case 36298:case 36306:case 35682:return Mb;case 35680:case 36300:case 36308:case 36293:return Tb}}(t.type)}function Ab(e){this.id=e,this.seq=[],this.map={}}Eb.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Yy(t,e)},Ab.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const Rb=/(\w+)(\])?(\[|\.)?/g;function Lb(e,t){e.seq.push(t),e.map[t.id]=t}function Cb(e,t,n){const r=e.name,i=r.length;for(Rb.lastIndex=0;;){const o=Rb.exec(r),s=Rb.lastIndex;let a=o[1];const c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===i){Lb(n,void 0===l?new Sb(a,e,t):new Eb(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new Ab(a),Lb(n,e)),n=e}}}function Pb(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Cb(n,e.getUniformLocation(t,n.name),this)}}function Ob(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Pb.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Pb.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},Pb.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},Pb.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let Nb=0;function Ib(e){switch(e){case gm:return["Linear","( value )"];case vm:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Db(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function kb(e,t){const n=Ib(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Bb(e,t){const n=Ib(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ub(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Fb(e){return""!==e}function zb(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Hb(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Gb=/^[ \t]*#include +<([\w\d./]+)>/gm;function jb(e){return e.replace(Gb,Vb)}function Vb(e,t){const n=yy[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return jb(n)}const Wb=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,qb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Xb(e){return e.replace(qb,Zb).replace(Wb,Yb)}function Yb(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Zb(0,t,n,r)}function Zb(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Jb(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function $b(e,t,n,r){const i=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=e.gammaFactor>0?e.gammaFactor:1,p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fb).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(o),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(Fb).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(Fb).join("\n"),v.length>0&&(v+="\n")):(g=[Jb(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Fb).join("\n"),v=[p,Jb(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?yy.tonemapping_pars_fragment:"",0!==n.toneMapping?Ub("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",yy.encodings_pars_fragment,n.map?kb("mapTexelToLinear",n.mapEncoding):"",n.matcap?kb("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?kb("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?kb("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?kb("lightMapTexelToLinear",n.lightMapEncoding):"",Bb("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Fb).join("\n")),s=jb(s),s=zb(s,n),s=Hb(s,n),a=jb(a),a=zb(a,n),a=Hb(a,n),s=Xb(s),a=Xb(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===_m?"":"out highp vec4 pc_fragColor;",n.glslVersion===_m?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+v+a,x=Ob(i,35633,y+g+s),_=Ob(i,35632,b);if(i.attachShader(m,x),i.attachShader(m,_),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(m).trim(),t=i.getShaderInfoLog(x).trim(),n=i.getShaderInfoLog(_).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(m,35714)){r=!1;const t=Db(i,x,"vertex"),n=Db(i,_,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let w,M;return i.deleteShader(x),i.deleteShader(_),this.getUniforms=function(){return void 0===w&&(w=new Pb(i,m)),w},this.getAttributes=function(){return void 0===M&&(M=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i).name;n[r]=e.getAttribLocation(t,r)}return n}(i,m)),M},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=Nb++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=_,this}function Kb(e,t,n,r,i,o){const s=[],a=r.isWebGL2,c=r.logarithmicDepthBuffer,l=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=gm,t}return{getParameters:function(i,s,f,g,v){const y=g.fog,b=i.isMeshStandardMaterial?g.environment:null,x=t.get(i.envMap||b),_=p[i.type],w=v.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(l)return 1024;{const e=u,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(v):0;let M,T;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),_){const e=xy[_];M=e.vertexShader,T=e.fragmentShader}else M=i.vertexShader,T=i.fragmentShader;const S=e.getRenderTarget();return{isWebGL2:a,shaderID:_,shaderName:i.type,vertexShader:M,fragmentShader:T,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?m(S.texture):e.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(306===x.mapping||307===x.mapping),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!y,useFog:i.fog,fogExp2:y&&y.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:c,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:l,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=xy[t];n=ry.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=s.length;e<t;e++){const t=s[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new $b(e,n,t,i),s.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Qb(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function ex(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function tx(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function nx(e){const t=[];let n=0;const r=[],i=[],o={id:-1};function s(r,i,s,a,c,l){let u=t[n];const h=e.get(s);return void 0===u?(u={id:r.id,object:r,geometry:i,material:s,program:h.program||o,groupOrder:a,renderOrder:r.renderOrder,z:c,group:l},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=s,u.program=h.program||o,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=c,u.group=l),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,t,n,o,a,c){const l=s(e,t,n,o,a,c);(!0===n.transparent?i:r).push(l)},unshift:function(e,t,n,o,a,c){const l=s(e,t,n,o,a,c);(!0===n.transparent?i:r).unshift(l)},finish:function(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||ex),i.length>1&&i.sort(t||tx)}}}function rx(e){let t=new WeakMap;return{get:function(n,r){const i=t.get(n);let o;return void 0===i?(o=new nx(e),t.set(n,new WeakMap),t.get(n).set(r,o)):(o=i.get(r),void 0===o&&(o=new nx(e),i.set(r,o))),o},dispose:function(){t=new WeakMap}}}function ix(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Bm,color:new iv};break;case"SpotLight":n={position:new Bm,direction:new Bm,color:new iv,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Bm,color:new iv,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Bm,skyColor:new iv,groundColor:new iv};break;case"RectAreaLight":n={color:new iv,position:new Bm,halfWidth:new Bm,halfHeight:new Bm}}return e[t.id]=n,n}}}let ox=0;function sx(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ax(e,t){const n=new ix,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Em};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Em,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new Bm);const o=new Bm,s=new hg,a=new hg;return{setup:function(o){let s=0,a=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;o.sort(sx);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,b=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=v.r*y,a+=v.g*y,c+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=x,i.directionalShadowMatrix[l]=t.shadow.matrix,f++}i.directional[l]=e,l++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=t.shadow.matrix,g++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=t.shadow.matrix,m++}i.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),i.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=by.LTC_FLOAT_1,i.rectAreaLTC2=by.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=by.LTC_HALF_1,i.rectAreaLTC2=by.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=c;const v=i.hash;v.directionalLength===l&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=l,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=l,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,i.version=ox++)},setupView:function(e,t){let n=0,r=0,c=0,l=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),c++}else if(d.isRectAreaLight){const e=i.rectArea[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:i}}function cx(e,t){const n=new ax(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function lx(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new cx(e,t),n.set(r,[]),n.get(r).push(o)):i>=n.get(r).length?(o=new cx(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}function ux(e){av.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function hx(e){av.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Bm,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function dx(e,t,n){let r=new fy;const i=new Em,o=new Em,s=new Nm,a=[],c=[],l={},u={0:1,1:0,2:2},h=new iy({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Em},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new Nv;p.setAttribute("position",new hv(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new $v(p,h),m=this;function g(n,r){const i=t.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,f,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,d,f,null)}function v(e,t,n){const r=e<<0|t<<1|n<<2;let i=a[r];return void 0===i&&(i=new ux({depthPacking:3201,morphTargets:e,skinning:t}),a[r]=i),i}function y(e,t,n){const r=e<<0|t<<1|n<<2;let i=c[r];return void 0===i&&(i=new hx({morphTargets:e,skinning:t}),c[r]=i),i}function b(t,n,r,i,o,s,a){let c=null,h=v,d=t.customDepthMaterial;if(!0===i.isPointLight&&(h=y,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===r.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c=h(e,i,!0===t.isInstancedMesh)}else c=d;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const e=c.uuid,t=r.uuid;let n=l[e];void 0===n&&(n={},l[e]=n);let i=n[t];void 0===i&&(i=c.clone(),n[t]=i),c=i}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=3===a?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!0===i.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(i.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function x(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let c=0,l=t.length;c<l;c++){const l=t[c],u=i[l.materialIndex];if(u&&u.visible){const t=b(n,r,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,l)}}}else if(i.visible){const t=b(n,r,i,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)x(c[e],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,a,c){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,u=t.length;l<u;l++){const u=t[l],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),o.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(o.x=Math.floor(n/p.x),i.x=o.x*p.x,h.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/p.y),i.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const e={minFilter:Qf,magFilter:Qf,format:am};h.map=new Im(i.x,i.y,e),h.map.texture.name=u.name+".shadowMap",h.mapPass=new Im(i.x,i.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:Jf,magFilter:Jf,format:am};h.map=new Im(i.x,i.y,e),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const f=h.getViewportCount();for(let e=0;e<f;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),h.updateMatrices(u,e),r=h.getFrustum(),x(a,c,h.camera,u,this.type)}h.isPointLightShadow||3!==this.type||g(h,c),h.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(l,u,h)}}function px(e,t,n){const r=n.isWebGL2,i=new function(){let t=!1;const n=new Nm;let r=null;const i=new Nm(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?N(2929):I(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(e){t||(e?N(2960):I(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&c===r||(e.stencilOp(t,n,r),s=t,a=n,c=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null}}};let a={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null;const M=e.getParameter(35661);let T=!1,S=0;const E=e.getParameter(7938);-1!==E.indexOf("WebGL")?(S=parseFloat(/^WebGL (\d)/.exec(E)[1]),T=S>=1):-1!==E.indexOf("OpenGL ES")&&(S=parseFloat(/^OpenGL ES (\d)/.exec(E)[1]),T=S>=2);let A=null,R={};const L=new Nm,C=new Nm;function P(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,i);return o}const O={};function N(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function I(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}O[3553]=P(3553,3553,1),O[34067]=P(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),N(2929),o.setFunc(3),U(!1),F(1),N(2884),B(0);const D={[qf]:32774,101:32778,102:32779};if(r)D[103]=32775,D[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(D[103]=e.MIN_EXT,D[104]=e.MAX_EXT)}const k={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function B(t,n,r,i,o,s,a,c){if(0!==t){if(l||(N(3042),l=!0),5===t)o=o||n,s=s||r,a=a||i,n===h&&o===f||(e.blendEquationSeparate(D[n],D[o]),h=n,f=o),r===d&&i===p&&s===m&&a===g||(e.blendFuncSeparate(k[r],k[i],k[s],k[a]),d=r,p=i,m=s,g=a),u=t,v=null;else if(t!==u||c!==v){if(h===qf&&f===qf||(e.blendEquation(32774),h=qf,f=qf),c)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}d=null,p=null,m=null,g=null,u=t,v=c}}else l&&(I(3042),l=!1)}function U(t){y!==t&&(t?e.frontFace(2304):e.frontFace(2305),y=t)}function F(t){0!==t?(N(2884),t!==b&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):I(2884),b=t}function z(t,n,r){t?(N(32823),_===n&&w===r||(e.polygonOffset(n,r),_=n,w=r)):I(32823)}function H(t){void 0===t&&(t=33984+M-1),A!==t&&(e.activeTexture(t),A=t)}return{buffers:{color:i,depth:o,stencil:s},enable:N,disable:I,useProgram:function(t){return c!==t&&(e.useProgram(t),c=t,!0)},setBlending:B,setMaterial:function(e,t){2===e.side?I(2884):N(2884);let n=1===e.side;t&&(n=!n),U(n),1===e.blending&&!1===e.transparent?B(0):B(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);const r=e.stencilWrite;s.setTest(r),r&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:U,setCullFace:F,setLineWidth:function(t){t!==x&&(T&&e.lineWidth(t),x=t)},setPolygonOffset:z,setScissorTest:function(e){e?N(3089):I(3089)},activeTexture:H,bindTexture:function(t,n){null===A&&H();let r=R[A];void 0===r&&(r={type:void 0,texture:void 0},R[A]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||O[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=R[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===L.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),L.copy(t))},viewport:function(t){!1===C.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),C.copy(t))},reset:function(){a={},A=null,R={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null,i.reset(),o.reset(),s.reset()}}}function fx(e,t,n,r,i,o,s){const a=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Sm.floorPowerOfTwo:Math.floor,o=r(i*e.width),s=r(i*e.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;return a.width=o,a.height=s,a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Sm.isPowerOfTwo(e.width)&&Sm.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==Jf&&e.minFilter!==Qf}function b(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function x(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function _(e){return e===Jf||e===$f||e===Kf?9728:9729}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=r.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),r.remove(t))}(n),n.isVideoTexture&&d.delete(n),s.memory.textures--}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=r.get(t),i=r.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}}(n),s.memory.textures--}let T=0;function S(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=s.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void P(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function E(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;C(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),c=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=s||c?c?r.image[e].image:r.image[e]:g(r.image[e],!1,!0,l);const h=u[0],d=v(h)||a,p=o.convert(r.format),f=o.convert(r.type),m=x(r.internalFormat,p,f);let _;if(L(34067,r,d),s){for(let e=0;e<6;e++){_=u[e].mipmaps;for(let t=0;t<_.length;t++){const i=_[t];r.format!==am&&r.format!==sm?null!==p?n.compressedTexImage2D(34069+e,t,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,i.width,i.height,0,p,f,i.data)}}t.__maxMipLevel=_.length-1}else{_=r.mipmaps;for(let e=0;e<6;e++)if(c){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<_.length;t++){const r=_[t].image[e].image;n.texImage2D(34069+e,t+1,m,r.width,r.height,0,p,f,r.data)}}else{n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<_.length;t++){const r=_[t];n.texImage2D(34069+e,t+1,m,p,f,r.image[e])}}t.__maxMipLevel=_.length}y(r,d)&&b(34067,r,h.width,h.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(s,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,s.__webglTexture))}const A={[Xf]:10497,[Yf]:33071,[Zf]:33648},R={[Jf]:9728,[$f]:9984,[Kf]:9986,[Qf]:9729,1007:9985,[em]:9987};function L(n,o,s){s?(e.texParameteri(n,10242,A[o.wrapS]),e.texParameteri(n,10243,A[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[o.wrapR]),e.texParameteri(n,10240,R[o.magFilter]),e.texParameteri(n,10241,R[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===Yf&&o.wrapT===Yf||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,_(o.magFilter)),e.texParameteri(n,10241,_(o.minFilter)),o.minFilter!==Jf&&o.minFilter!==Qf&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const c=t.get("EXT_texture_filter_anisotropic");if(c){if(o.type===rm&&null===t.get("OES_texture_float_linear"))return;if(o.type===im&&null===(a||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),s.memory.textures++)}function P(t,r,i){let s=3553;r.isDataTexture2DArray&&(s=35866),r.isDataTexture3D&&(s=32879),C(t,r),n.activeTexture(33984+i),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);const c=function(e){return!a&&(e.wrapS!==Yf||e.wrapT!==Yf||e.minFilter!==Jf&&e.minFilter!==Qf)}(r)&&!1===v(r.image),l=g(r.image,c,!1,u),h=v(l)||a,d=o.convert(r.format);let p,f=o.convert(r.type),m=x(r.internalFormat,d,f);L(s,r,h);const _=r.mipmaps;if(r.isDepthTexture)m=6402,a?m=r.type===rm?36012:r.type===nm?33190:r.type===om?35056:33189:r.type===rm&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===cm&&6402===m&&r.type!==tm&&r.type!==nm&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=tm,f=o.convert(r.type)),r.format===lm&&6402===m&&(m=34041,r.type!==om&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=om,f=o.convert(r.type))),n.texImage2D(3553,0,m,l.width,l.height,0,d,f,null);else if(r.isDataTexture)if(_.length>0&&h){for(let e=0,t=_.length;e<t;e++)p=_[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,l.width,l.height,0,d,f,l.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=_.length;e<t;e++)p=_[e],r.format!==am&&r.format!==sm?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=_.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,l.width,l.height,l.depth,0,d,f,l.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,l.width,l.height,l.depth,0,d,f,l.data),t.__maxMipLevel=0;else if(_.length>0&&h){for(let e=0,t=_.length;e<t;e++)p=_[e],n.texImage2D(3553,e,m,d,f,p);r.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,d,f,l),t.__maxMipLevel=0;y(r,h)&&b(s,r,l.width,l.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(t,i,s,a){const c=o.convert(i.texture.format),l=o.convert(i.texture.type),u=x(i.texture.internalFormat,c,l);n.texImage2D(a,0,u,i.width,i.height,0,c,l,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,a,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function N(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===rm?i=36012:t.type===nm&&(i=33190));const r=I(n);e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=I(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=o.convert(n.texture.format),i=o.convert(n.texture.type),s=x(n.texture.internalFormat,t,i);if(r){const t=I(n);e.renderbufferStorageMultisample(36161,t,s,n.width,n.height)}else e.renderbufferStorage(36161,s,n.width,n.height)}e.bindRenderbuffer(36161,null)}function I(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let D=!1,k=!1;this.allocateTextureUnit=function(){const e=T;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?P(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?P(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const i=r.get(t),c=r.get(t.texture);t.addEventListener("dispose",M),c.__webglTexture=e.createTexture(),s.memory.textures++;const l=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,h=v(t)||a;if(!a||t.texture.format!==sm||t.texture.type!==rm&&t.texture.type!==im||(t.texture.format=am,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){i.__webglFramebuffer=[];for(let t=0;t<6;t++)i.__webglFramebuffer[t]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);const n=o.convert(t.texture.format),r=o.convert(t.texture.type),s=x(t.texture.internalFormat,n,r),a=I(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),N(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,c.__webglTexture),L(34067,t.texture,h);for(let e=0;e<6;e++)O(i.__webglFramebuffer[e],t,36064,34069+e);y(t.texture,h)&&b(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),L(3553,t.texture,h),O(i.__webglFramebuffer,t,36064,3553),y(t.texture,h)&&b(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&function(t){const n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===cm)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==lm)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)e.bindFramebuffer(36160,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=e.createRenderbuffer(),N(n.__webglDepthbuffer[r],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),N(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(y(t,v(e)||a)){const i=e.isWebGLCubeRenderTarget?34067:3553,o=r.get(t).__webglTexture;n.bindTexture(i,o),b(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);const i=t.width,o=t.height;let s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,s,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),E(e,t)}}function mx(e,t,n){const r=n.isWebGL2;return{convert:function(e){let n;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===tm)return 5123;if(1013===e)return 5124;if(e===nm)return 5125;if(e===rm)return 5126;if(e===im)return r?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===e)return 6406;if(e===sm)return 6407;if(e===am)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===cm)return 6402;if(e===lm)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):36492===e?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===om?r?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function gx(e=[]){sy.call(this),this.cameras=e}function vx(){kg.call(this),this.type="Group"}function yx(){this._targetRay=null,this._grip=null,this._hand=null}function bx(e,t){const n=this;let r=null,i=1,o=null,s="local-floor",a=null;const c=[],l=new Map,u=new sy;u.layers.enable(1),u.viewport=new Nm;const h=new sy;h.layers.enable(2),h.viewport=new Nm;const d=[u,h],p=new gx;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(e){const t=l.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function v(){l.forEach((function(e,t){e.disconnect(t)})),l.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),T.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(e){o=e,T.setContext(r),T.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function b(e){const t=r.inputSources;for(let e=0;e<c.length;e++)l.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=l.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),l.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=l.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new yx,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new yx,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new yx,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=function(e){if(r=e,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",v);const e=t.getContextAttributes();!0!==e.xrCompatible&&t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:i},o=new XRWebGLLayer(r,t,n);r.updateRenderState({baseLayer:o}),r.requestReferenceSpace(s).then(y),r.addEventListener("inputsourceschange",b)}};const x=new Bm,_=new Bm;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=h.near=u.near=e.near,p.far=h.far=u.far=e.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const t=e.parent,n=p.cameras;w(p,t);for(let e=0;e<n.length;e++)w(n[e],t);e.matrixWorld.copy(p.matrixWorld);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){x.setFromMatrixPosition(t.matrixWorld),_.setFromMatrixPosition(n.matrixWorld);const r=x.distanceTo(_),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=a+f,y=d-m,b=p+(r-m),w=c*a/v*g,M=l*a/v*g;e.projectionMatrix.makePerspective(y,b,w,M,g,v)}(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let M=null;const T=new my;T.setAnimationLoop((function(t,n){if(a=n.getViewerPose(o),null!==a){const t=a.views,n=r.renderState.baseLayer;e.setFramebuffer(n.framebuffer);let i=!1;t.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let e=0;e<t.length;e++){const r=t[e],o=n.getViewport(r),s=d[e];s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===e&&p.matrix.copy(s.matrix),!0===i&&p.cameras.push(s)}}const i=r.inputSources;for(let e=0;e<c.length;e++){const t=c[e],r=i[e];t.update(r,n,o)}M&&M(t,n)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}function xx(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,r):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function _x(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=gm,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,v=0,y=0,b=null,x=null,_=-1,w=null;const M=new Nm,T=new Nm;let S=null,E=t.width,A=t.height,R=1,L=null,C=null;const P=new Nm(0,0,E,A),O=new Nm(0,0,E,A);let N=!1;const I=new fy;let D=!1,k=!1;const B=new hg,U=new Bm,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===b?R:1}let H,G,j,V,W,q,X,Y,Z,J,$,K,Q,ee,te,ne,re,ie,oe,se,ae,ce=n;function le(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",fe,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&t.shift(),ce=le(t,e),null===ce)throw le(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ue(){H=new Ay(ce),G=new Ty(ce,H,e),!1===G.isWebGL2&&(H.get("WEBGL_depth_texture"),H.get("OES_texture_float"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),H.get("OES_element_index_uint"),H.get("OES_vertex_array_object"),H.get("ANGLE_instanced_arrays")),H.get("OES_texture_float_linear"),se=new mx(ce,H,G),j=new px(ce,H,G),j.scissor(T.copy(O).multiplyScalar(R).floor()),j.viewport(M.copy(P).multiplyScalar(R).floor()),V=new Cy(ce),W=new Qb,q=new fx(ce,H,j,W,G,se,V),X=new Ey(f),Y=new gy(ce,G),ae=new wy(ce,H,Y,G),Z=new Ry(ce,Y,V,ae),J=new Iy(ce,Z,Y,V),re=new Ny(ce),te=new Sy(W),$=new Kb(f,X,H,G,ae,te),K=new xx(W),Q=new rx(W),ee=new lx(H,G),ne=new _y(f,X,j,J,a),ie=new My(ce,H,V,G),oe=new Ly(ce,H,V,G),V.programs=$.programs,f.capabilities=G,f.extensions=H,f.properties=W,f.renderLists=Q,f.state=j,f.info=V}ue();const he=new bx(f,ce);this.xr=he;const de=new dx(f,J,G.maxTextureSize);function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function fe(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,ue()}function me(e){const t=e.target;t.removeEventListener("dispose",me),function(e){ge(e),W.remove(e)}(t)}function ge(e){const t=W.get(e).program;void 0!==t&&$.releaseProgram(t)}this.shadowMap=de,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=H.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=H.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(E,A,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Em),e.set(E,A)},this.setSize=function(e,n,r){he.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=e,A=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Em),e.set(E*R,A*R).floor()},this.setDrawingBufferSize=function(e,n,r){E=e,A=n,R=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Nm),e.copy(M)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),j.viewport(M.copy(P).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),j.scissor(T.copy(O).multiplyScalar(R).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){j.setScissorTest(N=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new iv),e.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),ce.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pe,!1),t.removeEventListener("webglcontextrestored",fe,!1),Q.dispose(),ee.dispose(),W.dispose(),X.dispose(),J.dispose(),ae.dispose(),he.dispose(),ye.stop()},this.renderBufferImmediate=function(e,t){ae.initAttributes();const n=W.get(e);e.hasPositions&&!n.position&&(n.position=ce.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ce.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ce.createBuffer()),e.hasColors&&!n.color&&(n.color=ce.createBuffer());const r=t.getAttributes();e.hasPositions&&(ce.bindBuffer(34962,n.position),ce.bufferData(34962,e.positionArray,35048),ae.enableAttribute(r.position),ce.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(ce.bindBuffer(34962,n.normal),ce.bufferData(34962,e.normalArray,35048),ae.enableAttribute(r.normal),ce.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(ce.bindBuffer(34962,n.uv),ce.bufferData(34962,e.uvArray,35048),ae.enableAttribute(r.uv),ce.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(ce.bindBuffer(34962,n.color),ce.bufferData(34962,e.colorArray,35048),ae.enableAttribute(r.color),ce.vertexAttribPointer(r.color,3,5126,!1,0,0)),ae.disableUnusedAttributes(),ce.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=F);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=Me(e,t,r,i);j.setMaterial(r,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,h=1;!0===r.wireframe&&(c=Z.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&re.update(i,n,r,a),ae.setup(i,r,a,n,c);let d=ie;null!==c&&(u=Y.get(c),d=oe,d.setIndex(u));const p=null!==c?c.count:l.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(p,f+m,g+v)-1,x=Math.max(0,b-y+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*z()),d.setMode(1)):d.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),j.setLineWidth(e*z()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(y,x,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,e)}else d.render(y,x)}},this.compile=function(e,t){d=ee.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights();const n=new WeakMap;e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];!1===n.has(o)&&(we(o,e,t),n.set(o))}else!1===n.has(r)&&(we(r,e,t),n.set(r))}))};let ve=null;const ye=new my;function be(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=J.update(e),i=e.material;i.visible&&h.push(e,t,i,n,U.z,null)}}else if(e.isImmediateRenderObject)r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B),h.push(e,null,e.material,n,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==V.render.frame&&(e.skeleton.update(),e.skeleton.frame=V.render.frame),!e.frustumCulled||I.intersectsObject(e))){r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=J.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&h.push(e,t,a,n,U.z,s)}}else i.visible&&h.push(e,t,i,n,U.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)be(i[e],t,n,r)}function xe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,c=null===r?o.material:r,l=o.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,r=e.length;n<r;n++){const r=e[n];s.layers.test(r.layers)&&(j.viewport(M.copy(r.viewport)),d.setupLightsView(r),_e(s,t,r,a,c,l))}}else _e(s,t,n,a,c,l)}}function _e(e,t,n,r,i,o){if(e.onBeforeRender(f,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=Me(n,t,i,e);j.setMaterial(i),ae.reset(),function(e,t){e.render((function(e){f.renderBufferImmediate(e,t)}))}(e,r)}else f.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(f,t,n,r,i,o)}function we(e,t,n){!0!==t.isScene&&(t=F);const r=W.get(e),i=d.state.lights,o=d.state.shadowsArray,s=i.state.version,a=$.getParameters(e,i.state,o,t,n),c=$.getProgramCacheKey(a);let l=r.program,u=!0;if(void 0===l)e.addEventListener("dispose",me);else if(l.cacheKey!==c)ge(e);else if(r.lightsStateVersion!==s)u=!1;else{if(void 0!==a.shaderID){const n=e.isMeshStandardMaterial?t.environment:null;return void(r.envMap=X.get(e.envMap||n))}u=!1}u&&(a.uniforms=$.getUniforms(e),e.onBeforeCompile(a,f),l=$.acquireProgram(a,c),r.program=l,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,h.clippingPlanes=te.uniform),r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=X.get(e.envMap||r.environment),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=r.program.getUniforms(),m=Pb.seqWithValue(p.seq,h);r.uniformsList=m}function Me(e,t,n,r){!0!==t.isScene&&(t=F),q.resetTextureUnits();const i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===b?f.outputEncoding:b.texture.encoding,a=X.get(n.envMap||o),c=W.get(n),l=d.state.lights;if(!0===D&&(!0===k||e!==w)){const t=e===w&&n.id===_;te.setState(n,e,t)}n.version===c.__version?n.fog&&c.fog!==i||c.environment!==o||c.needsLights&&c.lightsStateVersion!==l.state.version?we(n,t,r):void 0===c.numClippingPlanes||c.numClippingPlanes===te.numPlanes&&c.numIntersection===te.numIntersection?(c.outputEncoding!==s||c.envMap!==a)&&we(n,t,r):we(n,t,r):(we(n,t,r),c.__version=n.version);let u=!1,h=!1,p=!1;const m=c.program,g=m.getUniforms(),v=c.uniforms;if(j.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==_&&(_=n.id,h=!0),u||w!==e){if(g.setValue(ce,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&g.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=g.map.cameraPosition;void 0!==t&&t.setValue(ce,U.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){g.setOptional(ce,r,"bindMatrix"),g.setOptional(ce,r,"bindMatrixInverse");const e=r.skeleton;if(e){const t=e.bones;if(G.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);n=Sm.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(e.boneMatrices);const i=new hy(r,n,n,am,rm);e.boneMatrices=r,e.boneTexture=i,e.boneTextureSize=n}g.setValue(ce,"boneTexture",e.boneTexture,q),g.setValue(ce,"boneTextureSize",e.boneTextureSize)}else g.setOptional(ce,e,"boneMatrices")}}var y,x;return(h||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,g.setValue(ce,"receiveShadow",r.receiveShadow)),h&&(g.setValue(ce,"toneMappingExposure",f.toneMappingExposure),c.needsLights&&(x=p,(y=v).ambientLightColor.needsUpdate=x,y.lightProbe.needsUpdate=x,y.directionalLights.needsUpdate=x,y.directionalLightShadows.needsUpdate=x,y.pointLights.needsUpdate=x,y.pointLightShadows.needsUpdate=x,y.spotLights.needsUpdate=x,y.spotLightShadows.needsUpdate=x,y.rectAreaLights.needsUpdate=x,y.hemisphereLights.needsUpdate=x),i&&n.fog&&K.refreshFogUniforms(v,i),K.refreshMaterialUniforms(v,n,R,A),Pb.upload(ce,c.uniformsList,v,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Pb.upload(ce,c.uniformsList,v,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(ce,"center",r.center),g.setValue(ce,"modelViewMatrix",r.modelViewMatrix),g.setValue(ce,"normalMatrix",r.normalMatrix),g.setValue(ce,"modelMatrix",r.matrixWorld),m}ye.setAnimationLoop((function(e){he.isPresenting||ve&&ve(e)})),"undefined"!=typeof window&&ye.setContext(window),this.setAnimationLoop=function(e){ve=e,he.setAnimationLoop(e),null===e?ye.stop():ye.start()},this.render=function(e,t){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;ae.resetDefaultState(),_=-1,w=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===he.enabled&&!0===he.isPresenting&&(t=he.getCamera(t)),!0===e.isScene&&e.onBeforeRender(f,e,t,n||b),d=ee.get(e,p.length),d.init(),p.push(d),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(B),k=this.localClippingEnabled,D=te.init(this.clippingPlanes,k,t),h=Q.get(e,t),h.init(),be(e,t,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(L,C),!0===D&&te.beginShadows();const i=d.state.shadowsArray;de.render(i,e,t),d.setupLights(),d.setupLightsView(t),!0===D&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,r);const o=h.opaque,s=h.transparent;o.length>0&&xe(o,e,t),s.length>0&&xe(s,e,t),!0===e.isScene&&e.onAfterRender(f,e,t),null!==b&&(q.updateRenderTargetMipmap(b),q.updateMultisampleRenderTarget(b)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(e){g!==e&&null===b&&ce.bindFramebuffer(36160,e),g=e},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,n=0){b=e,v=t,y=n,e&&void 0===W.get(e).__webglFramebuffer&&q.setupRenderTarget(e);let r=g,i=!1;if(e){const n=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=n[t],i=!0):r=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:n,M.copy(e.viewport),T.copy(e.scissor),S=e.scissorTest}else M.copy(P).multiplyScalar(R).floor(),T.copy(O).multiplyScalar(R).floor(),S=N;if(x!==r&&(ce.bindFramebuffer(36160,r),x=r),j.viewport(M),j.scissor(T),j.setScissorTest(S),i){const r=W.get(e.texture);ce.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==x&&(ce.bindFramebuffer(36160,a),s=!0);try{const a=e.texture,c=a.format,l=a.type;if(c!==am&&se.convert(c)!==ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===l||se.convert(l)===ce.getParameter(35738)||l===rm&&(G.isWebGL2||H.get("OES_texture_float")||H.get("WEBGL_color_buffer_float"))||l===im&&(G.isWebGL2?H.get("EXT_color_buffer_float"):H.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ce.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ce.readPixels(t,n,r,i,se.convert(c),se.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ce.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),s=se.convert(t.format);q.setTexture2D(t,0),ce.copyTexImage2D(3553,n,s,e.x,e.y,i,o,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,s=se.convert(n.format),a=se.convert(n.type);q.setTexture2D(n,0),ce.pixelStorei(37440,n.flipY),ce.pixelStorei(37441,n.premultiplyAlpha),ce.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ce.texSubImage2D(3553,r,e.x,e.y,i,o,s,a,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ce.texSubImage2D(3553,r,e.x,e.y,s,a,t.image),0===r&&n.generateMipmaps&&ce.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(e){q.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){j.reset(),ae.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function wx(e){_x.call(this,e)}ux.prototype=Object.create(av.prototype),ux.prototype.constructor=ux,ux.prototype.isMeshDepthMaterial=!0,ux.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},hx.prototype=Object.create(av.prototype),hx.prototype.constructor=hx,hx.prototype.isMeshDistanceMaterial=!0,hx.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},gx.prototype=Object.assign(Object.create(sy.prototype),{constructor:gx,isArrayCamera:!0}),vx.prototype=Object.assign(Object.create(kg.prototype),{constructor:vx,isGroup:!0}),Object.assign(yx.prototype,{constructor:yx,getHandSpace:function(){if(null===this._hand&&(this._hand=new vx,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){const e=new vx;e.matrixAutoUpdate=!1,e.visible=!1,this._hand.joints.push(e),this._hand.add(e)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new vx,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new vx,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(c&&e.hand){o=!0;for(let r=0;r<=window.XRHand.LITTLE_PHALANX_TIP;r++)if(e.hand[r]){const i=t.getJointPose(e.hand[r],n),o=c.joints[r];null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=i.radius),o.visible=null!==i;const s=c.joints[window.XRHand.INDEX_PHALANX_TIP],a=c.joints[window.XRHand.THUMB_PHALANX_TIP],l=s.position.distanceTo(a.position),u=.02,h=.005;c.inputState.pinching&&l>u+h?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&l<=u-h&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==s&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==o),this}}),Object.assign(bx.prototype,wm.prototype),wx.prototype=Object.assign(Object.create(_x.prototype),{constructor:wx,isWebGL1Renderer:!0});class Mx extends kg{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}function Tx(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=bm,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Sm.generateUUID()}Object.defineProperty(Tx.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Tx.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Sm.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new Tx(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Sm.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Sx=new Bm;function Ex(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function Ax(e){av.call(this),this.type="SpriteMaterial",this.color=new iv(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let Rx;Object.defineProperties(Ex.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(Ex.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,n=this.data.count;t<n;t++)Sx.x=this.getX(t),Sx.y=this.getY(t),Sx.z=this.getZ(t),Sx.applyMatrix4(e),this.setXYZ(t,Sx.x,Sx.y,Sx.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new hv(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ex(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Ax.prototype=Object.create(av.prototype),Ax.prototype.constructor=Ax,Ax.prototype.isSpriteMaterial=!0,Ax.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const Lx=new Bm,Cx=new Bm,Px=new Bm,Ox=new Em,Nx=new Em,Ix=new hg,Dx=new Bm,kx=new Bm,Bx=new Bm,Ux=new Em,Fx=new Em,zx=new Em;function Hx(e){if(kg.call(this),this.type="Sprite",void 0===Rx){Rx=new Nv;const e=new Tx(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Rx.setIndex([0,1,2,0,2,3]),Rx.setAttribute("position",new Ex(e,3,0,!1)),Rx.setAttribute("uv",new Ex(e,2,3,!1))}this.geometry=Rx,this.material=void 0!==e?e:new Ax,this.center=new Em(.5,.5)}function Gx(e,t,n,r,i,o){Ox.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Nx.x=o*Ox.x-i*Ox.y,Nx.y=i*Ox.x+o*Ox.y):Nx.copy(Ox),e.copy(t),e.x+=Nx.x,e.y+=Nx.y,e.applyMatrix4(Ix)}Hx.prototype=Object.assign(Object.create(kg.prototype),{constructor:Hx,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Cx.setFromMatrixScale(this.matrixWorld),Ix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Px.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Cx.multiplyScalar(-Px.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Gx(Dx.set(-.5,-.5,0),Px,o,Cx,r,i),Gx(kx.set(.5,-.5,0),Px,o,Cx,r,i),Gx(Bx.set(.5,.5,0),Px,o,Cx,r,i),Ux.set(0,0),Fx.set(1,0),zx.set(1,1);let s=e.ray.intersectTriangle(Dx,kx,Bx,!1,Lx);if(null===s&&(Gx(kx.set(-.5,.5,0),Px,o,Cx,r,i),Fx.set(0,1),s=e.ray.intersectTriangle(Dx,Bx,kx,!1,Lx),null===s))return;const a=e.ray.origin.distanceTo(Lx);a<e.near||a>e.far||t.push({distance:a,point:Lx.clone(),uv:$g.getUV(Lx,Dx,kx,Bx,Ux,Fx,zx,new Em),face:null,object:this})},copy:function(e){return kg.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const jx=new Bm,Vx=new Bm;function Wx(){kg.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Wx.prototype=Object.assign(Object.create(kg.prototype),{constructor:Wx,isLOD:!0,copy:function(e){kg.prototype.copy.call(this,e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){jx.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(jx);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){jx.setFromMatrixPosition(e.matrixWorld),Vx.setFromMatrixPosition(this.matrixWorld);const n=jx.distanceTo(Vx)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){const t=kg.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}});const qx=new Bm,Xx=new Nm,Yx=new Nm,Zx=new Bm,Jx=new hg;function $x(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),$v.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new hg,this.bindMatrixInverse=new hg}function Kx(){kg.call(this),this.type="Bone"}$x.prototype=Object.assign(Object.create($v.prototype),{constructor:$x,isSkinnedMesh:!0,copy:function(e){return $v.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new Nm,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){$v.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const n=this.skeleton,r=this.geometry;Xx.fromBufferAttribute(r.attributes.skinIndex,e),Yx.fromBufferAttribute(r.attributes.skinWeight,e),qx.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=Yx.getComponent(e);if(0!==r){const i=Xx.getComponent(e);Jx.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Zx.copy(qx).applyMatrix4(Jx),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}),Kx.prototype=Object.assign(Object.create(kg.prototype),{constructor:Kx,isBone:!0});const Qx=new hg,e_=new hg;function t_(e=[],t=[]){this.uuid=Sm.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(t_.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new hg)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new hg;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:e_;Qx.multiplyMatrices(i,t[r]),Qx.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new t_(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Kx),this.bones.push(i),this.boneInverses.push((new hg).fromArray(e.boneInverses[n]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}});const n_=new hg,r_=new hg,i_=[],o_=new $v;function s_(e,t,n){$v.call(this,e,t),this.instanceMatrix=new hv(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function a_(e){av.call(this),this.type="LineBasicMaterial",this.color=new iv(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}s_.prototype=Object.assign(Object.create($v.prototype),{constructor:s_,isInstancedMesh:!0,copy:function(e){return $v.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const n=this.matrixWorld,r=this.count;if(o_.geometry=this.geometry,o_.material=this.material,void 0!==o_.material)for(let i=0;i<r;i++){this.getMatrixAt(i,n_),r_.multiplyMatrices(n,n_),o_.matrixWorld=r_,o_.raycast(e,i_);for(let e=0,n=i_.length;e<n;e++){const n=i_[e];n.instanceId=i,n.object=this,t.push(n)}i_.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new hv(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),a_.prototype=Object.create(av.prototype),a_.prototype.constructor=a_,a_.prototype.isLineBasicMaterial=!0,a_.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const c_=new Bm,l_=new Bm,u_=new hg,h_=new ug,d_=new ng;function p_(e=new Nv,t=new a_){kg.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}p_.prototype=Object.assign(Object.create(kg.prototype),{constructor:p_,isLine:!0,copy:function(e){return kg.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)c_.fromBufferAttribute(t,e-1),l_.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=c_.distanceTo(l_);e.setAttribute("lineDistance",new xv(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;n[0]=0;for(let e=1,r=t.length;e<r;e++)n[e]=n[e-1],n[e]+=t[e-1].distanceTo(t[e])}return this},raycast:function(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),d_.copy(n.boundingSphere),d_.applyMatrix4(r),d_.radius+=i,!1===e.ray.intersectsSphere(d_))return;u_.copy(r).invert(),h_.copy(e.ray).applyMatrix4(u_);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new Bm,c=new Bm,l=new Bm,u=new Bm,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,o=n.length-1;r<o;r+=h){const o=n[r],h=n[r+1];if(a.fromBufferAttribute(i,o),c.fromBufferAttribute(i,h),h_.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:l.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){if(a.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),h_.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const r=n.vertices,i=r.length;for(let n=0;n<i-1;n+=h){if(h_.distanceSqToSegment(r[n],r[n+1],u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const f_=new Bm,m_=new Bm;function g_(e,t){p_.call(this,e,t),this.type="LineSegments"}function v_(e,t){p_.call(this,e,t),this.type="LineLoop"}function y_(e){av.call(this),this.type="PointsMaterial",this.color=new iv(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}g_.prototype=Object.assign(Object.create(p_.prototype),{constructor:g_,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)f_.fromBufferAttribute(t,e),m_.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+f_.distanceTo(m_);e.setAttribute("lineDistance",new xv(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;for(let e=0,r=t.length;e<r;e+=2)f_.copy(t[e]),m_.copy(t[e+1]),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+f_.distanceTo(m_)}return this}}),v_.prototype=Object.assign(Object.create(p_.prototype),{constructor:v_,isLineLoop:!0}),y_.prototype=Object.create(av.prototype),y_.prototype.constructor=y_,y_.prototype.isPointsMaterial=!0,y_.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const b_=new hg,x_=new ug,__=new ng,w_=new Bm;function M_(e=new Nv,t=new y_){kg.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function T_(e,t,n,r,i,o,s){const a=x_.distanceSqToPoint(e);if(a<n){const n=new Bm;x_.closestPointToPoint(e,n),n.applyMatrix4(r);const c=i.ray.origin.distanceTo(n);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}function S_(e,t,n,r,i,o,s,a,c){Pm.call(this,e,t,n,r,i,o,s,a,c),this.format=void 0!==s?s:sm,this.minFilter=void 0!==o?o:Qf,this.magFilter=void 0!==i?i:Qf,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){l.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function E_(e,t,n,r,i,o,s,a,c,l,u,h){Pm.call(this,null,o,s,a,c,l,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function A_(e,t,n,r,i,o,s,a,c){Pm.call(this,e,t,n,r,i,o,s,a,c),this.needsUpdate=!0}function R_(e,t,n,r,i,o,s,a,c,l){if((l=void 0!==l?l:cm)!==cm&&l!==lm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===cm&&(n=tm),void 0===n&&l===lm&&(n=om),Pm.call(this,null,r,i,o,s,a,l,n,c),this.image={width:e,height:t},this.magFilter=void 0!==s?s:Jf,this.minFilter=void 0!==a?a:Jf,this.flipY=!1,this.generateMipmaps=!1}M_.prototype=Object.assign(Object.create(kg.prototype),{constructor:M_,isPoints:!0,copy:function(e){return kg.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),__.copy(n.boundingSphere),__.applyMatrix4(r),__.radius+=i,!1===e.ray.intersectsSphere(__))return;b_.copy(r).invert(),x_.copy(e.ray).applyMatrix4(b_);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){const n=i.array;for(let i=0,a=n.length;i<a;i++){const a=n[i];w_.fromBufferAttribute(o,a),T_(w_,a,s,r,e,t,this)}}else for(let n=0,i=o.count;n<i;n++)w_.fromBufferAttribute(o,n),T_(w_,n,s,r,e,t,this)}else{const i=n.vertices;for(let n=0,o=i.length;n<o;n++)T_(i[n],n,s,r,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),S_.prototype=Object.assign(Object.create(Pm.prototype),{constructor:S_,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),E_.prototype=Object.create(Pm.prototype),E_.prototype.constructor=E_,E_.prototype.isCompressedTexture=!0,A_.prototype=Object.create(Pm.prototype),A_.prototype.constructor=A_,A_.prototype.isCanvasTexture=!0,R_.prototype=Object.create(Pm.prototype),R_.prototype.constructor=R_,R_.prototype.isDepthTexture=!0;let L_=0;const C_=new hg,P_=new kg,O_=new Bm;function N_(){Object.defineProperty(this,"id",{value:L_+=2}),this.uuid=Sm.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}N_.prototype=Object.assign(Object.create(wm.prototype),{constructor:N_,isGeometry:!0,applyMatrix4:function(e){const t=(new Am).getNormalMatrix(e);for(let t=0,n=this.vertices.length;t<n;t++)this.vertices[t].applyMatrix4(e);for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];n.normal.applyMatrix3(t).normalize();for(let e=0,r=n.vertexNormals.length;e<r;e++)n.vertexNormals[e].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return C_.makeRotationX(e),this.applyMatrix4(C_),this},rotateY:function(e){return C_.makeRotationY(e),this.applyMatrix4(C_),this},rotateZ:function(e){return C_.makeRotationZ(e),this.applyMatrix4(C_),this},translate:function(e,t,n){return C_.makeTranslation(e,t,n),this.applyMatrix4(C_),this},scale:function(e,t,n){return C_.makeScale(e,t,n),this.applyMatrix4(C_),this},lookAt:function(e){return P_.lookAt(e),P_.updateMatrix(),this.applyMatrix4(P_.matrix),this},fromBufferGeometry:function(e){const t=this,n=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const i=r.position,o=r.normal,s=r.color,a=r.uv,c=r.uv2;void 0!==c&&(this.faceVertexUvs[1]=[]);for(let e=0;e<i.count;e++)t.vertices.push((new Bm).fromBufferAttribute(i,e)),void 0!==s&&t.colors.push((new iv).fromBufferAttribute(s,e));function l(e,n,r,i){const l=void 0===s?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],u=void 0===o?[]:[(new Bm).fromBufferAttribute(o,e),(new Bm).fromBufferAttribute(o,n),(new Bm).fromBufferAttribute(o,r)],h=new ov(e,n,r,u,l,i);t.faces.push(h),void 0!==a&&t.faceVertexUvs[0].push([(new Em).fromBufferAttribute(a,e),(new Em).fromBufferAttribute(a,n),(new Em).fromBufferAttribute(a,r)]),void 0!==c&&t.faceVertexUvs[1].push([(new Em).fromBufferAttribute(c,e),(new Em).fromBufferAttribute(c,n),(new Em).fromBufferAttribute(c,r)])}const u=e.groups;if(u.length>0)for(let e=0;e<u.length;e++){const t=u[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)void 0!==n?l(n.getX(e),n.getX(e+1),n.getX(e+2),t.materialIndex):l(e,e+1,e+2,t.materialIndex)}else if(void 0!==n)for(let e=0;e<n.count;e+=3)l(n.getX(e),n.getX(e+1),n.getX(e+2));else for(let e=0;e<i.count;e+=3)l(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(O_).negate(),this.translate(O_.x,O_.y,O_.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new hg;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){const e=new Bm,t=new Bm;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],i=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,o),t.subVectors(i,o),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e=!0){const t=new Array(this.vertices.length);for(let e=0,n=this.vertices.length;e<n;e++)t[e]=new Bm;if(e){const e=new Bm,n=new Bm;for(let r=0,i=this.faces.length;r<i;r++){const i=this.faces[r],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),n.subVectors(o,s),e.cross(n),t[i.a].add(e),t[i.b].add(e),t[i.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let e=0,n=this.vertices.length;e<n;e++)t[e].normalize();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(t[n.a]),r[1].copy(t[n.b]),r[2].copy(t[n.c])):(r[0]=t[n.a].clone(),r[1]=t[n.b].clone(),r[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=t.vertexNormals;3===n.length?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,n=t.vertexNormals.length;e<n;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}const e=new N_;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,r=this.faces.length;t<r;t++){const t=new Bm,r={a:new Bm,b:new Bm,c:new Bm};e.push(t),n.push(r)}}const n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],r=n.faceNormals[e],i=n.vertexNormals[e];r.copy(t.normal),i.a.copy(t.vertexNormals[0]),i.b.copy(t.vertexNormals[1]),i.c.copy(t.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new zm),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ng),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let r;const i=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,c=e.faces,l=this.colors,u=e.colors;void 0!==t&&(r=(new Am).getNormalMatrix(t));for(let e=0,n=s.length;e<n;e++){const n=s[e].clone();void 0!==t&&n.applyMatrix4(t),o.push(n)}for(let e=0,t=u.length;e<t;e++)l.push(u[e].clone());for(let e=0,t=c.length;e<t;e++){const t=c[e];let o,s;const l=t.vertexNormals,u=t.vertexColors,h=new ov(t.a+i,t.b+i,t.c+i);h.normal.copy(t.normal),void 0!==r&&h.normal.applyMatrix3(r).normalize();for(let e=0,t=l.length;e<t;e++)o=l[e].clone(),void 0!==r&&o.applyMatrix3(r).normalize(),h.vertexNormals.push(o);h.color.copy(t.color);for(let e=0,t=u.length;e<t;e++)s=u[e],h.vertexColors.push(s.clone());h.materialIndex=t.materialIndex+n,a.push(h)}for(let t=0,n=e.faceVertexUvs.length;t<n;t++){const n=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,r=n.length;e<r;e++){const r=n[e],i=[];for(let e=0,t=r.length;e<t;e++)i.push(r[e].clone());this.faceVertexUvs[t].push(i)}}},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(e=4){const t={},n=[],r=[],i=Math.pow(10,e);for(let e=0,o=this.vertices.length;e<o;e++){const o=this.vertices[e],s=Math.round(o.x*i)+"_"+Math.round(o.y*i)+"_"+Math.round(o.z*i);void 0===t[s]?(t[s]=e,n.push(this.vertices[e]),r[e]=n.length-1):r[e]=r[t[s]]}const o=[];for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.a=r[t.a],t.b=r[t.b],t.c=r[t.c];const n=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(n[t]===n[(t+1)%3]){o.push(e);break}}for(let e=o.length-1;e>=0;e--){const t=o[e];this.faces.splice(t,1);for(let e=0,n=this.faceVertexUvs.length;e<n;e++)this.faceVertexUvs[e].splice(t,1)}const s=this.vertices.length-n.length;return this.vertices=n,s},setFromPoints:function(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];this.vertices.push(new Bm(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let i,o;n&&n.length===t&&(i=[]),r&&r.length===t&&(o=[]);for(let s=0;s<t;s++){const t=e[s]._id;i&&i.push(n[t]),o&&o.push(r[t])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const t=[];for(let e=0;e<this.vertices.length;e++){const n=this.vertices[e];t.push(n.x,n.y,n.z)}const n=[],r=[],i={},o=[],s={},a=[],c={};for(let e=0;e<this.faces.length;e++){const t=this.faces[e],r=!0,i=!1,o=void 0!==this.faceVertexUvs[0][e],s=t.normal.length()>0,a=t.vertexNormals.length>0,c=1!==t.color.r||1!==t.color.g||1!==t.color.b,p=t.vertexColors.length>0;let f=0;if(f=l(f,0,0),f=l(f,1,r),f=l(f,2,i),f=l(f,3,o),f=l(f,4,s),f=l(f,5,a),f=l(f,6,c),f=l(f,7,p),n.push(f),n.push(t.a,t.b,t.c),n.push(t.materialIndex),o){const t=this.faceVertexUvs[0][e];n.push(d(t[0]),d(t[1]),d(t[2]))}if(s&&n.push(u(t.normal)),a){const e=t.vertexNormals;n.push(u(e[0]),u(e[1]),u(e[2]))}if(c&&n.push(h(t.color)),p){const e=t.vertexColors;n.push(h(e[0]),h(e[1]),h(e[2]))}}function l(e,t,n){return n?e|1<<t:e&~(1<<t)}function u(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==i[t]||(i[t]=r.length/3,r.push(e.x,e.y,e.z)),i[t]}function h(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==s[t]||(s[t]=o.length,o.push(e.getHex())),s[t]}function d(e){const t=e.x.toString()+e.y.toString();return void 0!==c[t]||(c[t]=a.length/2,a.push(e.x,e.y)),c[t]}return e.data={},e.data.vertices=t,e.data.normals=r,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=n,e},clone:function(){return(new N_).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let e=0,n=t.length;e<n;e++)this.vertices.push(t[e].clone());const n=e.colors;for(let e=0,t=n.length;e<t;e++)this.colors.push(n[e].clone());const r=e.faces;for(let e=0,t=r.length;e<t;e++)this.faces.push(r[e].clone());for(let t=0,n=e.faceVertexUvs.length;t<n;t++){const n=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,r=n.length;e<r;e++){const r=n[e],i=[];for(let e=0,t=r.length;e<t;e++){const t=r[e];i.push(t.clone())}this.faceVertexUvs[t].push(i)}}const i=e.morphTargets;for(let e=0,t=i.length;e<t;e++){const t={};if(t.name=i[e].name,void 0!==i[e].vertices){t.vertices=[];for(let n=0,r=i[e].vertices.length;n<r;n++)t.vertices.push(i[e].vertices[n].clone())}if(void 0!==i[e].normals){t.normals=[];for(let n=0,r=i[e].normals.length;n<r;n++)t.normals.push(i[e].normals[n].clone())}this.morphTargets.push(t)}const o=e.morphNormals;for(let e=0,t=o.length;e<t;e++){const t={};if(void 0!==o[e].vertexNormals){t.vertexNormals=[];for(let n=0,r=o[e].vertexNormals.length;n<r;n++){const r=o[e].vertexNormals[n],i={};i.a=r.a.clone(),i.b=r.b.clone(),i.c=r.c.clone(),t.vertexNormals.push(i)}}if(void 0!==o[e].faceNormals){t.faceNormals=[];for(let n=0,r=o[e].faceNormals.length;n<r;n++)t.faceNormals.push(o[e].faceNormals[n].clone())}this.morphNormals.push(t)}const s=e.skinWeights;for(let e=0,t=s.length;e<t;e++)this.skinWeights.push(s[e].clone());const a=e.skinIndices;for(let e=0,t=a.length;e<t;e++)this.skinIndices.push(a[e].clone());const c=e.lineDistances;for(let e=0,t=c.length;e<t;e++)this.lineDistances.push(c[e]);const l=e.boundingBox;null!==l&&(this.boundingBox=l.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),new Bm,new Bm,new Bm,new $g;function I_(e,t,n,r,i){let o,s;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)s=tw(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=tw(o,e[o],e[o+1],s);return s&&Z_(s,s.next)&&(nw(s),s=s.next),s}function D_(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Z_(r,r.next)&&0!==Y_(r.prev,r,r.next))r=r.next;else{if(nw(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function k_(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=V_(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,s,a,c,l=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<l&&(a++,r=r.nextZ,r);t++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1)}(i)}(e,r,i,o);let a,c,l=e;for(;e.prev!==e.next;)if(a=e.prev,c=e.next,o?U_(e,r,i,o):B_(e))t.push(a.i/n),t.push(e.i/n),t.push(c.i/n),nw(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?k_(e=F_(D_(e),t,n),t,n,r,i,o,2):2===s&&z_(e,t,n,r,i,o):k_(D_(e),t,n,r,i,o,1);break}}function B_(e){const t=e.prev,n=e,r=e.next;if(Y_(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(q_(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Y_(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function U_(e,t,n,r){const i=e.prev,o=e,s=e.next;if(Y_(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=V_(a,c,t,n,r),d=V_(l,u,t,n,r);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&q_(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Y_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&q_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Y_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&q_(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Y_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&q_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Y_(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function F_(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!Z_(i,o)&&J_(i,r,r.next,o)&&Q_(i,o)&&Q_(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),nw(r),nw(r.next),r=e=o),r=r.next}while(r!==e);return D_(r)}function z_(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&X_(s,e)){let a=ew(s,e);return s=D_(s,s.next),a=D_(a,a.next),k_(s,t,n,r,i,o),void k_(a,t,n,r,i,o)}e=e.next}s=s.next}while(s!==e)}function H_(e,t){return e.x-t.x}function G_(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s){if(s=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===s)return o;const a=o,c=o.x,l=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=c&&r!==n.x&&q_(i<l?r:s,i,c,l,i<l?s:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),Q_(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&j_(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(e,t),t){const n=ew(t,e);D_(t,t.next),D_(n,n.next)}}function j_(e,t){return Y_(e.prev,e,t.prev)<0&&Y_(t.next,e,e.next)<0}function V_(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function W_(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function q_(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function X_(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&J_(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Q_(e,t)&&Q_(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Y_(e.prev,e,t.prev)||Y_(e,t.prev,t))||Z_(e,t)&&Y_(e.prev,e,e.next)>0&&Y_(t.prev,t,t.next)>0)}function Y_(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Z_(e,t){return e.x===t.x&&e.y===t.y}function J_(e,t,n,r){const i=K_(Y_(e,t,n)),o=K_(Y_(e,t,r)),s=K_(Y_(n,r,e)),a=K_(Y_(n,r,t));return i!==o&&s!==a||!(0!==i||!$_(e,n,t))||!(0!==o||!$_(e,r,t))||!(0!==s||!$_(n,e,r))||!(0!==a||!$_(n,t,r))}function $_(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function K_(e){return e>0?1:e<0?-1:0}function Q_(e,t){return Y_(e.prev,e,e.next)<0?Y_(e,t,e.next)>=0&&Y_(e,e.prev,t)>=0:Y_(e,t,e.prev)<0||Y_(e,e.next,t)<0}function ew(e,t){const n=new rw(e.i,e.x,e.y),r=new rw(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function tw(e,t,n,r){const i=new rw(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function nw(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function rw(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const iw={area:function(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return iw.area(e)<0},triangulateShape:function(e,t){const n=[],r=[],i=[];ow(e),sw(n,e);let o=e.length;t.forEach(ow);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,sw(n,t[e]);const s=function(e,t,n){n=n||2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=I_(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,d,p;if(r&&(o=function(e,t,n,r){const i=[];let o,s,a,c,l;for(o=0,s=t.length;o<s;o++)a=t[o]*r,c=o<s-1?t[o+1]*r:e.length,l=I_(e,a,c,r,!1),l===l.next&&(l.steiner=!0),i.push(W_(l));for(i.sort(H_),o=0;o<i.length;o++)G_(i[o],n),n=D_(n,n.next);return n}(e,t,o,n)),e.length>80*n){a=l=e[0],c=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=0!==p?1/p:0}return k_(o,s,n,a,c,p),s}(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}};function ow(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function sw(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class aw extends Nv{constructor(e,t){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)o(e[t]);function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let c=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:cw;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);let g,v,y,b,x,_=!1;f&&(g=f.getSpacedPoints(a),_=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new Bm,b=new Bm,x=new Bm),l||(p=0,u=0,h=0,d=0);const w=e.extractPoints(s);let M=w.shape;const T=w.holes;if(!iw.isClockWise(M)){M=M.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];iw.isClockWise(t)&&(T[e]=t.reverse())}}const S=iw.triangulateShape(M,T),E=M;for(let e=0,t=T.length;e<t;e++){const t=T[e];M=M.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const R=M.length,L=S.length;function C(e,t,n){let r,i,o;const s=e.x-t.x,a=e.y-t.y,c=n.x-e.x,l=n.y-e.y,u=s*s+a*a,h=s*l-a*c;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(c*c+l*l),p=t.x-a/h,f=t.y+s/h,m=((n.x-l/d-p)*l-(n.y+c/d-f)*c)/(s*l-a*c);r=p+s*m-e.x,i=f+a*m-e.y;const g=r*r+i*i;if(g<=2)return new Em(r,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?c>Number.EPSILON&&(e=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(l)&&(e=!0),e?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new Em(r/o,i/o)}const P=[];for(let e=0,t=E.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),P[e]=C(E[e],E[n],E[r]);const O=[];let N,I=P.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];N=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[e]=C(t[e],t[r],t[i]);O.push(N),I=I.concat(N)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],P[e],r);B(t.x,t.y,-n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];N=O[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],N[e],r);B(i.x,i.y,-n)}}}const D=h+d;for(let e=0;e<R;e++){const t=l?A(M[e],I[e],D):M[e];_?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(b).add(y),B(x.x,x.y,x.z)):B(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<R;t++){const n=l?A(M[t],I[t],D):M[t];_?(b.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(b).add(y),B(x.x,x.y,x.z)):B(n.x,n.y,c/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],P[e],r);B(t.x,t.y,c+n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];N=O[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],N[e],r);_?B(i.x,i.y+g[a-1].y,g[a-1].x+n):B(i.x,i.y,c+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=R*e,o=R*(e+1);F(t+r+n,t+i+n,t+i+o,t+r+o)}}}function B(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,i){z(e),z(t),z(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[2])}function F(e,t,i,o){z(e),z(t),z(o),z(t),z(i),z(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function z(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function H(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(l){let e=0,t=R*e;for(let e=0;e<L;e++){const n=S[e];U(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=R*e;for(let e=0;e<L;e++){const n=S[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<L;e++){const t=S[e];U(t[2],t[1],t[0])}for(let e=0;e<L;e++){const t=S[e];U(t[0]+R*a,t[1]+R*a,t[2]+R*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;k(E,t),t+=E.length;for(let e=0,n=T.length;e<n;e++){const n=T[e];k(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new xv(r,3)),this.setAttribute("uv",new xv(i,2)),this.computeVertexNormals()}toJSON(){const e=Nv.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}const cw={generateTopUV:function(e,t,n,r,i){const o=t[3*n],s=t[3*n+1],a=t[3*r],c=t[3*r+1],l=t[3*i],u=t[3*i+1];return[new Em(o,s),new Em(a,c),new Em(l,u)]},generateSideWallUV:function(e,t,n,r,i,o){const s=t[3*n],a=t[3*n+1],c=t[3*n+2],l=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<.01?[new Em(s,1-c),new Em(l,1-h),new Em(d,1-f),new Em(m,1-v)]:[new Em(a,1-c),new Em(u,1-h),new Em(p,1-f),new Em(g,1-v)]}};class lw extends N_{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new aw(e,t)),this.mergeVertices()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}function uw(e,t,n){Nv.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,c=new Bm,l=new Bm,u=new Bm,h=new Bm,d=new Bm;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,p,l),i.push(l.x,l.y,l.z),r-a>=0?(e(r-a,p,u),h.subVectors(l,u)):(e(r+a,p,u),h.subVectors(u,l)),p-a>=0?(e(r,p-a,u),d.subVectors(l,u)):(e(r,p+a,u),d.subVectors(u,l)),c.crossVectors(h,d).normalize(),o.push(c.x,c.y,c.z),s.push(r,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,i=e*p+n+1,o=(e+1)*p+n+1,s=(e+1)*p+n;r.push(t,i,s),r.push(i,o,s)}this.setIndex(r),this.setAttribute("position",new xv(i,3)),this.setAttribute("normal",new xv(o,3)),this.setAttribute("uv",new xv(s,2))}function hw(e,t,n){N_.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new uw(e,t,n)),this.mergeVertices()}uw.prototype=Object.create(Nv.prototype),uw.prototype.constructor=uw,hw.prototype=Object.create(N_.prototype),hw.prototype.constructor=hw;class dw extends Nv{constructor(e,t=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))c(e);else for(let t=0;t<e.length;t++)c(e[t]),this.addGroup(s,a,t),s+=a,a=0;function c(e){const s=r.length/3,c=e.extractPoints(t);let l=c.shape;const u=c.holes;!1===iw.isClockWise(l)&&(l=l.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===iw.isClockWise(t)&&(u[e]=t.reverse())}const h=iw.triangulateShape(l,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];l=l.concat(t)}for(let e=0,t=l.length;e<t;e++){const t=l[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+s,i=t[1]+s,o=t[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new xv(r,3)),this.setAttribute("normal",new xv(i,3)),this.setAttribute("uv",new xv(o,2))}toJSON(){const e=Nv.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class pw extends N_{constructor(e,t){super(),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new dw(e,t)),this.mergeVertices()}toJSON(){const e=N_.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}function fw(e){av.call(this),this.type="ShadowMaterial",this.color=new iv(0),this.transparent=!0,this.setValues(e)}function mw(e){iy.call(this,e),this.type="RawShaderMaterial"}function gw(e){av.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new iv(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iv(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Em(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function vw(e){gw.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Em(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Sm.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function yw(e){av.call(this),this.type="MeshPhongMaterial",this.color=new iv(16777215),this.specular=new iv(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iv(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Em(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function bw(e){av.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new iv(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iv(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Em(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function xw(e){av.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Em(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function _w(e){av.call(this),this.type="MeshLambertMaterial",this.color=new iv(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iv(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ww(e){av.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new iv(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Em(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Mw(e){a_.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}fw.prototype=Object.create(av.prototype),fw.prototype.constructor=fw,fw.prototype.isShadowMaterial=!0,fw.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this},mw.prototype=Object.create(iy.prototype),mw.prototype.constructor=mw,mw.prototype.isRawShaderMaterial=!0,gw.prototype=Object.create(av.prototype),gw.prototype.constructor=gw,gw.prototype.isMeshStandardMaterial=!0,gw.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},vw.prototype=Object.create(gw.prototype),vw.prototype.constructor=vw,vw.prototype.isMeshPhysicalMaterial=!0,vw.prototype.copy=function(e){return gw.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new iv).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},yw.prototype=Object.create(av.prototype),yw.prototype.constructor=yw,yw.prototype.isMeshPhongMaterial=!0,yw.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},bw.prototype=Object.create(av.prototype),bw.prototype.constructor=bw,bw.prototype.isMeshToonMaterial=!0,bw.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},xw.prototype=Object.create(av.prototype),xw.prototype.constructor=xw,xw.prototype.isMeshNormalMaterial=!0,xw.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},_w.prototype=Object.create(av.prototype),_w.prototype.constructor=_w,_w.prototype.isMeshLambertMaterial=!0,_w.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ww.prototype=Object.create(av.prototype),ww.prototype.constructor=ww,ww.prototype.isMeshMatcapMaterial=!0,ww.prototype.copy=function(e){return av.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Mw.prototype=Object.create(a_.prototype),Mw.prototype.constructor=Mw,Mw.prototype.isLineDashedMaterial=!0,Mw.prototype.copy=function(e){return a_.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Tw=Object.freeze({__proto__:null,ShadowMaterial:fw,SpriteMaterial:Ax,RawShaderMaterial:mw,ShaderMaterial:iy,PointsMaterial:y_,MeshPhysicalMaterial:vw,MeshStandardMaterial:gw,MeshPhongMaterial:yw,MeshToonMaterial:bw,MeshNormalMaterial:xw,MeshLambertMaterial:_w,MeshDepthMaterial:ux,MeshDistanceMaterial:hx,MeshBasicMaterial:cv,MeshMatcapMaterial:ww,LineDashedMaterial:Mw,LineBasicMaterial:a_,Material:av});const Sw={arraySlice:function(e,t,n){return Sw.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(t.push(o.time),n.push(s)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),c=[],l=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){c.push(t.times[e]);for(let n=0;n<a;++n)l.push(t.values[e*a+n])}}0!==c.length&&(t.times=Sw.convertArray(c,t.times.constructor),t.values=Sw.convertArray(l,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let a=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const e=a,t=c-a;d=Sw.arraySlice(r.values,e,t)}else if(o>=r.times[h]){const e=h*c+a,t=e+c-a;d=Sw.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=a,n=c-a;e.evaluate(o),d=Sw.arraySlice(e.resultBuffer,t,n)}"quaternion"===i&&(new km).fromArray(d).normalize().conjugate().toArray(d);const p=s.times.length;for(let e=0;e<p;++e){const t=e*u+l;if("quaternion"===i)km.multiplyQuaternionsFlat(s.values,t,d,0,s.values,t);else{const e=u-2*l;for(let n=0;n<e;++n)s.values[t+n]-=d[n]}}}return e.blendMode=2501,e}};function Ew(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Aw(e,t,n,r){Ew.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Rw(e,t,n,r){Ew.call(this,e,t,n,r)}function Lw(e,t,n,r){Ew.call(this,e,t,n,r)}function Cw(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Sw.convertArray(t,this.TimeBufferType),this.values=Sw.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Pw(e,t,n){Cw.call(this,e,t,n)}function Ow(e,t,n,r){Cw.call(this,e,t,n,r)}function Nw(e,t,n,r){Cw.call(this,e,t,n,r)}function Iw(e,t,n,r){Ew.call(this,e,t,n,r)}function Dw(e,t,n,r){Cw.call(this,e,t,n,r)}function kw(e,t,n,r){Cw.call(this,e,t,n,r)}function Bw(e,t,n,r){Cw.call(this,e,t,n,r)}function Uw(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Sm.generateUUID(),this.duration<0&&this.resetDuration()}function Fw(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Nw;case"vector":case"vector2":case"vector3":case"vector4":return Bw;case"color":return Ow;case"quaternion":return Dw;case"bool":case"boolean":return Pw;case"string":return kw}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Sw.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Ew.prototype,{evaluate:function(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ew.prototype,{beforeStart_:Ew.prototype.copySampleValue_,afterEnd_:Ew.prototype.copySampleValue_}),Aw.prototype=Object.assign(Object.create(Ew.prototype),{constructor:Aw,DefaultSettings_:{endingStart:pm,endingEnd:pm},intervalChanged_:function(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case fm:i=e,s=2*t-n;break;case mm:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case fm:o=e,a=2*n-t;break;case mm:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}const c=.5*(n-t),l=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(a-n),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let e=0;e!==s;++e)i[e]=g*o[l+e]+v*o[c+e]+y*o[a+e]+b*o[u+e];return i}}),Rw.prototype=Object.assign(Object.create(Ew.prototype),{constructor:Rw,interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=(n-t)/(r-t),u=1-l;for(let e=0;e!==s;++e)i[e]=o[c+e]*u+o[a+e]*l;return i}}),Lw.prototype=Object.assign(Object.create(Ew.prototype),{constructor:Lw,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Cw,{toJSON:function(e){const t=e.constructor;let n;if(void 0!==t.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Sw.convertArray(e.times,Array),values:Sw.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}}),Object.assign(Cw.prototype,{constructor:Cw,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:hm,InterpolantFactoryMethodDiscrete:function(e){return new Lw(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Rw(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Aw(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case um:t=this.InterpolantFactoryMethodDiscrete;break;case hm:t=this.InterpolantFactoryMethodLinear;break;case dm:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return um;case this.InterpolantFactoryMethodLinear:return hm;case this.InterpolantFactoryMethodSmooth:return dm}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this},trim:function(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=Sw.arraySlice(n,i,o),this.values=Sw.arraySlice(this.values,i*e,o*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&Sw.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e},optimize:function(){const e=Sw.arraySlice(this.times),t=Sw.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===dm,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==a[0]))if(r)i=!0;else{const e=s*n,r=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const r=s*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,s=0;s!==n;++s)t[r+s]=t[e+s];++o}return o!==e.length?(this.times=Sw.arraySlice(e,0,o),this.values=Sw.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){const e=Sw.arraySlice(this.times,0),t=Sw.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Pw.prototype=Object.assign(Object.create(Cw.prototype),{constructor:Pw,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:um,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ow.prototype=Object.assign(Object.create(Cw.prototype),{constructor:Ow,ValueTypeName:"color"}),Nw.prototype=Object.assign(Object.create(Cw.prototype),{constructor:Nw,ValueTypeName:"number"}),Iw.prototype=Object.assign(Object.create(Ew.prototype),{constructor:Iw,interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(r-t);let c=e*s;for(let e=c+s;c!==e;c+=4)km.slerpFlat(i,0,o,c-s,o,c,a);return i}}),Dw.prototype=Object.assign(Object.create(Cw.prototype),{constructor:Dw,ValueTypeName:"quaternion",DefaultInterpolation:hm,InterpolantFactoryMethodLinear:function(e){return new Iw(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),kw.prototype=Object.assign(Object.create(Cw.prototype),{constructor:kw,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:um,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Bw.prototype=Object.assign(Object.create(Cw.prototype),{constructor:Bw,ValueTypeName:"vector"}),Object.assign(Uw,{parse:function(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Fw(n[e]).scale(r));const i=new Uw(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i},toJSON:function(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Cw.toJSON(n[e]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let s=[],a=[];s.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const c=Sw.getKeyframeOrder(s);s=Sw.sortedArray(s,1,c),a=Sw.sortedArray(a,1,c),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new Nw(".morphTargetInfluences["+t[e].name+"]",s,a).scale(1/n))}return new Uw(e,-1,o)},findByName:function(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(Uw.CreateFromMorphTargetSequence(e,r[e],t,n));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],s=[];Sw.flattenJSON(n,o,s,r),0!==o.length&&i.push(new e(t,o,s))}},r=[],i=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let e=0;e<c.length;e++){const i=c[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new Nw(".morphTargetInfluence["+n+"]",e,o))}a=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";n(Bw,o+".position",i,"pos",r),n(Dw,o+".quaternion",i,"rot",r),n(Bw,o+".scale",i,"scl",r)}}return 0===r.length?null:new Uw(i,a,r,s)}}),Object.assign(Uw.prototype,{resetDuration:function(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Uw(this.name,this.duration,e,this.blendMode)},toJSON:function(){return Uw.toJSON(this)}});const zw={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};const Hw=new function(e,t,n){const r=this;let i,o=!1,s=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==r.onStart&&r.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,a),s===a&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=c.length;t<n;t+=2){const n=c[t],r=c[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}};function Gw(e){this.manager=void 0!==e?e:Hw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Gw.prototype,{load:function(){},loadAsync:function(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const jw={};function Vw(e){Gw.call(this,e)}function Ww(e){Gw.call(this,e)}function qw(e){Gw.call(this,e)}function Xw(e){Gw.call(this,e)}function Yw(e){Gw.call(this,e)}function Zw(e){Gw.call(this,e)}function Jw(e){Gw.call(this,e)}function $w(){this.type="Curve",this.arcLengthDivisions=200}function Kw(e,t,n,r,i,o,s,a){$w.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Qw(e,t,n,r,i,o){Kw.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function eM(){let e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){let c=(t-e)/o-(n-e)/(o+s)+(n-t)/s,l=(n-t)/s-(r-t)/(s+a)+(r-n)/a;c*=s,l*=s,i(t,n,c,l)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}Vw.prototype=Object.assign(Object.create(Gw.prototype),{constructor:Vw,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=zw.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0!==jw[e])return void jw[e].push({onLoad:t,onProgress:n,onError:r});const s=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);r="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{jw[e]=[],jw[e].push({onLoad:t,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const n=this.response,r=jw[e];if(delete jw[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),zw.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const n=jw[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const n=jw[e];delete jw[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const n=jw[e];delete jw[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return i.manager.itemStart(e),a},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Ww.prototype=Object.assign(Object.create(Gw.prototype),{constructor:Ww,load:function(e,t,n,r){const i=this,o=new Vw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t=[];for(let n=0;n<e.length;n++){const r=Uw.parse(e[n]);t.push(r)}return t}}),qw.prototype=Object.assign(Object.create(Gw.prototype),{constructor:qw,load:function(e,t,n,r){const i=this,o=[],s=new E_,a=new Vw(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let c=0;function l(l){a.load(e[l],(function(e){const n=i.parse(e,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(s.minFilter=Qf),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)l(t);else a.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=Qf),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}}),Xw.prototype=Object.assign(Object.create(Gw.prototype),{constructor:Xw,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=zw.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),zw.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(t){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}),Yw.prototype=Object.assign(Object.create(Gw.prototype),{constructor:Yw,load:function(e,t,n,r){const i=new ly,o=new Xw(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)a(t);return i}}),Zw.prototype=Object.assign(Object.create(Gw.prototype),{constructor:Zw,load:function(e,t,n,r){const i=this,o=new hy,s=new Vw(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:Yf,o.wrapT=void 0!==n.wrapT?n.wrapT:Yf,o.magFilter=void 0!==n.magFilter?n.magFilter:Qf,o.minFilter=void 0!==n.minFilter?n.minFilter:Qf,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=em),1===n.mipmapCount&&(o.minFilter=Qf),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),Jw.prototype=Object.assign(Object.create(Gw.prototype),{constructor:Jw,load:function(e,t,n,r){const i=new Pm,o=new Xw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;const r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?sm:am,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign($w.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let s,a=0,c=i-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(r=c,n[r]===o)return r/(i-1);const l=n[r];return(r+(o-l)/(n[r+1]-l))/(i-1)},getTangent:function(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),s=this.getPoint(i),a=t||(o.isVector2?new Em:new Bm);return a.copy(s).sub(o).normalize(),a},getTangentAt:function(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){const n=new Bm,r=[],i=[],o=[],s=new Bm,a=new hg;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new Bm),r[t].normalize()}i[0]=new Bm,o[0]=new Bm;let c=Number.MAX_VALUE;const l=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Sm.clamp(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Sm.clamp(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Kw.prototype=Object.create($w.prototype),Kw.prototype.constructor=Kw,Kw.prototype.isEllipseCurve=!0,Kw.prototype.getPoint=function(e,t){const n=t||new Em,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=c-this.aY;a=n*e-r*t+this.aX,c=n*t+r*e+this.aY}return n.set(a,c)},Kw.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Kw.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Kw.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Qw.prototype=Object.create(Kw.prototype),Qw.prototype.constructor=Qw,Qw.prototype.isArcCurve=!0;const tM=new Bm,nM=new eM,rM=new eM,iM=new eM;function oM(e=[],t=!1,n="centripetal",r=.5){$w.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}function sM(e,t,n,r,i){const o=.5*(r-t),s=.5*(i-n),a=e*e;return(2*n-2*r+o+s)*(e*a)+(-3*n+3*r-2*o-s)*a+o*e+n}function aM(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function cM(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function lM(e=new Em,t=new Em,n=new Em,r=new Em){$w.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function uM(e=new Bm,t=new Bm,n=new Bm,r=new Bm){$w.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function hM(e=new Em,t=new Em){$w.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function dM(e=new Bm,t=new Bm){$w.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function pM(e=new Em,t=new Em,n=new Em){$w.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}function fM(e=new Bm,t=new Bm,n=new Bm){$w.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}function mM(e=[]){$w.call(this),this.type="SplineCurve",this.points=e}oM.prototype=Object.create($w.prototype),oM.prototype.constructor=oM,oM.prototype.isCatmullRomCurve3=!0,oM.prototype.getPoint=function(e,t=new Bm){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let s,a,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===l&&c===i-1&&(c=i-2,l=1),this.closed||c>0?s=r[(c-1)%i]:(tM.subVectors(r[0],r[1]).add(r[0]),s=tM);const u=r[c%i],h=r[(c+1)%i];if(this.closed||c+2<i?a=r[(c+2)%i]:(tM.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=tM),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),nM.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,t,n,r),rM.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,t,n,r),iM.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,t,n,r)}else"catmullrom"===this.curveType&&(nM.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),rM.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),iM.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set(nM.calc(l),rM.calc(l),iM.calc(l)),n},oM.prototype.copy=function(e){$w.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},oM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},oM.prototype.fromJSON=function(e){$w.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Bm).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},lM.prototype=Object.create($w.prototype),lM.prototype.constructor=lM,lM.prototype.isCubicBezierCurve=!0,lM.prototype.getPoint=function(e,t=new Em){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(cM(e,r.x,i.x,o.x,s.x),cM(e,r.y,i.y,o.y,s.y)),n},lM.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},lM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},lM.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},uM.prototype=Object.create($w.prototype),uM.prototype.constructor=uM,uM.prototype.isCubicBezierCurve3=!0,uM.prototype.getPoint=function(e,t=new Bm){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(cM(e,r.x,i.x,o.x,s.x),cM(e,r.y,i.y,o.y,s.y),cM(e,r.z,i.z,o.z,s.z)),n},uM.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},uM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},uM.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},hM.prototype=Object.create($w.prototype),hM.prototype.constructor=hM,hM.prototype.isLineCurve=!0,hM.prototype.getPoint=function(e,t=new Em){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},hM.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},hM.prototype.getTangent=function(e,t){const n=t||new Em;return n.copy(this.v2).sub(this.v1).normalize(),n},hM.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},hM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},hM.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},dM.prototype=Object.create($w.prototype),dM.prototype.constructor=dM,dM.prototype.isLineCurve3=!0,dM.prototype.getPoint=function(e,t=new Bm){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},dM.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},dM.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},dM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},dM.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},pM.prototype=Object.create($w.prototype),pM.prototype.constructor=pM,pM.prototype.isQuadraticBezierCurve=!0,pM.prototype.getPoint=function(e,t=new Em){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(aM(e,r.x,i.x,o.x),aM(e,r.y,i.y,o.y)),n},pM.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},pM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},pM.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},fM.prototype=Object.create($w.prototype),fM.prototype.constructor=fM,fM.prototype.isQuadraticBezierCurve3=!0,fM.prototype.getPoint=function(e,t=new Bm){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(aM(e,r.x,i.x,o.x),aM(e,r.y,i.y,o.y),aM(e,r.z,i.z,o.z)),n},fM.prototype.copy=function(e){return $w.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},fM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},fM.prototype.fromJSON=function(e){return $w.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},mM.prototype=Object.create($w.prototype),mM.prototype.constructor=mM,mM.prototype.isSplineCurve=!0,mM.prototype.getPoint=function(e,t=new Em){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],c=r[o],l=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(sM(s,a.x,c.x,l.x,u.x),sM(s,a.y,c.y,l.y,u.y)),n},mM.prototype.copy=function(e){$w.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this},mM.prototype.toJSON=function(){const e=$w.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e},mM.prototype.fromJSON=function(e){$w.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Em).fromArray(n))}return this};var gM=Object.freeze({__proto__:null,ArcCurve:Qw,CatmullRomCurve3:oM,CubicBezierCurve:lM,CubicBezierCurve3:uM,EllipseCurve:Kw,LineCurve:hM,LineCurve3:dM,QuadraticBezierCurve:pM,QuadraticBezierCurve3:fM,SplineCurve:mM});function vM(){$w.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function yM(e){vM.call(this),this.type="Path",this.currentPoint=new Em,e&&this.setFromPoints(e)}function bM(e){yM.call(this,e),this.uuid=Sm.generateUUID(),this.type="Shape",this.holes=[]}function xM(e,t=1){kg.call(this),this.type="Light",this.color=new iv(e),this.intensity=t}function _M(e,t,n){xM.call(this,e,n),this.type="HemisphereLight",this.position.copy(kg.DefaultUp),this.updateMatrix(),this.groundColor=new iv(t)}function wM(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Em(512,512),this.map=null,this.mapPass=null,this.matrix=new hg,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fy,this._frameExtents=new Em(1,1),this._viewportCount=1,this._viewports=[new Nm(0,0,1,1)]}function MM(){wM.call(this,new sy(50,1,.5,500)),this.focus=1}function TM(e,t,n,r,i,o){xM.call(this,e,t),this.type="SpotLight",this.position.copy(kg.DefaultUp),this.updateMatrix(),this.target=new kg,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new MM}function SM(){wM.call(this,new sy(90,1,.5,500)),this._frameExtents=new Em(4,2),this._viewportCount=6,this._viewports=[new Nm(2,1,1,1),new Nm(0,1,1,1),new Nm(3,1,1,1),new Nm(1,1,1,1),new Nm(3,0,1,1),new Nm(1,0,1,1)],this._cubeDirections=[new Bm(1,0,0),new Bm(-1,0,0),new Bm(0,0,1),new Bm(0,0,-1),new Bm(0,1,0),new Bm(0,-1,0)],this._cubeUps=[new Bm(0,1,0),new Bm(0,1,0),new Bm(0,1,0),new Bm(0,1,0),new Bm(0,0,1),new Bm(0,0,-1)]}function EM(e,t,n,r){xM.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new SM}function AM(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){oy.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}function RM(){wM.call(this,new AM(-5,5,5,-5,.5,500))}function LM(e,t){xM.call(this,e,t),this.type="DirectionalLight",this.position.copy(kg.DefaultUp),this.updateMatrix(),this.target=new kg,this.shadow=new RM}function CM(e,t){xM.call(this,e,t),this.type="AmbientLight"}function PM(e,t,n,r){xM.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}vM.prototype=Object.assign(Object.create($w.prototype),{constructor:vM,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new hM(t,e))},getPoint:function(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],o=i.getLength(),s=0===o?0:1-e/o;return i.getPointAt(s)}r++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){$w.prototype.copy.call(this,e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=$w.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){$w.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new gM[n.type]).fromJSON(n))}return this}}),yM.prototype=Object.assign(Object.create(vM.prototype),{constructor:yM,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const n=new hM(this.currentPoint.clone(),new Em(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){const i=new pM(this.currentPoint.clone(),new Em(e,t),new Em(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){const s=new lM(this.currentPoint.clone(),new Em(e,t),new Em(n,r),new Em(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this},splineThru:function(e){const t=new mM([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+c,t+l,n,r,i,o,s,a),this},absellipse:function(e,t,n,r,i,o,s,a){const c=new Kw(e,t,n,r,i,o,s,a);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(e){return vM.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=vM.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return vM.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),bM.prototype=Object.assign(Object.create(yM.prototype),{constructor:bM,getPointsHoles:function(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){yM.prototype.copy.call(this,e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){const e=yM.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){yM.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new yM).fromJSON(n))}return this}}),xM.prototype=Object.assign(Object.create(kg.prototype),{constructor:xM,isLight:!0,copy:function(e){return kg.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=kg.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),_M.prototype=Object.assign(Object.create(xM.prototype),{constructor:_M,isHemisphereLight:!0,copy:function(e){return xM.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(wM.prototype,{_projScreenMatrix:new hg,_lightPositionWorld:new Bm,_lookTarget:new Bm,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),MM.prototype=Object.assign(Object.create(wM.prototype),{constructor:MM,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,n=2*Sm.RAD2DEG*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),wM.prototype.updateMatrices.call(this,e)}}),TM.prototype=Object.assign(Object.create(xM.prototype),{constructor:TM,isSpotLight:!0,copy:function(e){return xM.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),SM.prototype=Object.assign(Object.create(wM.prototype),{constructor:SM,isPointLightShadow:!0,updateMatrices:function(e,t=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),EM.prototype=Object.assign(Object.create(xM.prototype),{constructor:EM,isPointLight:!0,copy:function(e){return xM.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),AM.prototype=Object.assign(Object.create(oy.prototype),{constructor:AM,isOrthographicCamera:!0,copy:function(e,t){return oy.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=kg.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),RM.prototype=Object.assign(Object.create(wM.prototype),{constructor:RM,isDirectionalLightShadow:!0,updateMatrices:function(e){wM.prototype.updateMatrices.call(this,e)}}),LM.prototype=Object.assign(Object.create(xM.prototype),{constructor:LM,isDirectionalLight:!0,copy:function(e){return xM.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),CM.prototype=Object.assign(Object.create(xM.prototype),{constructor:CM,isAmbientLight:!0}),PM.prototype=Object.assign(Object.create(xM.prototype),{constructor:PM,isRectAreaLight:!0,copy:function(e){return xM.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=xM.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class OM{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Bm)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}function NM(e,t){xM.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new OM}function IM(e){Gw.call(this,e),this.textures={}}NM.prototype=Object.assign(Object.create(xM.prototype),{constructor:NM,isLightProbe:!0,copy:function(e){return xM.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=xM.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),IM.prototype=Object.assign(Object.create(Gw.prototype),{constructor:IM,load:function(e,t,n,r){const i=this,o=new Vw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=new Tw[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new iv).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new iv).setHex(i.value);break;case"v2":r.uniforms[t].value=(new Em).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new Bm).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new Nm).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new Am).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new hg).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Em).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Em).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});const DM=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},kM=function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)};function BM(){Nv.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function UM(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),hv.call(this,e,t,n),this.meshPerAttribute=r||1}function FM(e){Gw.call(this,e)}function zM(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Gw.call(this,e),this.options={premultiplyAlpha:"none"}}function HM(){this.type="ShapePath",this.color=new iv,this.subPaths=[],this.currentPath=null}function GM(e){this.type="Font",this.data=e}function jM(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const s=new HM;let a,c,l,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;)switch(e[i++]){case"m":a=e[i++]*t+n,c=e[i++]*t+r,s.moveTo(a,c);break;case"l":a=e[i++]*t+n,c=e[i++]*t+r,s.lineTo(a,c);break;case"q":l=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,s.quadraticCurveTo(h,d,l,u);break;case"b":l=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,p=e[i++]*t+n,f=e[i++]*t+r,s.bezierCurveTo(h,d,p,f,l,u)}}return{offsetX:o.ha*t,path:s}}function VM(e){Gw.call(this,e)}let WM;BM.prototype=Object.assign(Object.create(Nv.prototype),{constructor:BM,isInstancedBufferGeometry:!0,copy:function(e){return Nv.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=Nv.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),UM.prototype=Object.assign(Object.create(hv.prototype),{constructor:UM,isInstancedBufferAttribute:!0,copy:function(e){return hv.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=hv.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),FM.prototype=Object.assign(Object.create(Gw.prototype),{constructor:FM,load:function(e,t,n,r){const i=this,o=new Vw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=new Tx(Sv(i.type,o),i.stride);return s.uuid=i.uuid,t[r]=s,s}const i=e.isInstancedBufferGeometry?new BM:new Nv,o=e.data.index;if(void 0!==o){const e=Sv(o.type,o.array);i.setIndex(new hv(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let o;if(n.isInterleavedBufferAttribute)o=new Ex(r(e.data,n.data),n.itemSize,n.offset,n.normalized);else{const e=Sv(n.type,n.array);o=new(n.isInstancedBufferAttribute?UM:hv)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),i.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let s;s=i.isInterleavedBufferAttribute?new Ex(r(e.data,i.data),i.itemSize,i.offset,i.normalized):new hv(Sv(i.type,i.array),i.itemSize,i.normalized),void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){const t=c[e];i.addGroup(t.start,t.count,t.materialIndex)}const l=e.data.boundingSphere;if(void 0!==l){const e=new Bm;void 0!==l.center&&e.fromArray(l.center),i.boundingSphere=new ng(e,l.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}),zM.prototype=Object.assign(Object.create(Gw.prototype),{constructor:zM,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=zw.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,i.options)})).then((function(n){zw.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(HM.prototype,{moveTo:function(e,t){return this.currentPath=new yM,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new bM;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],s=t[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=t[o],a=-a,s=t[i],c=-c),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=c*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const i=iw.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,c;const l=[];if(1===o.length)return a=o[0],c=new bM,c.curves=a.curves,l.push(c),l;let u=!i(o[0].getPoints());u=e?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)a=o[t],p=a.getPoints(),s=i(p),s=e?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new bM,p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<d.length;i++)r(s.p,d[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):e=!0);a&&h[n].push(s)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){c=d[e].s,l.push(c),f=m[e];for(let e=0,t=f.length;e<t;e++)c.holes.push(f[e].h)}return l}}),Object.assign(GM.prototype,{isFont:!0,generateShapes:function(e,t=100){const n=[],r=function(e,t,n){const r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,c=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)a=0,c-=o;else{const e=jM(t,i,a,c,n);a+=e.offsetX,s.push(e.path)}}return s}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}),VM.prototype=Object.assign(Object.create(Gw.prototype),{constructor:VM,load:function(e,t,n,r){const i=this,o=new Vw(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new GM(e)}});function qM(e){Gw.call(this,e)}function XM(e,t,n){NM.call(this,void 0,n);const r=(new iv).set(e),i=(new iv).set(t),o=new Bm(r.r,r.g,r.b),s=new Bm(i.r,i.g,i.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}function YM(e,t){NM.call(this,void 0,t);const n=(new iv).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}qM.prototype=Object.assign(Object.create(Gw.prototype),{constructor:qM,load:function(e,t,n,r){const i=this,o=new Vw(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);(void 0===WM&&(WM=new(window.AudioContext||window.webkitAudioContext)),WM).decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}),XM.prototype=Object.assign(Object.create(NM.prototype),{constructor:XM,isHemisphereLightProbe:!0,copy:function(e){return NM.prototype.copy.call(this,e),this},toJSON:function(e){return NM.prototype.toJSON.call(this,e)}}),YM.prototype=Object.assign(Object.create(NM.prototype),{constructor:YM,isAmbientLightProbe:!0,copy:function(e){return NM.prototype.copy.call(this,e),this},toJSON:function(e){return NM.prototype.toJSON.call(this,e)}});const ZM=new hg,JM=new hg;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sy,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sy,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,o=t.near*Math.tan(Sm.DEG2RAD*t.fov*.5)/t.zoom;let s,a;JM.elements[12]=-r,ZM.elements[12]=r,s=-o*t.aspect+i,a=o*t.aspect+i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-i,a=o*t.aspect-i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(JM),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ZM)}});function $M(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign($M.prototype,{accumulate:function(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]},_slerp:function(e,t,n,r){km.slerpFlat(e,t,e,t,e,n,r)},_slerpAdditive:function(e,t,n,r,i){const o=this._workIndex*i;km.multiplyQuaternionsFlat(e,o,e,t,e,n),km.slerpFlat(e,t,e,t,e,o,r)},_lerp:function(e,t,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*o+e[n+s]*r}},_lerpAdditive:function(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}});const KM=new RegExp("[\\[\\]\\.:\\/]","g"),QM="[^\\[\\]\\.:\\/]",eT="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",tT=/((?:WC+[\/:])*)/.source.replace("WC",QM),nT=/(WCOD+)?/.source.replace("WCOD",eT),rT=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",QM),iT=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",QM),oT=new RegExp("^"+tT+nT+rT+iT+"$"),sT=["material","materials","bones"];function aT(e,t,n){const r=n||cT.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function cT(e,t,n){this.path=t,this.parsedPath=n||cT.parseTrackName(t),this.node=cT.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(aT.prototype,{getValue:function(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(cT,{Composite:aT,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new cT.Composite(e,t,n):new cT(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(KM,"")},parseTrackName:function(e){const t=oT.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==sT.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}}),Object.assign(cT.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=cT.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(cT.prototype,{_getValue_unbound:cT.prototype.getValue,_setValue_unbound:cT.prototype.setValue}),Object.assign(function(){this.uuid=Sm.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s,a=e.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const u=arguments[l],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new cT(u,n[e],r[e]))}else if(d<c){s=e[d];const a=--c,l=e[a];t[l.uuid]=d,e[d]=l,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new cT(u,n[e],r[e])),t[a]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=t[a];if(void 0!==c&&c>=i){const o=i++,l=e[o];t[l.uuid]=c,e[c]=l,t[a]=o,e[o]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[c]=r,t[o]=i}}}this.nCachedObjects_=i},uncache:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=t[a];if(void 0!==c)if(delete t[a],c<i){const s=--i,a=e[s],l=--o,u=e[l];t[a.uuid]=c,e[c]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[l];t[c]=r,t[s]=i,t.pop()}}else{const i=--o,s=e[i];i>0&&(t[s.uuid]=c),e[c]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[c]=t[i],t.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);r=i.length,n[e]=r,o.push(e),s.push(t),i.push(u);for(let n=l,r=a.length;n!==r;++n){const r=a[n];u[n]=new cT(r,e,t)}return u},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}});class lT{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,s=new Array(o),a={endingStart:pm,endingEnd:pm};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=2202===n;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=fm,r.endingEnd=fm):(r.endingStart=e?this.zeroSlopeAtStart?fm:pm:mm,r.endingEnd=t?this.zeroSlopeAtEnd?fm:pm:mm)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=n,this}}function uT(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}uT.prototype=Object.assign(Object.create(wm.prototype),{constructor:uT,_bindAction:function(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let e=0;e!==i;++e){const i=r[e],c=i.name;let u=l[c];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new $M(cT.create(n,c,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),o[e]=u}s[e].resultBuffer=u.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,c=a[a.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]},_lendBinding:function(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Rw(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?Uw.findByName(r,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let c=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new lT(this,o,t,n);return this._bindAction(l,c),this._addInactiveAction(l,s,i),l},existingAction:function(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?Uw.findByName(n,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==n;++s)t[s]._update(r,e,i,o);const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this},setTime:function(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class hT{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new hT(void 0===this.value.clone?this.value:this.value.clone())}}function dT(e,t,n){Tx.call(this,e,t),this.meshPerAttribute=n||1}function pT(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function fT(e,t,n,r){this.ray=new ug(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new wg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function mT(e,t){return e.distance-t.distance}function gT(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)gT(r[e],t,n,!0)}}dT.prototype=Object.assign(Object.create(Tx.prototype),{constructor:dT,isInstancedInterleavedBuffer:!0,copy:function(e){return Tx.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=Tx.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=Tx.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(pT.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(pT.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(fT.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,n){const r=n||[];return gT(e,this,r,t),r.sort(mT),r},intersectObjects:function(e,t,n){const r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=e.length;n<i;n++)gT(e[n],this,r,t);return r.sort(mT),r}});class vT{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Sm.clamp(t/this.radius,-1,1))),this}}const yT=new Em;function bT(e){kg.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}bT.prototype=Object.create(kg.prototype),bT.prototype.constructor=bT,bT.prototype.isImmediateRenderObject=!0;const xT=new Bm,_T=new hg,wT=new hg;function MT(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,MT(e.children[n]));return t}const TT=new Float32Array(1),ST=(new Int32Array(TT.buffer),Math.pow(2,8),[.125,.215,.35,.446,.526,.582]),ET=5+ST.length,{_lodPlanes:AT,_sizeLods:RT,_sigmas:LT}=CT();function CT(){const e=[],t=[],n=[];let r=8;for(let i=0;i<ET;i++){const o=Math.pow(2,r);t.push(o);let s=1/o;i>4?s=ST[i-8+4-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,u=[c,c,l,c,l,l,c,c,l,l,c,l],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,p*d*e),v.set(u,f*d*e);const i=[e,e,e,e,e,e];y.set(i,m*d*e)}const b=new Nv;b.setAttribute("position",new hv(g,p)),b.setAttribute("uv",new hv(v,f)),b.setAttribute("faceIndex",new hv(y,m)),e.push(b),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function PT(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),oM.call(this,e),this.type="catmullrom"}Math.sqrt(5),$w.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create($w.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(vM.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new N_;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.vertices.push(new Bm(r.x,r.y,r.z||0))}return t}}),Object.assign(yM.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(oM.prototype),Object.create(oM.prototype),PT.prototype=Object.create(oM.prototype),Object.assign(PT.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),class extends g_{constructor(e=10,t=10,n=4473924,r=8947848){n=new iv(n),r=new iv(r);const i=t/2,o=e/t,s=e/2,a=[],c=[];for(let e=0,l=0,u=-s;e<=t;e++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const t=e===i?n:r;t.toArray(c,l),l+=3,t.toArray(c,l),l+=3,t.toArray(c,l),l+=3,t.toArray(c,l),l+=3}const l=new Nv;l.setAttribute("position",new xv(a,3)),l.setAttribute("color",new xv(c,3)),super(l,new a_({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends g_{constructor(e){const t=MT(e),n=new Nv,r=[],i=[],o=new iv(0,0,1),s=new iv(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new xv(r,3)),n.setAttribute("color",new xv(i,3)),super(n,new a_({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");wT.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(_T.multiplyMatrices(wT,i.matrixWorld),xT.setFromMatrixPosition(_T),r.setXYZ(n,xT.x,xT.y,xT.z),_T.multiplyMatrices(wT,i.parent.matrixWorld),xT.setFromMatrixPosition(_T),r.setXYZ(n+1,xT.x,xT.y,xT.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Gw.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),kM(e)}}),Gw.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(class{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Em(1/0,1/0),this.max=void 0!==t?t:new Em(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=yT.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Em),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Em),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Em),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Em),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return yT.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(zm.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(ng.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),fy.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Object.assign(Sm,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Sm.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Sm.ceilPowerOfTwo(e)}}),Object.assign(Am.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign(hg.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Bm).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),zg.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(km.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(ug.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign($g.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign($g,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),$g.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),$g.getNormal(e,t,n,r)}}),Object.assign(bM.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new lw(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new pw(this,e)}}),Object.assign(Em.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Bm.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Nm.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(N_.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(kg.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(kg.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign($v.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties($v.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Wx.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(t_.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),$x.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty($w.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),sy.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(xM.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(hv.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===xm},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(xm)}}}),Object.assign(hv.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?xm:bm),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Nv.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new hv(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Nv.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(BM.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(fT.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(Tx.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===xm},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Tx.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?xm:bm),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(aw.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Mx.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(hT.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(av.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new iv}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(yw.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(vw.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(iy.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(_x.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(_x.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?vm:gm}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(dx.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Im.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(class extends kg{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new qM).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),cy.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},cy.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},Lm.crossOrigin=void 0,Lm.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Jw;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Lm.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Yw;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Lm.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Lm.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"124"}}));var OT=function(e){Gw.call(this,e),this.propertyNameMapping={}};OT.prototype=Object.assign(Object.create(Gw.prototype),{constructor:OT,load:function(e,t,n,r){var i=this,o=new Vw(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",n=0,r=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==r&&(t=r[1],n=new Blob([r[0]]).size);for(var i,o,s,a,c,l,h={comments:[],elements:[],headerLength:n,objInfo:""},d=t.split("\n"),p=0;p<d.length;p++){var f=d[p];if(""!==(f=f.trim()))switch(o=(s=f.split(/\s+/)).shift(),f=s.join(" "),o){case"format":h.format=s[0],h.version=s[1];break;case"comment":h.comments.push(f);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=s[0],i.count=parseInt(s[1]),i.properties=[];break;case"property":i.properties.push((a=s,c=u.propertyNameMapping,l=void 0,"list"===(l={type:a[0]}).type?(l.name=a[3],l.countType=a[1],l.itemType=a[2]):l.name=a[1],l.name in c&&(l.name=c[l.name]),l));break;case"obj_info":h.objInfo=f;break;default:console.log("unhandled",o,s)}}return void 0!==i&&h.elements.push(i),h}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){for(var r=t.split(/\s+/),i={},o=0;o<e.length;o++)if("list"===e[o].type){for(var s=[],a=n(r.shift(),e[o].countType),c=0;c<a;c++)s.push(n(r.shift(),e[o].itemType));i[e[o].name]=s}else i[e[o].name]=n(r.shift(),e[o].type);return i}function i(e,t){var n,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},a="";null!==(n=/end_header\s([\s\S]*)$/.exec(e))&&(a=n[1]);for(var c=a.split("\n"),l=0,u=0,h=0;h<c.length;h++){var d=c[h];if(""!==(d=d.trim())){u>=t.elements[l].count&&(l++,u=0);var p=r(t.elements[l].properties,d);s(i,t.elements[l].name,p),u++}}return o(i)}function o(e){var t=new Nv;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new xv(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new xv(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new xv(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new xv(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new xv(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function s(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){var r=n.vertex_indices||n.vertex_index,i=n.texcoord;3===r.length?(e.indices.push(r[0],r[1],r[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===r.length&&(e.indices.push(r[0],r[1],r[3]),e.indices.push(r[1],r[2],r[3]))}}function a(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function c(e,t,n,r){for(var i,o={},s=0,c=0;c<n.length;c++)if("list"===n[c].type){var l=[],u=(i=a(e,t+s,n[c].countType,r))[0];s+=i[1];for(var h=0;h<u;h++)i=a(e,t+s,n[c].itemType,r),l.push(i[0]),s+=i[1];o[n[c].name]=l}else i=a(e,t+s,n[c].type,r),o[n[c].name]=i[0],s+=i[1];return[o,s]}var l,u=this;if(e instanceof ArrayBuffer){var h=DM(new Uint8Array(e)),d=t(h);l="ascii"===d.format?i(h,d):function(e,t){for(var n,r={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),l=0,u=0;u<t.elements.length;u++)for(var h=0;h<t.elements[u].count;h++){l+=(n=c(a,l,t.elements[u].properties,i))[1];var d=n[0];s(r,t.elements[u].name,d)}return o(r)}(e,d)}else l=i(e,t(e));return l}});var NT,IT,DT,kT,BT,UT,FT=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},zT=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},HT=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let GT=class extends jf{constructor(){super(...arguments),NT.add(this),this.src="",IT.set(this,0)}requiredElementType(){return[zp]}_createComponent(){return this.model?this.model:new lp}loadGL(){super.loadGL(),this.loader=new OT,this.createEffect((()=>{var e;this.src,zT(this,NT,"m",DT).call(this),HT(this,IT,(e=zT(this,IT,"f"),++e),"f"),zT(this,NT,"m",kT).call(this)}))}unloadGL(){var e;super.unloadGL(),this.loader=void 0,zT(this,NT,"m",DT).call(this),HT(this,IT,(e=zT(this,IT,"f"),++e),"f")}};IT=new WeakMap,NT=new WeakSet,DT=function(){this.model=void 0},kT=function(){const{src:e}=this,t=zT(this,IT,"f");e&&(console.log("load the model!"),this.loader.load(e,(e=>t===zT(this,IT,"f")&&zT(this,NT,"m",UT).call(this,e)),(e=>t===zT(this,IT,"f")&&this.element.emit(Wi.PROGRESS,e)),(e=>t===zT(this,IT,"f")&&zT(this,NT,"m",BT).call(this,e))))},BT=function(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=e instanceof ErrorEvent&&e.error?e.error:e;console.error(n),this.element.emit(Wi.MODEL_ERROR,n)},UT=function(e){this.model=e,this.model.computeVertexNormals(),this.resetMeshComponent(),this.element.emit(Wi.MODEL_LOAD,{format:"ply",model:e})},FT([_f(""),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],GT.prototype,"src",void 0),GT=FT([In],GT),elementBehaviors.has("ply-geometry")||elementBehaviors.define("ply-geometry",GT);class jT extends lp{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,s=Math.floor(n),a=Math.floor(r),c=s+1,l=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<l;e++){const t=e*h-o;for(let n=0;n<c;n++){const r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+c*e,r=t+c*(e+1),i=t+1+c*(e+1),o=t+1+c*e;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new Jd(p,3)),this.setAttribute("normal",new Jd(f,3)),this.setAttribute("uv",new Jd(m,2))}}class VT extends Jp{constructor(e,t,n,r){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new jT(e,t,n,r)),this.mergeVertices()}}class WT extends jf{_createComponent(){return new VT(this.element.calculatedSize.x,this.element.calculatedSize.y)}}function qT(){this.type="Curve",this.arcLengthDivisions=200}function XT(e,t,n,r,i,o,s,a){qT.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function YT(e,t,n,r,i,o){XT.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function ZT(){let e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){let c=(t-e)/o-(n-e)/(o+s)+(n-t)/s,l=(n-t)/s-(r-t)/(s+a)+(r-n)/a;c*=s,l*=s,i(t,n,c,l)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}elementBehaviors.has("plane-geometry")||elementBehaviors.define("plane-geometry",WT),Object.assign(qT.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let s,a=0,c=i-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(r=c,n[r]===o)return r/(i-1);const l=n[r];return(r+(o-l)/(n[r+1]-l))/(i-1)},getTangent:function(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),s=this.getPoint(i),a=t||(o.isVector2?new zu:new $i);return a.copy(s).sub(o).normalize(),a},getTangentAt:function(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){const n=new $i,r=[],i=[],o=[],s=new $i,a=new eo;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new $i),r[t].normalize()}i[0]=new $i,o[0]=new $i;let c=Number.MAX_VALUE;const l=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Zi.clamp(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Zi.clamp(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),XT.prototype=Object.create(qT.prototype),XT.prototype.constructor=XT,XT.prototype.isEllipseCurve=!0,XT.prototype.getPoint=function(e,t){const n=t||new zu,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=c-this.aY;a=n*e-r*t+this.aX,c=n*t+r*e+this.aY}return n.set(a,c)},XT.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},XT.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},XT.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},YT.prototype=Object.create(XT.prototype),YT.prototype.constructor=YT,YT.prototype.isArcCurve=!0;const JT=new $i,$T=new ZT,KT=new ZT,QT=new ZT;function eS(e=[],t=!1,n="centripetal",r=.5){qT.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}function tS(e,t,n,r,i){const o=.5*(r-t),s=.5*(i-n),a=e*e;return(2*n-2*r+o+s)*(e*a)+(-3*n+3*r-2*o-s)*a+o*e+n}function nS(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function rS(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function iS(e=new zu,t=new zu,n=new zu,r=new zu){qT.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function oS(e=new $i,t=new $i,n=new $i,r=new $i){qT.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function sS(e=new zu,t=new zu){qT.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function aS(e=new $i,t=new $i){qT.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function cS(e=new zu,t=new zu,n=new zu){qT.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}function lS(e=new $i,t=new $i,n=new $i){qT.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}function uS(e=[]){qT.call(this),this.type="SplineCurve",this.points=e}function hS(){qT.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function dS(e){hS.call(this),this.type="Path",this.currentPoint=new zu,e&&this.setFromPoints(e)}function pS(e){dS.call(this,e),this.uuid=Zi.generateUUID(),this.type="Shape",this.holes=[]}eS.prototype=Object.create(qT.prototype),eS.prototype.constructor=eS,eS.prototype.isCatmullRomCurve3=!0,eS.prototype.getPoint=function(e,t=new $i){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let s,a,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===l&&c===i-1&&(c=i-2,l=1),this.closed||c>0?s=r[(c-1)%i]:(JT.subVectors(r[0],r[1]).add(r[0]),s=JT);const u=r[c%i],h=r[(c+1)%i];if(this.closed||c+2<i?a=r[(c+2)%i]:(JT.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=JT),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(h),e),r=Math.pow(h.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),$T.initNonuniformCatmullRom(s.x,u.x,h.x,a.x,t,n,r),KT.initNonuniformCatmullRom(s.y,u.y,h.y,a.y,t,n,r),QT.initNonuniformCatmullRom(s.z,u.z,h.z,a.z,t,n,r)}else"catmullrom"===this.curveType&&($T.initCatmullRom(s.x,u.x,h.x,a.x,this.tension),KT.initCatmullRom(s.y,u.y,h.y,a.y,this.tension),QT.initCatmullRom(s.z,u.z,h.z,a.z,this.tension));return n.set($T.calc(l),KT.calc(l),QT.calc(l)),n},eS.prototype.copy=function(e){qT.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},eS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},eS.prototype.fromJSON=function(e){qT.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new $i).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},iS.prototype=Object.create(qT.prototype),iS.prototype.constructor=iS,iS.prototype.isCubicBezierCurve=!0,iS.prototype.getPoint=function(e,t=new zu){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(rS(e,r.x,i.x,o.x,s.x),rS(e,r.y,i.y,o.y,s.y)),n},iS.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},iS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},iS.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},oS.prototype=Object.create(qT.prototype),oS.prototype.constructor=oS,oS.prototype.isCubicBezierCurve3=!0,oS.prototype.getPoint=function(e,t=new $i){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(rS(e,r.x,i.x,o.x,s.x),rS(e,r.y,i.y,o.y,s.y),rS(e,r.z,i.z,o.z,s.z)),n},oS.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},oS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},oS.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},sS.prototype=Object.create(qT.prototype),sS.prototype.constructor=sS,sS.prototype.isLineCurve=!0,sS.prototype.getPoint=function(e,t=new zu){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},sS.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},sS.prototype.getTangent=function(e,t){const n=t||new zu;return n.copy(this.v2).sub(this.v1).normalize(),n},sS.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},sS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},sS.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},aS.prototype=Object.create(qT.prototype),aS.prototype.constructor=aS,aS.prototype.isLineCurve3=!0,aS.prototype.getPoint=function(e,t=new $i){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},aS.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},aS.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},aS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},aS.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},cS.prototype=Object.create(qT.prototype),cS.prototype.constructor=cS,cS.prototype.isQuadraticBezierCurve=!0,cS.prototype.getPoint=function(e,t=new zu){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(nS(e,r.x,i.x,o.x),nS(e,r.y,i.y,o.y)),n},cS.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},cS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},cS.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},lS.prototype=Object.create(qT.prototype),lS.prototype.constructor=lS,lS.prototype.isQuadraticBezierCurve3=!0,lS.prototype.getPoint=function(e,t=new $i){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(nS(e,r.x,i.x,o.x),nS(e,r.y,i.y,o.y),nS(e,r.z,i.z,o.z)),n},lS.prototype.copy=function(e){return qT.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},lS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},lS.prototype.fromJSON=function(e){return qT.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},uS.prototype=Object.create(qT.prototype),uS.prototype.constructor=uS,uS.prototype.isSplineCurve=!0,uS.prototype.getPoint=function(e,t=new zu){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],c=r[o],l=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(tS(s,a.x,c.x,l.x,u.x),tS(s,a.y,c.y,l.y,u.y)),n},uS.prototype.copy=function(e){qT.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this},uS.prototype.toJSON=function(){const e=qT.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e},uS.prototype.fromJSON=function(e){qT.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new zu).fromArray(n))}return this},hS.prototype=Object.assign(Object.create(qT.prototype),{constructor:hS,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new sS(t,e))},getPoint:function(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],o=i.getLength(),s=0===o?0:1-e/o;return i.getPointAt(s)}r++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){qT.prototype.copy.call(this,e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=qT.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(t){qT.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let n=0,r=t.curves.length;n<r;n++){const r=t.curves[n];this.curves.push((new e[r.type]).fromJSON(r))}return this}}),dS.prototype=Object.assign(Object.create(hS.prototype),{constructor:dS,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const n=new sS(this.currentPoint.clone(),new zu(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){const i=new cS(this.currentPoint.clone(),new zu(e,t),new zu(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){const s=new iS(this.currentPoint.clone(),new zu(e,t),new zu(n,r),new zu(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this},splineThru:function(e){const t=new uS([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+c,t+l,n,r,i,o,s,a),this},absellipse:function(e,t,n,r,i,o,s,a){const c=new XT(e,t,n,r,i,o,s,a);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(e){return hS.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=hS.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return hS.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),pS.prototype=Object.assign(Object.create(dS.prototype),{constructor:pS,getPointsHoles:function(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){dS.prototype.copy.call(this,e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){const e=dS.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){dS.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new dS).fromJSON(n))}return this}});function fS(e,t,n,r,i){let o,s;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)s=DS(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=DS(o,e[o],e[o+1],s);return s&&LS(s,s.next)&&(kS(s),s=s.next),s}function mS(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!LS(r,r.next)&&0!==RS(r.prev,r,r.next))r=r.next;else{if(kS(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function gS(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=TS(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,s,a,c,l=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<l&&(a++,r=r.nextZ,r);t++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1)}(i)}(e,r,i,o);let a,c,l=e;for(;e.prev!==e.next;)if(a=e.prev,c=e.next,o?yS(e,r,i,o):vS(e))t.push(a.i/n),t.push(e.i/n),t.push(c.i/n),kS(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?gS(e=bS(mS(e),t,n),t,n,r,i,o,2):2===s&&xS(e,t,n,r,i,o):gS(mS(e),t,n,r,i,o,1);break}}function vS(e){const t=e.prev,n=e,r=e.next;if(RS(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(ES(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&RS(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function yS(e,t,n,r){const i=e.prev,o=e,s=e.next;if(RS(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=TS(a,c,t,n,r),d=TS(l,u,t,n,r);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&ES(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&RS(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&ES(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&RS(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&ES(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&RS(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&ES(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&RS(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function bS(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!LS(i,o)&&CS(i,r,r.next,o)&&NS(i,o)&&NS(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),kS(r),kS(r.next),r=e=o),r=r.next}while(r!==e);return mS(r)}function xS(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&AS(s,e)){let a=IS(s,e);return s=mS(s,s.next),a=mS(a,a.next),gS(s,t,n,r,i,o),void gS(a,t,n,r,i,o)}e=e.next}s=s.next}while(s!==e)}function _S(e,t){return e.x-t.x}function wS(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s){if(s=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===s)return o;const a=o,c=o.x,l=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=c&&r!==n.x&&ES(i<l?r:s,i,c,l,i<l?s:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),NS(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&MS(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(e,t),t){const n=IS(t,e);mS(t,t.next),mS(n,n.next)}}function MS(e,t){return RS(e.prev,e,t.prev)<0&&RS(t.next,e,e.next)<0}function TS(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function SS(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function ES(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function AS(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&CS(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(NS(e,t)&&NS(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(RS(e.prev,e,t.prev)||RS(e,t.prev,t))||LS(e,t)&&RS(e.prev,e,e.next)>0&&RS(t.prev,t,t.next)>0)}function RS(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function LS(e,t){return e.x===t.x&&e.y===t.y}function CS(e,t,n,r){const i=OS(RS(e,t,n)),o=OS(RS(e,t,r)),s=OS(RS(n,r,e)),a=OS(RS(n,r,t));return i!==o&&s!==a||!(0!==i||!PS(e,n,t))||!(0!==o||!PS(e,r,t))||!(0!==s||!PS(n,e,r))||!(0!==a||!PS(n,t,r))}function PS(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function OS(e){return e>0?1:e<0?-1:0}function NS(e,t){return RS(e.prev,e,e.next)<0?RS(e,t,e.next)>=0&&RS(e,e.prev,t)>=0:RS(e,t,e.prev)<0||RS(e,e.next,t)<0}function IS(e,t){const n=new BS(e.i,e.x,e.y),r=new BS(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function DS(e,t,n,r){const i=new BS(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function kS(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function BS(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const US={area:function(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return US.area(e)<0},triangulateShape:function(e,t){const n=[],r=[],i=[];FS(e),zS(n,e);let o=e.length;t.forEach(FS);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,zS(n,t[e]);const s=function(e,t,n){n=n||2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=fS(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,d,p;if(r&&(o=function(e,t,n,r){const i=[];let o,s,a,c,l;for(o=0,s=t.length;o<s;o++)a=t[o]*r,c=o<s-1?t[o+1]*r:e.length,l=fS(e,a,c,r,!1),l===l.next&&(l.steiner=!0),i.push(SS(l));for(i.sort(_S),o=0;o<i.length;o++)wS(i[o],n),n=mS(n,n.next);return n}(e,t,o,n)),e.length>80*n){a=l=e[0],c=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=0!==p?1/p:0}return gS(o,s,n,a,c,p),s}(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}};function FS(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function zS(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class HS extends lp{constructor(e,t){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)o(e[t]);function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let c=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:GS;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);let g,v,y,b,x,_=!1;f&&(g=f.getSpacedPoints(a),_=!0,l=!1,v=f.computeFrenetFrames(a,!1),y=new $i,b=new $i,x=new $i),l||(p=0,u=0,h=0,d=0);const w=e.extractPoints(s);let M=w.shape;const T=w.holes;if(!US.isClockWise(M)){M=M.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];US.isClockWise(t)&&(T[e]=t.reverse())}}const S=US.triangulateShape(M,T),E=M;for(let e=0,t=T.length;e<t;e++){const t=T[e];M=M.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const R=M.length,L=S.length;function C(e,t,n){let r,i,o;const s=e.x-t.x,a=e.y-t.y,c=n.x-e.x,l=n.y-e.y,u=s*s+a*a,h=s*l-a*c;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(c*c+l*l),p=t.x-a/h,f=t.y+s/h,m=((n.x-l/d-p)*l-(n.y+c/d-f)*c)/(s*l-a*c);r=p+s*m-e.x,i=f+a*m-e.y;const g=r*r+i*i;if(g<=2)return new zu(r,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?c>Number.EPSILON&&(e=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(l)&&(e=!0),e?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new zu(r/o,i/o)}const P=[];for(let e=0,t=E.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),P[e]=C(E[e],E[n],E[r]);const O=[];let N,I=P.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];N=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[e]=C(t[e],t[r],t[i]);O.push(N),I=I.concat(N)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],P[e],r);B(t.x,t.y,-n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];N=O[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],N[e],r);B(i.x,i.y,-n)}}}const D=h+d;for(let e=0;e<R;e++){const t=l?A(M[e],I[e],D):M[e];_?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(b).add(y),B(x.x,x.y,x.z)):B(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<R;t++){const n=l?A(M[t],I[t],D):M[t];_?(b.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(b).add(y),B(x.x,x.y,x.z)):B(n.x,n.y,c/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],P[e],r);B(t.x,t.y,c+n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];N=O[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],N[e],r);_?B(i.x,i.y+g[a-1].y,g[a-1].x+n):B(i.x,i.y,c+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=R*e,o=R*(e+1);F(t+r+n,t+i+n,t+i+o,t+r+o)}}}function B(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,i){z(e),z(t),z(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[2])}function F(e,t,i,o){z(e),z(t),z(o),z(t),z(i),z(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function z(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function H(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(l){let e=0,t=R*e;for(let e=0;e<L;e++){const n=S[e];U(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=R*e;for(let e=0;e<L;e++){const n=S[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<L;e++){const t=S[e];U(t[2],t[1],t[0])}for(let e=0;e<L;e++){const t=S[e];U(t[0]+R*a,t[1]+R*a,t[2]+R*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;k(E,t),t+=E.length;for(let e=0,n=T.length;e<n;e++){const n=T[e];k(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Jd(r,3)),this.setAttribute("uv",new Jd(i,2)),this.computeVertexNormals()}toJSON(){const e=lp.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}const GS={generateTopUV:function(e,t,n,r,i){const o=t[3*n],s=t[3*n+1],a=t[3*r],c=t[3*r+1],l=t[3*i],u=t[3*i+1];return[new zu(o,s),new zu(a,c),new zu(l,u)]},generateSideWallUV:function(e,t,n,r,i,o){const s=t[3*n],a=t[3*n+1],c=t[3*n+2],l=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<.01?[new zu(s,1-c),new zu(l,1-h),new zu(d,1-f),new zu(m,1-v)]:[new zu(a,1-c),new zu(u,1-h),new zu(p,1-f),new zu(g,1-v)]}};class jS extends Jp{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new HS(e,t)),this.mergeVertices()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}class VS extends lp{constructor(e,t=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))c(e);else for(let t=0;t<e.length;t++)c(e[t]),this.addGroup(s,a,t),s+=a,a=0;function c(e){const s=r.length/3,c=e.extractPoints(t);let l=c.shape;const u=c.holes;!1===US.isClockWise(l)&&(l=l.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===US.isClockWise(t)&&(u[e]=t.reverse())}const h=US.triangulateShape(l,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];l=l.concat(t)}for(let e=0,t=l.length;e<t;e++){const t=l[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+s,i=t[1]+s,o=t[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Jd(r,3)),this.setAttribute("normal",new Jd(i,3)),this.setAttribute("uv",new Jd(o,2))}toJSON(){const e=lp.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class WS extends Jp{constructor(e,t){super(),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new VS(e,t)),this.mergeVertices()}toJSON(){const e=Jp.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}var qS,XS=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},YS=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ZS=class extends jf{constructor(){super(...arguments),this.cornerRadius=0,this.thickness=0,qS.set(this,!1)}get quadraticCorners(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,qS,"f")}set quadraticCorners(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,qS,null!==e&&"false"!==e,"f")}loadGL(){super.loadGL(),this.createEffect((()=>{this.cornerRadius,this.thickness,this.quadraticCorners,this.resetMeshComponent()}))}_createComponent(){let e,t=this.thickness;const n=new JS(0,0,this.element.calculatedSize.x,this.element.calculatedSize.y,this.cornerRadius,this.quadraticCorners);return e=t>0?new jS(n,{bevelEnabled:!0,steps:1,bevelSegments:1,bevelSize:0,bevelThickness:0,depth:t}):new WS(n),e.translate(-this.element.calculatedSize.x/2,-this.element.calculatedSize.y/2,-t/2),e}};qS=new WeakMap,XS([xf({from:Number}),YS("design:type",Object)],ZS.prototype,"cornerRadius",void 0),XS([xf({from:Number}),YS("design:type",Object)],ZS.prototype,"thickness",void 0),XS([xf,YS("design:type",Boolean),YS("design:paramtypes",[Boolean])],ZS.prototype,"quadraticCorners",null),ZS=XS([In],ZS),elementBehaviors.has("rounded-rectangle-geometry")||elementBehaviors.define("rounded-rectangle-geometry",ZS);class JS extends pS{constructor(e,t,n,r,i,o=!1){if(super(),o)return this.moveTo(e,t+i),this.lineTo(e,t+r-i),this.quadraticCurveTo(e,t+r,e+i,t+r),this.lineTo(e+n-i,t+r),this.quadraticCurveTo(e+n,t+r,e+n,t+r-i),this.lineTo(e+n,t+i),this.quadraticCurveTo(e+n,t,e+n-i,t),this.lineTo(e+i,t),void this.quadraticCurveTo(e,t,e,t+i);this.absarc(e+n-i,t+i,i,-Math.PI/2,0,!1),this.absarc(e+n-i,t+r-i,i,0,Math.PI/2,!1),this.absarc(e+i,t+r-i,i,Math.PI/2,Math.PI,!1),this.absarc(e+i,t+i,i,Math.PI,Math.PI+Math.PI/2,!1),this.lineTo(e+n-i,t)}}function $S(){this.type="ShapePath",this.color=new Xu,this.subPaths=[],this.currentPath=null}Object.assign($S.prototype,{moveTo:function(e,t){return this.currentPath=new dS,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new pS;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],s=t[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=t[o],a=-a,s=t[i],c=-c),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=c*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const i=US.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,c;const l=[];if(1===o.length)return a=o[0],c=new pS,c.curves=a.curves,l.push(c),l;let u=!i(o[0].getPoints());u=e?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)a=o[t],p=a.getPoints(),s=i(p),s=e?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new pS,p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<d.length;i++)r(s.p,d[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):e=!0);a&&h[n].push(s)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){c=d[e].s,l.push(c),f=m[e];for(let e=0,t=f.length;e<t;e++)c.holes.push(f[e].h)}return l}});var KS=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},QS=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const eE=new pS;eE.moveTo(5,5),eE.bezierCurveTo(5,5,4,0,0,0),eE.bezierCurveTo(-6,0,-6,7,-6,7),eE.bezierCurveTo(-6,11,-3,15.4,5,19),eE.bezierCurveTo(12,15.4,16,11,16,7),eE.bezierCurveTo(16,7,16,0,10,0),eE.bezierCurveTo(7,0,5,5,5,5);const tE=new pS,nE=/^[mlhvcsqtaz][^a-z]/i;let rE=class extends jf{constructor(){super(...arguments),this.__shape=(new pS).copy(eE),this.curveSegments=8,this.bevel=!1,this.bevelSegments=4,this.bevelThickness=4,this.centerGeometry=!0,this.fitment="none"}get shape(){return this.__shape}set shape(e){var t;if(e)if("string"==typeof e&&(e=e.trim())&&e.match(nE)){const n=function(e){const t=new $S,n=new zu,r=new zu,i=new zu;let o=!0,s=!1;if(!e)return console.error("Path has not `d` attribute."),t;const a=e.match(/[a-df-z][^a-df-z]*/gi);if(!a)return console.error("Empty or invalid path: ",e),t;for(let e=0,c=a.length;e<c;e++){const c=a[e],l=c.charAt(0),u=c.slice(1).trim();let h;switch(!0===o&&(s=!0,o=!1),l){case"M":h=iE(u);for(let e=0,o=h.length;e<o;e+=2)n.x=h[e+0],n.y=h[e+1],r.x=n.x,r.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&i.copy(n);break;case"H":h=iE(u);for(let e=0,o=h.length;e<o;e++)n.x=h[e],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===s&&i.copy(n);break;case"V":h=iE(u);for(let e=0,o=h.length;e<o;e++)n.y=h[e],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===s&&i.copy(n);break;case"L":h=iE(u);for(let e=0,o=h.length;e<o;e+=2)n.x=h[e+0],n.y=h[e+1],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===s&&i.copy(n);break;case"C":h=iE(u);for(let e=0,o=h.length;e<o;e+=6)t.bezierCurveTo(h[e+0],h[e+1],h[e+2],h[e+3],h[e+4],h[e+5]),r.x=h[e+2],r.y=h[e+3],n.x=h[e+4],n.y=h[e+5],0===e&&!0===s&&i.copy(n);break;case"S":h=iE(u);for(let e=0,o=h.length;e<o;e+=4)t.bezierCurveTo(sE(n.x,r.x),sE(n.y,r.y),h[e+0],h[e+1],h[e+2],h[e+3]),r.x=h[e+0],r.y=h[e+1],n.x=h[e+2],n.y=h[e+3],0===e&&!0===s&&i.copy(n);break;case"Q":h=iE(u);for(let e=0,o=h.length;e<o;e+=4)t.quadraticCurveTo(h[e+0],h[e+1],h[e+2],h[e+3]),r.x=h[e+0],r.y=h[e+1],n.x=h[e+2],n.y=h[e+3],0===e&&!0===s&&i.copy(n);break;case"T":h=iE(u);for(let e=0,o=h.length;e<o;e+=2){const o=sE(n.x,r.x),a=sE(n.y,r.y);t.quadraticCurveTo(o,a,h[e+0],h[e+1]),r.x=o,r.y=a,n.x=h[e+0],n.y=h[e+1],0===e&&!0===s&&i.copy(n)}break;case"A":h=iE(u,[3,4],7);for(let e=0,o=h.length;e<o;e+=7){if(h[e+5]==n.x&&h[e+6]==n.y)continue;const o=n.clone();n.x=h[e+5],n.y=h[e+6],r.x=n.x,r.y=n.y,oE(t,h[e],h[e+1],h[e+2],h[e+3],h[e+4],o,n),0===e&&!0===s&&i.copy(n)}break;case"m":h=iE(u);for(let e=0,o=h.length;e<o;e+=2)n.x+=h[e+0],n.y+=h[e+1],r.x=n.x,r.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&i.copy(n);break;case"h":h=iE(u);for(let e=0,o=h.length;e<o;e++)n.x+=h[e],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===s&&i.copy(n);break;case"v":h=iE(u);for(let e=0,o=h.length;e<o;e++)n.y+=h[e],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===s&&i.copy(n);break;case"l":h=iE(u);for(let e=0,o=h.length;e<o;e+=2)n.x+=h[e+0],n.y+=h[e+1],r.x=n.x,r.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===s&&i.copy(n);break;case"c":h=iE(u);for(let e=0,o=h.length;e<o;e+=6)t.bezierCurveTo(n.x+h[e+0],n.y+h[e+1],n.x+h[e+2],n.y+h[e+3],n.x+h[e+4],n.y+h[e+5]),r.x=n.x+h[e+2],r.y=n.y+h[e+3],n.x+=h[e+4],n.y+=h[e+5],0===e&&!0===s&&i.copy(n);break;case"s":h=iE(u);for(let e=0,o=h.length;e<o;e+=4)t.bezierCurveTo(sE(n.x,r.x),sE(n.y,r.y),n.x+h[e+0],n.y+h[e+1],n.x+h[e+2],n.y+h[e+3]),r.x=n.x+h[e+0],r.y=n.y+h[e+1],n.x+=h[e+2],n.y+=h[e+3],0===e&&!0===s&&i.copy(n);break;case"q":h=iE(u);for(let e=0,o=h.length;e<o;e+=4)t.quadraticCurveTo(n.x+h[e+0],n.y+h[e+1],n.x+h[e+2],n.y+h[e+3]),r.x=n.x+h[e+0],r.y=n.y+h[e+1],n.x+=h[e+2],n.y+=h[e+3],0===e&&!0===s&&i.copy(n);break;case"t":h=iE(u);for(let e=0,o=h.length;e<o;e+=2){const o=sE(n.x,r.x),a=sE(n.y,r.y);t.quadraticCurveTo(o,a,n.x+h[e+0],n.y+h[e+1]),r.x=o,r.y=a,n.x=n.x+h[e+0],n.y=n.y+h[e+1],0===e&&!0===s&&i.copy(n)}break;case"a":h=iE(u,[3,4],7);for(let e=0,o=h.length;e<o;e+=7){if(0==h[e+5]&&0==h[e+6])continue;const o=n.clone();n.x+=h[e+5],n.y+=h[e+6],r.x=n.x,r.y=n.y,oE(t,h[e],h[e+1],h[e+2],h[e+3],h[e+4],o,n),0===e&&!0===s&&i.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(i),t.currentPath.currentPoint.copy(n),o=!0);break;default:console.warn(c)}s=!1}return t}(e);this.__shape.copy(null!==(t=n.toShapes(!0)[0])&&void 0!==t?t:eE)}else if("string"!=typeof e||e.match(/^[0-9]/))if("string"==typeof e||Array.isArray(e)){const t="string"==typeof e?Qp(e,"shape"):e;if(t.length){if(t.length%2!=0)throw new Error("shape path must have an even number of numbers, each pair of numbers being a point.");if(this.__shape.copy(tE),this.__shape.moveTo(t[0],t[1]),t.length>2)for(let e=2;e<t.length;e+=2)this.__shape.lineTo(t[e],t[e+1])}else this.__shape.copy(eE)}else this.__shape!==e&&this.__shape.copy(e);else console.error("Unsupported shape path: ",e),this.__shape.copy(eE);else this.__shape.copy(eE);this.__shape.updateArcLengths()}_createComponent(){let e;if(e=0===this.element.calculatedSize.z?new WS(this.shape,this.curveSegments):new jS(this.shape,{curveSegments:this.curveSegments,bevelSegments:this.bevelSegments,bevelThickness:this.bevelThickness,bevelEnabled:this.bevel,depth:this.element.calculatedSize.z}),this.centerGeometry&&e.center(),e.scale(1,-1,1),function(e){for(const t of e.faces){t.normal.x*=-1,t.normal.y*=-1,t.normal.z*=-1;const e=t.a;t.a=t.c,t.c=e}const t=e.faceVertexUvs[0];for(let e=0;e<t.length;e++){const n=t[e][0];t[e][0]=t[e][2],t[e][2]=n}e.verticesNeedUpdate=!0,e.normalsNeedUpdate=!0}(e),"none"===this.fitment)return e;let t=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(const o of e.vertices)t=o.x<t?o.x:t,n=o.x>n?o.x:n,r=o.y<r?o.y:r,i=o.y>i?o.y:i;const o=n-t,s=i-r,a=o/this.element.calculatedSize.x,c=s/this.element.calculatedSize.y;if("fill"===this.fitment)return e.scale(1/a,1/c,1),e;const l=o/s,u=this.element.calculatedSize.x/this.element.calculatedSize.y;return"contain"===this.fitment?l<u?e.scale(1/c,1/c,1):e.scale(1/a,1/a,1):"cover"===this.fitment?l<u?e.scale(1/a,1/a,1):e.scale(1/c,1/c,1):"scale-down"===this.fitment&&(o<=this.element.calculatedSize.x&&s<=this.element.calculatedSize.y||(l<u?e.scale(1/c,1/c,1):e.scale(1/a,1/a,1))),e}loadGL(){super.loadGL(),this.createEffect((()=>{this.shape,this.curveSegments,this.bevel,this.bevelSegments,this.bevelThickness,this.centerGeometry,this.element.calculatedSize,Hn((()=>this.resetMeshComponent()))}))}};function iE(e,t,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const r={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let i=0,o=!0,s="",a="";const c=[];class l extends SyntaxError{}function u(e,t,n){const r=new l('Unexpected character "'+e+'" at index '+t+".");throw r.partial=n,r}function h(){""!==s&&(""===a?c.push(Number(s)):c.push(Number(s)*Math.pow(10,Number(a)))),s="",a=""}let d;const p=e.length;for(let l=0;l<p;l++)if(d=e[l],Array.isArray(t)&&t.includes(c.length%n)&&r.FLAGS.test(d))i=1,s=d,h();else{if(0===i){if(r.WHITESPACE.test(d))continue;if(r.DIGIT.test(d)||r.SIGN.test(d)){i=1,s=d;continue}if(r.POINT.test(d)){i=2,s=d;continue}r.COMMA.test(d)&&(o&&u(d,l,c),o=!0)}if(1===i){if(r.DIGIT.test(d)){s+=d;continue}if(r.POINT.test(d)){s+=d,i=2;continue}if(r.EXP.test(d)){i=3;continue}r.SIGN.test(d)&&1===s.length&&r.SIGN.test(s[0])&&u(d,l,c)}if(2===i){if(r.DIGIT.test(d)){s+=d;continue}if(r.EXP.test(d)){i=3;continue}r.POINT.test(d)&&"."===s[s.length-1]&&u(d,l,c)}if(3===i){if(r.DIGIT.test(d)){a+=d;continue}if(r.SIGN.test(d)){if(""===a){a+=d;continue}1===a.length&&r.SIGN.test(a)&&u(d,l,c)}}r.WHITESPACE.test(d)?(h(),i=0,o=!1):r.COMMA.test(d)?(h(),i=0,o=!0):r.SIGN.test(d)?(h(),i=1,s=d):r.POINT.test(d)?(h(),i=2,s=d):u(d,l,c)}return h(),c}function oE(e,t,n,r,i,o,s,a){if(0==t||0==n)return void e.lineTo(a.x,a.y);r=r*Math.PI/180,t=Math.abs(t),n=Math.abs(n);const c=(s.x-a.x)/2,l=(s.y-a.y)/2,u=Math.cos(r)*c+Math.sin(r)*l,h=-Math.sin(r)*c+Math.cos(r)*l;let d=t*t,p=n*n;const f=u*u,m=h*h,g=f/d+m/p;if(g>1){const e=Math.sqrt(g);d=(t*=e)*t,p=(n*=e)*n}const v=d*m+p*f,y=(d*p-v)/v;let b=Math.sqrt(Math.max(0,y));i===o&&(b=-b);const x=b*t*h/n,_=-b*n*u/t,w=Math.cos(r)*x-Math.sin(r)*_+(s.x+a.x)/2,M=Math.sin(r)*x+Math.cos(r)*_+(s.y+a.y)/2,T=aE(1,0,(u-x)/t,(h-_)/n),S=aE((u-x)/t,(h-_)/n,(-u-x)/t,(-h-_)/n)%(2*Math.PI);e.currentPath.absellipse(w,M,t,n,T,T+S,0===o,r)}function sE(e,t){return e-(t-e)}function aE(e,t,n,r){const i=e*n+t*r,o=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r);let s=Math.acos(Math.max(-1,Math.min(1,i/o)));return e*r-t*n<0&&(s=-s),s}KS([xf,QS("design:type",Object),QS("design:paramtypes",[Object])],rE.prototype,"shape",null),KS([wf(8),QS("design:type",Object)],rE.prototype,"curveSegments",void 0),KS([Mf(!1),QS("design:type",Object)],rE.prototype,"bevel",void 0),KS([wf(4),QS("design:type",Object)],rE.prototype,"bevelSegments",void 0),KS([wf(4),QS("design:type",Object)],rE.prototype,"bevelThickness",void 0),KS([Mf(!0),QS("design:type",Object)],rE.prototype,"centerGeometry",void 0),KS([_f("none"),QS("design:type",String)],rE.prototype,"fitment",void 0),rE=KS([In],rE),elementBehaviors.has("shape-geometry")||elementBehaviors.define("shape-geometry",rE);class cE extends lp{constructor(e=1,t=8,n=6,r=0,i=2*Math.PI,o=0,s=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let c=0;const l=[],u=new $i,h=new $i,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==o?y=.5/t:d==n&&a==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(r+a*i)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(r+a*i)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(c++)}l.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=l[e][r+1],i=l[e][r],s=l[e+1][r],c=l[e+1][r+1];(0!==e||o>0)&&d.push(t,i,c),(e!==n-1||a<Math.PI)&&d.push(i,s,c)}this.setIndex(d),this.setAttribute("position",new Jd(p,3)),this.setAttribute("normal",new Jd(f,3)),this.setAttribute("uv",new Jd(m,2))}}class lE extends Jp{constructor(e,t,n,r,i,o,s){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new cE(e,t,n,r,i,o,s)),this.mergeVertices()}}class uE extends jf{_createComponent(){return new lE(this.element.calculatedSize.x/2,32,32)}}elementBehaviors.has("sphere-geometry")||elementBehaviors.define("sphere-geometry",uE);const hE={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function dE(e,t,n){const r=this;let i,o=!1,s=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==r.onStart&&r.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,a),s===a&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=c.length;t<n;t+=2){const n=c[t],r=c[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}const pE=new dE;function fE(e){this.manager=void 0!==e?e:pE,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}function mE(e){fE.call(this,e)}let gE;Object.assign(fE.prototype,{load:function(){},loadAsync:function(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),mE.prototype=Object.assign(Object.create(fE.prototype),{constructor:mE,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=hE.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),hE.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(t){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}});const vE={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===gE&&(gE=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),gE.width=e.width,gE.height=e.height;const n=gE.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=gE}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let yE=0;function bE(e=bE.DEFAULT_IMAGE,t=bE.DEFAULT_MAPPING,n=mc,r=mc,i=wc,o=Sc,s=Hc,a=Ac,c=1,l=Ql){Object.defineProperty(this,"id",{value:yE++}),this.uuid=Zi.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=a,this.offset=new zu(0,0),this.repeat=new zu(1,1),this.center=new zu(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}function xE(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?vE.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}function _E(e){fE.call(this,e)}bE.DEFAULT_IMAGE=void 0,bE.DEFAULT_MAPPING=ac,bE.prototype=Object.assign(Object.create(co.prototype),{constructor:bE,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Zi.generateUUID()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(xE(r[e].image)):t.push(xE(r[e]))}else t=xE(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==ac)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case fc:e.x=e.x-Math.floor(e.x);break;case mc:e.x=e.x<0?0:1;break;case gc:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case fc:e.y=e.y-Math.floor(e.y);break;case mc:e.y=e.y<0?0:1;break;case gc:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(bE.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),_E.prototype=Object.assign(Object.create(fE.prototype),{constructor:_E,load:function(e,t,n,r){const i=new bE,o=new mE(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;const r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?zc:Hc,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}});var wE,ME=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},TE=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},SE=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};let EE=class extends Gf{constructor(){super(...arguments),this.type="material",this.alphaTest=0,this.clipIntersection=!1,this.colorWrite=!0,this.depthTest=!0,this.depthWrite=!0,this.dithering=!1,this.fog=!0,this.wireframe=!1,this.sidedness="front",wE.set(this,new Xu("deeppink")),this._actualTexture=null}get color(){return SE(this,wE,"f")}set color(e){"string"==typeof(e=null!=e?e:"")||"number"==typeof e?SE(this,wE,"f").set(e):function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,wE,e,"f")}get transparent(){return this.element.opacity<1}loadGL(){super.loadGL();const e=this.meshComponent;this.createEffect((()=>{e.alphaTest=this.alphaTest,e.clipIntersection=this.clipIntersection,e.colorWrite=this.colorWrite,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.dithering=this.dithering,this.element.needsUpdate()})),"wireframe"in e&&this.createEffect((()=>{e.wireframe=this.wireframe,this.element.needsUpdate()})),"side"in e&&this.createEffect((()=>{let t;switch(this.sidedness){case"front":t=va;break;case"back":t=ya;break;case"double":t=ba}e.side=t,this.element.needsUpdate()})),"color"in e&&this.createEffect((()=>{e.color=this.color,this.element.needsUpdate()})),this.createEffect((()=>{e.opacity=this.element.opacity,e.transparent=this.transparent,this.element.needsUpdate()}))}_createComponent(){return super._createComponent,new Fu}resetMeshComponent(){super.resetMeshComponent();const e=this.element.behaviors.get("clip-planes");e&&(console.log("PLANES trigger clipShadows",e.clipPlanes),e.clipShadows=e.clipShadows)}_handleTexture(e,t){const n=this.meshComponent;this.createEffect((()=>{const r=e();if(r){const e=(new _E).load(r,(()=>{this.element.needsUpdate(),this._actualTexture=e}));he((()=>{e.dispose()})),t(e)}else t(null);n.needsUpdate=!0,this.element.needsUpdate()}))}};wE=new WeakMap,ME([wf(0),TE("design:type",Object)],EE.prototype,"alphaTest",void 0),ME([Mf(!1),TE("design:type",Object)],EE.prototype,"clipIntersection",void 0),ME([Mf(!0),TE("design:type",Object)],EE.prototype,"colorWrite",void 0),ME([Mf(!0),TE("design:type",Object)],EE.prototype,"depthTest",void 0),ME([Mf(!0),TE("design:type",Object)],EE.prototype,"depthWrite",void 0),ME([Mf(!1),TE("design:type",Object)],EE.prototype,"dithering",void 0),ME([Mf(!0),TE("design:type",Object)],EE.prototype,"fog",void 0),ME([Mf(!1),TE("design:type",Object)],EE.prototype,"wireframe",void 0),ME([_f("front"),TE("design:type",String)],EE.prototype,"sidedness",void 0),ME([_f("deeppink"),TE("design:type",Object),TE("design:paramtypes",[Object])],EE.prototype,"color",null),ME([In,TE("design:type",Object)],EE.prototype,"_actualTexture",void 0),EE=ME([In],EE);var AE=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},RE=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class LE extends EE{constructor(){super(...arguments),this.texture="",this.specularMap=""}_createComponent(){return new Bd({color:65280})}loadGL(){super.loadGL(),this._handleTexture((()=>this.texture),(e=>{this.meshComponent.map=e})),this._handleTexture((()=>this.specularMap),(e=>{this.meshComponent.specularMap=e}))}}function CE(e){Fu.call(this),this.type="MeshLambertMaterial",this.color=new Xu(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ka,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}AE([_f(""),RE("design:type",Object)],LE.prototype,"texture",void 0),AE([_f(""),RE("design:type",Object)],LE.prototype,"specularMap",void 0),elementBehaviors.has("basic-material")||elementBehaviors.define("basic-material",LE),CE.prototype=Object.create(Fu.prototype),CE.prototype.constructor=CE,CE.prototype.isMeshLambertMaterial=!0,CE.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};var PE=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},OE=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class NE extends EE{constructor(){super(...arguments),this.texture="",this.specularMap=""}_createComponent(){return new CE({color:65280})}loadGL(){super.loadGL(),this._handleTexture((()=>this.texture),(e=>{this.meshComponent.map=e})),this._handleTexture((()=>this.specularMap),(e=>{this.meshComponent.specularMap=e}))}}PE([_f(""),OE("design:type",Object)],NE.prototype,"texture",void 0),PE([_f(""),OE("design:type",Object)],NE.prototype,"specularMap",void 0),elementBehaviors.has("lambert-material")||elementBehaviors.define("lambert-material",NE);class IE extends EE{_createComponent(){return new Yu({opacity:.5,color:new Xu(1118481),blending:wa})}}elementBehaviors.has("mixedplane-material")||elementBehaviors.define("mixedplane-material",IE);var DE,kE,BE=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},UE=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},FE=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},zE=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let HE=class extends EE{constructor(){super(...arguments),this.alphaMap="",this.aoMap="",this.aoMapIntensity=1,this.bumpMap="",this.bumpScale=1,this.displacementMap="",this.displacementScale=1,this.displacementBias=0,this.emissiveMap="",DE.set(this,new Xu("black")),this.emissiveIntensity=1,this.envMap="",this.flatShading=!1,this.lightMap="",this.lightMapIntensity=1,this.texture="",this.normalMap="",this.normalScale=1,this.reflectivity=1,this.specularMap="",kE.set(this,new Xu("#111")),this.shininess=30}get emissive(){return FE(this,DE,"f")}set emissive(e){"string"==typeof(e=null!=e?e:"")||"number"==typeof e?FE(this,DE,"f").set(e):zE(this,DE,e,"f")}get specular(){return FE(this,kE,"f")}set specular(e){"string"==typeof(e=null!=e?e:"")||"number"==typeof e?FE(this,kE,"f").set(e):zE(this,kE,e,"f")}_createComponent(){return new Yu({color:65280})}loadGL(){super.loadGL();const e=this.meshComponent;this.createEffect((()=>{e.aoMapIntensity=this.aoMapIntensity,e.bumpScale=this.bumpScale,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias,e.emissive=this.emissive,e.emissiveIntensity=this.emissiveIntensity,e.flatShading=this.flatShading,e.lightMapIntensity=this.lightMapIntensity,e.normalScale.set(this.normalScale,this.normalScale),e.reflectivity=this.reflectivity,e.specular=this.specular,e.shininess=this.shininess,this.element.needsUpdate()})),this._handleTexture((()=>this.alphaMap),(t=>e.alphaMap=t)),this._handleTexture((()=>this.aoMap),(t=>e.aoMap=t)),this._handleTexture((()=>this.bumpMap),(t=>e.bumpMap=t)),this._handleTexture((()=>this.displacementMap),(t=>e.displacementMap=t)),this._handleTexture((()=>this.emissiveMap),(t=>e.emissiveMap=t)),this._handleTexture((()=>this.envMap),(t=>e.envMap=t)),this._handleTexture((()=>this.lightMap),(t=>e.lightMap=t)),this._handleTexture((()=>this.texture),(t=>e.map=t)),this._handleTexture((()=>this.normalMap),(t=>e.normalMap=t)),this._handleTexture((()=>this.specularMap),(t=>e.specularMap=t))}};function GE(e){Fu.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Xu(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lu,this.normalScale=new zu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function jE(e){GE.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new zu(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Zi.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}DE=new WeakMap,kE=new WeakMap,BE([_f(""),UE("design:type",Object)],HE.prototype,"alphaMap",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"aoMap",void 0),BE([wf(1),UE("design:type",Object)],HE.prototype,"aoMapIntensity",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"bumpMap",void 0),BE([wf(1),UE("design:type",Object)],HE.prototype,"bumpScale",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"displacementMap",void 0),BE([wf(1),UE("design:type",Object)],HE.prototype,"displacementScale",void 0),BE([wf(0),UE("design:type",Object)],HE.prototype,"displacementBias",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"emissiveMap",void 0),BE([_f("black"),UE("design:type",Object),UE("design:paramtypes",[Object])],HE.prototype,"emissive",null),BE([wf(1),UE("design:type",Object)],HE.prototype,"emissiveIntensity",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"envMap",void 0),BE([Mf(!1),UE("design:type",Object)],HE.prototype,"flatShading",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"lightMap",void 0),BE([wf(1),UE("design:type",Object)],HE.prototype,"lightMapIntensity",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"texture",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"normalMap",void 0),BE([wf(1),UE("design:type",Object)],HE.prototype,"normalScale",void 0),BE([wf(1),UE("design:type",Object)],HE.prototype,"reflectivity",void 0),BE([_f(""),UE("design:type",Object)],HE.prototype,"specularMap",void 0),BE([_f("#111"),UE("design:type",Object),UE("design:paramtypes",[Object])],HE.prototype,"specular",null),BE([wf(30),UE("design:type",Object)],HE.prototype,"shininess",void 0),HE=BE([In],HE),elementBehaviors.has("phong-material")||elementBehaviors.define("phong-material",HE),GE.prototype=Object.create(Fu.prototype),GE.prototype.constructor=GE,GE.prototype.isMeshStandardMaterial=!0,GE.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},jE.prototype=Object.create(GE.prototype),jE.prototype.constructor=jE,jE.prototype.isMeshPhysicalMaterial=!0,jE.prototype.copy=function(e){return GE.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Xu).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this};var VE=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},WE=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let qE=class extends EE{constructor(){super(...arguments),this.bumpMap="",this.bumpScale=1,this.texture="",this.normalMap="",this.normalScale=1,this.metalness=0,this.roughness=1,this.roughnessMap="",this.vertexTangents=!1,this.morphTargets=!1,this.morphNormals=!1}_createComponent(){return new GE}loadGL(){super.loadGL();const e=this.meshComponent;this.createEffect((()=>{e.bumpScale=this.bumpScale,e.normalScale.set(this.normalScale,this.normalScale),e.metalness=this.metalness,e.morphNormals=this.morphNormals,e.morphTargets=this.morphTargets,e.roughness=this.roughness,e.vertexTangents=this.vertexTangents,this.element.needsUpdate()})),this._handleTexture((()=>this.bumpMap),(t=>e.bumpMap=t)),this._handleTexture((()=>this.texture),(t=>e.map=t)),this._handleTexture((()=>this.normalMap),(t=>e.normalMap=t)),this._handleTexture((()=>this.roughnessMap),(t=>e.roughnessMap=t))}};VE([_f(""),WE("design:type",Object)],qE.prototype,"bumpMap",void 0),VE([wf(1),WE("design:type",Object)],qE.prototype,"bumpScale",void 0),VE([_f(""),WE("design:type",Object)],qE.prototype,"texture",void 0),VE([_f(""),WE("design:type",Object)],qE.prototype,"normalMap",void 0),VE([wf(1),WE("design:type",Object)],qE.prototype,"normalScale",void 0),VE([wf(0),WE("design:type",Object)],qE.prototype,"metalness",void 0),VE([wf(1),WE("design:type",Object)],qE.prototype,"roughness",void 0),VE([_f(""),WE("design:type",Object)],qE.prototype,"roughnessMap",void 0),VE([Mf(!1),WE("design:type",Boolean)],qE.prototype,"vertexTangents",void 0),VE([Mf(!1),WE("design:type",Boolean)],qE.prototype,"morphTargets",void 0),VE([Mf(!1),WE("design:type",Boolean)],qE.prototype,"morphNormals",void 0),qE=VE([In],qE),elementBehaviors.has("standard-material")||elementBehaviors.define("standard-material",qE);var XE=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},YE=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ZE=class extends qE{constructor(){super(...arguments),this.clearcoat=0,this.clearcoatRoughness=0,this.refractiveIndex=1.5,this.reflectivity=.5,this.transmission=0}_createComponent(){return new jE({})}loadGL(){super.loadGL();const e=this.meshComponent;this.createEffect((()=>{e.clearcoat=this.clearcoat,e.clearcoatRoughness=this.clearcoatRoughness,e.ior=this.refractiveIndex,e.reflectivity=this.reflectivity,e.transmission=this.transmission,this.element.needsUpdate()}))}};XE([wf(0),YE("design:type",Object)],ZE.prototype,"clearcoat",void 0),XE([wf(0),YE("design:type",Object)],ZE.prototype,"clearcoatRoughness",void 0),XE([wf(1.5),YE("design:type",Object)],ZE.prototype,"refractiveIndex",void 0),XE([wf(.5),YE("design:type",Object)],ZE.prototype,"reflectivity",void 0),XE([wf(0),YE("design:type",Object)],ZE.prototype,"transmission",void 0),ZE=XE([In],ZE),elementBehaviors.has("physical-material")||elementBehaviors.define("physical-material",ZE);var JE=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},$E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let KE=class extends EE{constructor(){super(...arguments),this.texture="",this.sizeAttenuation=!0,this.pointSize=1}_createComponent(){return new Np({color:65280})}loadGL(){super.loadGL();const e=this.meshComponent;this.createEffect((()=>{e.sizeAttenuation=this.sizeAttenuation,e.size=this.pointSize,this.element.needsUpdate()})),this._handleTexture((()=>this.texture),(e=>this.meshComponent.map=e))}};JE([_f(""),$E("design:type",Object)],KE.prototype,"texture",void 0),JE([Mf(!0),$E("design:type",Object)],KE.prototype,"sizeAttenuation",void 0),JE([wf(1),$E("design:type",Object)],KE.prototype,"pointSize",void 0),KE=JE([In],KE),elementBehaviors.has("points-material")||elementBehaviors.define("points-material",KE);var QE=0;function eA(e){return"__private_"+QE+++"_"+e}function tA(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function nA(e,{defines:t="",header:n="",main:r="",...i}){let o=e;return Object.keys(i).forEach((e=>{var t,n,r;t=o,n=e,r=i[e],o=t.split(n).join(r)})),o=o.replace("void main() {",`\n    ${n}\n    void main() {\n      ${r}\n    `),`\n    ${Object.keys(t).map((e=>`#define ${e} ${t[e]}`)).join("\n")}\n    ${o}\n  `}function rA(e,t){if(e.image&&0!==e.image.videoWidth&&0!==e.image.videoHeight)return;const n=setInterval((()=>{if(e.image&&0!==e.image.videoWidth&&0!==e.image.videoHeight)return clearInterval(n),t(e)}),16)}function iA(e,t){const n=function(e){switch(e){case gm:return["Linear","( value )"];case vm:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return`\n    vec4 ${e}(vec4 value) {\n      return ${n[0]}ToLinear${n[1]};\n    }\n  `}var oA=eA("camera"),sA=eA("cover"),aA=eA("textureScale");function cA(e,t,n,r){if(!e.image)return[1,1];if(0===e.image.videoWidth&&0===e.image.videoHeight)return[1,1];const i=(e.image.naturalWidth||e.image.videoWidth||e.image.clientWidth)/(e.image.naturalHeight||e.image.videoHeight||e.image.clientHeight),o=function(e){switch(e.type){case"PerspectiveCamera":return e.aspect;case"OrthographicCamera":return Math.abs(e.right-e.left)/Math.abs(e.top-e.bottom);default:throw new Error(`${e.type} is currently not supported in ProjectedMaterial`)}}(t),s=1/o*1;let a,c;return(r?i>o:i<o)?(a=1/(s*i/1*n),c=1/n):(c=1/(1/i*1/s*n),a=1/n),[a,c]}const lA=class extends vw{get camera(){return tA(this,oA)[oA]}set camera(e){if(!e||!e.isCamera)throw new Error("Invalid camera set to the ProjectedMaterial");tA(this,oA)[oA]=e,this.saveDimensions()}get texture(){return this.uniforms.projectedTexture.value}set texture(e){if(null==e||!e.isTexture)throw new Error("Invalid texture set to the ProjectedMaterial");this.uniforms.projectedTexture.value=e,this.uniforms.isTextureLoaded.value=Boolean(e.image),this.projectedTexelToLinear=iA("projectedTexelToLinear",e.encoding),this.uniforms.isTextureLoaded?this.saveDimensions():rA(e,(()=>{this.uniforms.isTextureLoaded.value=!0,this.saveDimensions()}))}get textureScale(){return tA(this,aA)[aA]}set textureScale(e){tA(this,aA)[aA]=e,this.saveDimensions()}get textureOffset(){return this.uniforms.textureOffset.value}set textureOffset(e){this.uniforms.textureOffset.value=e}get cover(){return tA(this,sA)[sA]}set cover(e){tA(this,sA)[sA]=e,this.saveDimensions()}constructor({camera:e=new sy,texture:t=new Pm,textureScale:n=1,textureOffset:r=new Em,cover:i=!1,...o}={}){if(!t.isTexture)throw new Error("Invalid texture passed to the ProjectedMaterial");if(!e.isCamera)throw new Error("Invalid camera passed to the ProjectedMaterial");super(o),Object.defineProperty(this,oA,{writable:!0,value:void 0}),Object.defineProperty(this,sA,{writable:!0,value:void 0}),Object.defineProperty(this,aA,{writable:!0,value:void 0}),Object.defineProperty(this,"isProjectedMaterial",{value:!0}),tA(this,oA)[oA]=e,tA(this,sA)[sA]=i,tA(this,aA)[aA]=n;const[s,a]=cA(t,e,n,i);this.projectedTexelToLinear=iA("projectedTexelToLinear",t.encoding),this.uniforms={projectedTexture:{value:t},isTextureLoaded:{value:Boolean(t.image)},isTextureProjected:{value:!1},backgroundOpacity:{value:1},viewMatrixCamera:{value:new hg},projectionMatrixCamera:{value:new hg},projPosition:{value:new Bm},projDirection:{value:new Bm(0,0,-1)},savedModelMatrix:{value:new hg},widthScaled:{value:s},heightScaled:{value:a},textureOffset:{value:r}},this.onBeforeCompile=e=>{Object.assign(this.uniforms,e.uniforms),e.uniforms=this.uniforms,this.camera.isOrthographicCamera&&(e.defines.ORTHOGRAPHIC=""),e.vertexShader=nA(e.vertexShader,{header:"\n          uniform mat4 viewMatrixCamera;\n          uniform mat4 projectionMatrixCamera;\n\n          #ifdef USE_INSTANCING\n          attribute vec4 savedModelMatrix0;\n          attribute vec4 savedModelMatrix1;\n          attribute vec4 savedModelMatrix2;\n          attribute vec4 savedModelMatrix3;\n          #else\n          uniform mat4 savedModelMatrix;\n          #endif\n\n          varying vec3 vSavedNormal;\n          varying vec4 vTexCoords;\n          #ifndef ORTHOGRAPHIC\n          varying vec4 vWorldPosition;\n          #endif\n        ",main:"\n          #ifdef USE_INSTANCING\n          mat4 savedModelMatrix = mat4(\n            savedModelMatrix0,\n            savedModelMatrix1,\n            savedModelMatrix2,\n            savedModelMatrix3\n          );\n          #endif\n\n          vSavedNormal = mat3(savedModelMatrix) * normal;\n          vTexCoords = projectionMatrixCamera * viewMatrixCamera * savedModelMatrix * vec4(position, 1.0);\n          #ifndef ORTHOGRAPHIC\n          vWorldPosition = savedModelMatrix * vec4(position, 1.0);\n          #endif\n        "}),e.fragmentShader=nA(e.fragmentShader,{header:`\n          uniform sampler2D projectedTexture;\n          uniform bool isTextureLoaded;\n          uniform bool isTextureProjected;\n          uniform float backgroundOpacity;\n          uniform vec3 projPosition;\n          uniform vec3 projDirection;\n          uniform float widthScaled;\n          uniform float heightScaled;\n          uniform vec2 textureOffset;\n\n          varying vec3 vSavedNormal;\n          varying vec4 vTexCoords;\n          #ifndef ORTHOGRAPHIC\n          varying vec4 vWorldPosition;\n          #endif\n\n          ${this.projectedTexelToLinear}\n\n          float mapRange(float value, float min1, float max1, float min2, float max2) {\n            return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n          }\n        `,"vec4 diffuseColor = vec4( diffuse, opacity );":"\n          // clamp the w to make sure we don't project behind\n          float w = max(vTexCoords.w, 0.0);\n\n          vec2 uv = (vTexCoords.xy / w) * 0.5 + 0.5;\n\n          uv += textureOffset;\n\n          // apply the corrected width and height\n          uv.x = mapRange(uv.x, 0.0, 1.0, 0.5 - widthScaled / 2.0, 0.5 + widthScaled / 2.0);\n          uv.y = mapRange(uv.y, 0.0, 1.0, 0.5 - heightScaled / 2.0, 0.5 + heightScaled / 2.0);\n\n          // this makes sure we don't sample out of the texture\n          bool isInTexture = (max(uv.x, uv.y) <= 1.0 && min(uv.x, uv.y) >= 0.0);\n\n          // this makes sure we don't render also the back of the object\n          #ifdef ORTHOGRAPHIC\n          vec3 projectorDirection = projDirection;\n          #else\n          vec3 projectorDirection = normalize(projPosition - vWorldPosition.xyz);\n          #endif\n          float dotProduct = dot(vSavedNormal, projectorDirection);\n          bool isFacingProjector = dotProduct > 0.0000001;\n\n\n          vec4 diffuseColor = vec4(diffuse, opacity * backgroundOpacity);\n\n          if (isFacingProjector && isInTexture && isTextureLoaded && isTextureProjected) {\n            vec4 textureColor = texture2D(projectedTexture, uv);\n\n            // apply the enccoding from the texture\n            textureColor = projectedTexelToLinear(textureColor);\n\n            // apply the material opacity\n            textureColor.a *= opacity;\n\n            // https://learnopengl.com/Advanced-OpenGL/Blending\n            diffuseColor = textureColor * textureColor.a + diffuseColor * (1.0 - textureColor.a);\n          }\n        "})},window.addEventListener("resize",(()=>{this.uniforms.projectionMatrixCamera.value.copy(this.camera.projectionMatrix),this.saveDimensions()})),rA(t,(()=>{this.uniforms.isTextureLoaded.value=!0,this.saveDimensions()}))}saveDimensions(){const[e,t]=cA(this.texture,this.camera,this.textureScale,this.cover);this.uniforms.widthScaled.value=e,this.uniforms.heightScaled.value=t}saveCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix();const e=this.camera.matrixWorldInverse,t=this.camera.projectionMatrix,n=this.camera.matrixWorld;this.uniforms.viewMatrixCamera.value.copy(e),this.uniforms.projectionMatrixCamera.value.copy(t),this.uniforms.projPosition.value.copy(this.camera.position),this.uniforms.projDirection.value.set(0,0,1).applyMatrix4(n),this.uniforms.isTextureProjected.value=!0}project(e){if(!(Array.isArray(e.material)?e.material.every((e=>e.isProjectedMaterial)):e.material.isProjectedMaterial))throw new Error("The mesh material must be a ProjectedMaterial");if(!(Array.isArray(e.material)?e.material.some((e=>e===this)):e.material===this))throw new Error("The provided mesh doesn't have the same material as where project() has been called from");if(e.updateWorldMatrix(!0,!1),this.uniforms.savedModelMatrix.value.copy(e.matrixWorld),Array.isArray(e.material)){const t=e.material.indexOf(this);if(!e.material[t].transparent)throw new Error('You have to pass "transparent: true" to the ProjectedMaterial if you\'re working with multiple materials.');t>0&&(this.uniforms.backgroundOpacity.value=0)}this.saveCameraMatrices()}projectInstanceAt(e,t,n,{forceCameraSave:r=!1}={}){if(!t.isInstancedMesh)throw new Error("The provided mesh is not an InstancedMesh");if(!(Array.isArray(t.material)?t.material.every((e=>e.isProjectedMaterial)):t.material.isProjectedMaterial))throw new Error("The InstancedMesh material must be a ProjectedMaterial");if(!(Array.isArray(t.material)?t.material.some((e=>e===this)):t.material===this))throw new Error("The provided InstancedMeshhave't i samenclude thas e material where project() has been called from");if(!(t.geometry.attributes.savedModelMatrix0&&t.geometry.attributes.savedModelMatrix1&&t.geometry.attributes.savedModelMatrix2&&t.geometry.attributes.savedModelMatrix3))throw new Error("No allocated data found on the geometry, please call 'allocateProjectionData(geometry, instancesCount)'");if(t.geometry.attributes.savedModelMatrix0.setXYZW(e,n.elements[0],n.elements[1],n.elements[2],n.elements[3]),t.geometry.attributes.savedModelMatrix1.setXYZW(e,n.elements[4],n.elements[5],n.elements[6],n.elements[7]),t.geometry.attributes.savedModelMatrix2.setXYZW(e,n.elements[8],n.elements[9],n.elements[10],n.elements[11]),t.geometry.attributes.savedModelMatrix3.setXYZW(e,n.elements[12],n.elements[13],n.elements[14],n.elements[15]),Array.isArray(t.material)){const e=t.material.indexOf(this);if(!t.material[e].transparent)throw new Error('You have to pass "transparent: true" to the ProjectedMaterial if you\'re working with multiple materials.');e>0&&(this.uniforms.backgroundOpacity.value=0)}(0===e||r)&&this.saveCameraMatrices()}copy(e){return super.copy(e),this.camera=e.camera,this.texture=e.texture,this.textureScale=e.textureScale,this.textureOffset=e.textureOffset,this.cover=e.cover,this}};function uA(){Ro.call(this),this.type="Camera",this.matrixWorldInverse=new eo,this.projectionMatrix=new eo,this.projectionMatrixInverse=new eo}function hA(e=50,t=1,n=.1,r=2e3){uA.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}uA.prototype=Object.assign(Object.create(Ro.prototype),{constructor:uA,isCamera:!0,copy:function(e,t){return Ro.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new $i),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Ro.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Ro.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),hA.prototype=Object.assign(Object.create(uA.prototype),{constructor:hA,isPerspectiveCamera:!0,copy:function(e,t){return uA.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Zi.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*Zi.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Zi.RAD2DEG*Math.atan(Math.tan(.5*Zi.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*Zi.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/s,r*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Ro.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var dA,pA=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class fA extends EE{constructor(){super(...arguments),dA.set(this,new hA(50,1,.1,2e3))}get camera(){return pA(this,dA,"f")}set camera(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,dA,e,"f")}_createComponent(){var e;return pA(this,dA,"f").position.set(0,0,500),new lA({color:255,texture:null!==(e=this._actualTexture)&&void 0!==e?e:void 0,camera:this.camera})}loadGL(){super.loadGL(),this.createEffect((()=>{this._actualTexture,this.resetMeshComponent()}))}}function mA(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function gA(e){const t={};for(let n=0;n<e.length;n++){const r=mA(e[n]);for(const e in r)t[e]=r[e]}return t}dA=new WeakMap,elementBehaviors.has("projected-material")||elementBehaviors.define("projected-material",fA);const vA={clone:mA,merge:gA},yA="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",bA="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n";function xA(e){Fu.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=yA,this.fragmentShader=bA,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}xA.prototype=Object.create(Fu.prototype),xA.prototype.constructor=xA,xA.prototype.isShaderMaterial=!0,xA.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=mA(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},xA.prototype.toJSON=function(e){const t=Fu.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t};var _A,wA=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},MA=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let TA=class extends EE{constructor(){super(...arguments),_A.set(this,{}),this.vertexShader=yA,this.fragmentShader=bA}get uniforms(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,_A,"f")}set uniforms(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,_A,e?"string"==typeof e?JSON.parse(e):e:{},"f")}_createComponent(){return new xA({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}loadGL(){super.loadGL(),this.createEffect((()=>{const e=this.meshComponent;e.uniforms=this.uniforms,e.vertexShader=this.vertexShader||yA,e.fragmentShader=this.fragmentShader||bA,e.needsUpdate=!0,this.element.needsUpdate()}))}};_A=new WeakMap,wA([xf,MA("design:type",Object),MA("design:paramtypes",[Object])],TA.prototype,"uniforms",null),wA([_f(yA),MA("design:type",Object)],TA.prototype,"vertexShader",void 0),wA([_f(bA),MA("design:type",Object)],TA.prototype,"fragmentShader",void 0),TA=wA([In],TA),elementBehaviors.has("shader-material")||elementBehaviors.define("shader-material",TA);var SA=function(e){Gw.call(this,e)};SA.prototype=Object.assign(Object.create(Gw.prototype),{constructor:SA,load:function(e,t,n,r){var i=this,o=new Pm,s=new Vw(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(e,(function(e){o.image=i.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)}),n,r),o},parse:function(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var t=new Uint8Array(e),n=0,r={id_length:t[n++],colormap_type:t[n++],image_type:t[n++],colormap_index:t[n++]|t[n++]<<8,colormap_length:t[n++]|t[n++]<<8,colormap_size:t[n++],origin:[t[n++]|t[n++]<<8,t[n++]|t[n++]<<8],width:t[n++]|t[n++]<<8,height:t[n++]|t[n++]<<8,pixel_size:t[n++],flags:t[n++]};!function(e){switch(e.image_type){case 1:case 9:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(r),r.id_length+n>e.length&&console.error("THREE.TGALoader: No data."),n+=r.id_length;var i=!1,o=!1,s=!1;switch(r.image_type){case 9:i=!0,o=!0;break;case 1:o=!0;break;case 10:i=!0;break;case 2:break;case 11:i=!0,s=!0;break;case 3:s=!0}var a="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(r.width,r.height):document.createElement("canvas");a.width=r.width,a.height=r.height;var c=a.getContext("2d"),l=c.createImageData(r.width,r.height),u=function(e,t,n,r,i){var o,s,a,c;if(a=n.width*n.height*(s=n.pixel_size>>3),t&&(c=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),e){var l,u,h;o=new Uint8Array(a);for(var d=0,p=new Uint8Array(s);d<a;)if(u=1+(127&(l=i[r++])),128&l){for(h=0;h<s;++h)p[h]=i[r++];for(h=0;h<u;++h)o.set(p,d+h*s);d+=s*u}else{for(u*=s,h=0;h<u;++h)o[d+h]=i[r++];d+=u}}else o=i.subarray(r,r+=t?n.width*n.height:a);return{pixel_data:o,palettes:c}}(i,o,r,n,t);return function(e,t,n,i,o){var a,c,l,u,h,d;switch((48&r.flags)>>4){default:case 2:a=0,l=1,h=t,c=0,u=1,d=n;break;case 0:a=0,l=1,h=t,c=n-1,u=-1,d=-1;break;case 3:a=t-1,l=-1,h=-1,c=0,u=1,d=n;break;case 1:a=t-1,l=-1,h=-1,c=n-1,u=-1,d=-1}if(s)switch(r.pixel_size){case 8:!function(e,t,n,i,o,s,a,c){var l,u,h,d=0,p=r.width;for(h=t;h!==i;h+=n)for(u=o;u!==a;u+=s,d++)l=c[d],e[4*(u+p*h)+0]=l,e[4*(u+p*h)+1]=l,e[4*(u+p*h)+2]=l,e[4*(u+p*h)+3]=255}(e,c,u,d,a,l,h,i);break;case 16:!function(e,t,n,i,o,s,a,c){var l,u,h=0,d=r.width;for(u=t;u!==i;u+=n)for(l=o;l!==a;l+=s,h+=2)e[4*(l+d*u)+0]=c[h+0],e[4*(l+d*u)+1]=c[h+0],e[4*(l+d*u)+2]=c[h+0],e[4*(l+d*u)+3]=c[h+1]}(e,c,u,d,a,l,h,i);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(r.pixel_size){case 8:!function(e,t,n,i,o,s,a,c,l){var u,h,d,p=l,f=0,m=r.width;for(d=t;d!==i;d+=n)for(h=o;h!==a;h+=s,f++)u=c[f],e[4*(h+m*d)+3]=255,e[4*(h+m*d)+2]=p[3*u+0],e[4*(h+m*d)+1]=p[3*u+1],e[4*(h+m*d)+0]=p[3*u+2]}(e,c,u,d,a,l,h,i,o);break;case 16:!function(e,t,n,i,o,s,a,c){var l,u,h,d=0,p=r.width;for(h=t;h!==i;h+=n)for(u=o;u!==a;u+=s,d+=2)l=c[d+0]+(c[d+1]<<8),e[4*(u+p*h)+0]=(31744&l)>>7,e[4*(u+p*h)+1]=(992&l)>>2,e[4*(u+p*h)+2]=(31&l)>>3,e[4*(u+p*h)+3]=32768&l?0:255}(e,c,u,d,a,l,h,i);break;case 24:!function(e,t,n,i,o,s,a,c){var l,u,h=0,d=r.width;for(u=t;u!==i;u+=n)for(l=o;l!==a;l+=s,h+=3)e[4*(l+d*u)+3]=255,e[4*(l+d*u)+2]=c[h+0],e[4*(l+d*u)+1]=c[h+1],e[4*(l+d*u)+0]=c[h+2]}(e,c,u,d,a,l,h,i);break;case 32:!function(e,t,n,i,o,s,a,c){var l,u,h=0,d=r.width;for(u=t;u!==i;u+=n)for(l=o;l!==a;l+=s,h+=4)e[4*(l+d*u)+2]=c[h+0],e[4*(l+d*u)+1]=c[h+1],e[4*(l+d*u)+0]=c[h+2],e[4*(l+d*u)+3]=c[h+3]}(e,c,u,d,a,l,h,i);break;default:console.error("THREE.TGALoader: Format not supported.")}}(l.data,r.width,r.height,u.pixel_data,u.palettes),c.putImageData(l,0,0),a}});var EA=function(e){Gw.call(this,e)};EA.prototype=Object.assign(Object.create(Gw.prototype),{constructor:EA,load:function(e,t,n,r){var i=this,o=""===i.path?kM(e):i.path,s=new Vw(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(n){try{t(i.parse(n,o))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(e,t){function n(e,t){for(var n=[],r=e.childNodes,i=0,o=r.length;i<o;i++){var s=r[i];s.nodeName===t&&n.push(s)}return n}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=t[r];return n}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=parseFloat(t[r]);return n}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=parseInt(t[r]);return n}function s(e){return e.substring(1)}function a(e){return 0===Object.keys(e).length}function c(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function l(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,r,i){var o=n(e,t)[0];if(void 0!==o)for(var s=n(o,r),a=0;a<s.length;a++)i(s[a])}function h(e,t){for(var n in e)e[n].build=t(e[n])}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){var o=s(i.getAttribute("source")),a=i.getAttribute("semantic");t.inputs[a]=o}}return t}function f(e){var t={},n=e.getAttribute("target").split("/"),r=n.shift(),i=n.shift(),o=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)n=i.split("."),i=n.shift(),t.member=n.shift();else if(o){var c=i.split("(");i=c.shift();for(var l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));t.indices=c}return t.id=r,t.sid=i,t.arraySyntax=o,t.memberSyntax=a,t.sampler=s(e.getAttribute("source")),t}function m(e){var t=[],n=e.channels,r=e.samplers,i=e.sources;for(var o in n)if(n.hasOwnProperty(o)){var s=n[o],a=r[s.sampler],c=a.inputs.INPUT,l=a.inputs.OUTPUT;_(v(s,i[c],i[l]),t)}return t}function g(e){return d(Ke.animations[e],m)}function v(e,t,n){var r,i,o,s,a,c,l=Ke.nodes[e.id],u=ke(l.id),h=l.transforms[e.sid],d=l.matrix.clone().transpose(),p={};switch(h){case"matrix":for(o=0,s=t.array.length;o<s;o++)if(r=t.array[o],i=o*n.stride,void 0===p[r]&&(p[r]={}),!0===e.arraySyntax){var f=n.array[i],m=e.indices[0]+4*e.indices[1];p[r][m]=f}else for(a=0,c=n.stride;a<c;a++)p[r][a]=n.array[i+a];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var g=function(e,t){var n=[];for(var r in e)n.push({time:parseFloat(r),value:e[r]});n.sort((function(e,t){return e.time-t.time}));for(var i=0;i<16;i++)w(n,i,t.elements[i]);return n}(p,d);return{name:u.uuid,keyframes:g}}var y=new Bm,b=new Bm,x=new km;function _(e,t){for(var n=e.keyframes,r=e.name,i=[],o=[],s=[],a=[],c=0,l=n.length;c<l;c++){var u=n[c],h=u.time,d=u.value;Se.fromArray(d).transpose(),Se.decompose(y,x,b),i.push(h),o.push(y.x,y.y,y.z),s.push(x.x,x.y,x.z,x.w),a.push(b.x,b.y,b.z)}return o.length>0&&t.push(new Bw(r+".position",i,o)),s.length>0&&t.push(new Dw(r+".quaternion",i,s)),a.length>0&&t.push(new Bw(r+".scale",i,a)),t}function w(e,t,n){var r,i,o,s=!0;for(i=0,o=e.length;i<o;i++)void 0===(r=e[i]).value[t]?r.value[t]=null:s=!1;if(!0===s)for(i=0,o=e.length;i<o;i++)(r=e[i]).value[t]=n;else!function(e,t){for(var n,r,i=0,o=e.length;i<o;i++){var s=e[i];if(null===s.value[t]){if(n=M(e,i,t),r=T(e,i,t),null===n){s.value[t]=r.value[t];continue}if(null===r){s.value[t]=n.value[t];continue}S(s,n,r,t)}}}(e,t)}function M(e,t,n){for(;t>=0;){var r=e[t];if(null!==r.value[n])return r;t--}return null}function T(e,t,n){for(;t<e.length;){var r=e[t];if(null!==r.value[n])return r;t++}return null}function S(e,t,n,r){n.time-t.time!=0?e.value[r]=(e.time-t.time)*(n.value[r]-t.value[r])/(n.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function E(e){for(var t=[],n=e.name,r=e.end-e.start||-1,i=e.animations,o=0,s=i.length;o<s;o++)for(var a=g(i[o]),c=0,l=a.length;c<l;c++)t.push(a[c]);return new Uw(n,r,t)}function A(e){return d(Ke.clips[e],E)}function R(e){for(var t={sources:{}},n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(o.textContent);break;case"source":var s=o.getAttribute("id");t.sources[s]=oe(o);break;case"joints":t.joints=L(o);break;case"vertex_weights":t.vertexWeights=C(o)}}return t}function L(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){var o=i.getAttribute("semantic"),a=s(i.getAttribute("source"));t.inputs[o]=a}}return t}function C(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),c=s(i.getAttribute("source")),l=parseInt(i.getAttribute("offset"));t.inputs[a]={id:c,offset:l};break;case"vcount":t.vcount=o(i.textContent);break;case"v":t.v=o(i.textContent)}}return t}function P(e){var t={id:e.id},n=Ke.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,n,r,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,s=e.vertexWeights,a=s.vcount,c=s.v,l=s.inputs.JOINT.offset,u=s.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[s.inputs.WEIGHT.id].array,f=0;for(t=0,r=a.length;t<r;t++){var m=a[t],g=[];for(n=0;n<m;n++){var v=c[f+l],y=p[c[f+u]];g.push({index:v,weight:y}),f+=2}for(g.sort(w),n=0;n<4;n++){var b=g[n];void 0!==b?(i.indices.array.push(b.index),i.weights.array.push(b.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(e.bindShapeMatrix?i.bindMatrix=(new hg).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new hg).identity(),t=0,r=h.array.length;t<r;t++){var x=h.array[t],_=(new hg).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:x,boneInverse:_})}return i;function w(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function O(e){return d(Ke.controllers[e],P)}function N(e){return void 0!==e.build?e.build:e.init_from}function I(e){var t=Ke.images[e];return void 0!==t?d(t,N):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function D(e){for(var t={surfaces:{},samplers:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":k(i,t);break;case"technique":t.technique=F(i);break;case"extra":t.extra=W(i)}}return t}function k(e,t){for(var n=e.getAttribute("sid"),r=0,i=e.childNodes.length;r<i;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[n]=B(o);break;case"sampler2D":t.samplers[n]=U(o)}}}function B(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"init_from"===i.nodeName&&(t.init_from=i.textContent)}return t}function U(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"source"===i.nodeName&&(t.source=i.textContent)}return t}function F(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=z(i)}}return t}function z(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=H(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:H(i)}}}return t}function H(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=i(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:G(o)}}}return t}function G(e){for(var t={technique:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"extra"===i.nodeName&&j(i,t)}return t}function j(e,t){for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"technique"===i.nodeName&&V(i,t)}}function V(e,t){for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function W(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"technique"===i.nodeName&&(t.technique=q(i))}return t}function q(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"double_sided"===i.nodeName&&(t[i.nodeName]=parseInt(i.textContent))}return t}function X(e){return e}function Y(e){var t,n=function(e){return d(Ke.effects[e],X)}(e.url),r=n.profile.technique,i=n.profile.extra;switch(r.type){case"phong":case"blinn":t=new yw;break;case"lambert":t=new _w;break;default:t=new cv}function o(e){var t=n.profile.samplers[e.id],r=null;if(void 0!==t?r=I(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=I(e.id)),null!==r){var i=function(e){var t=e.slice(2+(e.lastIndexOf(".")-1>>>0));return"tga"===(t=t.toLowerCase())?qe:Ye}(r);if(void 0!==i){var o=i.load(r),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===a(s.technique)){var c=s.technique;o.wrapS=c.wrapU?Xf:Yf,o.wrapT=c.wrapV?Xf:Yf,o.offset.set(c.offsetU||0,c.offsetV||0),o.repeat.set(c.repeatU||1,c.repeatV||1)}else o.wrapS=Xf,o.wrapT=Xf;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}t.name=e.name||"";var s=r.parameters;for(var c in s){var l=s[c];switch(c){case"diffuse":l.color&&t.color.fromArray(l.color),l.texture&&(t.map=o(l.texture));break;case"specular":l.color&&t.specular&&t.specular.fromArray(l.color),l.texture&&(t.specularMap=o(l.texture));break;case"bump":l.texture&&(t.normalMap=o(l.texture));break;case"ambient":l.texture&&(t.lightMap=o(l.texture));break;case"shininess":l.float&&t.shininess&&(t.shininess=l.float);break;case"emission":l.color&&t.emissive&&t.emissive.fromArray(l.color),l.texture&&(t.emissiveMap=o(l.texture))}}var u=s.transparent,h=s.transparency;if(void 0===h&&u&&(h={float:1}),void 0===u&&h&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&h)if(u.data.texture)t.transparent=!0;else{var p=u.data.color;switch(u.opaque){case"A_ONE":t.opacity=p[3]*h.float;break;case"RGB_ZERO":t.opacity=1-p[0]*h.float;break;case"A_ZERO":t.opacity=1-p[3]*h.float;break;case"RGB_ONE":t.opacity=p[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}t.opacity<1&&(t.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(t.side=2),t}function Z(e){return d(Ke.materials[e],Y)}function J(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if("technique_common"===n.nodeName)return $(n)}return{}}function $(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=K(r)}}return t}function K(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function Q(e){var t;switch(e.optics.technique){case"perspective":t=new sy(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var n=e.optics.parameters.ymag,r=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,t=new AM(-(r*=.5),r,n*=.5,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new sy}return t.name=e.name||"",t}function ee(e){var t=Ke.cameras[e];return void 0!==t?d(t,Q):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function te(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ne(i)}}return t}function ne(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":var s=i(o.textContent);t.color=(new iv).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);t.distance=a?Math.sqrt(1/a):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new LM;break;case"point":t=new EM;break;case"spot":t=new TM;break;case"ambient":t=new CM}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ie(e){var t=Ke.lights[e];return void 0!==t?d(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function oe(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=i(s.textContent);break;case"Name_array":t.array=r(s.textContent);break;case"technique_common":var a=n(s,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function se(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&(t[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return t}function ae(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var a=s(i.getAttribute("source")),c=i.getAttribute("semantic"),l=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?c+u:c;t.inputs[h]={id:a,offset:l},t.stride=Math.max(t.stride,l+1),"TEXCOORD"===c&&(t.hasUV=!0);break;case"vcount":t.vcount=o(i.textContent);break;case"p":t.p=o(i.textContent)}}return t}function ce(e){for(var t=0,n=0,r=e.length;n<r;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},n=e.sources,r=e.vertices,i=e.primitives;if(0===i.length)return{};var o=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(i);for(var s in o){var a=o[s];ce(a),t[s]=ue(a,n,r)}return t}function ue(e,t,n){for(var r={},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l=[],u=[],h=new Nv,d=[],p=0,f=0;f<e.length;f++){var m=e[f],g=m.inputs,v=0;switch(m.type){case"lines":case"linestrips":v=2*m.count;break;case"triangles":v=3*m.count;break;case"polylist":for(var y=0;y<m.count;y++){var b=m.vcount[y];switch(b){case 3:v+=3;break;case 4:v+=6;break;default:v+=3*(b-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",m.type)}for(var x in h.addGroup(p,v,f),p+=v,m.material&&d.push(m.material),g){var _=g[x];switch(x){case"VERTEX":for(var w in n){var M=n[w];switch(w){case"POSITION":var T=i.array.length;if(he(m,t[M],_.offset,i.array),i.stride=t[M].stride,t.skinWeights&&t.skinIndices&&(he(m,t.skinIndices,_.offset,l),he(m,t.skinWeights,_.offset,u)),!1===m.hasUV&&!0===e.uvsNeedsFix){v=(i.array.length-T)/i.stride;for(var S=0;S<v;S++)s.array.push(0,0)}break;case"NORMAL":he(m,t[M],_.offset,o.array),o.stride=t[M].stride;break;case"COLOR":he(m,t[M],_.offset,c.array),c.stride=t[M].stride;break;case"TEXCOORD":he(m,t[M],_.offset,s.array),s.stride=t[M].stride;break;case"TEXCOORD1":he(m,t[M],_.offset,a.array),s.stride=t[M].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',w)}}break;case"NORMAL":he(m,t[_.id],_.offset,o.array),o.stride=t[_.id].stride;break;case"COLOR":he(m,t[_.id],_.offset,c.array),c.stride=t[_.id].stride;break;case"TEXCOORD":he(m,t[_.id],_.offset,s.array),s.stride=t[_.id].stride;break;case"TEXCOORD1":he(m,t[_.id],_.offset,a.array),a.stride=t[_.id].stride}}}return i.array.length>0&&h.setAttribute("position",new xv(i.array,i.stride)),o.array.length>0&&h.setAttribute("normal",new xv(o.array,o.stride)),c.array.length>0&&h.setAttribute("color",new xv(c.array,c.stride)),s.array.length>0&&h.setAttribute("uv",new xv(s.array,s.stride)),a.array.length>0&&h.setAttribute("uv2",new xv(a.array,a.stride)),l.length>0&&h.setAttribute("skinIndex",new xv(l,4)),u.length>0&&h.setAttribute("skinWeight",new xv(u,4)),r.data=h,r.type=e[0].type,r.materialKeys=d,r}function he(e,t,n,r){var i=e.p,o=e.stride,s=e.vcount;function a(e){for(var t=i[e+n]*l,o=t+l;t<o;t++)r.push(c[t])}var c=t.array,l=t.stride;if(void 0!==e.vcount)for(var u=0,h=0,d=s.length;h<d;h++){var p=s[h];if(4===p){var f=u+1*o,m=u+2*o,g=u+3*o;a(u+0*o),a(f),a(g),a(f),a(m),a(g)}else if(3===p)f=u+1*o,m=u+2*o,a(u+0*o),a(f),a(m);else if(p>4)for(var v=1,y=p-2;v<=y;v++)f=u+o*v,m=u+o*(v+1),a(u+0*o),a(f),a(m);u+=o*p}else for(h=0,d=i.length;h<d;h+=o)a(h)}function de(e){return d(Ke.geometries[e],le)}function pe(e){return void 0!==e.build?e.build:e}function fe(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=me(r);break;case"link":t.links.push(ve(r))}}}function me(e){for(var t,n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=ge(r)}}return t}function ge(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new Bm,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=i(r.textContent);t.axis.fromArray(o);break;case"limits":var s=r.getElementsByTagName("max")[0],a=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ye(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(r))}}return t}function ye(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(ve(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(r))}}return t}function be(e){var t={type:e.nodeName},n=i(e.textContent);switch(t.type){case"matrix":t.obj=new hg,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new Bm,t.obj.fromArray(n);break;case"rotate":t.obj=new Bm,t.obj.fromArray(n),t.angle=Sm.degToRad(n[3])}return t}function xe(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&_e(r,t)}}function _e(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=i(r.textContent);break;case"mass":t.mass=i(r.textContent)[0]}}}function we(e){for(var t={target:e.getAttribute("target").split("/").pop()},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType&&"axis"===r.nodeName){var i=r.getElementsByTagName("param")[0];t.axis=i.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function Me(e){return void 0!==e.build?e.build:e}function Te(e){for(var t=[],n=He.querySelector('[id="'+e.id+'"]'),r=0;r<n.childNodes.length;r++){var o=n.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=i(o.textContent),a=(new hg).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"translate":case"scale":s=i(o.textContent);var c=(new Bm).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"rotate":s=i(o.textContent),c=(new Bm).fromArray(s);var l=Sm.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c,angle:l})}}return t}var Se=new hg,Ee=new Bm;function Ae(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new hg,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),Ae(r);break;case"instance_camera":t.instanceCameras.push(s(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Re(r));break;case"instance_light":t.instanceLights.push(s(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Re(r));break;case"instance_node":t.instanceNodes.push(s(r.getAttribute("url")));break;case"matrix":var o=i(r.textContent);t.matrix.multiply(Se.fromArray(o).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=i(r.textContent),Ee.fromArray(o),t.matrix.multiply(Se.makeTranslation(Ee.x,Ee.y,Ee.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=i(r.textContent);var a=Sm.degToRad(o[3]);t.matrix.multiply(Se.makeRotationAxis(Ee.fromArray(o),a)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=i(r.textContent),t.matrix.scale(Ee.fromArray(o)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return De(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ke.nodes[t.id]=t,t}function Re(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var a=i[o],c=a.getAttribute("symbol"),l=a.getAttribute("target");t.materials[c]=s(l)}break;case"skeleton":t.skeletons.push(s(r.textContent))}}return t}function Le(e,t){var n,r,i=[],o=[];for(n=0;n<e.length;n++){var s=e[n];if(De(s))Ce(ke(s),t,i);else if(Ue(s))for(var a=Ke.visualScenes[s].children,c=0;c<a.length;c++){var l=a[c];"JOINT"===l.type&&Ce(ke(l.id),t,i)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(n=0;n<t.length;n++)for(c=0;c<i.length;c++)if((r=i[c]).bone.name===t[n].name){o[n]=r,r.processed=!0;break}for(n=0;n<i.length;n++)!1===(r=i[n]).processed&&(o.push(r),r.processed=!0);var u=[],h=[];for(n=0;n<o.length;n++)r=o[n],u.push(r.bone),h.push(r.boneInverse);return new t_(u,h)}function Ce(e,t,n){e.traverse((function(e){if(!0===e.isBone){for(var r,i=0;i<t.length;i++){var o=t[i];if(o.name===e.name){r=o.boneInverse;break}}void 0===r&&(r=new hg),n.push({bone:e,boneInverse:r,processed:!1})}}))}function Pe(e){for(var t=[],n=e.matrix,r=e.nodes,i=e.type,o=e.instanceCameras,s=e.instanceControllers,a=e.instanceLights,c=e.instanceGeometries,l=e.instanceNodes,u=0,h=r.length;u<h;u++)t.push(ke(r[u]));for(u=0,h=o.length;u<h;u++){var d=ee(o[u]);null!==d&&t.push(d.clone())}for(u=0,h=s.length;u<h;u++)for(var p=O((x=s[u]).id),f=Ie(de(p.id),x.materials),m=Le(x.skeletons,p.skin.joints),g=0,v=f.length;g<v;g++){var y;(y=f[g]).isSkinnedMesh&&(y.bind(m,p.skin.bindMatrix),y.normalizeSkinWeights()),t.push(y)}for(u=0,h=a.length;u<h;u++){var b=ie(a[u]);null!==b&&t.push(b.clone())}for(u=0,h=c.length;u<h;u++){var x;for(g=0,v=(f=Ie(de((x=c[u]).id),x.materials)).length;g<v;g++)t.push(f[g])}for(u=0,h=l.length;u<h;u++)t.push(ke(l[u]).clone());if(0===r.length&&1===t.length)y=t[0];else for(y="JOINT"===i?new Kx:new vx,u=0;u<t.length;u++)y.add(t[u]);return y.name="JOINT"===i?e.sid:e.name,y.matrix.copy(n),y.matrix.decompose(y.position,y.quaternion,y.scale),y}var Oe=new cv({color:16711935});function Ne(e,t){for(var n=[],r=0,i=e.length;r<i;r++){var o=t[e[r]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),n.push(Oe)):n.push(Z(o))}return n}function Ie(e,t){var n=[];for(var r in e){var i=e[r],o=Ne(i.materialKeys,t);0===o.length&&("lines"===r||"linestrips"===r?o.push(new a_):o.push(new yw));var s=void 0!==i.data.attributes.skinIndex;if(s)for(var a=0,c=o.length;a<c;a++)o[a].skinning=!0;var l,u=1===o.length?o[0]:o;switch(r){case"lines":l=new g_(i.data,u);break;case"linestrips":l=new p_(i.data,u);break;case"triangles":case"polylist":l=s?new $x(i.data,u):new $v(i.data,u)}n.push(l)}return n}function De(e){return void 0!==Ke.nodes[e]}function ke(e){return d(Ke.nodes[e],Pe)}function Be(e){var t=new vx;t.name=e.name;for(var n=e.children,r=0;r<n.length;r++){var i=n[r];t.add(ke(i.id))}return t}function Ue(e){return void 0!==Ke.visualScenes[e]}function Fe(e){return d(Ke.visualScenes[e],Be)}if(0===e.length)return{scene:new Mx};var ze=(new DOMParser).parseFromString(e,"application/xml"),He=n(ze,"COLLADA")[0],Ge=ze.getElementsByTagName("parsererror")[0];if(void 0!==Ge){var je,Ve=n(Ge,"div")[0];return je=Ve?Ve.textContent:function(e){for(var t="",n=[e];n.length;){var r=n.shift();r.nodeType===Node.TEXT_NODE?t+=r.textContent:(t+="\n",n.push.apply(n,r.childNodes))}return t.trim()}(Ge),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",je),null}var We=He.getAttribute("version");console.log("THREE.ColladaLoader: File version",We);var qe,Xe=function(e){return{unit:c(n(e,"unit")[0]),upAxis:l(n(e,"up_axis")[0])}}(n(He,"asset")[0]),Ye=new Jw(this.manager);Ye.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),SA&&(qe=new SA(this.manager)).setPath(this.resourcePath||t);var Ze=[],Je={},$e=0,Ke={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(He,"library_animations","animation",(function e(t){for(var n={sources:{},samplers:{},channels:{}},r=!1,i=0,o=t.childNodes.length;i<o;i++){var s,a=t.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"source":s=a.getAttribute("id"),n.sources[s]=oe(a);break;case"sampler":s=a.getAttribute("id"),n.samplers[s]=p(a);break;case"channel":s=a.getAttribute("target"),n.channels[s]=f(a);break;case"animation":e(a),r=!0;break;default:console.log(a)}}!1===r&&(Ke.animations[t.getAttribute("id")||Sm.generateUUID()]=n)})),u(He,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"instance_animation"===i.nodeName&&t.animations.push(s(i.getAttribute("url")))}Ke.clips[e.getAttribute("id")]=t})),u(He,"library_controllers","controller",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=s(i.getAttribute("source")),t.skin=R(i);break;case"morph":t.id=s(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ke.controllers[e.getAttribute("id")]=t})),u(He,"library_images","image",(function(e){var t={init_from:n(e,"init_from")[0].textContent};Ke.images[e.getAttribute("id")]=t})),u(He,"library_effects","effect",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"profile_COMMON"===i.nodeName&&(t.profile=D(i))}Ke.effects[e.getAttribute("id")]=t})),u(He,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"instance_effect"===i.nodeName&&(t.url=s(i.getAttribute("url")))}Ke.materials[e.getAttribute("id")]=t})),u(He,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"optics"===i.nodeName&&(t.optics=J(i))}Ke.cameras[e.getAttribute("id")]=t})),u(He,"library_lights","light",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];1===i.nodeType&&"technique_common"===i.nodeName&&(t=te(i))}Ke.lights[e.getAttribute("id")]=t})),u(He,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType){var s=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[s]=oe(o);break;case"vertices":t.vertices=se(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ae(o));break;default:console.log(o)}}}Ke.geometries[e.getAttribute("id")]=t}})),u(He,"library_nodes","node",Ae),u(He,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),n=0;n<t.length;n++){var r=t[n];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+$e++)}}(e);for(var r=n(e,"node"),i=0;i<r.length;i++)t.children.push(Ae(r[i]));Ke.visualScenes[e.getAttribute("id")]=t})),u(He,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&fe(r,t)}Ke.kinematicsModels[e.getAttribute("id")]=t})),u(He,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&"rigid_body"===r.nodeName&&(t.rigidBodies[r.getAttribute("name")]={},xe(r,t.rigidBodies[r.getAttribute("name")]))}Ke.physicsModels[e.getAttribute("id")]=t})),u(He,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&"bind_joint_axis"===r.nodeName&&t.bindJointAxis.push(we(r))}Ke.kinematicsScenes[s(e.getAttribute("url"))]=t})),h(Ke.animations,m),h(Ke.clips,E),h(Ke.controllers,P),h(Ke.images,N),h(Ke.effects,X),h(Ke.materials,Y),h(Ke.cameras,Q),h(Ke.lights,re),h(Ke.geometries,le),h(Ke.visualScenes,Be),function(){var e=Ke.clips;if(!0===a(e)){if(!1===a(Ke.animations)){var t=[];for(var n in Ke.animations)for(var r=g(n),i=0,o=r.length;i<o;i++)t.push(r[i]);Ze.push(new Uw("default",-1,t))}}else for(var n in e)Ze.push(A(n))}(),function(){var e=Object.keys(Ke.kinematicsModels)[0],t=Object.keys(Ke.kinematicsScenes)[0],n=Object.keys(Ke.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r=function(e){return d(Ke.kinematicsModels[e],pe)}(e),i=function(e){return d(Ke.kinematicsScenes[e],Me)}(t),o=Fe(n),s=i.bindJointAxis,a={},c=0,l=s.length;c<l;c++){var u=s[c],h=He.querySelector('[sid="'+u.target+'"]');if(h){var p=h.parentElement;m(u.jointIndex,p)}}var f=new hg;Je={joints:r&&r.joints,getJointValue:function(e){var t=a[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var n=a[e];if(n){var r=n.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=n.object,o=r.axis,s=n.transforms;Se.identity();for(var c=0;c<s.length;c++){var l=s[c];if(l.sid&&-1!==l.sid.indexOf(e))switch(r.type){case"revolute":Se.multiply(f.makeRotationAxis(o,Sm.degToRad(t)));break;case"prismatic":Se.multiply(f.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(l.type){case"matrix":Se.multiply(l.obj);break;case"translate":Se.multiply(f.makeTranslation(l.obj.x,l.obj.y,l.obj.z));break;case"scale":Se.scale(l.obj);break;case"rotate":Se.multiply(f.makeRotationAxis(l.obj,l.angle))}}i.matrix.copy(Se),i.matrix.decompose(i.position,i.quaternion,i.scale),a[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function m(e,t){var n=t.getAttribute("name"),i=r.joints[e];o.traverse((function(r){r.name===n&&(a[e]={object:r,transforms:Te(t),joint:i,position:i.zeroPosition})}))}}();var Qe=function(e){return Fe(s(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(He,"scene")[0]);return Qe.animations=Ze,"Z_UP"===Xe.upAxis&&Qe.quaternion.setFromEuler(new bg(-Math.PI/2,0,0)),Qe.scale.multiplyScalar(Xe.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ze},kinematics:Je,library:Ke,scene:Qe}}});var AA,RA,LA,CA,PA,OA,NA=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},IA=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},DA=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let kA=class extends Zh{constructor(){super(...arguments),AA.add(this),this.src="",RA.set(this,0)}loadGL(){this.loader=new EA,this.createEffect((()=>{var e;this.src,IA(this,AA,"m",LA).call(this),DA(this,RA,(e=IA(this,RA,"f"),++e),"f"),IA(this,AA,"m",CA).call(this)}))}unloadGL(){var e;this.loader=void 0,IA(this,AA,"m",LA).call(this),DA(this,RA,(e=IA(this,RA,"f"),++e),"f")}};RA=new WeakMap,AA=new WeakSet,LA=function(){this.model&&Ku(this.model.scene),this.model=void 0},CA=function(){const{src:e}=this,t=IA(this,RA,"f");e&&this.loader.load(e,(e=>t===IA(this,RA,"f")&&IA(this,AA,"m",OA).call(this,e)),(e=>t===IA(this,RA,"f")&&this.element.emit(Wi.PROGRESS,e)),(e=>t===IA(this,RA,"f")&&IA(this,AA,"m",PA).call(this,e)))},PA=function(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=e instanceof ErrorEvent&&e.error?e.error:e;console.error(n),this.element.emit(Wi.MODEL_ERROR,n)},OA=function(e){this.model=e,this.element.three.add(e.scene),this.element.emit(Wi.MODEL_LOAD,{format:"collada",model:e}),this.element.needsUpdate()},NA([_f(""),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],kA.prototype,"src",void 0),kA=NA([In],kA),elementBehaviors.has("collada-model")||elementBehaviors.define("collada-model",kA);var BA={},UA=void 0,FA=BA;function zA(e,t){var n,r=e.split("."),i=FA;!(r[0]in i)&&i.execScript&&i.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||t===UA?i=i[n]?i[n]:i[n]={}:i[n]=t}var HA="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function GA(e){var t,n,r,i,o,s,a,c,l,u,h=e.length,d=0,p=Number.POSITIVE_INFINITY;for(c=0;c<h;++c)e[c]>d&&(d=e[c]),e[c]<p&&(p=e[c]);for(t=1<<d,n=new(HA?Uint32Array:Array)(t),r=1,i=0,o=2;r<=d;){for(c=0;c<h;++c)if(e[c]===r){for(s=0,a=i,l=0;l<r;++l)s=s<<1|1&a,a>>=1;for(u=r<<16|c,l=s;l<t;l+=o)n[l]=u;++i}++r,i<<=1,o<<=1}return[n,d,p]}function jA(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=HA?new Uint8Array(e):e,this.m=!1,this.i=WA,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case VA:this.b=32768,this.c=new(HA?Uint8Array:Array)(32768+this.h+258);break;case WA:this.b=0,this.c=new(HA?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var VA=0,WA=1,qA={t:VA,s:WA};jA.prototype.k=function(){for(;!this.m;){var e=hR(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var t=this.input,n=this.a,r=this.c,i=this.b,o=t.length,s=UA,a=r.length,c=UA;if(this.d=this.f=0,n+1>=o)throw Error("invalid uncompressed block header: LEN");if(s=t[n++]|t[n++]<<8,n+1>=o)throw Error("invalid uncompressed block header: NLEN");if(s===~(t[n++]|t[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+s>t.length)throw Error("input buffer is broken");switch(this.i){case VA:for(;i+s>r.length;){if(s-=c=a-i,HA)r.set(t.subarray(n,n+c),i),i+=c,n+=c;else for(;c--;)r[i++]=t[n++];this.b=i,r=this.e(),i=this.b}break;case WA:for(;i+s>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(HA)r.set(t.subarray(n,n+s),i),i+=s,n+=s;else for(;s--;)r[i++]=t[n++];this.a=n,this.b=i,this.c=r;break;case 1:this.j(cR,uR);break;case 2:var l,u,h,d,p=hR(this,5)+257,f=hR(this,5)+1,m=hR(this,4)+4,g=new(HA?Uint8Array:Array)(JA.length),v=UA,y=UA,b=UA,x=UA,_=UA;for(_=0;_<m;++_)g[JA[_]]=hR(this,3);if(!HA)for(_=m,m=g.length;_<m;++_)g[JA[_]]=0;for(l=GA(g),v=new(HA?Uint8Array:Array)(p+f),_=0,d=p+f;_<d;)switch(y=dR(this,l),y){case 16:for(x=3+hR(this,2);x--;)v[_++]=b;break;case 17:for(x=3+hR(this,3);x--;)v[_++]=0;b=0;break;case 18:for(x=11+hR(this,7);x--;)v[_++]=0;b=0;break;default:b=v[_++]=y}u=GA(HA?v.subarray(0,p):v.slice(0,p)),h=GA(HA?v.subarray(p):v.slice(p)),this.j(u,h);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var XA,YA,ZA=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],JA=HA?new Uint16Array(ZA):ZA,$A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],KA=HA?new Uint16Array($A):$A,QA=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],eR=HA?new Uint8Array(QA):QA,tR=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],nR=HA?new Uint16Array(tR):tR,rR=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],iR=HA?new Uint8Array(rR):rR,oR=new(HA?Uint8Array:Array)(288);for(XA=0,YA=oR.length;XA<YA;++XA)oR[XA]=143>=XA?8:255>=XA?9:279>=XA?7:8;var sR,aR,cR=GA(oR),lR=new(HA?Uint8Array:Array)(30);for(sR=0,aR=lR.length;sR<aR;++sR)lR[sR]=5;var uR=GA(lR);function hR(e,t){for(var n,r=e.f,i=e.d,o=e.input,s=e.a,a=o.length;i<t;){if(s>=a)throw Error("input buffer is broken");r|=o[s++]<<i,i+=8}return n=r&(1<<t)-1,e.f=r>>>t,e.d=i-t,e.a=s,n}function dR(e,t){for(var n,r,i=e.f,o=e.d,s=e.input,a=e.a,c=s.length,l=t[0],u=t[1];o<u&&!(a>=c);)i|=s[a++]<<o,o+=8;if((r=(n=l[i&(1<<u)-1])>>>16)>o)throw Error("invalid code length: "+r);return e.f=i>>r,e.d=o-r,e.a=a,65535&n}function pR(e,t){var n,r;if(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],r=e[this.a++],(15&n)!==fR)throw Error("unsupported compression method");if(this.method=fR,0!=((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new jA(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}jA.prototype.j=function(e,t){var n=this.c,r=this.b;this.o=e;for(var i,o,s,a,c=n.length-258;256!==(i=dR(this,e));)if(256>i)r>=c&&(this.b=r,n=this.e(),r=this.b),n[r++]=i;else for(a=KA[o=i-257],0<eR[o]&&(a+=hR(this,eR[o])),i=dR(this,t),s=nR[i],0<iR[i]&&(s+=hR(this,iR[i])),r>=c&&(this.b=r,n=this.e(),r=this.b);a--;)n[r]=n[r++-s];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},jA.prototype.w=function(e,t){var n=this.c,r=this.b;this.o=e;for(var i,o,s,a,c=n.length;256!==(i=dR(this,e));)if(256>i)r>=c&&(c=(n=this.e()).length),n[r++]=i;else for(a=KA[o=i-257],0<eR[o]&&(a+=hR(this,eR[o])),i=dR(this,t),s=nR[i],0<iR[i]&&(s+=hR(this,iR[i])),r+a>c&&(c=(n=this.e()).length);a--;)n[r]=n[r++-s];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},jA.prototype.e=function(){var e,t,n=new(HA?Uint8Array:Array)(this.b-32768),r=this.b-32768,i=this.c;if(HA)n.set(i.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=i[e+32768];if(this.g.push(n),this.l+=n.length,HA)i.set(i.subarray(r,r+32768));else for(e=0;32768>e;++e)i[e]=i[r+e];return this.b=32768,i},jA.prototype.z=function(e){var t,n,r,i=this.input.length/this.a+1|0,o=this.input,s=this.c;return e&&("number"==typeof e.p&&(i=e.p),"number"==typeof e.u&&(i+=e.u)),n=2>i?(r=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+r:s.length<<1:s.length*i,HA?(t=new Uint8Array(n)).set(s):t=s,this.c=t},jA.prototype.n=function(){var e,t,n,r,i,o=0,s=this.c,a=this.g,c=new(HA?Uint8Array:Array)(this.l+(this.b-32768));if(0===a.length)return HA?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=a.length;t<n;++t)for(r=0,i=(e=a[t]).length;r<i;++r)c[o++]=e[r];for(t=32768,n=this.b;t<n;++t)c[o++]=s[t];return this.g=[],this.buffer=c},jA.prototype.v=function(){var e,t=this.b;return HA?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},pR.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=e;if("string"==typeof r){var i,o,s=r.split("");for(i=0,o=s.length;i<o;i++)s[i]=(255&s[i].charCodeAt(0))>>>0;r=s}for(var a,c=1,l=0,u=r.length,h=0;0<u;){u-=a=1024<u?1024:u;do{l+=c+=r[h++]}while(--a);c%=65521,l%=65521}if(t!==(l<<16|c)>>>0)throw Error("invalid adler-32 checksum")}return e};var fR=8;zA("Zlib.Inflate",pR),zA("Zlib.Inflate.prototype.decompress",pR.prototype.k);var mR,gR,vR,yR,bR={ADAPTIVE:qA.s,BLOCK:qA.t};if(Object.keys)mR=Object.keys(bR);else for(gR in mR=[],vR=0,bR)mR[vR++]=gR;for(vR=0,yR=mR.length;vR<yR;++vR)zA("Zlib.Inflate.BufferType."+(gR=mR[vR]),bR[gR]);var xR=BA.Zlib.Inflate,_R={findSpan:function(e,t,n){var r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;for(var i=e,o=r,s=Math.floor((i+o)/2);t<n[s]||t>=n[s+1];)t<n[s]?o=s:i=s,s=Math.floor((i+o)/2);return s},calcBasisFunctions:function(e,t,n,r){var i=[],o=[],s=[];i[0]=1;for(var a=1;a<=n;++a){o[a]=t-r[e+1-a],s[a]=r[e+a]-t;for(var c=0,l=0;l<a;++l){var u=s[l+1],h=o[a-l],d=i[l]/(u+h);i[l]=c+u*d,c=h*d}i[a]=c}return i},calcBSplinePoint:function(e,t,n,r){for(var i=this.findSpan(e,r,t),o=this.calcBasisFunctions(i,r,e,t),s=new Nm(0,0,0,0),a=0;a<=e;++a){var c=n[i-e+a],l=o[a],u=c.w*l;s.x+=c.x*u,s.y+=c.y*u,s.z+=c.z*u,s.w+=c.w*l}return s},calcBasisFunctionDerivatives:function(e,t,n,r,i){for(var o=[],s=0;s<=n;++s)o[s]=0;var a=[];for(s=0;s<=r;++s)a[s]=o.slice(0);var c=[];for(s=0;s<=n;++s)c[s]=o.slice(0);c[0][0]=1;for(var l=o.slice(0),u=o.slice(0),h=1;h<=n;++h){l[h]=t-i[e+1-h],u[h]=i[e+h]-t;for(var d=0,p=0;p<h;++p){var f=u[p+1],m=l[h-p];c[h][p]=f+m;var g=c[p][h-1]/c[h][p];c[p][h]=d+f*g,d=m*g}c[h][h]=d}for(h=0;h<=n;++h)a[0][h]=c[h][n];for(p=0;p<=n;++p){var v=0,y=1,b=[];for(s=0;s<=n;++s)b[s]=o.slice(0);b[0][0]=1;for(var x=1;x<=r;++x){var _=0,w=p-x,M=n-x;p>=x&&(b[y][0]=b[v][0]/c[M+1][w],_=b[y][0]*c[w][M]);var T=p-1<=M?x-1:n-p;for(h=w>=-1?1:-w;h<=T;++h)b[y][h]=(b[v][h]-b[v][h-1])/c[M+1][w+h],_+=b[y][h]*c[w+h][M];p<=M&&(b[y][x]=-b[v][x-1]/c[M+1][p],_+=b[y][x]*c[p][M]),a[x][p]=_,h=v,v=y,y=h}}for(p=n,x=1;x<=r;++x){for(h=0;h<=n;++h)a[x][h]*=p;p*=n-x}return a},calcBSplineDerivatives:function(e,t,n,r,i){for(var o=i<e?i:e,s=[],a=this.findSpan(e,r,t),c=this.calcBasisFunctionDerivatives(a,r,e,o,t),l=[],u=0;u<n.length;++u){var h=(p=n[u].clone()).w;p.x*=h,p.y*=h,p.z*=h,l[u]=p}for(var d=0;d<=o;++d){for(var p=l[a-e].clone().multiplyScalar(c[d][0]),f=1;f<=e;++f)p.add(l[a-e+f].clone().multiplyScalar(c[d][f]));s[d]=p}for(d=o+1;d<=i+1;++d)s[d]=new Nm(0,0,0);return s},calcKoverI:function(e,t){for(var n=1,r=2;r<=e;++r)n*=r;var i=1;for(r=2;r<=t;++r)i*=r;for(r=2;r<=e-t;++r)i*=r;return n/i},calcRationalCurveDerivatives:function(e){for(var t=e.length,n=[],r=[],i=0;i<t;++i){var o=e[i];n[i]=new Bm(o.x,o.y,o.z),r[i]=o.w}for(var s=[],a=0;a<t;++a){var c=n[a].clone();for(i=1;i<=a;++i)c.sub(s[a-i].clone().multiplyScalar(this.calcKoverI(a,i)*r[i]));s[a]=c.divideScalar(r[0])}return s},calcNURBSDerivatives:function(e,t,n,r,i){var o=this.calcBSplineDerivatives(e,t,n,r,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(e,t,n,r,i,o,s,a){for(var c=this.findSpan(e,o,n),l=this.findSpan(t,s,r),u=this.calcBasisFunctions(c,o,e,n),h=this.calcBasisFunctions(l,s,t,r),d=[],p=0;p<=t;++p){d[p]=new Nm(0,0,0,0);for(var f=0;f<=e;++f){var m=i[c-e+f][l-t+p].clone(),g=m.w;m.x*=g,m.y*=g,m.z*=g,d[p].add(m.multiplyScalar(u[f]))}}var v=new Nm(0,0,0,0);for(p=0;p<=t;++p)v.add(d[p].multiplyScalar(h[p]));v.divideScalar(v.w),a.set(v.x,v.y,v.z)}},wR=function(e,t,n,r,i){$w.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<n.length;++o){var s=n[o];this.controlPoints[o]=new Nm(s.x,s.y,s.z,s.w)}};(wR.prototype=Object.create($w.prototype)).constructor=wR,wR.prototype.getPoint=function(e,t){var n=t||new Bm,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=_R.calcBSplinePoint(this.degree,this.knots,this.controlPoints,r);return 1!=i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)},wR.prototype.getTangent=function(e,t){var n=t||new Bm,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=_R.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n};var MR,TR,SR,ER,AR,RR,LR=function(){var e,t,n;function r(e){Gw.call(this,e)}function i(e,t){this.textureLoader=e,this.manager=t}function o(){}function s(){}function a(){}function c(){}function l(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function u(){}function h(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}r.prototype=Object.assign(Object.create(Gw.prototype),{constructor:r,load:function(e,t,n,r){var i=this,o=""===i.path?kM(e):i.path,s=new Vw(this.manager);s.setPath(i.path),s.setResponseType("arraybuffer"),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(n){try{t(i.parse(n,o))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(t,n){if(s="Kaydara FBX Binary  \0",(o=t).byteLength>=s.length&&s===x(o,0,s.length))e=(new c).parse(t);else{var r=x(t);if(!function(e){var t,n,r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;for(var o=0;o<r.length;++o)if(n=void 0,n=e[(t=1)-1],e=e.slice(i+t),i++,n===r[o])return!1;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(h(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+h(r));e=(new a).parse(r)}var o,s;return new i(new Jw(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),i.prototype={constructor:i,parse:function(){t=this.parseConnections();var e=this.parseImages(),r=this.parseTextures(e),i=this.parseMaterials(r),s=this.parseDeformers(),a=(new o).parse(s);return this.parseScene(s,a,i),n},parseConnections:function(){var t=new Map;return"Connections"in e&&e.Connections.connections.forEach((function(e){var n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).parents.push(o),t.has(r)||t.set(r,{parents:[],children:[]});var s={ID:n,relationship:i};t.get(r).children.push(s)})),t},parseImages:function(){var t={},n={};if("Video"in e.Objects){var r=e.Objects.Video;for(var i in r){var o=r[i];if(t[l=parseInt(i)]=o.RelativeFilename||o.Filename,"Content"in o){var s=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,a="string"==typeof o.Content&&""!==o.Content;if(s||a){var c=this.parseImage(r[i]);n[o.RelativeFilename||o.Filename]=c}}}}for(var l in t){var u=t[l];void 0!==n[u]?t[l]=n[u]:t[l]=t[l].split("\\").pop()}return t},parseImage:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof n)return"data:"+t+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var n=new Map;if("Texture"in e.Objects){var r=e.Objects.Texture;for(var i in r){var o=this.parseTexture(r[i],t);n.set(parseInt(i),o)}}return n},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,i=e.WrapModeV,o=void 0!==r?r.value:0,s=void 0!==i?i.value:0;if(n.wrapS=0===o?Xf:Yf,n.wrapT=0===s?Xf:Yf,"Scaling"in e){var a=e.Scaling.value;n.repeat.x=a[0],n.repeat.y=a[1]}return n},loadTexture:function(e,n){var r,i,o=this.textureLoader.path,s=t.get(e.id).children;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(0!==(r=n[s[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));var a=e.FileName.slice(-3).toLowerCase();if("tga"===a){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new Pm):i=c.load(r)}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new Pm):i=this.textureLoader.load(r);return this.textureLoader.setPath(o),i},parseMaterials:function(t){var n=new Map;if("Material"in e.Objects){var r=e.Objects.Material;for(var i in r){var o=this.parseMaterial(r[i],t);null!==o&&n.set(parseInt(i),o)}}return n},parseMaterial:function(e,n){var r=e.id,i=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(r))return null;var s,a=this.parseParameters(e,n,r);switch(o.toLowerCase()){case"phong":s=new yw;break;case"lambert":s=new _w;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new yw}return s.setValues(a),s.name=i,s},parseParameters:function(e,n,r){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new iv).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new iv).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new iv).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new iv).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new iv).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new iv).fromArray(e.SpecularColor.value));var o=this;return t.get(r).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=o.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(n,e.ID),i.map.encoding=vm;break;case"DisplacementColor":i.displacementMap=o.getTexture(n,e.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(n,e.ID),i.emissiveMap.encoding=vm;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(n,e.ID);break;case"ReflectionColor":i.envMap=o.getTexture(n,e.ID),i.envMap.mapping=303,i.envMap.encoding=vm;break;case"SpecularColor":i.specularMap=o.getTexture(n,e.ID),i.specularMap.encoding=vm;break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(n,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),i},getTexture:function(n,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=t.get(r).children[0].ID),n.get(r)},parseDeformers:function(){var n={},r={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var o in i){var s=i[o],a=t.get(parseInt(o));if("Skin"===s.attrType){var c=this.parseSkeleton(a,i);c.ID=o,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=a.parents[0].ID,n[o]=c}else if("BlendShape"===s.attrType){var l={id:o};l.rawTargets=this.parseMorphTargets(a,i),l.id=o,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[o]=l}}}return{skeletons:n,morphTargets:r}},parseSkeleton:function(e,t){var n=[];return e.children.forEach((function(e){var r=t[e.ID];if("Cluster"===r.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new hg).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(e,n){for(var r=[],i=0;i<e.children.length;i++){var o=e.children[i],s=n[o.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=t.get(parseInt(o.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(a)}return r},parseScene:function(r,i,o){n=new vx;var a=this.parseModels(r.skeletons,i,o),c=e.Objects.Model,l=this;a.forEach((function(e){var r=c[e.ID];l.setLookAtProperties(e,r),t.get(e.ID).parents.forEach((function(t){var n=a.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(r.skeletons,i,a),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=v(e.userData.transformData);e.applyMatrix4(t)}}));var u=(new s).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=u,n=n.children[0]),n.animations=u},parseModels:function(n,r,i){var o=new Map,s=e.Objects.Model;for(var a in s){var c=parseInt(a),l=s[a],u=t.get(c),h=this.buildSkeleton(u,n,c,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(u);break;case"Light":h=this.createLight(u);break;case"Mesh":h=this.createMesh(u,r,i);break;case"NurbsCurve":h=this.createCurve(u,r);break;case"LimbNode":case"Root":h=new Kx;break;default:h=new vx}h.name=l.attrName?cT.sanitizeNodeName(l.attrName):"",h.ID=c}this.getTransformData(h,l),o.set(c,h)}return o},buildSkeleton:function(e,t,n,r){var i=null;return e.parents.forEach((function(e){for(var o in t){var s=t[o];s.rawBones.forEach((function(t,o){if(t.ID===e.ID){var a=i;(i=new Kx).matrixWorld.copy(t.transformLink),i.name=r?cT.sanitizeNodeName(r):"",i.ID=n,s.bones[o]=i,null!==a&&i.add(a)}}))}})),i},createCamera:function(t){var n,r;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new kg;else{var i=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(i=1);var o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);var s=1e3;void 0!==r.FarPlane&&(s=r.FarPlane.value/1e3);var a=window.innerWidth,c=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,c=r.AspectHeight.value);var l=a/c,u=45;void 0!==r.FieldOfView&&(u=r.FieldOfView.value);var h=r.FocalLength?r.FocalLength.value:null;switch(i){case 0:n=new sy(u,l,o,s),null!==h&&n.setFocalLength(h);break;case 1:n=new AM(-a/2,a/2,c/2,-c/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),n=new kg}}return n},createLight:function(t){var n,r;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new kg;else{var i;i=void 0===r.LightType?0:r.LightType.value;var o=16777215;void 0!==r.Color&&(o=(new iv).fromArray(r.Color.value));var s=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(s=0);var a=0;switch(void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),i){case 0:n=new EM(o,s,a,1);break;case 1:n=new LM(o,s);break;case 2:var c=Math.PI/3;void 0!==r.InnerAngle&&(c=Sm.degToRad(r.InnerAngle.value));var l=0;void 0!==r.OuterAngle&&(l=Sm.degToRad(r.OuterAngle.value),l=Math.max(l,1)),n=new TM(o,s,a,c,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new EM(o,s)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(e,t,n){var r,i=null,o=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&s.push(n.get(e.ID))})),s.length>1?o=s:s.length>0?o=s[0]:(o=new yw({color:13421772}),s.push(o)),"color"in i.attributes&&s.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),(r=new $x(i,o)).normalizeSkinWeights()):r=new $v(i,o),r},createCurve:function(e,t){return new p_(e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),new a_({color:3342591,linewidth:1}))},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?y(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(r,i){"LookAtProperty"in i&&t.get(r.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var o=i.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(o),n.add(r.target)):r.lookAt((new Bm).fromArray(o))}}}))},bindSkeleton:function(e,n,r){var i=this.parsePoseNodes();for(var o in e){var s=e[o];t.get(parseInt(s.ID)).parents.forEach((function(e){if(n.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new t_(s.bones),i[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var n=e.Objects.Pose;for(var r in n)if("BindPose"===n[r].attrType){var i=n[r].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new hg).fromArray(e.Matrix.a)})):t[i.Node]=(new hg).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,r=t[0],i=t[1],o=t[2];if(0!==r||0!==i||0!==o){var s=new iv(r,i,o);n.add(new CM(s,1))}}},setupMorphMaterials:function(){var e=this;n.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,r){e.setupMorphMaterial(t,n,r)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,r){var i=e.uuid,o=t.uuid,s=!1;if(n.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===o&&e.uuid!==i&&(s=!0)})):e.material.uuid===o&&e.uuid!==i&&(s=!0))})),!0===s){var a=t.clone();a.morphTargets=!0,void 0===r?e.material=a:e.material[r]=a}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(n){var r=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var o in i){var s=t.get(parseInt(o)),a=this.parseGeometry(s,i[o],n);r.set(parseInt(o),a)}}return r},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,n,r){var i=r.skeletons,o=[],s=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==s.length){var a=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&o.push(r.morphTargets[e.ID])}));var c=s[0],l={};"RotationOrder"in c&&(l.eulerOrder=y(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);var u=v(l);return this.genGeometry(n,a,o,u)}},genGeometry:function(e,t,n,r){var i=new Nv;e.attrName&&(i.name=e.attrName);var o=this.parseGeoNode(e,t),s=this.genBuffers(o),a=new xv(s.vertex,3);if(a.applyMatrix4(r),i.setAttribute("position",a),s.colors.length>0&&i.setAttribute("color",new xv(s.colors,3)),t&&(i.setAttribute("skinIndex",new gv(s.weightsIndices,4)),i.setAttribute("skinWeight",new xv(s.vertexWeights,4)),i.FBX_Deformer=t),s.normal.length>0){var c=(new Am).getNormalMatrix(r),l=new xv(s.normal,3);l.applyNormalMatrix(c),i.setAttribute("normal",l)}if(s.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),i.setAttribute(n,new xv(s.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var u=s.materialIndex[0],h=0;if(s.materialIndex.forEach((function(e,t){e!==u&&(i.addGroup(h,t-h,u),u=e,h=t)})),i.groups.length>0){var d=i.groups[i.groups.length-1],p=d.start+d.count;p!==s.materialIndex.length&&i.addGroup(p,s.materialIndex.length-p,u)}0===i.groups.length&&i.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var r=0;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],s=[],a=[],c=[],l=[],u=[],h=this;return e.vertexIndices.forEach((function(d,p){var m=!1;d<0&&(d^=-1,m=!0);var g=[],v=[];if(o.push(3*d,3*d+1,3*d+2),e.color){var y=f(p,n,d,e.color);a.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var b=[0,0,0,0],x=[0,0,0,0];v.forEach((function(e,t){var n=e,r=g[t];x.forEach((function(e,t,i){if(n>e){i[t]=n,n=e;var o=b[t];b[t]=r,r=o}}))})),g=b,v=x}for(;v.length<4;)v.push(0),g.push(0);for(var _=0;_<4;++_)l.push(v[_]),u.push(g[_])}if(e.normal&&(y=f(p,n,d,e.normal),s.push(y[0],y[1],y[2])),e.material&&"AllSame"!==e.material.mappingType)var w=f(p,n,d,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var r=f(p,n,d,e);void 0===c[t]&&(c[t]=[]),c[t].push(r[0]),c[t].push(r[1])})),r++,m&&(h.genFace(t,e,o,w,s,a,c,l,u,r),n++,r=0,o=[],s=[],a=[],c=[],l=[],u=[])})),t},genFace:function(e,t,n,r,i,o,s,a,c,l){for(var u=2;u<l;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(s[n][0]),e.uvs[n].push(s[n][1]),e.uvs[n].push(s[n][2*(u-1)]),e.uvs[n].push(s[n][2*(u-1)+1]),e.uvs[n].push(s[n][2*u]),e.uvs[n].push(s[n][2*u+1])}))},addMorphTargets:function(t,n,r,i){if(0!==r.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var s=e.Objects.Geometry[r.geoID];void 0!==s&&o.genMorphGeometry(t,n,s,i,r.name)}))}))}},genMorphGeometry:function(e,t,n,r,i){for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],a=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,l=new Float32Array(c),u=0;u<a.length;u++){var h=3*a[u];l[h]=s[3*u],l[h+1]=s[3*u+1],l[h+2]=s[3*u+2]}var d={vertexIndices:o,vertexPositions:l},p=new xv(this.genBuffers(d).vertex,3);p.name=i||n.attrName,p.applyMatrix4(r),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===wR)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Nv;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Nv;for(var n,r,i=t-1,o=e.KnotVector.a,s=[],a=e.Points.a,c=0,l=a.length;c<l;c+=4)s.push((new Nm).fromArray(a,c));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form)for(n=i,r=o.length-1-n,c=0;c<i;++c)s.push(s[c]);var u=new wR(i,o,s,n,r).getPoints(7*s.length),h=new Float32Array(3*u.length);u.forEach((function(e,t){e.toArray(h,3*t)}));var d=new Nv;return d.setAttribute("position",new hv(h,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],i=this.addClip(r);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var n=this.parseAnimationLayers(t);return this.parseAnimStacks(n)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,n=new Map;for(var r in t){var i=t[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n},parseAnimationCurves:function(n){var r=e.Objects.AnimationCurve;for(var i in r){var o={id:r[i].id,times:r[i].KeyTime.a.map(d),values:r[i].KeyValueFloat.a},s=t.get(o.id);if(void 0!==s){var a=s.parents[0].ID,c=s.parents[0].relationship;c.match(/X/)?n.get(a).curves.x=o:c.match(/Y/)?n.get(a).curves.y=o:c.match(/Z/)?n.get(a).curves.z=o:c.match(/d|DeformPercent/)&&n.has(a)&&(n.get(a).curves.morph=o)}}},parseAnimationLayers:function(r){var i=e.Objects.AnimationLayer,o=new Map;for(var s in i){var a=[],c=t.get(parseInt(s));void 0!==c&&(c.children.forEach((function(i,o){if(r.has(i.ID)){var s=r.get(i.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===a[o]&&void 0!==(p=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){if(void 0===(l=e.Objects.Model[p.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",i);var c={modelName:l.attrName?cT.sanitizeNodeName(l.attrName):"",ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===l.id&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))})),c.transform||(c.transform=new hg),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),a[o]=c}a[o]&&(a[o][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===a[o]){var l,u=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,h=t.get(u).parents[0].ID,d=t.get(h).parents[0].ID,p=t.get(d).parents[0].ID;c={modelName:(l=e.Objects.Model[p]).attrName?cT.sanitizeNodeName(l.attrName):"",morphName:e.Objects.Deformer[u].attrName},a[o]=c}a[o][s.attr]=s}}})),o.set(parseInt(s),a))}return o},parseAnimStacks:function(n){var r=e.Objects.AnimationStack,i={};for(var o in r){var s=t.get(parseInt(o)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=n.get(s[0].ID);i[o]={name:r[o].attrName,layer:a}}return i},addClip:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new Uw(e.name,-1,t)},generateTracks:function(e){var t=[],n=new Bm,r=new km,i=new Bm;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new bg).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var s=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==s&&t.push(s)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==a&&t.push(a)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,n,r){var i=this.getTimesForAllAxes(t);return new Bw(e+"."+r,i,this.getKeyframeTrackValues(i,t,n))},generateRotationTrack:function(e,t,n,r,i,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Sm.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Sm.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Sm.degToRad));var s=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(s,t,n);void 0!==r&&((r=r.map(Sm.degToRad)).push(o),r=(new bg).fromArray(r),r=(new km).setFromEuler(r)),void 0!==i&&((i=i.map(Sm.degToRad)).push(o),i=(new bg).fromArray(i),i=(new km).setFromEuler(i).invert());for(var c=new km,l=new bg,u=[],h=0;h<a.length;h+=3)l.set(a[h],a[h+1],a[h+2],o),c.setFromEuler(l),void 0!==r&&c.premultiply(r),void 0!==i&&c.multiply(i),c.toArray(u,h/3*4);return new Dw(e+".quaternion",s,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Nw(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)},getTimesForAllAxes:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort((function(e,t){return e-t}))).length>1){for(var n=1,r=t[0],i=1;i<t.length;i++){var o=t[i];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t},getKeyframeTrackValues:function(e,t,n){var r=n,i=[],o=-1,s=-1,a=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){var n=t.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==s){var c=t.y.values[s];i.push(c),r[1]=c}else i.push(r[1]);if(-1!==a){var l=t.z.values[a];i.push(l),r[2]=l}else i.push(r[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){for(var o=i/180,s=r/o,a=n+s,c=e.times[t-1],l=(e.times[t]-c)/o,u=c+l,h=[],d=[];u<e.times[t];)h.push(u),u+=l,d.push(a),a+=s;e.times=_(e.times,t,h),e.values=_(e.values,t,d)}}}},a.prototype={constructor:a,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new u,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){var i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!i&&!o){var s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,n[++r]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in s?("PoseNode"===n?s.PoseNode.push(i):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==o.id&&(s[n][o.id]=i)):"number"==typeof o.id?(s[n]={},s[n][o.id]=i):"Properties70"!==n&&(s[n]="PoseNode"===n?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}},parseNodeProperty:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var s=i.split(",").slice(1),a=parseInt(s[0]),c=parseInt(s[1]),l=i.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i=[a,c],l=l.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=b(i))}else this.parseNodeSpecialProperty(e,r,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,n){var r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],s=r[2],a=r[3],c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=b(c)}this.getPrevNode()[i]={type:o,type2:s,flag:a,value:c},this.setCurrentProp(this.getPrevNode(),i)}},c.prototype={constructor:c,parse:function(e){var t=new l(e);t.skip(23);var n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var r=new u;!this.endOfContent(t);){var i=this.parseNode(t,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var o=e.getUint8(),s=e.getString(o);if(0===r)return null;for(var a=[],c=0;c<i;c++)a.push(this.parseProperty(e));var l=a.length>0?a[0]:"",u=a.length>1?a[1]:"",h=a.length>2?a[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(s,n,d)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==s&&(n.name=s),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var i=[];n.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){var o,s=n.propertyList[0],a=n.propertyList[1],c=n.propertyList[2],l=n.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),o="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[s]={type:a,type2:c,flag:l,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===xR&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new l(new xR(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},l.prototype={constructor:l,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),DM(new Uint8Array(t))}},u.prototype={constructor:u,add:function(e,t){this[e]=t}};var p=[];function f(e,t,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,s=o+r.dataSize;return function(e,t,n,r){for(var i=n,o=0;i<r;i++,o++)e[o]=t[i];return e}(p,r.buffer,o,s)}var m=new bg,g=new Bm;function v(e){var t,n=new hg,r=new hg,i=new hg,o=new hg,s=new hg,a=new hg,c=new hg,l=new hg,u=new hg,h=new hg,d=new hg,p=e.inheritType?e.inheritType:0;e.translation&&n.setPosition(g.fromArray(e.translation)),e.preRotation&&((t=e.preRotation.map(Sm.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(m.fromArray(t))),e.rotation&&((t=e.rotation.map(Sm.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(m.fromArray(t))),e.postRotation&&((t=e.postRotation.map(Sm.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(m.fromArray(t))),e.scale&&s.scale(g.fromArray(e.scale)),e.scalingOffset&&c.setPosition(g.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(g.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(g.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(g.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var f=r.multiply(i).multiply(o),v=new hg;h.extractRotation(v),(new hg).copyPosition(h);var y=new hg;y.copy(v).invert().multiply(h);var b=new hg;if(0===p)b.copy(v).multiply(f).multiply(y).multiply(s);else if(1===p)b.copy(v).multiply(y).multiply(f).multiply(s);else{var x=new hg;x.copy(s).invert();var _=(new hg).multiply(y).multiply(x);b.copy(v).multiply(f).multiply(_).multiply(s)}var w=new hg;w.copy(u).invert();var M=new hg;M.copy(a).invert();var T=new hg;T.copy(n).multiply(l).multiply(u).multiply(r).multiply(i).multiply(o).multiply(w).multiply(c).multiply(a).multiply(s).multiply(M);var S=(new hg).copyPosition(T),E=(new hg).copy(h).multiply(S);return d.copyPosition(E),(new hg).multiply(d).multiply(b)}function y(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function x(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),DM(new Uint8Array(e,t,n))}function _(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}return r}(),CR=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},PR=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},OR=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let NR=class extends Zh{constructor(){super(...arguments),MR.add(this),this.src="",TR.set(this,0)}loadGL(){this.loader=new LR,this.createEffect((()=>{var e;this.src,PR(this,MR,"m",SR).call(this),OR(this,TR,(e=PR(this,TR,"f"),++e),"f"),PR(this,MR,"m",ER).call(this)}))}unloadGL(){var e;this.loader=void 0,PR(this,MR,"m",SR).call(this),OR(this,TR,(e=PR(this,TR,"f"),++e),"f")}};TR=new WeakMap,MR=new WeakSet,SR=function(){this.model&&Ku(this.model),this.model=void 0},ER=function(){const{src:e}=this,t=PR(this,TR,"f");e&&this.loader.load(e,(e=>t===PR(this,TR,"f")&&PR(this,MR,"m",RR).call(this,e)),(e=>t===PR(this,TR,"f")&&this.element.emit(Wi.PROGRESS,e)),(e=>t===PR(this,TR,"f")&&PR(this,MR,"m",AR).call(this,e)))},AR=function(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}". See the following error.`;console.warn(t);const n=e instanceof ErrorEvent&&e.error?e.error:e;console.error(n),this.element.emit(Wi.MODEL_ERROR,n)},RR=function(e){this.model=e,this.element.three.add(e),this.element.emit(Wi.MODEL_LOAD,{format:"fbx",model:e}),this.element.needsUpdate()},CR([_f(""),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],NR.prototype,"src",void 0),NR=CR([In],NR),elementBehaviors.has("fbx-model")||elementBehaviors.define("fbx-model",NR);class IR extends Ro{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}var DR=function(e){Gw.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};DR.prototype=Object.assign(Object.create(Gw.prototype),{constructor:DR,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,r){var i=new Vw(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(r)}),n,r)},decodeDracoFile:function(e,t,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)},decodeGeometry:function(e,t){for(var n in t.attributeTypes){var r=t.attributeTypes[n];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=r.name)}var i,o=JSON.stringify(t);if(DR.taskCache.has(e)){var s=DR.taskCache.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a=this.workerNextTaskID++,c=e.byteLength,l=this._getWorker(a,c).then((n=>(i=n,new Promise(((n,r)=>{i._callbacks[a]={resolve:n,reject:r},i.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return l.catch((()=>!0)).then((()=>{i&&a&&this._releaseTask(i,a)})),DR.taskCache.set(e,{key:o,promise:l}),l},_createGeometry:function(e){var t=new Nv;e.index&&t.setIndex(new hv(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n],i=r.name,o=r.array,s=r.itemSize;t.setAttribute(i,new hv(o,s))}return t},_loadLibrary:function(e,t){var n=new Vw(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,r)=>{n.load(e,t,void 0,r)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var r=DR.DRACOWorker.toString(),i=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then((()=>{var n;return this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1})),(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),DR.DRACOWorker=function(){var e,t;function n(e,t,n,r,i,o){var s=o.num_components(),a=n.num_points()*s,c=a*i.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),u=e._malloc(c);t.GetAttributeDataArrayForAllPoints(n,o,l,c,u);var h=new i(e.HEAPF32.buffer,u,a).slice();return e._free(u),{name:r,array:h,itemSize:s}}onmessage=function(r){var i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var o=i.buffer,s=i.taskConfig;t.then((e=>{var t=e.draco,r=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(o),o.byteLength);try{var c=function(e,t,r,i){var o,s,a=i.attributeIDs,c=i.attributeTypes,l=t.GetEncodedGeometryType(r);if(l===e.TRIANGULAR_MESH)o=new e.Mesh,s=t.DecodeBufferToMesh(r,o);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,s=t.DecodeBufferToPointCloud(r,o)}if(!s.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var u={index:null,attributes:[]};for(var h in a){var d,p,f=self[c[h]];if(i.useUniqueIDs)p=a[h],d=t.GetAttributeByUniqueId(o,p);else{if(-1===(p=t.GetAttributeId(o,e[a[h]])))continue;d=t.GetAttribute(o,p)}u.attributes.push(n(e,t,o,h,f,d))}return l===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){var r=3*n.num_faces(),i=4*r,o=e._malloc(i);t.GetTrianglesUInt32Array(n,i,o);var s=new Uint32Array(e.HEAPF32.buffer,o,r).slice();return e._free(o),{array:s,itemSize:1}}(e,t,o)),e.destroy(o),u}(t,r,a,s),l=c.attributes.map((e=>e.array.buffer));c.index&&l.push(c.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:c},l)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(a),t.destroy(r)}}))}}},DR.taskCache=new WeakMap,DR.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},DR.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},DR.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},DR.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var kR,BR,UR,FR,zR,HR,GR=function(){function e(e){Gw.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new u(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(Gw.prototype),{constructor:e,load:function(e,t,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:kM(e),this.manager.itemStart(e);var s=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},a=new Vw(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{o.parse(n,i,(function(n){t(n),o.manager.itemEnd(e)}),s)}catch(e){s(e)}}),n,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,s){var a,c={},l={};if("string"==typeof e)a=e;else if(DM(new Uint8Array(e,0,4))===h){try{c[n.KHR_BINARY_GLTF]=new d(e)}catch(e){return void(s&&s(e))}a=c[n.KHR_BINARY_GLTF].content}else a=DM(new Uint8Array(e));var u=JSON.parse(a);if(void 0===u.asset||u.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var m=new O(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});m.fileLoader.setRequestHeader(this.requestHeader);for(var y=0;y<this.pluginCallbacks.length;y++){var b=this.pluginCallbacks[y](m);l[b.name]=b,c[b.name]=!0}if(u.extensionsUsed)for(y=0;y<u.extensionsUsed.length;++y){var x=u.extensionsUsed[y],_=u.extensionsRequired||[];switch(x){case n.KHR_MATERIALS_UNLIT:c[x]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[x]=new g;break;case n.KHR_DRACO_MESH_COMPRESSION:c[x]=new p(u,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:c[x]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:c[x]=new f;break;case n.KHR_MESH_QUANTIZATION:c[x]=new v;break;default:_.indexOf(x)>=0&&void 0===l[x]&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}m.setExtensions(c),m.setPlugins(l),m.parse(i,s)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function o(){this.name=n.KHR_MATERIALS_UNLIT}function s(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function a(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function c(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function l(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function u(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}i.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},i.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var i,o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],a=new iv(16777215);void 0!==s.color&&a.fromArray(s.color);var c=void 0!==s.range?s.range:0;switch(s.type){case"directional":(i=new LM(a)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new EM(a)).distance=c;break;case"spot":(i=new TM(a)).distance=c,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,i.angle=s.spot.outerConeAngle,i.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return i.position.set(0,0,0),i.decay=2,void 0!==s.intensity&&(i.intensity=s.intensity),i.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r},i.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))},o.prototype.getMaterialType=function(){return cv},o.prototype.extendParams=function(e,t,n){var r=[];e.color=new iv(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vw:null},s.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Em(s,s)}return Promise.all(i)},a.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?vw:null},a.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)},c.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,s)},l.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],s=r.images[o.source],a=s.uri?n.options.manager.getHandler(s.uri):n.textureLoader;return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},l.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},u.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,s=r.byteStride,a=new ArrayBuffer(i*s),c=new Uint8Array(e[0],t,n);return o.decodeGltfBuffer(new Uint8Array(a),i,s,c,r.mode,r.filter),a}))}return null};var h="glTF";function d(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:DM(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=new DataView(e,12),i=0;i<r.byteLength;){var o=r.getUint32(i,!0);i+=4;var s=r.getUint32(i,!0);if(i+=4,1313821514===s){var a=new Uint8Array(e,12+i,o);this.content=DM(a)}else if(5130562===s){var c=12+i;this.body=e.slice(c,c+o)}i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function p(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function f(){this.name=n.KHR_TEXTURE_TRANSFORM}function m(e){gw.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new iv).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var a in s)e.uniforms[a]=s[a];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function g(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return m},extendParams:function(e,t,n){var r=t.extensions[this.name];e.color=new iv(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new iv(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new iv(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var s=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",s)),i.push(n.assignTexture(e,"specularMap",s))}return Promise.all(i)},createMaterial:function(e){var t=new m(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function v(){this.name=n.KHR_MESH_QUANTIZATION}function y(e,t,n,r){Ew.call(this,e,t,n,r)}p.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},a={},c={};for(var l in o){var u=M[l]||l.toLowerCase();s[u]=o[l]}for(l in e.attributes)if(u=M[l]||l.toLowerCase(),void 0!==o[l]){var h=n.accessors[e.attributes[l]],d=b[h.componentType];c[u]=d,a[u]=!0===h.normalized}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=a[n];void 0!==i&&(r.normalized=i)}t(e)}),s,c)}))}))},f.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},m.prototype=Object.create(gw.prototype),m.prototype.constructor=m,m.prototype.copy=function(e){return gw.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},y.prototype=Object.create(Ew.prototype),y.prototype.constructor=y,y.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,o=0;o!==r;o++)t[o]=n[i+o];return t},y.prototype.beforeStart_=y.prototype.copySampleValue_,y.prototype.afterEnd_=y.prototype.copySampleValue_,y.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,c=3*s,l=r-t,u=(n-t)/l,h=u*u,d=h*u,p=e*c,f=p-c,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u,b=0;b!==s;b++){var x=o[f+b+s],_=o[f+b+a]*l,w=o[p+b+s],M=o[p+b]*l;i[b]=v*x+y*_+m*w+g*M}return i};var b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:Jf,9729:Qf,9984:$f,9985:1007,9986:Kf,9987:em},_={33071:Yf,33648:Zf,10497:Xf},w={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},T={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:void 0,LINEAR:hm,STEP:um};function E(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function A(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new gw({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function R(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function L(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function C(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length)for(e.morphTargetDictionary={},n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function P(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function O(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new zM(this.options.manager):this.textureLoader=new Jw(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Vw(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function N(e,t,n){var r=t.attributes,i=[];function o(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var s in r){var a=M[s]||s.toLowerCase();a in e.attributes||i.push(o(r[s],a))}if(void 0!==t.indices&&!e.index){var c=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(c)}return L(e,t),function(e,t,n){var r=t.attributes,i=new zm;if(void 0!==r.POSITION){var o=(d=n.json.accessors[r.POSITION]).min,s=d.max;if(void 0!==o&&void 0!==s){i.set(new Bm(o[0],o[1],o[2]),new Bm(s[0],s[1],s[2]));var a=t.targets;if(void 0!==a){for(var c=new Bm,l=new Bm,u=0,h=a.length;u<h;u++){var d,p=a[u];void 0!==p.POSITION&&(o=(d=n.json.accessors[p.POSITION]).min,s=d.max,void 0!==o&&void 0!==s?(l.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),c.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}i.expandByVector(c)}e.boundingBox=i;var f=new ng;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,o=0,s=t.length;o<s&&(void 0!==(l=t[o]).POSITION&&(r=!0),void 0!==l.NORMAL&&(i=!0),!r||!i);o++);if(!r&&!i)return Promise.resolve(e);var a=[],c=[];for(o=0,s=t.length;o<s;o++){var l=t[o];if(r){var u=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;a.push(u)}i&&(u=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal,c.push(u))}return Promise.all([Promise.all(a),Promise.all(c)]).then((function(t){var n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function I(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<i.count;o++)r.push(o);e.setIndex(r),n=e.getIndex()}var s=n.count-2,a=[];if(2===t)for(o=1;o<=s;o++)a.push(n.getX(0)),a.push(n.getX(o)),a.push(n.getX(o+1));else for(o=0;o<s;o++)o%2==0?(a.push(n.getX(o)),a.push(n.getX(o+1)),a.push(n.getX(o+2))):(a.push(n.getX(o+2)),a.push(n.getX(o+1)),a.push(n.getX(o)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(a),c}return O.prototype.setExtensions=function(e){this.extensions=e},O.prototype.setPlugins=function(e){this.plugins=e},O.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};R(i,o,r),L(o,r),e(o)})).catch(t)},O.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var o=t[r].joints,s=0,a=o.length;s<a;s++)e[o[s]].isBone=!0;for(var c=0,l=e.length;c<l;c++){var u=e[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},O.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},O.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},O.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},O.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n},O.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},O.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},O.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,n){r.load(E(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},O.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},O.prototype.loadAccessor=function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,o=e[0],s=w[r.type],a=b[r.componentType],c=a.BYTES_PER_ELEMENT,l=c*s,u=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(h&&h!==l){var p=Math.floor(u/h),f="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+p+":"+r.count,m=t.cache.get(f);m||(m=new Tx(new a(o,p*h,r.count*h/c),h/c),t.cache.add(f,m)),i=new Ex(m,s,u%h/c,d)}else i=new hv(null===o?new a(r.count*s):new a(o,u,r.count*s),s,d);if(void 0!==r.sparse){var g=w.SCALAR,v=b[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,x=r.sparse.values.byteOffset||0,_=new v(e[1],y,r.sparse.count*g),M=new a(e[2],x,r.sparse.count*s);null!==o&&(i=new hv(i.array.slice(),i.itemSize,i.normalized));for(var T=0,S=_.length;T<S;T++){var E=_[T];if(i.setX(E,M[T*s]),s>=2&&i.setY(E,M[T*s+1]),s>=3&&i.setZ(E,M[T*s+2]),s>=4&&i.setW(E,M[T*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},O.prototype.loadTexture=function(e){var t,r,i=this.json,o=this.options,s=i.textures[e],a=s.extensions||{};return(t=a[n.MSFT_TEXTURE_DDS]?i.images[a[n.MSFT_TEXTURE_DDS].source]:i.images[s.source]).uri&&(r=o.manager.getHandler(t.uri)),r||(r=a[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,r)},O.prototype.loadTextureImage=function(e,t,n){var r=this,i=this.json,o=this.options,s=i.textures[e],a=self.URL||self.webkitURL,c=t.uri,l=!1,u=!0;return"image/jpeg"===t.mimeType&&(u=!1),void 0!==t.bufferView&&(c=r.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);u=6===n||4===n||3===n}l=!0;var r=new Blob([e],{type:t.mimeType});return c=a.createObjectURL(r)}))),Promise.resolve(c).then((function(e){return new Promise((function(t,r){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){t(new A_(e))}),n.load(E(e,o.path),i,void 0,r)}))})).then((function(t){!0===l&&a.revokeObjectURL(c),t.flipY=!1,s.name&&(t.name=s.name),u||(t.format=sm);var n=(i.samplers||{})[s.sampler]||{};return t.magFilter=x[n.magFilter]||Qf,t.minFilter=x[n.minFilter]||em,t.wrapS=_[n.wrapS]||Xf,t.wrapT=_[n.wrapT]||Xf,r.associations.set(t,{type:"textures",index:e}),t}))},O.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then((function(o){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var a=i.associations.get(o);o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),i.associations.set(o,a)}}e[t]=o}))},O.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=void 0!==t.attributes.tangent,i=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,a=Object.keys(t.morphAttributes).length>0,c=a&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+n.uuid,u=this.cache.get(l);u||(u=new y_,av.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(l,u)),n=u}else if(e.isLine){l="LineBasicMaterial:"+n.uuid;var h=this.cache.get(l);h||(h=new a_,av.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(r||i||o||s||a){l="ClonedMaterial:"+n.uuid+":",n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),s&&(l+="skinning:"),r&&(l+="vertex-tangents:"),i&&(l+="vertex-colors:"),o&&(l+="flat-shading:"),a&&(l+="morph-targets:"),c&&(l+="morph-normals:");var d=this.cache.get(l);d||(d=n.clone(),s&&(d.skinning=!0),r&&(d.vertexTangents=!0),i&&(d.vertexColors=!0),o&&(d.flatShading=!0),a&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(l,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),n.normalScale&&!r&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!r&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),e.material=n},O.prototype.getMaterialType=function(){return gw},O.prototype.loadMaterial=function(e){var t,r=this,i=this.json,o=this.extensions,s=i.materials[e],a={},c=s.extensions||{},l=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),l.push(u.extendParams(a,s,r))}else if(c[n.KHR_MATERIALS_UNLIT]){var h=o[n.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),l.push(h.extendParams(a,s,r))}else{var d=s.pbrMetallicRoughness||{};if(a.color=new iv(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}void 0!==d.baseColorTexture&&l.push(r.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(l.push(r.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),l.push(r.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=2);var f=s.alphaMode||"OPAQUE";return"BLEND"===f?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===f&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==cv&&(l.push(r.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Em(1,1),void 0!==s.normalTexture.scale&&a.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==cv&&(l.push(r.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==cv&&(a.emissive=(new iv).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==cv&&l.push(r.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){var i;return i=t===m?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),s.name&&(i.name=s.name),i.map&&(i.map.encoding=vm),i.emissiveMap&&(i.emissiveMap.encoding=vm),L(i,s),r.associations.set(i,{type:"materials",index:e}),s.extensions&&R(o,i,s),i}))},O.prototype.createUniqueName=function(e){for(var t=cT.sanitizeNodeName(e||""),n=t,r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n},O.prototype.loadGeometries=function(e){var t=this,r=this.extensions,i=this.primitiveCache;function o(e){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return N(n,e,t)}))}for(var s,a,c=[],l=0,u=e.length;l<u;l++){var h,d=e[l],p=(void 0,(a=(s=d).extensions&&s.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+P(a.attributes):s.indices+":"+P(s.attributes)+":"+s.mode),f=i[p];f?c.push(f.promise):(h=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(d):N(new Nv,d,t),i[p]={primitive:d,promise:h},c.push(h))}return Promise.all(c)},O.prototype.loadMesh=function(e){for(var t=this,n=this.json,r=this.extensions,i=n.meshes[e],o=i.primitives,s=[],a=0,c=o.length;a<c;a++){var l=void 0===o[a].material?A(this.cache):this.getDependency("material",o[a].material);s.push(l)}return s.push(t.loadGeometries(o)),Promise.all(s).then((function(n){for(var s=n.slice(0,n.length-1),a=n[n.length-1],c=[],l=0,u=a.length;l<u;l++){var h,d=a[l],p=o[l],f=s[l];if(4===p.mode||5===p.mode||6===p.mode||void 0===p.mode)!0!==(h=!0===i.isSkinnedMesh?new $x(d,f):new $v(d,f)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),5===p.mode?h.geometry=I(h.geometry,1):6===p.mode&&(h.geometry=I(h.geometry,2));else if(1===p.mode)h=new g_(d,f);else if(3===p.mode)h=new p_(d,f);else if(2===p.mode)h=new v_(d,f);else{if(0!==p.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);h=new M_(d,f)}Object.keys(h.geometry.morphAttributes).length>0&&C(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),L(h,i),p.extensions&&R(r,h,p),t.assignFinalMaterial(h),c.push(h)}if(1===c.length)return c[0];var m=new vx;for(l=0,u=c.length;l<u;l++)m.add(c[l]);return m}))},O.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new sy(Sm.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new AM(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),L(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},O.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},O.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],r=[],i=[],o=[],s=[],a=0,c=t.channels.length;a<c;a++){var l=t.channels[a],u=t.samplers[l.sampler],h=l.target,d=void 0!==h.node?h.node:h.id,p=void 0!==t.parameters?t.parameters[u.input]:u.input,f=void 0!==t.parameters?t.parameters[u.output]:u.output;n.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",p)),i.push(this.getDependency("accessor",f)),o.push(u),s.push(h)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(s)]).then((function(n){for(var r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=[],l=0,u=r.length;l<u;l++){var h=r[l],d=i[l],p=o[l],f=s[l],m=a[l];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,T[m.path]){case T.weights:g=Nw;break;case T.rotation:g=Dw;break;default:g=Bw}var v=h.name?h.name:h.uuid,b=void 0!==f.interpolation?S[f.interpolation]:hm,x=[];T[m.path]===T.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)})):x.push(v);var _=p.array;if(p.normalized){var w;if(_.constructor===Int8Array)w=1/127;else if(_.constructor===Uint8Array)w=1/255;else if(_.constructor==Int16Array)w=1/32767;else{if(_.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var M=new Float32Array(_.length),E=0,A=_.length;E<A;E++)M[E]=_[E]*w;_=M}for(E=0,A=x.length;E<A;E++){var R=new g(x[E]+"."+T[m.path],d.array,_,b);"CUBICSPLINE"===f.interpolation&&(R.createInterpolant=function(e){return new y(this.times,this.values,this.getValueSize()/3,e)},R.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(R)}}}return new Uw(t.name?t.name:"animation_"+e,void 0,c)}))},O.prototype.loadNode=function(e){var t,n=this.json,r=this.extensions,i=this,o=n.nodes[e],s=o.name?i.createUniqueName(o.name):"";return(t=[],void 0!==o.mesh&&t.push(i.getDependency("mesh",o.mesh).then((function(e){var t=i._getNodeRef(i.meshCache,o.mesh,e);return void 0!==o.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=o.weights.length;t<n;t++)e.morphTargetInfluences[t]=o.weights[t]})),t}))),void 0!==o.camera&&t.push(i.getDependency("camera",o.camera).then((function(e){return i._getNodeRef(i.cameraCache,o.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===o.isBone?new Kx:t.length>1?new vx:1===t.length?t[0]:new kg)!==t[0])for(var a=0,c=t.length;a<c;a++)n.add(t[a]);if(o.name&&(n.userData.name=o.name,n.name=s),L(n,o),o.extensions&&R(r,n,o),void 0!==o.matrix){var l=new hg;l.fromArray(o.matrix),n.applyMatrix4(l)}else void 0!==o.translation&&n.position.fromArray(o.translation),void 0!==o.rotation&&n.quaternion.fromArray(o.rotation),void 0!==o.scale&&n.scale.fromArray(o.scale);return i.associations.set(n,{type:"nodes",index:e}),n}))},O.prototype.loadScene=function(){function e(t,n,r,i){var o=r.nodes[t];return i.getDependency("node",t).then((function(e){return void 0===o.skin?e:i.getDependency("skin",o.skin).then((function(e){for(var n=[],r=0,o=(t=e).joints.length;r<o;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],o=0,s=n.length;o<s;o++){var a=n[o];if(a){r.push(a);var c=new hg;void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*o),i.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new t_(r,i),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var s=[];if(o.children)for(var a=o.children,c=0,l=a.length;c<l;c++){var u=a[c];s.push(e(u,t,r,i))}return Promise.all(s)}))}return function(t){var n=this.json,r=this.extensions,i=this.json.scenes[t],o=new vx;i.name&&(o.name=this.createUniqueName(i.name)),L(o,i),i.extensions&&R(r,o,i);for(var s=i.nodes||[],a=[],c=0,l=s.length;c<l;c++)a.push(e(s[c],o,n,this));return Promise.all(a).then((function(){return o}))}}(),e}(),jR=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},VR=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},WR=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},qR=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let XR=class extends Zh{constructor(){super(...arguments),kR.add(this),this.src="",this.dracoDecoder="",this.centerGeometry=!1,this.model=null,BR.set(this,0)}loadGL(){this.dracoLoader=new DR,this.gltfLoader=new GR,this.gltfLoader.setDRACOLoader(this.dracoLoader);let e=!0;this.createEffect((()=>{this.dracoDecoder&&(e||this.dracoLoader.dispose(),this.dracoLoader.setDecoderPath(this.dracoDecoder))})),this.createEffect((()=>{var e;this.src,this.dracoDecoder,this.centerGeometry,WR(this,kR,"m",UR).call(this),qR(this,BR,(e=WR(this,BR,"f"),++e),"f"),WR(this,kR,"m",FR).call(this)})),e=!1}unloadGL(){var e,t;this.gltfLoader=void 0,null===(e=this.dracoLoader)||void 0===e||e.dispose(),this.dracoLoader=void 0,WR(this,kR,"m",UR).call(this),qR(this,BR,(t=WR(this,BR,"f"),++t),"f")}};BR=new WeakMap,kR=new WeakSet,UR=function(){this.model&&Ku(this.model.scene),this.model=null},FR=function(){const{src:e}=this,t=WR(this,BR,"f");e&&this.gltfLoader.load(e,(e=>t==WR(this,BR,"f")&&WR(this,kR,"m",HR).call(this,e)),(e=>t==WR(this,BR,"f")&&this.element.emit(Wi.PROGRESS,e)),(e=>t==WR(this,BR,"f")&&WR(this,kR,"m",zR).call(this,e)))},zR=function(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with src "${this.src}" and dracoDecoder "${this.dracoDecoder}". See the following error.`;console.warn(t);const n=e instanceof ErrorEvent&&e.error?e.error:e;console.error(n),this.element.emit(Wi.MODEL_ERROR,n)},HR=function(e){if(this.model=e,e.scene=e.scene||(new IR).add(...e.scenes),this.centerGeometry){const t=new Jh;t.setFromObject(e.scene);const n=new $i;t.getCenter(n),e.scene.position.copy(n.negate())}this.element.three.add(e.scene),this.element.emit(Wi.MODEL_LOAD,{format:"gltf",model:e}),this.element.needsUpdate()},jR([xf,VR("design:type",Object)],XR.prototype,"src",void 0),jR([xf,VR("design:type",Object)],XR.prototype,"dracoDecoder",void 0),jR([Mf(!1),VR("design:type",Object)],XR.prototype,"centerGeometry",void 0),XR=jR([In],XR),elementBehaviors.has("gltf-model")||elementBehaviors.define("gltf-model",XR);var YR=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,r=/^usemap /,i=new Bm,o=new Bm,s=new Bm,a=new Bm,c=new Bm;function l(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){var r=this.vertices,l=this.object.geometry.normals;i.fromArray(r,e),o.fromArray(r,t),s.fromArray(r,n),c.subVectors(s,o),a.subVectors(i,o),c.cross(a),c.normalize(),l.push(c.x,c.y,c.z),l.push(c.x,c.y,c.z),l.push(c.x,c.y,c.z)},addColor:function(e,t,n){var r=this.colors,i=this.object.geometry.colors;void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,o,s,a,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),d=this.parseVertexIndex(n,l);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==s&&""!==s){var p=this.normals.length;u=this.parseNormalIndex(s,p),h=this.parseNormalIndex(a,p),d=this.parseNormalIndex(c,p),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==r&&""!==r){var f=this.uvs.length;u=this.parseUVIndex(r,f),h=this.parseUVIndex(i,f),d=this.parseUVIndex(o,f),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++){var i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));var s=0;for(o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return e.startObject("",!1),e}function u(e){Gw.call(this,e),this.materials=null}return u.prototype=Object.assign(Object.create(Gw.prototype),{constructor:u,load:function(e,t,n,r){var i=this,o=new Vw(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},setMaterials:function(e){return this.materials=e,this},parse:function(i){var o=new l;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var s=i.split("\n"),a="",c="",u=[],h="function"==typeof"".trimLeft,d=0,p=s.length;d<p;d++)if(a=s[d],0!==(a=h?a.trimLeft():a.trim()).length&&"#"!==(c=a.charAt(0)))if("v"===c){var f=a.split(/\s+/);switch(f[0]){case"v":o.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?o.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])):o.colors.push(void 0,void 0,void 0);break;case"vn":o.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":o.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===c){for(var m=a.substr(1).trim().split(/\s+/),g=[],v=0,y=m.length;v<y;v++){var b=m[v];if(b.length>0){var x=b.split("/");g.push(x)}}var _=g[0];for(v=1,y=g.length-1;v<y;v++){var w=g[v],M=g[v+1];o.addFace(_[0],w[0],M[0],_[1],w[1],M[1],_[2],w[2],M[2])}}else if("l"===c){var T=a.substring(1).trim().split(" "),S=[],E=[];if(-1===a.indexOf("/"))S=T;else for(var A=0,R=T.length;A<R;A++){var L=T[A].split("/");""!==L[0]&&S.push(L[0]),""!==L[1]&&E.push(L[1])}o.addLineGeometry(S,E)}else if("p"===c){var C=a.substr(1).trim().split(" ");o.addPointGeometry(C)}else if(null!==(u=e.exec(a))){var P=(" "+u[0].substr(1).trim()).substr(1);o.startObject(P)}else if(n.test(a))o.object.startMaterial(a.substring(7).trim(),o.materialLibraries);else if(t.test(a))o.materialLibraries.push(a.substring(7).trim());else if(r.test(a))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((u=a.split(" ")).length>1){var O=u[1].trim().toLowerCase();o.object.smooth="0"!==O&&"off"!==O}else o.object.smooth=!0;(W=o.object.currentMaterial())&&(W.smooth=o.object.smooth)}else{if("\0"===a)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}o.finalize();var N=new vx;if(N.materialLibraries=[].concat(o.materialLibraries),!0==!(1===o.objects.length&&0===o.objects[0].geometry.vertices.length))for(d=0,p=o.objects.length;d<p;d++){var I=o.objects[d],D=I.geometry,k=I.materials,B="Line"===D.type,U="Points"===D.type,F=!1;if(0!==D.vertices.length){(Z=new Nv).setAttribute("position",new xv(D.vertices,3)),D.normals.length>0&&Z.setAttribute("normal",new xv(D.normals,3)),D.colors.length>0&&(F=!0,Z.setAttribute("color",new xv(D.colors,3))),!0===D.hasUVIndices&&Z.setAttribute("uv",new xv(D.uvs,2));for(var z,H=[],G=0,j=k.length;G<j;G++){var V=(Y=k[G]).name+"_"+Y.smooth+"_"+F,W=o.materials[V];if(null!==this.materials)if(W=this.materials.create(Y.name),!B||!W||W instanceof a_){if(U&&W&&!(W instanceof y_)){var q=new y_({size:10,sizeAttenuation:!1});av.prototype.copy.call(q,W),q.color.copy(W.color),q.map=W.map,W=q}}else{var X=new a_;av.prototype.copy.call(X,W),X.color.copy(W.color),W=X}void 0===W&&((W=B?new a_:U?new y_({size:1,sizeAttenuation:!1}):new yw).name=Y.name,W.flatShading=!Y.smooth,W.vertexColors=F,o.materials[V]=W),H.push(W)}if(H.length>1){for(G=0,j=k.length;G<j;G++){var Y=k[G];Z.addGroup(Y.groupStart,Y.groupCount,G)}z=B?new g_(Z,H):U?new M_(Z,H):new $v(Z,H)}else z=B?new g_(Z,H[0]):U?new M_(Z,H[0]):new $v(Z,H[0]);z.name=I.name,N.add(z)}}else if(o.vertices.length>0){var Z;W=new y_({size:1,sizeAttenuation:!1}),(Z=new Nv).setAttribute("position",new xv(o.vertices,3)),o.colors.length>0&&void 0!==o.colors[0]&&(Z.setAttribute("color",new xv(o.colors,3)),W.vertexColors=!0);var J=new M_(Z,W);N.add(J)}return N}}),u}(),ZR=function(e){Gw.call(this,e)};ZR.prototype=Object.assign(Object.create(Gw.prototype),{constructor:ZR,load:function(e,t,n,r){var i=this,o=""===this.path?kM(e):this.path,s=new Vw(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(i.parse(n,o))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var n=e.split("\n"),r={},i=/\s+/,o={},s=0;s<n.length;s++){var a=n[s];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var c=a.indexOf(" "),l=c>=0?a.substring(0,c):a;l=l.toLowerCase();var u=c>=0?a.substring(c+1):"";if(u=u.trim(),"newmtl"===l)r={name:u},o[u]=r;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var h=u.split(i,3);r[l]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else r[l]=u}}var d=new ZR.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(o),d}}),(ZR.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:0,this.wrap=this.options&&this.options.wrap?this.options.wrap:Xf}).prototype={constructor:ZR.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var n in e){var r=e[n],i={};for(var o in t[n]=i,r){var s=!0,a=r[o],c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[2]&&(s=!1)}s&&(i[c]=a)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,n=this.materialsInfo[e],r={name:e,side:this.side};function i(e,n){if(!r[e]){var i,o,s=t.getTextureParams(n,r),a=t.loadTexture((i=t.baseUrl,"string"!=typeof(o=s.url)||""===o?"":/^https?:\/\//i.test(o)?o:i+o));a.repeat.copy(s.scale),a.offset.copy(s.offset),a.wrapS=t.wrap,a.wrapT=t.wrap,r[e]=a}}for(var o in n){var s,a=n[o];if(""!==a)switch(o.toLowerCase()){case"kd":r.color=(new iv).fromArray(a);break;case"ks":r.specular=(new iv).fromArray(a);break;case"ke":r.emissive=(new iv).fromArray(a);break;case"map_kd":i("map",a);break;case"map_ks":i("specularMap",a);break;case"map_ke":i("emissiveMap",a);break;case"norm":i("normalMap",a);break;case"map_bump":case"bump":i("bumpMap",a);break;case"map_d":i("alphaMap",a),r.transparent=!0;break;case"ns":r.shininess=parseFloat(a);break;case"d":(s=parseFloat(a))<1&&(r.opacity=s,r.transparent=!0);break;case"tr":s=parseFloat(a),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(r.opacity=1-s,r.transparent=!0)}}return this.materials[e]=new yw(r),this.materials[e]},getTextureParams:function(e,t){var n,r={scale:new Em(1,1),offset:new Em(0,0)},i=e.split(/\s+/);return(n=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[n+1]),i.splice(n,2)),(n=i.indexOf("-s"))>=0&&(r.scale.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),(n=i.indexOf("-o"))>=0&&(r.offset.set(parseFloat(i[n+1]),parseFloat(i[n+2])),i.splice(n,4)),r.url=i.join(" ").trim(),r},loadTexture:function(e,t,n,r,i){var o,s=void 0!==this.manager?this.manager:Hw,a=s.getHandler(e);return null===a&&(a=new Jw(s)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),o=a.load(e,n,r,i),void 0!==t&&(o.mapping=t),o}};var JR,$R,KR,QR,eL,tL,nL,rL,iL=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},oL=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},sL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},aL=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let cL=class extends Zh{constructor(){super(...arguments),JR.add(this),this.obj="",this.mtl="",$R.set(this,0),KR.set(this,!1)}loadGL(){this.objLoader=new YR,this.mtlLoader=new ZR(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.objLoader.manager.onLoad=()=>{this.element.needsUpdate()};let e=!0;this.createEffect((()=>{var t;this.mtl,this.obj,e||sL(this,JR,"m",QR).call(this),aL(this,$R,(t=sL(this,$R,"f"),++t),"f"),sL(this,JR,"m",eL).call(this)})),e=!1}unloadGL(){var e;sL(this,JR,"m",QR).call(this),aL(this,$R,(e=sL(this,$R,"f"),++e),"f")}};$R=new WeakMap,KR=new WeakMap,JR=new WeakSet,QR=function(){this.model&&Ku(this.model,{destroyMaterial:!sL(this,KR,"f")}),aL(this,KR,!1,"f"),this.model=void 0},eL=function(){const{obj:e,mtl:t,mtlLoader:n,objLoader:r}=this,i=sL(this,$R,"f");e&&(t?(n.setResourcePath(t.substr(0,t.lastIndexOf("/")+1)),console.log("load mtl"),n.load(t,(e=>{i===sL(this,$R,"f")&&(console.log("loaded mtl:",e),e.preload(),r.setMaterials(e),sL(this,JR,"m",tL).call(this,i,!0))}))):sL(this,JR,"m",tL).call(this,i,!1))},tL=function(e,t){this.objLoader.load(this.obj,(n=>e==sL(this,$R,"f")&&sL(this,JR,"m",rL).call(this,n,t)),(t=>e===sL(this,$R,"f")&&this.element.emit(Wi.PROGRESS,t)),(t=>e===sL(this,$R,"f")&&sL(this,JR,"m",nL).call(this,t)))},nL=function(e){const t=`Failed to load ${this.element.tagName.toLowerCase()} with obj value "${this.obj}" and mtl value "${this.mtl}". See the following error.`;console.warn(t);const n=e instanceof ErrorEvent&&e.error?e.error:e;console.error(n),this.element.emit(Wi.MODEL_ERROR,n)},rL=function(e,t){if(!t){let t=this.element.behaviors.get("basic-material");t||(t=this.element.behaviors.get("phong-material")),t||(t=this.element.behaviors.get("standard-material")),t||(t=this.element.behaviors.get("lambert-material")),t?(aL(this,KR,!0,"f"),e.traverse((e=>{console.log("isRenderItem?",Zu(e)),Zu(e)&&(e.material=t.meshComponent||lL(new Error("Expected a material")))}))):(console.log("Set random material"),th(e))}this.model=e,this.element.three.add(e),this.element.emit(Wi.MODEL_LOAD,{format:"obj",model:e}),this.element.needsUpdate()},iL([_f(""),oL("design:type",Object)],cL.prototype,"obj",void 0),iL([_f(""),oL("design:type",Object)],cL.prototype,"mtl",void 0),cL=iL([In],cL),elementBehaviors.has("obj-model")||elementBehaviors.define("obj-model",cL);const lL=e=>{throw e};function uL(e,t,n){return Math.max(Math.min(e,n),t)}var hL,dL,pL,fL,mL,gL=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},vL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class yL{constructor(e){this.minFlingRotationX=-90,this.maxFlingRotationX=90,this.minFlingRotationY=-1/0,this.maxFlingRotationY=1/0,this.interactionContainer=document,hL.set(this,void 0),dL.set(this,void 0),pL.set(this,(()=>{this.rotationXTarget.rotation=()=>!1,this.rotationYTarget.rotation=()=>!1;let e=0,t=0;gL(this,hL,(n=>{e=.2*n.movementY,this.rotationXTarget.rotation.x=uL(this.rotationXTarget.rotation.x+e,this.minFlingRotationX,this.maxFlingRotationX),t=.2*-n.movementX,this.rotationYTarget.rotation.y=uL(this.rotationYTarget.rotation.y+t,this.minFlingRotationY,this.maxFlingRotationY)}),"f"),this.interactionContainer.addEventListener("pointermove",vL(this,hL,"f")),this.interactionContainer.addEventListener("pointerup",gL(this,dL,(()=>{this.interactionContainer.removeEventListener("pointermove",vL(this,hL,"f")),0===e&&0===t||(this.rotationXTarget.rotation=(t,n,r)=>(e*=.95,!(Math.abs(e)<.01)&&[uL(t+e,this.minFlingRotationX,this.maxFlingRotationX),n,r]),this.rotationYTarget.rotation=(e,n,r)=>(t*=.95,!(Math.abs(t)<.01)&&[e,uL(n+t,this.minFlingRotationY,this.maxFlingRotationY),r]))}),"f"),{once:!0})})),fL.set(this,(e=>e.preventDefault())),mL.set(this,!1),Object.assign(this,e),this.rotationXTarget||(this.rotationXTarget=this.rotationYTarget.children[0]),this.interactionInitiator||(this.interactionInitiator=this.rotationXTarget)}start(){return vL(this,mL,"f")||(gL(this,mL,!0,"f"),this.interactionInitiator.addEventListener("pointerdown",vL(this,pL,"f")),this.interactionInitiator.addEventListener("dragstart",vL(this,fL,"f")),this.interactionInitiator.addEventListener("pointercancel",(()=>{throw new Error("Pointercancel should not be happening. If so, please open a bug report.")}))),this}stop(){return vL(this,mL,"f")?(gL(this,mL,!1,"f"),this.rotationXTarget.rotation=()=>!1,this.rotationYTarget.rotation=()=>!1,this.interactionInitiator.removeEventListener("pointerdown",vL(this,pL,"f")),this.interactionInitiator.removeEventListener("dragstart",vL(this,fL,"f")),vL(this,hL,"f")&&this.interactionContainer.removeEventListener("pointermove",vL(this,hL,"f")),vL(this,dL,"f")&&this.interactionContainer.removeEventListener("pointerup",vL(this,dL,"f")),this):this}}hL=new WeakMap,dL=new WeakMap,pL=new WeakMap,fL=new WeakMap,mL=new WeakMap;var bL,xL,_L,wL=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},ML=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},TL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},SL=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let EL=class{constructor(e){this.x=0,this.y=0,this.minX=-1/0,this.maxX=1/0,this.minY=-1/0,this.maxY=1/0,this.target=document,this.scrollFactor=1,bL.set(this,void 0),xL.set(this,(e=>{e.preventDefault();let t=e.deltaX*this.scrollFactor,n=e.deltaY*this.scrollFactor;this.x=uL(this.x+t,this.minX,this.maxX),this.y=uL(this.y+n,this.minY,this.maxY),0===t&&0===n||(TL(this,bL,"f")&&_s.removeRenderTask(TL(this,bL,"f")),SL(this,bL,_s.addRenderTask((()=>{if(t*=.95,n*=.95,this.x=uL(this.x+t,this.minX,this.maxX),this.y=uL(this.y+n,this.minY,this.maxY),Math.abs(t)<.01&&Math.abs(n)<.01)return!1})),"f"))})),_L.set(this,!1),Object.assign(this,e)}start(){return TL(this,_L,"f")||(SL(this,_L,!0,"f"),this.target.addEventListener("wheel",TL(this,xL,"f"))),this}stop(){return TL(this,_L,"f")?(SL(this,_L,!1,"f"),TL(this,bL,"f")&&_s.removeRenderTask(TL(this,bL,"f")),this.target.removeEventListener("wheel",TL(this,xL,"f")),this):this}};bL=new WeakMap,xL=new WeakMap,_L=new WeakMap,wL([In,ML("design:type",Object)],EL.prototype,"x",void 0),wL([In,ML("design:type",Object)],EL.prototype,"y",void 0),EL=wL([In,ML("design:paramtypes",[Object])],EL);var AL,RL=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},LL=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},CL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};let PL=class extends Vh{constructor(){super(...arguments),this.hasShadow=!0,this.initialPolarAngle=0,this.minPolarAngle=-90,this.maxPolarAngle=90,this.minHorizontalAngle=-1/0,this.maxHorizontalAngle=1/0,this.initialDistance=1e3,this.minDistance=200,this.maxDistance=2e3,this.active=!0,this.dollySpeed=1,this.interactive=!0,this.template=()=>br`
		<lume-node
			id="cameraY"
			size="1 1 1"
			ref=${e=>this.rotationYTarget=e}
			size-mode="proportional proportional proportional"
		>
			<lume-node
				id="cameraX"
				size="1 1 1"
				rotation=${()=>Hn((()=>[this.initialPolarAngle,0,0]))}
				size-mode="proportional proportional proportional"
			>
				<slot
					name="camera"
					TODO="determine semantics for overriding the internal camera (this slot is not documented yet)"
				>
					<lume-perspective-camera
						ref=${e=>this.cam=e}
						active=${()=>this.active}
						position=${[0,0,this.initialDistance]}
						align-point="0.5 0.5 0.5"
						far="10000"
					>
						<slot name="camera-child"></slot>
					</lume-perspective-camera>
				</slot>
			</lume-node>
		</lume-node>

		<slot></slot>
	`,AL.set(this,!1)}startInteraction(){CL(this,AL,"f")||(function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,AL,!0,"f"),this.flingRotation=new yL({interactionInitiator:this.scene,rotationYTarget:this.rotationYTarget,minFlingRotationX:this.minPolarAngle,maxFlingRotationX:this.maxPolarAngle,minFlingRotationY:this.minHorizontalAngle,maxFlingRotationY:this.maxHorizontalAngle}).start(),this.scrollFling=new EL({target:this.scene,y:this.initialDistance,minY:this.minDistance,maxY:this.maxDistance,scrollFactor:this.dollySpeed}).start(),this.autorunStoppers=[],this.autorunStoppers.push(Nn((()=>{this.scrollFling.y,Hn((()=>this.cam.position.z=this.scrollFling.y))})),Nn((()=>{this.interactive?(this.flingRotation.start(),this.scrollFling.start()):(this.flingRotation.stop(),this.scrollFling.stop())}))))}stopInteraction(){var e,t;if(CL(this,AL,"f")&&(null===(e=this.flingRotation)||void 0===e||e.stop(),null===(t=this.scrollFling)||void 0===t||t.stop(),this.autorunStoppers))for(const e of this.autorunStoppers)e()}_loadGL(){return!!super._loadGL()&&(this.startInteraction(),!0)}_loadCSS(){return!!super._loadCSS()&&(this.startInteraction(),!0)}disconnectedCallback(){super.disconnectedCallback(),this.stopInteraction()}};AL=new WeakMap,RL([qn(0),LL("design:type",Object)],PL.prototype,"initialPolarAngle",void 0),RL([qn(-90),LL("design:type",Object)],PL.prototype,"minPolarAngle",void 0),RL([qn(90),LL("design:type",Object)],PL.prototype,"maxPolarAngle",void 0),RL([qn(-1/0),LL("design:type",Object)],PL.prototype,"minHorizontalAngle",void 0),RL([qn(1/0),LL("design:type",Object)],PL.prototype,"maxHorizontalAngle",void 0),RL([qn(1e3),LL("design:type",Object)],PL.prototype,"initialDistance",void 0),RL([qn(200),LL("design:type",Object)],PL.prototype,"minDistance",void 0),RL([qn(2e3),LL("design:type",Object)],PL.prototype,"maxDistance",void 0),RL([Xn(!0),LL("design:type",Object)],PL.prototype,"active",void 0),RL([qn(1),LL("design:type",Object)],PL.prototype,"dollySpeed",void 0),RL([Xn(!0),LL("design:type",Object)],PL.prototype,"interactive",void 0),PL=RL([Yn("lume-camera-rig",Hh)],PL);var OL,NL,IL,DL=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},kL=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},BL=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},UL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};let FL=class extends Vh{constructor(){super(...arguments),OL.add(this),this.fov=50,this.aspect=0,this.near=.1,this.far=3e3,this.zoom=1,this.active=!1,NL.set(this,null)}connectedCallback(){super.connectedCallback();const e=Nn((t=>{this.scene&&Hn((()=>{BL(this,NL,this.scene,"f"),UL(this,OL,"m",IL).call(this,this.active?void 0:"unset"),Xr((()=>e()))}))}));this._stopFns.push(Nn((e=>{this.three.fov=this.fov,this.three.updateProjectionMatrix(),this.needsUpdate()})),Nn((e=>{if(0!==this.aspect)return this.three.aspect=this.aspect,void this.three.updateProjectionMatrix();let t=0;this.scene&&(t=this.scene.calculatedSize.x/this.scene.calculatedSize.y),t||(t=16/9),this.three.aspect=t,this.three.updateProjectionMatrix(),this.needsUpdate()})),Nn((e=>{this.three.near=this.near,this.three.updateProjectionMatrix(),this.needsUpdate()})),Nn((e=>{this.three.far=this.far,this.three.updateProjectionMatrix(),this.needsUpdate()})),Nn((e=>{this.three.zoom=this.zoom,this.three.updateProjectionMatrix(),this.needsUpdate()})),Nn((e=>{const t=this.active;Hn((()=>{UL(this,OL,"m",IL).call(this,t?void 0:"unset")})),this.needsUpdate()})))}makeThreeObject3d(){return new hA(75,16/9,1,1e3)}disconnectedCallback(){super.disconnectedCallback(),UL(this,OL,"m",IL).call(this,"unset"),BL(this,NL,null,"f")}};NL=new WeakMap,OL=new WeakSet,IL=function(e){if(e)UL(this,NL,"f")&&UL(this,NL,"f")._removeCamera(this);else{if(!this.scene||!this.isConnected)return;this.scene._addCamera(this)}},DL([qn(50),kL("design:type",Object)],FL.prototype,"fov",void 0),DL([qn(0),kL("design:type",Object)],FL.prototype,"aspect",void 0),DL([qn(.1),kL("design:type",Object)],FL.prototype,"near",void 0),DL([qn(3e3),kL("design:type",Object)],FL.prototype,"far",void 0),DL([qn(1),kL("design:type",Object)],FL.prototype,"zoom",void 0),DL([Xn(!1),kL("design:type",Object)],FL.prototype,"active",void 0),FL=DL([Yn("lume-perspective-camera",Hh)],FL);class zL extends Bh{constructor(){super(...arguments),this.template=()=>br`
		<div class="container">
			<div
				ref=${e=>this._cssLayer=e}
				class="CSS3DLayer"
				style=${()=>this.swapLayers?"z-index: 1":""}
			>
				${""}
			</div>

			<div ref=${e=>this._glLayer=e} class="WebGLLayer">
				${""}
			</div>

			<div ref=${e=>this._miscLayer=e} class="MiscellaneousLayer">
				${""}
				<slot name="misc"></slot>
			</div>
		</div>
	`,this._glLayer=null,this._cssLayer=null,this._miscLayer=null}}zL.css="\n\t\t:host {\n\t\t\t/*\n\t\t\t * All items of the scene graph are hidden until they are mounted in\n\t\t\t * a scene (this changes to display:block). 'display' gets toggled\n\t\t\t * between \"none\" and \"block\" by ImperativeBase depending on if CSS\n\t\t\t * rendering is enabled.\n\t\t\t */\n\t\t\tdisplay: none;\n\n\t\t\t/*\n\t\t\tA Scene is strict: it does not leak content, its rendering is not\n\t\t\taffected by external layout, and its size is not affected by its\n\t\t\tcontent. It is an absolutely contained drawing area.\n\t\t\t*/\n\t\t\tcontain: size layout paint; /*fallback, TODO remove once Safari goers are caught up*/\n\t\t\tcontain: strict;\n\n\t\t\tbox-sizing: border-box;\n\t\t\tposition: static;\n\t\t\toverflow: hidden;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\n\t\t\t/*\n\t\t\t\tDefaults to [0.5,0.5,0.5] (the Z axis doesn't apply for DOM elements,\n\t\t\t\tbut will for 3D objects in WebGL.)\n\t\t\t*/\n\t\t\ttransform-origin: 50% 50% 0; /* default */\n\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\n\t\t/* The purpose of this is to contain the position:absolute layers so they don't break out of the Scene layout. */\n\t\t.container {\n\t\t\tposition: relative\n\t\t}\n\n\t\t.container,\n\t\t.CSS3DLayer,\n\t\t.MiscellaneousLayer,\n\t\t.WebGLLayer,\n\t\t.WebGLLayer > canvas  {\n\t\t\tmargin: 0; padding: 0;\n\t\t\twidth: 100%; height: 100%;\n\t\t\tdisplay: block;\n\t\t}\n\n\t\t.CSS3DLayer,\n\t\t.MiscellaneousLayer,\n\t\t.WebGLLayer {\n\t\t\t/* make sure all layers are stacked on top of each other */\n\t\t\tposition: absolute; top: 0; left: 0;\n\t\t}\n\n\t\t.CSS3DLayer {\n\t\t\ttransform-style: preserve-3d;\n\t\t}\n\n\t\t.container {\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.MiscellaneousLayer > * {\n\t\t\t/* Allow children of the Misc layer to have pointer events.\tNeeded for the WebXR button, for example */\n\t\t\tpointer-events: auto;\n\t\t}\n\n\t\t/*\n\t\t * This trick is needed in Firefox to remove pointer events from the\n\t\t * transparent cameraElement from interfering with pointer events on the\n\t\t * scene objects. We do not wish to interact with this element anyway, as\n\t\t * it serves only for positioning the view.\n\t\t */\n\t\t.cameraElement > * {\n\t\t\tpointer-events: auto;\n\t\t}\n\t";class HL{constructor(e,t,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Xu(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}clone(){return new HL(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class GL{constructor(e,t){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Xu(e),this.density=void 0!==t?t:25e-5}clone(){return new GL(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}function jL(e,t,n,r,i,o,s,a,c,l,u,h){bE.call(this,null,o,s,a,c,l,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==c?c:vc,this.minFilter=void 0!==l?l:vc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}jL.prototype=Object.create(bE.prototype),jL.prototype.constructor=jL,jL.prototype.isDataTexture=!0;const VL=new dd,WL=new $i;class qL{constructor(e,t,n,r,i,o){this.planes=[void 0!==e?e:new Td,void 0!==t?t:new Td,void 0!==n?n:new Td,void 0!==r?r:new Td,void 0!==i?i:new Td,void 0!==o?o:new Td]}set(e,t,n,r,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(s-r,u-a,f-h,y-m).normalize(),t[1].setComponents(s+r,u+a,f+h,y+m).normalize(),t[2].setComponents(s+i,u+c,f+d,y+g).normalize(),t[3].setComponents(s-i,u-c,f-d,y-g).normalize(),t[4].setComponents(s-o,u-l,f-p,y-v).normalize(),t[5].setComponents(s+o,u+l,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),VL.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(VL)}intersectsSprite(e){return VL.center.set(0,0,0),VL.radius=.7071067811865476,VL.applyMatrix4(e.matrixWorld),this.intersectsSphere(VL)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(WL.x=r.normal.x>0?e.max.x:e.min.x,WL.y=r.normal.y>0?e.max.y:e.min.y,WL.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(WL)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}function XL(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function YL(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,s=e.createBuffer();e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback();let a=e.FLOAT;return i instanceof Float32Array?a=e.FLOAT:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?a=e.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=e.UNSIGNED_SHORT:i instanceof Int16Array?a=e.SHORT:i instanceof Uint32Array?a=e.UNSIGNED_INT:i instanceof Int32Array?a=e.INT:i instanceof Int8Array?a=e.BYTE:i instanceof Uint8Array&&(a=e.UNSIGNED_BYTE),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(function(t,r,i){const o=r.array,s=r.updateRange;e.bindBuffer(i,t),-1===s.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,t,i),o.version=t.version)}}}const ZL={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)G(v) / 4(nl)(nv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor.xyz *= color.xyz;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},JL={common:{diffuse:{value:new Xu(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new fo},uv2Transform:{value:new fo},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new zu(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xu(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xu(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fo}},sprite:{diffuse:{value:new Xu(15658734)},opacity:{value:1},center:{value:new zu(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fo}}},$L={basic:{uniforms:gA([JL.common,JL.specularmap,JL.envmap,JL.aomap,JL.lightmap,JL.fog]),vertexShader:ZL.meshbasic_vert,fragmentShader:ZL.meshbasic_frag},lambert:{uniforms:gA([JL.common,JL.specularmap,JL.envmap,JL.aomap,JL.lightmap,JL.emissivemap,JL.fog,JL.lights,{emissive:{value:new Xu(0)}}]),vertexShader:ZL.meshlambert_vert,fragmentShader:ZL.meshlambert_frag},phong:{uniforms:gA([JL.common,JL.specularmap,JL.envmap,JL.aomap,JL.lightmap,JL.emissivemap,JL.bumpmap,JL.normalmap,JL.displacementmap,JL.fog,JL.lights,{emissive:{value:new Xu(0)},specular:{value:new Xu(1118481)},shininess:{value:30}}]),vertexShader:ZL.meshphong_vert,fragmentShader:ZL.meshphong_frag},standard:{uniforms:gA([JL.common,JL.envmap,JL.aomap,JL.lightmap,JL.emissivemap,JL.bumpmap,JL.normalmap,JL.displacementmap,JL.roughnessmap,JL.metalnessmap,JL.fog,JL.lights,{emissive:{value:new Xu(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ZL.meshphysical_vert,fragmentShader:ZL.meshphysical_frag},toon:{uniforms:gA([JL.common,JL.aomap,JL.lightmap,JL.emissivemap,JL.bumpmap,JL.normalmap,JL.displacementmap,JL.gradientmap,JL.fog,JL.lights,{emissive:{value:new Xu(0)}}]),vertexShader:ZL.meshtoon_vert,fragmentShader:ZL.meshtoon_frag},matcap:{uniforms:gA([JL.common,JL.bumpmap,JL.normalmap,JL.displacementmap,JL.fog,{matcap:{value:null}}]),vertexShader:ZL.meshmatcap_vert,fragmentShader:ZL.meshmatcap_frag},points:{uniforms:gA([JL.points,JL.fog]),vertexShader:ZL.points_vert,fragmentShader:ZL.points_frag},dashed:{uniforms:gA([JL.common,JL.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ZL.linedashed_vert,fragmentShader:ZL.linedashed_frag},depth:{uniforms:gA([JL.common,JL.displacementmap]),vertexShader:ZL.depth_vert,fragmentShader:ZL.depth_frag},normal:{uniforms:gA([JL.common,JL.bumpmap,JL.normalmap,JL.displacementmap,{opacity:{value:1}}]),vertexShader:ZL.normal_vert,fragmentShader:ZL.normal_frag},sprite:{uniforms:gA([JL.sprite,JL.fog]),vertexShader:ZL.sprite_vert,fragmentShader:ZL.sprite_frag},background:{uniforms:{uvTransform:{value:new fo},t2D:{value:null}},vertexShader:ZL.background_vert,fragmentShader:ZL.background_frag},cube:{uniforms:gA([JL.envmap,{opacity:{value:1}}]),vertexShader:ZL.cube_vert,fragmentShader:ZL.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ZL.equirect_vert,fragmentShader:ZL.equirect_frag},distanceRGBA:{uniforms:gA([JL.common,JL.displacementmap,{referencePosition:{value:new $i},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ZL.distanceRGBA_vert,fragmentShader:ZL.distanceRGBA_frag},shadow:{uniforms:gA([JL.lights,JL.fog,{color:{value:new Xu(0)},opacity:{value:1}}]),vertexShader:ZL.shadow_vert,fragmentShader:ZL.shadow_frag}};function KL(e,t,n,r,i){const o=new Xu(0);let s,a,c=0,l=null,u=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),c=t,d(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,d(o,c)},render:function(n,i,p,f){let m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,c):m&&m.isColor&&(d(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===dc)?(void 0===a&&(a=new Ap(new $p(1,1,1),new xA({name:"BackgroundCubeMaterial",uniforms:mA($L.cube.uniforms),vertexShader:$L.cube.vertexShader,fragmentShader:$L.cube.fragmentShader,side:ya,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,l===m&&u===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,l=m,u=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new Ap(new jT(2,2),new xA({name:"BackgroundMaterial",uniforms:mA($L.background.uniforms),vertexShader:$L.background.vertexShader,fragmentShader:$L.background.fragmentShader,side:va,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&u===m.version&&h===e.toneMapping||(s.material.needsUpdate=!0,l=m,u=m.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function QL(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},c=d(null);let l=c;function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){const e=l.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,i){const o=l.newAttributes,s=l.enabledAttributes,a=l.attributeDivisors;o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function g(){const t=l.newAttributes,n=l.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,i,o,s,a){!0!==r.isWebGL2||i!==e.INT&&i!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,i,o,s,a):e.vertexAttribIPointer(t,n,i,s,a)}function y(){b(),l!==c&&(l=c,u(l.object))}function b(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,h,y,b){let x=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let c=a[t.id];void 0===c&&(c={},a[t.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let u=l[s];return void 0===u&&(u=d(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),l[s]=u),u}(y,h,c);l!==t&&(l=t,u(l.object)),x=function(e,t){const n=l.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return l.attributesNum!==i||l.index!==t}(y,b),x&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}l.attributes=n,l.attributesNum=i,l.index=t}(y,b)}else{const e=!0===c.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===e||(l.geometry=y.id,l.program=h.id,l.wireframe=e,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),x&&(function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const c=a.attributes,l=s.getAttributes(),u=o.defaultAttributeValues;for(const t in l){const r=l[t];if(r>=0){const o=c[t];if(void 0!==o){const t=o.normalized,i=o.itemSize,s=n.get(o);if(void 0===s)continue;const c=s.buffer,l=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(m(r,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(r),e.bindBuffer(e.ARRAY_BUFFER,c),v(r,i,l,t,s*u,h*u)}else o.isInstancedBufferAttribute?(m(r,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):f(r),e.bindBuffer(e.ARRAY_BUFFER,c),v(r,i,l,t,0,0)}else if("instanceMatrix"===t){const t=n.get(i.instanceMatrix);if(void 0===t)continue;const o=t.buffer,s=t.type;m(r+0,1),m(r+1,1),m(r+2,1),m(r+3,1),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(r+0,4,s,!1,64,0),e.vertexAttribPointer(r+1,4,s,!1,64,16),e.vertexAttribPointer(r+2,4,s,!1,64,32),e.vertexAttribPointer(r+3,4,s,!1,64,48)}else if("instanceColor"===t){const t=n.get(i.instanceColor);if(void 0===t)continue;const o=t.buffer,s=t.type;m(r,1),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(r,3,s,!1,12,0)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r,n);break;case 3:e.vertexAttrib3fv(r,n);break;case 4:e.vertexAttrib4fv(r,n);break;default:e.vertexAttrib1fv(r,n)}}}}g()}(i,c,h,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function eC(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let c,l;if(i)c=e,l="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](o,r,s,a),n.update(s,o,a)}}function tC(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=!0===n.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function nC(e){const t=this;let n=null,r=0,i=!1,o=!1;const s=new Td,a=new fo,c={value:null,needsUpdate:!1};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const o=null!==e?e.length:0;let l=null;if(0!==o){if(l=c.value,!0!==i||null===l){const t=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===l||l.length<t)&&(l=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(l,n),l[n+3]=s.constant}c.value=l,c.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const s=0!==e.length||t||0!==r||i;return i=t,n=u(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,l()},this.setState=function(t,s,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!i||null===h||0===h.length||o&&!p)o?u(null):l();else{const e=o?0:r,t=4*e;let i=f.clippingState||null;c.value=i,i=u(h,s,t,a);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function rC(e,t,n){this.width=e,this.height=t,this.scissor=new Ud(0,0,e,t),this.scissorTest=!1,this.viewport=new Ud(0,0,e,t),n=n||{},this.texture=new bE(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:wc,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}$L.physical={uniforms:gA([$L.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new zu(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Xu(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ZL.meshphysical_vert,fragmentShader:ZL.meshphysical_frag},rC.prototype=Object.assign(Object.create(co.prototype),{constructor:rC,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const iC=90;function oC(e,t,n){if(Ro.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new hA(iC,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new $i(1,0,0)),this.add(r);const i=new hA(iC,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new $i(-1,0,0)),this.add(i);const o=new hA(iC,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new $i(0,1,0)),this.add(o);const s=new hA(iC,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new $i(0,-1,0)),this.add(s);const a=new hA(iC,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new $i(0,0,1)),this.add(a);const c=new hA(iC,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new $i(0,0,-1)),this.add(c),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const l=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(u),e.xr.enabled=l}}function sC(e,t,n,r,i,o,s,a,c,l){e=void 0!==e?e:[],t=void 0!==t?t:cc,s=void 0!==s?s:zc,bE.call(this,e,t,n,r,i,o,s,a,c,l),this.flipY=!1,this._needsFlipEnvMap=!0}function aC(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),rC.call(this,e,e,t),t=t||{},this.texture=new sC(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}function cC(e){let t=new WeakMap;function n(e,t){return t===uc?e.mapping=cc:t===hc&&(e.mapping=lc),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(o===uc||o===hc){if(t.has(i))return n(t.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const s=e.getRenderList(),a=e.getRenderTarget(),c=new aC(o.height/2);return c.fromEquirectangularTexture(e,i),t.set(i,c),e.setRenderTarget(a),e.setRenderList(s),i.addEventListener("dispose",r),n(c.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}function lC(e){const t={};return{has:function(n){if(void 0!==t[n])return null!==t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,null!==r},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]}}}function uC(e,t,n,r){const i=new WeakMap,o=new WeakMap;function s(e){const a=e.target,c=i.get(a);null!==c.index&&t.remove(c.index);for(const e in c.attributes)t.remove(c.attributes[e]);a.removeEventListener("dispose",s),i.delete(a);const l=o.get(c);l&&(t.remove(l),o.delete(c)),r.releaseStatesOfGeometry(c),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const a=new(Qd(n)>65535?Yd:qd)(n,1);a.version=s;const c=o.get(e);c&&t.remove(c),o.set(e,a)}return{get:function(e,t){let r=i.get(t);return r||(t.addEventListener("dispose",s),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new lp).setFromObject(e)),r=t._bufferGeometry),i.set(t,r),n.memory.geometries++,r)},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function hC(e,t,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,s,t*a),n.update(r,o,1)},this.renderInstances=function(r,c,l){if(0===l)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,c,s,r*a,l),n.update(c,o,l)}}function dC(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function pC(e,t){return e[0]-t[0]}function fC(e,t){return Math.abs(t[1])-Math.abs(e[1])}function mC(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];return{update:function(i,o,s,a){const c=i.morphTargetInfluences,l=void 0===c?0:c.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<l;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<l;e++){const t=u[e];t[0]=e,t[1]=c[e]}u.sort(fC);for(let e=0;e<8;e++)e<l&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(pC);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],s=t[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+e)!==h[i]&&o.setAttribute("morphTarget"+e,h[i]),d&&o.getAttribute("morphNormal"+e)!==d[i]&&o.setAttribute("morphNormal"+e,d[i]),n[e]=s,p+=s):(h&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),d&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",f),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function gC(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const a=r.render.frame,c=s.geometry,l=t.get(s,c);return i.get(l)!==a&&(c.isGeometry&&l.updateFromObject(s),t.update(l),i.set(l,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER)),l},dispose:function(){i=new WeakMap}}}function vC(e=null,t=1,n=1,r=1){bE.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=vc,this.minFilter=vc,this.wrapR=mc,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function yC(e=null,t=1,n=1,r=1){bE.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=vc,this.minFilter=vc,this.wrapR=mc,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}oC.prototype=Object.create(Ro.prototype),oC.prototype.constructor=oC,sC.prototype=Object.create(bE.prototype),sC.prototype.constructor=sC,sC.prototype.isCubeTexture=!0,Object.defineProperty(sC.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),aC.prototype=Object.create(rC.prototype),aC.prototype.constructor=aC,aC.prototype.isWebGLCubeRenderTarget=!0,aC.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=Hc,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",i="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",o=new $p(5,5,5),s=new xA({name:"CubemapFromEquirect",uniforms:mA(n),vertexShader:r,fragmentShader:i,side:ya,blending:wa});s.uniforms.tEquirect.value=t;const a=new Ap(o,s),c=t.minFilter;return t.minFilter===Sc&&(t.minFilter=wc),new oC(1,10,this).update(e,a),t.minFilter=c,a.geometry.dispose(),a.material.dispose(),this},aC.prototype.clear=function(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)},vC.prototype=Object.create(bE.prototype),vC.prototype.constructor=vC,vC.prototype.isDataTexture2DArray=!0,yC.prototype=Object.create(bE.prototype),yC.prototype.constructor=yC,yC.prototype.isDataTexture3D=!0;const bC=new bE,xC=new vC,_C=new yC,wC=new sC,MC=[],TC=[],SC=new Float32Array(16),EC=new Float32Array(9),AC=new Float32Array(4);function RC(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=MC[i];if(void 0===o&&(o=new Float32Array(i),MC[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function LC(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function CC(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function PC(e,t){let n=TC[t];void 0===n&&(n=new Int32Array(t),TC[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function OC(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function NC(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(LC(n,t))return;e.uniform2fv(this.addr,t),CC(n,t)}}function IC(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(LC(n,t))return;e.uniform3fv(this.addr,t),CC(n,t)}}function DC(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(LC(n,t))return;e.uniform4fv(this.addr,t),CC(n,t)}}function kC(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(LC(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),CC(n,t)}else{if(LC(n,r))return;AC.set(r),e.uniformMatrix2fv(this.addr,!1,AC),CC(n,r)}}function BC(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(LC(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),CC(n,t)}else{if(LC(n,r))return;EC.set(r),e.uniformMatrix3fv(this.addr,!1,EC),CC(n,r)}}function UC(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(LC(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),CC(n,t)}else{if(LC(n,r))return;SC.set(r),e.uniformMatrix4fv(this.addr,!1,SC),CC(n,r)}}function FC(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||bC,i)}function zC(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||xC,i)}function HC(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||_C,i)}function GC(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||wC,i)}function jC(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function VC(e,t){const n=this.cache;LC(n,t)||(e.uniform2iv(this.addr,t),CC(n,t))}function WC(e,t){const n=this.cache;LC(n,t)||(e.uniform3iv(this.addr,t),CC(n,t))}function qC(e,t){const n=this.cache;LC(n,t)||(e.uniform4iv(this.addr,t),CC(n,t))}function XC(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function YC(e,t){e.uniform1fv(this.addr,t)}function ZC(e,t){e.uniform1iv(this.addr,t)}function JC(e,t){e.uniform2iv(this.addr,t)}function $C(e,t){e.uniform3iv(this.addr,t)}function KC(e,t){e.uniform4iv(this.addr,t)}function QC(e,t){const n=RC(t,this.size,2);e.uniform2fv(this.addr,n)}function eP(e,t){const n=RC(t,this.size,3);e.uniform3fv(this.addr,n)}function tP(e,t){const n=RC(t,this.size,4);e.uniform4fv(this.addr,n)}function nP(e,t){const n=RC(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function rP(e,t){const n=RC(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function iP(e,t){const n=RC(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function oP(e,t,n){const r=t.length,i=PC(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||bC,i[e])}function sP(e,t,n){const r=t.length,i=PC(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||wC,i[e])}function aP(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return OC;case 35664:return NC;case 35665:return IC;case 35666:return DC;case 35674:return kC;case 35675:return BC;case 35676:return UC;case 5124:case 35670:return jC;case 35667:case 35671:return VC;case 35668:case 35672:return WC;case 35669:case 35673:return qC;case 5125:return XC;case 35678:case 36198:case 36298:case 36306:case 35682:return FC;case 35679:case 36299:case 36307:return HC;case 35680:case 36300:case 36308:case 36293:return GC;case 36289:case 36303:case 36311:case 36292:return zC}}(t.type)}function cP(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return YC;case 35664:return QC;case 35665:return eP;case 35666:return tP;case 35674:return nP;case 35675:return rP;case 35676:return iP;case 5124:case 35670:return ZC;case 35667:case 35671:return JC;case 35668:case 35672:return $C;case 35669:case 35673:return KC;case 35678:case 36198:case 36298:case 36306:case 35682:return oP;case 35680:case 36300:case 36308:case 36293:return sP}}(t.type)}function lP(e){this.id=e,this.seq=[],this.map={}}cP.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),CC(t,e)},lP.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const uP=/(\w+)(\])?(\[|\.)?/g;function hP(e,t){e.seq.push(t),e.map[t.id]=t}function dP(e,t,n){const r=e.name,i=r.length;for(uP.lastIndex=0;;){const o=uP.exec(r),s=uP.lastIndex;let a=o[1];const c="]"===o[2],l=o[3];if(c&&(a|=0),void 0===l||"["===l&&s+2===i){hP(n,void 0===l?new aP(a,e,t):new cP(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new lP(a),hP(n,e)),n=e}}}function pP(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);dP(n,e.getUniformLocation(t,n.name),this)}}function fP(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}pP.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},pP.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},pP.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},pP.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let mP=0;function gP(e){switch(e){case Ql:return["Linear","( value )"];case eu:return["sRGB","( value )"];case nu:return["RGBE","( value )"];case iu:return["RGBM","( value, 7.0 )"];case ou:return["RGBM","( value, 16.0 )"];case su:return["RGBD","( value, 256.0 )"];case tu:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ru:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function vP(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function yP(e,t){const n=gP(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function bP(e,t){const n=gP(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function xP(e,t){let n;switch(t){case nc:n="Linear";break;case rc:n="Reinhard";break;case ic:n="OptimizedCineon";break;case oc:n="ACESFilmic";break;case sc:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function _P(e){return""!==e}function wP(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function MP(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const TP=/^[ \t]*#include +<([\w\d./]+)>/gm;function SP(e){return e.replace(TP,EP)}function EP(e,t){const n=ZL[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return SP(n)}const AP=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,RP=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function LP(e){return e.replace(RP,PP).replace(AP,CP)}function CP(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),PP(0,t,n,r)}function PP(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function OP(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function NP(e,t,n,r){const i=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===fa?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===ma?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===ga&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case cc:case lc:t="ENVMAP_TYPE_CUBE";break;case dc:case pc:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case lc:case pc:t="ENVMAP_MODE_REFRACTION"}return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Ka:t="ENVMAP_BLENDING_MULTIPLY";break;case Qa:t="ENVMAP_BLENDING_MIX";break;case ec:t="ENVMAP_BLENDING_ADD"}return t}(n),d=e.gammaFactor>0?e.gammaFactor:1,p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_P).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(o),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(_P).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(_P).join("\n"),v.length>0&&(v+="\n")):(g=[OP(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_P).join("\n"),v=[p,OP(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==tc?"#define TONE_MAPPING":"",n.toneMapping!==tc?ZL.tonemapping_pars_fragment:"",n.toneMapping!==tc?xP("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",ZL.encodings_pars_fragment,n.map?yP("mapTexelToLinear",n.mapEncoding):"",n.matcap?yP("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?yP("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?yP("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?yP("lightMapTexelToLinear",n.lightMapEncoding):"",bP("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(_P).join("\n")),s=SP(s),s=wP(s,n),s=MP(s,n),a=SP(a),a=wP(a,n),a=MP(a,n),s=LP(s),a=LP(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Bu?"":"out highp vec4 pc_fragColor;",n.glslVersion===Bu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+s,x=y+v+a,_=fP(i,i.VERTEX_SHADER,b),w=fP(i,i.FRAGMENT_SHADER,x);if(i.attachShader(m,_),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),e.debug.checkShaderErrors){const e=i.getProgramInfoLog(m).trim(),t=i.getShaderInfoLog(_).trim(),n=i.getShaderInfoLog(w).trim();let r=!0,o=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS)){r=!1;const t=vP(i,_,"vertex"),n=vP(i,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"gl.VALIDATE_STATUS",i.getProgramParameter(m,i.VALIDATE_STATUS),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let M,T;return i.deleteShader(_),i.deleteShader(w),this.getUniforms=function(){return void 0===M&&(M=new pP(i,m)),M},this.getAttributes=function(){return void 0===T&&(T=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i).name;n[r]=e.getAttribLocation(t,r)}return n}(i,m)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=mP++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this}function IP(e,t,n,r,i,o){const s=[],a=r.isWebGL2,c=r.logarithmicDepthBuffer,l=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures;let d=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Ql,t}return{getParameters:function(i,s,f,g,v){const y=g.fog,b=i.isMeshStandardMaterial?g.environment:null,x=t.get(i.envMap||b),_=p[i.type],w=v.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(l)return 1024;{const e=u,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(v):0;let M,T;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.")),_){const e=$L[_];M=e.vertexShader,T=e.fragmentShader}else M=i.vertexShader,T=i.fragmentShader;const S=e.getRenderTarget();return{isWebGL2:a,shaderID:_,shaderName:i.type,vertexShader:M,fragmentShader:T,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?m(S.texture):e.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(x.mapping===dc||x.mapping===pc),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===uu,tangentSpaceNormalMap:i.normalMapType===lu,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!y,useFog:i.fog,fogExp2:y&&y.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:c,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:l,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:tc,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===ba,flipSided:i.side===ya,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=$L[t];n=vA.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=s.length;e<t;e++){const t=s[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new NP(e,n,t,i),s.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function DP(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function kP(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function BP(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function UP(e){const t=[];let n=0;const r=[],i=[],o={id:-1};function s(r,i,s,a,c,l){let u=t[n];const h=e.get(s);return void 0===u?(u={id:r.id,object:r,geometry:i,material:s,program:h.program||o,groupOrder:a,renderOrder:r.renderOrder,z:c,group:l},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=s,u.program=h.program||o,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=c,u.group=l),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,t,n,o,a,c){const l=s(e,t,n,o,a,c);(!0===n.transparent?i:r).push(l)},unshift:function(e,t,n,o,a,c){const l=s(e,t,n,o,a,c);(!0===n.transparent?i:r).unshift(l)},finish:function(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||kP),i.length>1&&i.sort(t||BP)}}}function FP(e){let t=new WeakMap;return{get:function(n,r){const i=t.get(n);let o;return void 0===i?(o=new UP(e),t.set(n,new WeakMap),t.get(n).set(r,o)):(o=i.get(r),void 0===o&&(o=new UP(e),i.set(r,o))),o},dispose:function(){t=new WeakMap}}}function zP(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new $i,color:new Xu};break;case"SpotLight":n={position:new $i,direction:new $i,color:new Xu,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new $i,color:new Xu,distance:0,decay:0};break;case"HemisphereLight":n={direction:new $i,skyColor:new Xu,groundColor:new Xu};break;case"RectAreaLight":n={color:new Xu,position:new $i,halfWidth:new $i,halfHeight:new $i}}return e[t.id]=n,n}}}let HP=0;function GP(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function jP(e,t){const n=new zP,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zu};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zu,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new $i);const o=new $i,s=new eo,a=new eo;return{setup:function(o){let s=0,a=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0;o.sort(GP);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,b=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=v.r*y,a+=v.g*y,c+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=x,i.directionalShadowMatrix[l]=t.shadow.matrix,f++}i.directional[l]=e,l++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=x,i.spotShadowMatrix[h]=t.shadow.matrix,g++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[u]=n,i.pointShadowMap[u]=x,i.pointShadowMatrix[u]=t.shadow.matrix,m++}i.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),i.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=JL.LTC_FLOAT_1,i.rectAreaLTC2=JL.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=JL.LTC_HALF_1,i.rectAreaLTC2=JL.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=c;const v=i.hash;v.directionalLength===l&&v.pointLength===u&&v.spotLength===h&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(i.directional.length=l,i.spot.length=h,i.rectArea.length=d,i.point.length=u,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=m,i.pointShadowMap.length=m,i.spotShadow.length=g,i.spotShadowMap.length=g,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=m,i.spotShadowMatrix.length=g,v.directionalLength=l,v.pointLength=u,v.spotLength=h,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,i.version=HP++)},setupView:function(e,t){let n=0,r=0,c=0,l=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),c++}else if(d.isRectAreaLight){const e=i.rectArea[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:i}}function VP(e,t){const n=new jP(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function WP(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new VP(e,t),n.set(r,[]),n.get(r).push(o)):i>=n.get(r).length?(o=new VP(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}function qP(e){Fu.call(this),this.type="MeshDepthMaterial",this.depthPacking=au,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function XP(e){Fu.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new $i,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}function YP(e,t,n){let r=new qL;const i=new zu,o=new zu,s=new Ud,a=[],c=[],l={},u={0:ya,1:va,2:ba},h=new xA({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new zu},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONTAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new lp;p.setAttribute("position",new Hd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new Ap(p,h),m=this;function g(n,r){const i=t.update(f);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,f,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,d,f,null)}function v(e,t,n){const r=e<<0|t<<1|n<<2;let i=a[r];return void 0===i&&(i=new qP({depthPacking:cu,morphTargets:e,skinning:t}),a[r]=i),i}function y(e,t,n){const r=e<<0|t<<1|n<<2;let i=c[r];return void 0===i&&(i=new XP({morphTargets:e,skinning:t}),c[r]=i),i}function b(t,n,r,i,o,s,a){let c=null,h=v,d=t.customDepthMaterial;if(!0===i.isPointLight&&(h=y,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===r.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let i=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?i=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c=h(e,i,!0===t.isInstancedMesh)}else c=d;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){const e=c.uuid,t=r.uuid;let n=l[e];void 0===n&&(n={},l[e]=n);let i=n[t];void 0===i&&(i=c.clone(),n[t]=i),c=i}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=a===ga?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!0===i.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(i.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function x(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===ga)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let c=0,l=t.length;c<l;c++){const l=t[c],u=i[l.materialIndex];if(u&&u.visible){const t=b(n,r,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,l)}}}else if(i.visible){const t=b(n,r,i,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)x(c[e],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=fa,this.render=function(t,a,c){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(wa),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,u=t.length;l<u;l++){const u=t[l],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const p=h.getFrameExtents();if(i.multiply(p),o.copy(h.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(o.x=Math.floor(n/p.x),i.x=o.x*p.x,h.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/p.y),i.y=o.y*p.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===ga){const e={minFilter:wc,magFilter:wc,format:Hc};h.map=new rC(i.x,i.y,e),h.map.texture.name=u.name+".shadowMap",h.mapPass=new rC(i.x,i.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:vc,magFilter:vc,format:Hc};h.map=new rC(i.x,i.y,e),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const f=h.getViewportCount();for(let e=0;e<f;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),h.updateMatrices(u,e),r=h.getFrustum(),x(a,c,h.camera,u,this.type)}h.isPointLightShadow||this.type!==ga||g(h,c),h.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(l,u,h)}}function ZP(e,t,n){const r=n.isWebGL2,i=new function(){let t=!1;const n=new Ud;let r=null;const i=new Ud(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?N(e.DEPTH_TEST):I(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case Va:e.depthFunc(e.NEVER);break;case Wa:e.depthFunc(e.ALWAYS);break;case qa:e.depthFunc(e.LESS);break;case Xa:e.depthFunc(e.LEQUAL);break;case Ya:e.depthFunc(e.EQUAL);break;case Za:e.depthFunc(e.GEQUAL);break;case Ja:e.depthFunc(e.GREATER);break;case $a:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null;return{setTest:function(n){t||(n?N(e.STENCIL_TEST):I(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&c===r||(e.stencilOp(t,n,r),s=t,a=n,c=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,l=null}}};let a={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null;const M=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let T=!1,S=0;const E=e.getParameter(e.VERSION);-1!==E.indexOf("WebGL")?(S=parseFloat(/^WebGL (\d)/.exec(E)[1]),T=S>=1):-1!==E.indexOf("OpenGL ES")&&(S=parseFloat(/^OpenGL ES (\d)/.exec(E)[1]),T=S>=2);let A=null,R={};const L=new Ud,C=new Ud;function P(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let t=0;t<r;t++)e.texImage2D(n+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return o}const O={};function N(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function I(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}O[e.TEXTURE_2D]=P(e.TEXTURE_2D,e.TEXTURE_2D,1),O[e.TEXTURE_CUBE_MAP]=P(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),N(e.DEPTH_TEST),o.setFunc(Xa),U(!1),F(ua),N(e.CULL_FACE),B(wa);const D={[Ra]:e.FUNC_ADD,[La]:e.FUNC_SUBTRACT,[Ca]:e.FUNC_REVERSE_SUBTRACT};if(r)D[Pa]=e.MIN,D[Oa]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(D[Pa]=e.MIN_EXT,D[Oa]=e.MAX_EXT)}const k={[Na]:e.ZERO,[Ia]:e.ONE,[Da]:e.SRC_COLOR,[Ba]:e.SRC_ALPHA,[ja]:e.SRC_ALPHA_SATURATE,[Ha]:e.DST_COLOR,[Fa]:e.DST_ALPHA,[ka]:e.ONE_MINUS_SRC_COLOR,[Ua]:e.ONE_MINUS_SRC_ALPHA,[Ga]:e.ONE_MINUS_DST_COLOR,[za]:e.ONE_MINUS_DST_ALPHA};function B(t,n,r,i,o,s,a,c){if(t!==wa){if(l||(N(e.BLEND),l=!0),t===Aa)o=o||n,s=s||r,a=a||i,n===h&&o===f||(e.blendEquationSeparate(D[n],D[o]),h=n,f=o),r===d&&i===p&&s===m&&a===g||(e.blendFuncSeparate(k[r],k[i],k[s],k[a]),d=r,p=i,m=s,g=a),u=t,v=null;else if(t!==u||c!==v){if(h===Ra&&f===Ra||(e.blendEquation(e.FUNC_ADD),h=Ra,f=Ra),c)switch(t){case Ma:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ta:e.blendFunc(e.ONE,e.ONE);break;case Sa:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case Ea:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Ma:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ta:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case Sa:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case Ea:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}d=null,p=null,m=null,g=null,u=t,v=c}}else l&&(I(e.BLEND),l=!1)}function U(t){y!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),y=t)}function F(t){t!==la?(N(e.CULL_FACE),t!==b&&(t===ua?e.cullFace(e.BACK):t===ha?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):I(e.CULL_FACE),b=t}function z(t,n,r){t?(N(e.POLYGON_OFFSET_FILL),_===n&&w===r||(e.polygonOffset(n,r),_=n,w=r)):I(e.POLYGON_OFFSET_FILL)}function H(t){void 0===t&&(t=e.TEXTURE0+M-1),A!==t&&(e.activeTexture(t),A=t)}return{buffers:{color:i,depth:o,stencil:s},enable:N,disable:I,useProgram:function(t){return c!==t&&(e.useProgram(t),c=t,!0)},setBlending:B,setMaterial:function(t,n){t.side===ba?I(e.CULL_FACE):N(e.CULL_FACE);let r=t.side===ya;n&&(r=!r),U(r),t.blending===Ma&&!1===t.transparent?B(wa):B(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),i.setMask(t.colorWrite);const a=t.stencilWrite;s.setTest(a),a&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),z(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:U,setCullFace:F,setLineWidth:function(t){t!==x&&(T&&e.lineWidth(t),x=t)},setPolygonOffset:z,setScissorTest:function(t){t?N(e.SCISSOR_TEST):I(e.SCISSOR_TEST)},activeTexture:H,bindTexture:function(t,n){null===A&&H();let r=R[A];void 0===r&&(r={type:void 0,texture:void 0},R[A]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||O[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=R[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===L.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),L.copy(t))},viewport:function(t){!1===C.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),C.copy(t))},reset:function(){a={},A=null,R={},c=null,l=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,v=!1,y=null,b=null,x=null,_=null,w=null,i.reset(),o.reset(),s.reset()}}}function JP(e,t,n,r,i,o,s){const a=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Zi.floorPowerOfTwo:Math.floor,o=r(i*e.width),s=r(i*e.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;return a.width=o,a.height=s,a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Zi.isPowerOfTwo(e.width)&&Zi.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==vc&&e.minFilter!==wc}function b(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function x(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return r===e.RED&&(i===e.FLOAT&&(o=e.R32F),i===e.HALF_FLOAT&&(o=e.R16F),i===e.UNSIGNED_BYTE&&(o=e.R8)),r===e.RGB&&(i===e.FLOAT&&(o=e.RGB32F),i===e.HALF_FLOAT&&(o=e.RGB16F),i===e.UNSIGNED_BYTE&&(o=e.RGB8)),r===e.RGBA&&(i===e.FLOAT&&(o=e.RGBA32F),i===e.HALF_FLOAT&&(o=e.RGBA16F),i===e.UNSIGNED_BYTE&&(o=e.RGBA8)),o!==e.R16F&&o!==e.R32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function _(t){return t===vc||t===yc||t===xc?e.NEAREST:e.LINEAR}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=r.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),r.remove(t))}(n),n.isVideoTexture&&d.delete(n),s.memory.textures--}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=r.get(t),i=r.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}}(n),s.memory.textures--}let T=0;function S(t,i){const o=r.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(t),t.version>0&&o.__version!==t.version){const e=t.image;if(void 0===e)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==e.complete)return void P(o,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D,o.__webglTexture)}function E(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;C(t,r),n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),c=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=s||c?c?r.image[e].image:r.image[e]:g(r.image[e],!1,!0,l);const h=u[0],d=v(h)||a,p=o.convert(r.format),f=o.convert(r.type),m=x(r.internalFormat,p,f);let _;if(L(e.TEXTURE_CUBE_MAP,r,d),s){for(let t=0;t<6;t++){_=u[t].mipmaps;for(let i=0;i<_.length;i++){const o=_[i];r.format!==Hc&&r.format!==zc?null!==p?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,m,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,m,o.width,o.height,0,p,f,o.data)}}t.__maxMipLevel=_.length-1}else{_=r.mipmaps;for(let t=0;t<6;t++)if(c){n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,u[t].width,u[t].height,0,p,f,u[t].data);for(let r=0;r<_.length;r++){const i=_[r].image[t].image;n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,p,f,u[t]);for(let r=0;r<_.length;r++){const i=_[r];n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,m,p,f,i.image[t])}}t.__maxMipLevel=_.length}y(r,d)&&b(e.TEXTURE_CUBE_MAP,r,h.width,h.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(s,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture))}const A={[fc]:e.REPEAT,[mc]:e.CLAMP_TO_EDGE,[gc]:e.MIRRORED_REPEAT},R={[vc]:e.NEAREST,[yc]:e.NEAREST_MIPMAP_NEAREST,[xc]:e.NEAREST_MIPMAP_LINEAR,[wc]:e.LINEAR,[Mc]:e.LINEAR_MIPMAP_NEAREST,[Sc]:e.LINEAR_MIPMAP_LINEAR};function L(n,o,s){s?(e.texParameteri(n,e.TEXTURE_WRAP_S,A[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,A[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,A[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,R[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,R[o.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),o.wrapS===mc&&o.wrapT===mc||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,_(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,_(o.minFilter)),o.minFilter!==vc&&o.minFilter!==wc&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const c=t.get("EXT_texture_filter_anisotropic");if(c){if(o.type===Nc&&null===t.get("OES_texture_float_linear"))return;if(o.type===Ic&&null===(a||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),s.memory.textures++)}function P(t,r,i){let s=e.TEXTURE_2D;r.isDataTexture2DArray&&(s=e.TEXTURE_2D_ARRAY),r.isDataTexture3D&&(s=e.TEXTURE_3D),C(t,r),n.activeTexture(e.TEXTURE0+i),n.bindTexture(s,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);const c=function(e){return!a&&(e.wrapS!==mc||e.wrapT!==mc||e.minFilter!==vc&&e.minFilter!==wc)}(r)&&!1===v(r.image),l=g(r.image,c,!1,u),h=v(l)||a,d=o.convert(r.format);let p,f=o.convert(r.type),m=x(r.internalFormat,d,f);L(s,r,h);const _=r.mipmaps;if(r.isDepthTexture)m=e.DEPTH_COMPONENT,a?m=r.type===Nc?e.DEPTH_COMPONENT32F:r.type===Oc?e.DEPTH_COMPONENT24:r.type===Uc?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===Nc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Wc&&m===e.DEPTH_COMPONENT&&r.type!==Cc&&r.type!==Oc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Cc,f=o.convert(r.type)),r.format===qc&&m===e.DEPTH_COMPONENT&&(m=e.DEPTH_STENCIL,r.type!==Uc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Uc,f=o.convert(r.type))),n.texImage2D(e.TEXTURE_2D,0,m,l.width,l.height,0,d,f,null);else if(r.isDataTexture)if(_.length>0&&h){for(let t=0,r=_.length;t<r;t++)p=_[t],n.texImage2D(e.TEXTURE_2D,t,m,p.width,p.height,0,d,f,p.data);r.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(e.TEXTURE_2D,0,m,l.width,l.height,0,d,f,l.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let t=0,i=_.length;t<i;t++)p=_[t],r.format!==Hc&&r.format!==zc?null!==d?n.compressedTexImage2D(e.TEXTURE_2D,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,t,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=_.length-1}else if(r.isDataTexture2DArray)n.texImage3D(e.TEXTURE_2D_ARRAY,0,m,l.width,l.height,l.depth,0,d,f,l.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(e.TEXTURE_3D,0,m,l.width,l.height,l.depth,0,d,f,l.data),t.__maxMipLevel=0;else if(_.length>0&&h){for(let t=0,r=_.length;t<r;t++)p=_[t],n.texImage2D(e.TEXTURE_2D,t,m,d,f,p);r.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(e.TEXTURE_2D,0,m,d,f,l),t.__maxMipLevel=0;y(r,h)&&b(s,r,l.width,l.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function O(t,i,s,a){const c=o.convert(i.texture.format),l=o.convert(i.texture.type),u=x(i.texture.internalFormat,c,l);n.texImage2D(a,0,u,i.width,i.height,0,c,l,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,s,a,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=e.DEPTH_COMPONENT16;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Nc?i=e.DEPTH_COMPONENT32F:t.type===Oc&&(i=e.DEPTH_COMPONENT24));const r=I(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=I(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,t,e.DEPTH24_STENCIL8,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=o.convert(n.texture.format),i=o.convert(n.texture.type),s=x(n.texture.internalFormat,t,i);if(r){const t=I(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,t,s,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function I(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let D=!1,k=!1;this.allocateTextureUnit=function(){const e=T;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=S,this.setTexture2DArray=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?P(o,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture))},this.setTexture3D=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?P(o,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_3D,o.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const i=r.get(t),c=r.get(t.texture);t.addEventListener("dispose",M),c.__webglTexture=e.createTexture(),s.memory.textures++;const l=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,h=v(t)||a;if(!a||t.texture.format!==zc||t.texture.type!==Nc&&t.texture.type!==Ic||(t.texture.format=Hc,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){i.__webglFramebuffer=[];for(let t=0;t<6;t++)i.__webglFramebuffer[t]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),u)if(a){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.__webglColorRenderbuffer);const n=o.convert(t.texture.format),r=o.convert(t.texture.type),s=x(t.texture.internalFormat,n,r),a=I(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,a,s,t.width,t.height),e.bindFramebuffer(e.FRAMEBUFFER,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,i.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),N(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),L(e.TEXTURE_CUBE_MAP,t.texture,h);for(let n=0;n<6;n++)O(i.__webglFramebuffer[n],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n);y(t.texture,h)&&b(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else n.bindTexture(e.TEXTURE_2D,c.__webglTexture),L(e.TEXTURE_2D,t.texture,h),O(i.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),y(t.texture,h)&&b(e.TEXTURE_2D,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&function(t){const n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);const i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Wc)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(n.depthTexture.format!==qc)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=e.createRenderbuffer(),N(n.__webglDepthbuffer[r],t,!1)}else e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),N(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(e.FRAMEBUFFER,null)}(t)},this.updateRenderTargetMipmap=function(t){const i=t.texture;if(y(i,v(t)||a)){const o=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(i).__webglTexture;n.bindTexture(o,s),b(o,i,t.width,t.height),n.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const n=r.get(t);e.bindFramebuffer(e.READ_FRAMEBUFFER,n.__webglMultisampledFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n.__webglFramebuffer);const i=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT),e.blitFramebuffer(0,0,i,o,0,0,i,o,s,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),E(e,t)}}function $P(e,t,n){const r=n.isWebGL2;return{convert:function(n){let i;if(n===Ac)return e.UNSIGNED_BYTE;if(n===Dc)return e.UNSIGNED_SHORT_4_4_4_4;if(n===kc)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Bc)return e.UNSIGNED_SHORT_5_6_5;if(n===Rc)return e.BYTE;if(n===Lc)return e.SHORT;if(n===Cc)return e.UNSIGNED_SHORT;if(n===Pc)return e.INT;if(n===Oc)return e.UNSIGNED_INT;if(n===Nc)return e.FLOAT;if(n===Ic)return r?e.HALF_FLOAT:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(n===Fc)return e.ALPHA;if(n===zc)return e.RGB;if(n===Hc)return e.RGBA;if(n===Gc)return e.LUMINANCE;if(n===jc)return e.LUMINANCE_ALPHA;if(n===Wc)return e.DEPTH_COMPONENT;if(n===qc)return e.DEPTH_STENCIL;if(n===Xc)return e.RED;if(n===Yc)return e.RED_INTEGER;if(n===Zc)return e.RG;if(n===Jc)return e.RG_INTEGER;if(n===$c)return e.RGB_INTEGER;if(n===Kc)return e.RGBA_INTEGER;if(n===Qc||n===el||n===tl||n===nl){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Qc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===el)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===tl)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===nl)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===rl||n===il||n===ol||n===sl){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===rl)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===il)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===ol)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===sl)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===al)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((n===cl||n===ll)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(n===cl)return i.COMPRESSED_RGB8_ETC2;if(n===ll)return i.COMPRESSED_RGBA8_ETC2_EAC}return n===ul||n===hl||n===dl||n===pl||n===fl||n===ml||n===gl||n===vl||n===yl||n===bl||n===xl||n===_l||n===wl||n===Ml||n===Sl||n===El||n===Al||n===Rl||n===Ll||n===Cl||n===Pl||n===Ol||n===Nl||n===Il||n===Dl||n===kl||n===Bl||n===Ul?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?n:null):n===Tl?(i=t.get("EXT_texture_compression_bptc"),null!==i?n:null):n===Uc?r?e.UNSIGNED_INT_24_8:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function KP(e=[]){hA.call(this),this.cameras=e}function QP(){Ro.call(this),this.type="Group"}function eO(){this._targetRay=null,this._grip=null,this._hand=null}function tO(e,t){const n=this;let r=null,i=1,o=null,s="local-floor",a=null;const c=[],l=new Map,u=new hA;u.layers.enable(1),u.viewport=new Ud;const h=new hA;h.layers.enable(2),h.viewport=new Ud;const d=[u,h],p=new KP;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(e){const t=l.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function v(){l.forEach((function(e,t){e.disconnect(t)})),l.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),T.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(e){o=e,T.setContext(r),T.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function b(e){const t=r.inputSources;for(let e=0;e<c.length;e++)l.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=l.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),l.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=l.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new eO,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new eO,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new eO,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=function(e){if(r=e,null!==r){r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",v);const e=t.getContextAttributes();!0!==e.xrCompatible&&t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:i},o=new XRWebGLLayer(r,t,n);r.updateRenderState({baseLayer:o}),r.requestReferenceSpace(s).then(y),r.addEventListener("inputsourceschange",b)}};const x=new $i,_=new $i;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=h.near=u.near=e.near,p.far=h.far=u.far=e.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const t=e.parent,n=p.cameras;w(p,t);for(let e=0;e<n.length;e++)w(n[e],t);e.matrixWorld.copy(p.matrixWorld);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){x.setFromMatrixPosition(t.matrixWorld),_.setFromMatrixPosition(n.matrixWorld);const r=x.distanceTo(_),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=a+f,y=d-m,b=p+(r-m),w=c*a/v*g,M=l*a/v*g;e.projectionMatrix.makePerspective(y,b,w,M,g,v)}(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let M=null;const T=new XL;T.setAnimationLoop((function(t,n){if(a=n.getViewerPose(o),null!==a){const t=a.views,n=r.renderState.baseLayer;e.setFramebuffer(n.framebuffer);let i=!1;t.length!==p.cameras.length&&(p.cameras.length=0,i=!0);for(let e=0;e<t.length;e++){const r=t[e],o=n.getViewport(r),s=d[e];s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===e&&p.matrix.copy(s.matrix),!0===i&&p.cameras.push(s)}}const i=r.inputSources;for(let e=0;e<c.length;e++){const t=c[e],r=i[e];t.update(r,n,o)}M&&M(t,n)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}function nO(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===ya&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===ya&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ya&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ya&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ya&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ya&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===ya&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,r):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ya&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ya&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ya&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ya&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function rO(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ql,this.physicallyCorrectLights=!1,this.toneMapping=tc,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,v=0,y=0,b=null,x=null,_=-1,w=null;const M=new Ud,T=new Ud;let S=null,E=t.width,A=t.height,R=1,L=null,C=null;const P=new Ud(0,0,E,A),O=new Ud(0,0,E,A);let N=!1;const I=new qL;let D=!1,k=!1;const B=new eo,U=new $i,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===b?R:1}let H,G,j,V,W,q,X,Y,Z,J,$,K,Q,ee,te,ne,re,ie,oe,se,ae,ce=n;function le(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",fe,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&t.shift(),ce=le(t,e),null===ce)throw le(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ue(){H=new lC(ce),G=new tC(ce,H,e),!1===G.isWebGL2&&(H.get("WEBGL_depth_texture"),H.get("OES_texture_float"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),H.get("OES_element_index_uint"),H.get("OES_vertex_array_object"),H.get("ANGLE_instanced_arrays")),H.get("OES_texture_float_linear"),se=new $P(ce,H,G),j=new ZP(ce,H,G),j.scissor(T.copy(O).multiplyScalar(R).floor()),j.viewport(M.copy(P).multiplyScalar(R).floor()),V=new dC(ce),W=new DP,q=new JP(ce,H,j,W,G,se,V),X=new cC(f),Y=new YL(ce,G),ae=new QL(ce,H,Y,G),Z=new uC(ce,Y,V,ae),J=new gC(ce,Z,Y,V),re=new mC(ce),te=new nC(W),$=new IP(f,X,H,G,ae,te),K=new nO(W),Q=new FP(W),ee=new WP(H,G),ne=new KL(f,X,j,J,a),ie=new eC(ce,H,V,G),oe=new hC(ce,H,V,G),V.programs=$.programs,f.capabilities=G,f.extensions=H,f.properties=W,f.renderLists=Q,f.state=j,f.info=V}ue();const he=new tO(f,ce);this.xr=he;const de=new YP(f,J,G.maxTextureSize);function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function fe(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,ue()}function me(e){const t=e.target;t.removeEventListener("dispose",me),function(e){ge(e),W.remove(e)}(t)}function ge(e){const t=W.get(e).program;void 0!==t&&$.releaseProgram(t)}this.shadowMap=de,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=H.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=H.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(E,A,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new zu),e.set(E,A)},this.setSize=function(e,n,r){he.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=e,A=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new zu),e.set(E*R,A*R).floor()},this.setDrawingBufferSize=function(e,n,r){E=e,A=n,R=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Ud),e.copy(M)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),j.viewport(M.copy(P).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),j.scissor(T.copy(O).multiplyScalar(R).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){j.setScissorTest(N=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Xu),e.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=ce.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=ce.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=ce.STENCIL_BUFFER_BIT),ce.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pe,!1),t.removeEventListener("webglcontextrestored",fe,!1),Q.dispose(),ee.dispose(),W.dispose(),X.dispose(),J.dispose(),ae.dispose(),he.dispose(),ye.stop()},this.renderBufferImmediate=function(e,t){ae.initAttributes();const n=W.get(e);e.hasPositions&&!n.position&&(n.position=ce.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ce.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ce.createBuffer()),e.hasColors&&!n.color&&(n.color=ce.createBuffer());const r=t.getAttributes();e.hasPositions&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.position),ce.bufferData(ce.ARRAY_BUFFER,e.positionArray,ce.DYNAMIC_DRAW),ae.enableAttribute(r.position),ce.vertexAttribPointer(r.position,3,ce.FLOAT,!1,0,0)),e.hasNormals&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.normal),ce.bufferData(ce.ARRAY_BUFFER,e.normalArray,ce.DYNAMIC_DRAW),ae.enableAttribute(r.normal),ce.vertexAttribPointer(r.normal,3,ce.FLOAT,!1,0,0)),e.hasUvs&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.uv),ce.bufferData(ce.ARRAY_BUFFER,e.uvArray,ce.DYNAMIC_DRAW),ae.enableAttribute(r.uv),ce.vertexAttribPointer(r.uv,2,ce.FLOAT,!1,0,0)),e.hasColors&&(ce.bindBuffer(ce.ARRAY_BUFFER,n.color),ce.bufferData(ce.ARRAY_BUFFER,e.colorArray,ce.DYNAMIC_DRAW),ae.enableAttribute(r.color),ce.vertexAttribPointer(r.color,3,ce.FLOAT,!1,0,0)),ae.disableUnusedAttributes(),ce.drawArrays(ce.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=F);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=Me(e,t,r,i);j.setMaterial(r,s);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,h=1;!0===r.wireframe&&(c=Z.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&re.update(i,n,r,a),ae.setup(i,r,a,n,c);let d=ie;null!==c&&(u=Y.get(c),d=oe,d.setIndex(u));const p=null!==c?c.count:l.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(p,f+m,g+v)-1,x=Math.max(0,b-y+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*z()),d.setMode(ce.LINES)):d.setMode(ce.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),j.setLineWidth(e*z()),i.isLineSegments?d.setMode(ce.LINES):i.isLineLoop?d.setMode(ce.LINE_LOOP):d.setMode(ce.LINE_STRIP)}else i.isPoints?d.setMode(ce.POINTS):i.isSprite&&d.setMode(ce.TRIANGLES);if(i.isInstancedMesh)d.renderInstances(y,x,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,e)}else d.render(y,x)}},this.compile=function(e,t){d=ee.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights();const n=new WeakMap;e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];!1===n.has(o)&&(we(o,e,t),n.set(o))}else!1===n.has(r)&&(we(r,e,t),n.set(r))}))};let ve=null;const ye=new XL;function be(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=J.update(e),i=e.material;i.visible&&h.push(e,t,i,n,U.z,null)}}else if(e.isImmediateRenderObject)r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B),h.push(e,null,e.material,n,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==V.render.frame&&(e.skeleton.update(),e.skeleton.frame=V.render.frame),!e.frustumCulled||I.intersectsObject(e))){r&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=J.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&h.push(e,t,a,n,U.z,s)}}else i.visible&&h.push(e,t,i,n,U.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)be(i[e],t,n,r)}function xe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,c=null===r?o.material:r,l=o.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,r=e.length;n<r;n++){const r=e[n];s.layers.test(r.layers)&&(j.viewport(M.copy(r.viewport)),d.setupLightsView(r),_e(s,t,r,a,c,l))}}else _e(s,t,n,a,c,l)}}function _e(e,t,n,r,i,o){if(e.onBeforeRender(f,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=Me(n,t,i,e);j.setMaterial(i),ae.reset(),function(e,t){e.render((function(e){f.renderBufferImmediate(e,t)}))}(e,r)}else f.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(f,t,n,r,i,o)}function we(e,t,n){!0!==t.isScene&&(t=F);const r=W.get(e),i=d.state.lights,o=d.state.shadowsArray,s=i.state.version,a=$.getParameters(e,i.state,o,t,n),c=$.getProgramCacheKey(a);let l=r.program,u=!0;if(void 0===l)e.addEventListener("dispose",me);else if(l.cacheKey!==c)ge(e);else if(r.lightsStateVersion!==s)u=!1;else{if(void 0!==a.shaderID){const n=e.isMeshStandardMaterial?t.environment:null;return void(r.envMap=X.get(e.envMap||n))}u=!1}u&&(a.uniforms=$.getUniforms(e),e.onBeforeCompile(a,f),l=$.acquireProgram(a,c),r.program=l,r.uniforms=a.uniforms,r.outputEncoding=a.outputEncoding);const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,h.clippingPlanes=te.uniform),r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=X.get(e.envMap||r.environment),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const p=r.program.getUniforms(),m=pP.seqWithValue(p.seq,h);r.uniformsList=m}function Me(e,t,n,r){!0!==t.isScene&&(t=F),q.resetTextureUnits();const i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===b?f.outputEncoding:b.texture.encoding,a=X.get(n.envMap||o),c=W.get(n),l=d.state.lights;if(!0===D&&(!0===k||e!==w)){const t=e===w&&n.id===_;te.setState(n,e,t)}n.version===c.__version?n.fog&&c.fog!==i||c.environment!==o||c.needsLights&&c.lightsStateVersion!==l.state.version?we(n,t,r):void 0===c.numClippingPlanes||c.numClippingPlanes===te.numPlanes&&c.numIntersection===te.numIntersection?(c.outputEncoding!==s||c.envMap!==a)&&we(n,t,r):we(n,t,r):(we(n,t,r),c.__version=n.version);let u=!1,h=!1,p=!1;const m=c.program,g=m.getUniforms(),v=c.uniforms;if(j.useProgram(m.program)&&(u=!0,h=!0,p=!0),n.id!==_&&(_=n.id,h=!0),u||w!==e){if(g.setValue(ce,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&g.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,h=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=g.map.cameraPosition;void 0!==t&&t.setValue(ce,U.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&g.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&g.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){g.setOptional(ce,r,"bindMatrix"),g.setOptional(ce,r,"bindMatrixInverse");const e=r.skeleton;if(e){const t=e.bones;if(G.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);n=Zi.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(e.boneMatrices);const i=new jL(r,n,n,Hc,Nc);e.boneMatrices=r,e.boneTexture=i,e.boneTextureSize=n}g.setValue(ce,"boneTexture",e.boneTexture,q),g.setValue(ce,"boneTextureSize",e.boneTextureSize)}else g.setOptional(ce,e,"boneMatrices")}}var y,x;return(h||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,g.setValue(ce,"receiveShadow",r.receiveShadow)),h&&(g.setValue(ce,"toneMappingExposure",f.toneMappingExposure),c.needsLights&&(x=p,(y=v).ambientLightColor.needsUpdate=x,y.lightProbe.needsUpdate=x,y.directionalLights.needsUpdate=x,y.directionalLightShadows.needsUpdate=x,y.pointLights.needsUpdate=x,y.pointLightShadows.needsUpdate=x,y.spotLights.needsUpdate=x,y.spotLightShadows.needsUpdate=x,y.rectAreaLights.needsUpdate=x,y.hemisphereLights.needsUpdate=x),i&&n.fog&&K.refreshFogUniforms(v,i),K.refreshMaterialUniforms(v,n,R,A),pP.upload(ce,c.uniformsList,v,q)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(pP.upload(ce,c.uniformsList,v,q),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&g.setValue(ce,"center",r.center),g.setValue(ce,"modelViewMatrix",r.modelViewMatrix),g.setValue(ce,"normalMatrix",r.normalMatrix),g.setValue(ce,"modelMatrix",r.matrixWorld),m}ye.setAnimationLoop((function(e){he.isPresenting||ve&&ve(e)})),"undefined"!=typeof window&&ye.setContext(window),this.setAnimationLoop=function(e){ve=e,he.setAnimationLoop(e),null===e?ye.stop():ye.start()},this.render=function(e,t){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;ae.resetDefaultState(),_=-1,w=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===he.enabled&&!0===he.isPresenting&&(t=he.getCamera(t)),!0===e.isScene&&e.onBeforeRender(f,e,t,n||b),d=ee.get(e,p.length),d.init(),p.push(d),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(B),k=this.localClippingEnabled,D=te.init(this.clippingPlanes,k,t),h=Q.get(e,t),h.init(),be(e,t,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(L,C),!0===D&&te.beginShadows();const i=d.state.shadowsArray;de.render(i,e,t),d.setupLights(),d.setupLightsView(t),!0===D&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,r);const o=h.opaque,s=h.transparent;o.length>0&&xe(o,e,t),s.length>0&&xe(s,e,t),!0===e.isScene&&e.onAfterRender(f,e,t),null!==b&&(q.updateRenderTargetMipmap(b),q.updateMultisampleRenderTarget(b)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(e){g!==e&&null===b&&ce.bindFramebuffer(ce.FRAMEBUFFER,e),g=e},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,n=0){b=e,v=t,y=n,e&&void 0===W.get(e).__webglFramebuffer&&q.setupRenderTarget(e);let r=g,i=!1;if(e){const n=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=n[t],i=!0):r=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:n,M.copy(e.viewport),T.copy(e.scissor),S=e.scissorTest}else M.copy(P).multiplyScalar(R).floor(),T.copy(O).multiplyScalar(R).floor(),S=N;if(x!==r&&(ce.bindFramebuffer(ce.FRAMEBUFFER,r),x=r),j.viewport(M),j.scissor(T),j.setScissorTest(S),i){const r=W.get(e.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==x&&(ce.bindFramebuffer(ce.FRAMEBUFFER,a),s=!0);try{const a=e.texture,c=a.format,l=a.type;if(c!==Hc&&se.convert(c)!==ce.getParameter(ce.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===Ac||se.convert(l)===ce.getParameter(ce.IMPLEMENTATION_COLOR_READ_TYPE)||l===Nc&&(G.isWebGL2||H.get("OES_texture_float")||H.get("WEBGL_color_buffer_float"))||l===Ic&&(G.isWebGL2?H.get("EXT_color_buffer_float"):H.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ce.checkFramebufferStatus(ce.FRAMEBUFFER)===ce.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ce.readPixels(t,n,r,i,se.convert(c),se.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ce.bindFramebuffer(ce.FRAMEBUFFER,x)}}},this.copyFramebufferToTexture=function(e,t,n=0){const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),s=se.convert(t.format);q.setTexture2D(t,0),ce.copyTexImage2D(ce.TEXTURE_2D,n,s,e.x,e.y,i,o,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,s=se.convert(n.format),a=se.convert(n.type);q.setTexture2D(n,0),ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,n.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ce.texSubImage2D(ce.TEXTURE_2D,r,e.x,e.y,i,o,s,a,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(ce.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ce.texSubImage2D(ce.TEXTURE_2D,r,e.x,e.y,s,a,t.image),0===r&&n.generateMipmaps&&ce.generateMipmap(ce.TEXTURE_2D),j.unbindTexture()},this.initTexture=function(e){q.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){j.reset(),ae.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function iO(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){uA.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}function oO(e){xA.call(this,e),this.type="RawShaderMaterial"}qP.prototype=Object.create(Fu.prototype),qP.prototype.constructor=qP,qP.prototype.isMeshDepthMaterial=!0,qP.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},XP.prototype=Object.create(Fu.prototype),XP.prototype.constructor=XP,XP.prototype.isMeshDistanceMaterial=!0,XP.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},KP.prototype=Object.assign(Object.create(hA.prototype),{constructor:KP,isArrayCamera:!0}),QP.prototype=Object.assign(Object.create(Ro.prototype),{constructor:QP,isGroup:!0}),Object.assign(eO.prototype,{constructor:eO,getHandSpace:function(){if(null===this._hand&&(this._hand=new QP,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){const e=new QP;e.matrixAutoUpdate=!1,e.visible=!1,this._hand.joints.push(e),this._hand.add(e)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new QP,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new QP,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(c&&e.hand){o=!0;for(let r=0;r<=window.XRHand.LITTLE_PHALANX_TIP;r++)if(e.hand[r]){const i=t.getJointPose(e.hand[r],n),o=c.joints[r];null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=i.radius),o.visible=null!==i;const s=c.joints[window.XRHand.INDEX_PHALANX_TIP],a=c.joints[window.XRHand.THUMB_PHALANX_TIP],l=s.position.distanceTo(a.position),u=.02,h=.005;c.inputState.pinching&&l>u+h?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&l<=u-h&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==s&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==o),this}}),Object.assign(tO.prototype,co.prototype),iO.prototype=Object.assign(Object.create(uA.prototype),{constructor:iO,isOrthographicCamera:!0,copy:function(e,t){return uA.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Ro.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),oO.prototype=Object.create(xA.prototype),oO.prototype.constructor=oO,oO.prototype.isRawShaderMaterial=!0;const sO=Math.pow(2,8),aO=[.125,.215,.35,.446,.526,.582],cO=5+aO.length,lO={[Ql]:0,[eu]:1,[nu]:2,[iu]:3,[ou]:4,[su]:5,[tu]:6},uO=new iO,{_lodPlanes:hO,_sizeLods:dO,_sigmas:pO}=_O(),fO=new Xu;let mO=null;const gO=(1+Math.sqrt(5))/2,vO=1/gO,yO=[new $i(1,1,1),new $i(-1,1,1),new $i(1,1,-1),new $i(-1,1,-1),new $i(0,gO,vO),new $i(0,gO,-vO),new $i(vO,0,gO),new $i(-vO,0,gO),new $i(gO,vO,0),new $i(-gO,vO,0)];class bO{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=new oO({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new $i(0,1,0)},inputEncoding:{value:lO[Ql]},outputEncoding:{value:lO[Ql]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:wa,depthTest:!1,depthWrite:!1}),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){mO=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=SO(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=TO(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<hO.length;e++)hO[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(mO),e.scissorTest=!1,MO(e,0,0,e.width,e.height)}_fromTexture(e){mO=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:vc,minFilter:vc,generateMipmaps:!1,type:Ac,format:Vc,encoding:xO(e)?e.encoding:nu,depthBuffer:!1},n=wO(t);return n.depthBuffer=!e,this._pingPongRenderTarget=wO(t),n}_compileMaterial(e){const t=new Ap(hO[0],e);this._renderer.compile(t,uO)}_sceneToCubeUV(e,t,n,r){const i=new hA(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,c=a.outputEncoding,l=a.toneMapping;a.getClearColor(fO);const u=a.getClearAlpha();a.toneMapping=tc,a.outputEncoding=Ql;let h=e.background;if(h&&h.isColor){h.convertSRGBToLinear();const t=Math.max(h.r,h.g,h.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);h=h.multiplyScalar(Math.pow(2,-n));const r=(n+128)/255;a.setClearColor(h,r),e.background=null}for(let t=0;t<6;t++){const n=t%3;0==n?(i.up.set(0,o[t],0),i.lookAt(s[t],0,0)):1==n?(i.up.set(0,0,o[t]),i.lookAt(0,s[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,s[t])),MO(r,n*sO,t>2?sO:0,sO,sO),a.setRenderTarget(r),a.render(e,i)}a.toneMapping=l,a.outputEncoding=c,a.setClearColor(fO,u)}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=SO()):null==this._equirectShader&&(this._equirectShader=TO());const r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Ap(hO[0],r),o=r.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=lO[e.encoding],o.outputEncoding.value=lO[t.texture.encoding],MO(t,0,0,3*sO,2*sO),n.setRenderTarget(t),n.render(i,uO)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<cO;t++){const n=Math.sqrt(pO[t]*pO[t]-pO[t-1]*pO[t-1]),r=yO[(t-1)%yO.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,s){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new Ap(hO[r],c),u=c.uniforms,h=dO[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0==e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=lO[e.texture.encoding],u.outputEncoding.value=lO[e.texture.encoding];const v=dO[r];MO(t,3*Math.max(0,sO-2*v),(0===r?0:2*sO)+2*v*(r>4?r-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(l,uO)}}function xO(e){return void 0!==e&&e.type===Ac&&(e.encoding===Ql||e.encoding===eu||e.encoding===tu)}function _O(){const e=[],t=[],n=[];let r=8;for(let i=0;i<cO;i++){const o=Math.pow(2,r);t.push(o);let s=1/o;i>4?s=aO[i-8+4-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,u=[c,c,l,c,l,l,c,c,l,l,c,l],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,p*d*e),v.set(u,f*d*e);const i=[e,e,e,e,e,e];y.set(i,m*d*e)}const b=new lp;b.setAttribute("position",new Hd(g,p)),b.setAttribute("uv",new Hd(v,f)),b.setAttribute("faceIndex",new Hd(y,m)),e.push(b),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function wO(e){const t=new rC(3*sO,3*sO,e);return t.texture.mapping=dc,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function MO(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function TO(){return new oO({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new zu(1,1)},inputEncoding:{value:lO[Ql]},outputEncoding:{value:lO[Ql]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:wa,depthTest:!1,depthWrite:!1})}function SO(){return new oO({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:lO[Ql]},outputEncoding:{value:lO[Ql]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:wa,depthTest:!1,depthWrite:!1})}var EO,AO,RO,LO,CO,PO,OO=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},NO=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},IO=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},DO=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const kO=new WeakMap;let BO=null,UO=!1,FO=PO=class{constructor(){if(EO.add(this),this.localClippingEnabled=!1,this.disposers=[],AO.set(this,0),LO.set(this,0),!UO)throw new Error("class is a singleton, use the static .singleton() method to get an instance")}static singleton(){if(BO)return BO;try{return UO=!0,BO=new PO}catch(e){throw e}finally{UO=!1}}initialize(e){let t=kO.get(e);if(t)return;const n=new rO({alpha:!0,premultipliedAlpha:!0,antialias:!0});this.disposers.push(Bi((()=>{n.localClippingEnabled=this.localClippingEnabled}))),n.xr.enabled=!0,n.setPixelRatio(window.devicePixelRatio),n.shadowMap.enabled=!0,n.shadowMap.type=ma,kO.set(e,t={renderer:n,sizeChangeHandler:()=>this.updateResolution(e)}),this.updateResolution(e),e.on("sizechange",t.sizeChangeHandler),e._glLayer.appendChild(n.domElement)}uninitialize(e){var t,n;const r=kO.get(e);r&&(e.off("sizechange",r.sizeChangeHandler),null===(t=e._glLayer)||void 0===t||t.removeChild(r.renderer.domElement),r.renderer.dispose(),null===(n=r.pmremgen)||void 0===n||n.dispose(),kO.delete(e))}drawScene(e){const t=kO.get(e);if(!t)throw new ReferenceError("Can not draw scene. Scene state should be initialized first.");const{renderer:n}=t;n.render(e.three,e.threeCamera)}updateResolution(e){const t=kO.get(e);if(!t)throw new ReferenceError("Unable to update resolution. Scene state should be initialized first.");e._updateCameraAspect(),e._updateCameraPerspective(),e._updateCameraProjection();const{x:n,y:r}=e.calculatedSize;t.renderer.setSize(n,r),e.needsUpdate()}setClearColor(e,t,n){const r=kO.get(e);if(!r)throw new ReferenceError("Unable to set clear color. Scene state should be initialized first.");r.renderer.setClearColor(t,n)}setClearAlpha(e,t){const n=kO.get(e);if(!n)throw new ReferenceError("Unable to set clear alpha. Scene state should be initialized first.");n.renderer.setClearAlpha(t)}setShadowMapType(e,t){const n=kO.get(e);if(!n)throw new ReferenceError("Unable to set clear alpha. Scene state should be initialized first.");t?"pcf"==(t=t.toLowerCase())?n.renderer.shadowMap.type=fa:"pcfsoft"==t?n.renderer.shadowMap.type=ma:"basic"==t&&(n.renderer.shadowMap.type=pa):n.renderer.shadowMap.type=fa}enableBackground(e,t,n){const r=kO.get(e);if(!r)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");DO(this,AO,IO(this,AO,"f")+1,"f"),r.backgroundIsEquirectangular=t,t&&(r.pmremgen||(r.pmremgen=new bO(r.renderer),r.pmremgen.compileCubemapShader())),r.hasBackground=!0,IO(this,EO,"m",RO).call(this,e,n)}disableBackground(e){var t;const n=kO.get(e);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");DO(this,AO,IO(this,AO,"f")+1,"f"),n.hasBackground||n.hasEnvironment||(null===(t=n.pmremgen)||void 0===t||t.dispose(),n.pmremgen=void 0)}enableEnvironment(e,t){const n=kO.get(e);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");DO(this,LO,IO(this,LO,"f")+1,"f"),n.pmremgen||(n.pmremgen=new bO(n.renderer),n.pmremgen.compileCubemapShader()),n.hasEnvironment=!0,IO(this,EO,"m",CO).call(this,e,t)}disableEnvironment(e){var t;const n=kO.get(e);if(!n)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");DO(this,LO,IO(this,LO,"f")+1,"f"),n.hasBackground||n.hasEnvironment||(null===(t=n.pmremgen)||void 0===t||t.dispose(),n.pmremgen=void 0)}requestFrame(e,t){const n=kO.get(e);if(!n)throw new ReferenceError("Unable to request frame. Scene state should be initialized first.");const{renderer:r}=n;r.setAnimationLoop?r.setAnimationLoop(t):r.animate&&r.animate(t)}enableVR(e,t){const n=kO.get(e);if(!n)throw new ReferenceError("Unable to enable VR. Scene state should be initialized first.");const{renderer:r}=n;r.xr.enabled=t}createDefaultVRButton(e){const t=kO.get(e);if(!t)throw new ReferenceError("Unable to create VR button. Scene state should be initialized first.");const{renderer:n}=t;return class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function r(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",r(n),navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?function(){let t=null;function r(r){r.addEventListener("end",i),e.xr.setSession(r),n.textContent="EXIT VR",t=r}function i(){t.removeEventListener("end",i),n.textContent="ENTER VR",t=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(null===t){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking"]};navigator.xr.requestSession("immersive-vr",e).then(r)}else t.end()}}():(n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,n.textContent="VR NOT SUPPORTED")})),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",r(e),e}}}.createButton(n)}};function zO(){BO=null}AO=new WeakMap,LO=new WeakMap,EO=new WeakSet,RO=function(e,t){var n;const r=kO.get(e);if(!r)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");const i=IO(this,AO,"f");(new _E).load(null!==(n=e.background)&&void 0!==n?n:"",(e=>{i===IO(this,AO,"f")&&(r.backgroundIsEquirectangular?t(r.pmremgen.fromEquirectangular(e).texture):t(e))}))},CO=function(e,t){var n;const r=kO.get(e);if(!r)throw new ReferenceError("Internal error: Scene not registered with WebGLRendererThree.");const i=IO(this,LO,"f");(new _E).load(null!==(n=e.environment)&&void 0!==n?n:"",(e=>{i===IO(this,LO,"f")&&(t(r.pmremgen.fromEquirectangular(e).texture),e.dispose())}))},OO([Ui,NO("design:type",Object)],FO.prototype,"localClippingEnabled",void 0),FO=PO=OO([Ui,NO("design:paramtypes",[])],FO);const HO=new WeakMap;let GO=null,jO=!1;class VO{static singleton(){if(GO)return GO;try{return jO=!0,GO=new VO}catch(e){throw e}finally{jO=!1}}constructor(){if(!jO)throw new Error("class is a singleton, use the static .singleton() method to get an instance")}initialize(e){let t=HO.get(e);if(t)return;HO.set(e,t={renderer:new xh,sizeChangeHandler:()=>this.updateResolution(e)});const{renderer:n}=t;this.updateResolution(e),e.on("sizechange",t.sizeChangeHandler),e._cssLayer.appendChild(n.domElement)}uninitialize(e){var t;const n=HO.get(e);n&&(e.off("sizechange",n.sizeChangeHandler),null===(t=e._cssLayer)||void 0===t||t.removeChild(n.renderer.domElement),HO.delete(e))}drawScene(e){const t=HO.get(e);if(!t)throw new ReferenceError("Can not draw scene. Scene state should be initialized first.");const{renderer:n}=t;n.render(e.threeCSS,e.threeCamera)}updateResolution(e){const t=HO.get(e);if(!t)throw new ReferenceError("Unable to update resolution. Scene state should be initialized first.");e._updateCameraAspect(),e._updateCameraPerspective(),e._updateCameraProjection();const{x:n,y:r}=e.calculatedSize;t.renderer.setSize(n,r),e.needsUpdate()}requestFrame(e,t){requestAnimationFrame(t)}}function WO(){GO=null}var qO,XO,YO,ZO,JO,$O,KO,QO,eN,tN,nN,rN=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},iN=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},oN=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},sN=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};let aN=class extends zL{constructor(){super(),qO.add(this),this.isScene=!0,this.enableCss=!0,this.webgl=!1,this.swapLayers=!1,this.shadowmapType="basic",this.vr=!1,this.backgroundColor=new Xu("white"),this.backgroundOpacity=0,this.background=null,this.equirectangularBackground=!1,this.environment=null,this.fogMode="none",this.fogNear=0,this.fogFar=1e3,this.fogColor="gray",this.fogDensity=.0025,this.cameraNear=.1,this.cameraFar=1e4,XO.set(this,400),this.__localClipping=!1,YO.set(this,null),ZO.set(this,null),this.__elementParentSize={x:0,y:0,z:0},QO.set(this,null),this._scene=this,this.sizeMode.set("proportional","proportional","literal"),this.size.set(1,1,0),this._elementOperations.shouldRender=!0,this._createDefaultCamera(),this._calcSize(),this.needsUpdate()}set perspective(e){oN(this,XO,e,"f"),this._updateCameraPerspective(),this._updateCameraProjection(),this.needsUpdate()}get perspective(){return sN(this,XO,"f")}get threeCamera(){return this.__threeCamera}drawScene(){sN(this,YO,"f")&&sN(this,YO,"f").drawScene(this),sN(this,ZO,"f")&&sN(this,ZO,"f").drawScene(this)}connectedCallback(){super.connectedCallback(),this._stopFns.push(Nn((()=>{this.webgl?this._triggerLoadGL():this._triggerUnloadGL(),this.needsUpdate()})),Nn((()=>{var e;if(!this.webgl||!this.background)return oh(this.three.background)&&this.three.background.dispose(),null===(e=sN(this,YO,"f"))||void 0===e||e.disableBackground(this),void this.needsUpdate();this.background.match(/\.(jpg|jpeg|png)$/)?(oh(this.three.background)&&this.three.background.dispose(),sN(this,YO,"f").disableBackground(this),sN(this,YO,"f").enableBackground(this,this.equirectangularBackground,(e=>{this.three.background=e||null,this.needsUpdate()}))):console.warn(`<${this.tagName.toLowerCase()}> background attribute ignored, the given image type is not currently supported.`)})),Nn((()=>{var e;if(!this.webgl||!this.environment)return oh(this.three.environment)&&this.three.environment.dispose(),null===(e=sN(this,YO,"f"))||void 0===e||e.disableEnvironment(this),void this.needsUpdate();this.environment.match(/\.(jpg|jpeg|png)$/)?(oh(this.three.environment)&&this.three.environment.dispose(),sN(this,YO,"f").disableEnvironment(this),sN(this,YO,"f").enableEnvironment(this,(e=>{this.three.environment=e,this.needsUpdate()}))):console.warn(`<${this.tagName.toLowerCase()}> environment attribute ignored, the given image type is not currently supported.`)})),Nn((()=>{this.enableCss?this._triggerLoadCSS():this._triggerUnloadCSS(),this.needsUpdate()})),Nn((()=>{this.sizeMode,sN(this,qO,"m",KO).call(this)})))}disconnectedCallback(){super.disconnectedCallback(),sN(this,qO,"m",tN).call(this)}attributeChangedCallback(e,t,n){super.attributeChangedCallback(e,t,n),"slot"===e&&Xr((()=>{throw new Error("Assigning a <lume-scene> to a slot is not currently supported and may not work as expected. Instead, wrap the <lume-scene> in another element like a <div>, then assign the wrapper to the slot.")}))}makeThreeObject3d(){return new IR}makeThreeCSSObject(){return new IR}traverseSceneGraph(e,t=!1){if(!t){for(const n of this.composedLumeChildren)n.traverseSceneGraph(e,t);return}let n=Promise.resolve();for(const r of this.composedLumeChildren)n=r.matches(":defined")?n.then((()=>r.traverseSceneGraph(e,t))):n.then((()=>customElements.whenDefined(r.tagName.toLowerCase()))).then((()=>r.traverseSceneGraph(e,t)));return n}_createDefaultCamera(){Hn((()=>{const e=this.calculatedSize;this.__threeCamera=new hA(45,e.x/e.y||1,.1,1e4),this.__threeCamera.name=`${this.tagName}${this.id?"#"+this.id:""} DEFAULT CAMERA (webgl, ${this.__threeCamera.type})`,this.perspective=this.perspective}))}_updateCameraPerspective(){const e=sN(this,XO,"f");this.__threeCamera.fov=2*Math.atan(this.calculatedSize.y/2/e)*180/Math.PI,this.__threeCamera.position.z=e}_updateCameraAspect(){this.__threeCamera.aspect=this.calculatedSize.x/this.calculatedSize.y||1}_updateCameraProjection(){this.__threeCamera.updateProjectionMatrix()}_addCamera(e){this.__activeCameras||(this.__activeCameras=new Set),this.__activeCameras.add(e),this.__setCamera(e)}_removeCamera(e){this.__activeCameras&&(this.__activeCameras.delete(e),this.__activeCameras.size?(this.__activeCameras.forEach((t=>e=t)),this.__setCamera(e)):(this.__activeCameras=void 0,this.__setCamera()))}get parentSize(){var e,t;return null!==(t=null===(e=this.composedLumeParent)||void 0===e?void 0:e.calculatedSize)&&void 0!==t?t:this.__elementParentSize}_loadGL(){return!!super._loadGL()&&(this.three.autoUpdate=!1,oN(this,YO,sN(this,qO,"m",JO).call(this,"three"),"f"),this._glStopFns.push(Nn((()=>{"none"===this.fogMode?this.three.fog=null:"linear"===this.fogMode?this.three.fog=new HL("deeppink"):"expo2"===this.fogMode&&(this.three.fog=new GL(new Xu("deeppink").getHex())),this.needsUpdate()})),Nn((()=>{if("none"===this.fogMode);else if("linear"===this.fogMode){const e=this.three.fog;e.near=this.fogNear,e.far=this.fogFar,e.color.set(this.fogColor)}else if("expo2"===this.fogMode){const e=this.three.fog;e.color.set(this.fogColor),e.density=this.fogDensity}this.needsUpdate()})),Nn((()=>{sN(this,YO,"f").localClippingEnabled=this.__localClipping,this.needsUpdate()})),Nn((()=>{sN(this,YO,"f").setClearColor(this,this.backgroundColor,this.backgroundOpacity),this.needsUpdate()})),Nn((()=>{sN(this,YO,"f").setClearAlpha(this,this.backgroundOpacity),this.needsUpdate()})),Nn((()=>{sN(this,YO,"f").setShadowMapType(this,this.shadowmapType),this.needsUpdate()})),Nn((()=>{if(sN(this,YO,"f").enableVR(this,this.vr),this.vr){console.log("set vr frame requester!"),_s.setFrameRequester((e=>(sN(this,YO,"f").requestFrame(this,e),0)));const e=sN(this,YO,"f").createDefaultVRButton(this);e.classList.add("vrButton"),this._miscLayer.appendChild(e)}else this.xr;this.needsUpdate()})),Nn((()=>{this.__threeCamera.near=this.cameraNear,this.__threeCamera.far=this.cameraFar,this.needsUpdate()}))),this.traverseSceneGraph((e=>e._triggerLoadGL()),!0),!0)}_unloadGL(){var e;return!!super._unloadGL()&&(sN(this,YO,"f")&&(sN(this,YO,"f").uninitialize(this),oN(this,YO,null,"f")),this.traverseSceneGraph((e=>e._triggerUnloadGL())),null===(e=this.three.environment)||void 0===e||e.dispose(),oh(this.three.background)&&this.three.background.dispose(),!0)}_loadCSS(){return!!super._loadCSS()&&(oN(this,ZO,sN(this,qO,"m",$O).call(this,"three"),"f"),this.traverseSceneGraph((e=>e._loadCSS()),!0),!0)}_unloadCSS(){return!!super._unloadCSS()&&(sN(this,ZO,"f")&&(sN(this,ZO,"f").uninitialize(this),oN(this,ZO,null,"f")),this.traverseSceneGraph((e=>e._unloadCSS())),!0)}__setCamera(e){e?(this.__threeCamera=e.three,this._updateCameraAspect(),this._updateCameraProjection(),this.needsUpdate()):this._createDefaultCamera()}};XO=new WeakMap,YO=new WeakMap,ZO=new WeakMap,QO=new WeakMap,qO=new WeakSet,JO=function(e){if(sN(this,YO,"f"))return sN(this,YO,"f");let t;if("three"!==e)throw new Error("invalid WebGL renderer");return t=FO.singleton(),t.initialize(this),t},$O=function(e){if(sN(this,ZO,"f"))return sN(this,ZO,"f");let t;if("three"!==e)throw new Error('invalid CSS renderer. The only type supported is currently "three" (i.e. Three.js).');return t=VO.singleton(),t.initialize(this),t},KO=function(){!this.enableCss&&!this.webgl||"proportional"!=this.sizeMode.x&&"proportional"!=this.sizeMode.y?sN(this,qO,"m",tN).call(this):sN(this,qO,"m",eN).call(this)},eN=function(){const e=this.composedParent;if(!e)throw new Error("A Scene can only be child of HTMLElement or ShadowRoot (f.e. not an SVGElement).");oN(this,QO,new ResizeObserver((t=>{for(const n of t)if(n.contentBoxSize){const t=n.contentBoxSize[0]||n.contentBoxSize,{inlineSize:r,blockSize:i}=t;getComputedStyle(e).writingMode.includes("horizontal")?sN(this,qO,"m",nN).call(this,r,i):sN(this,qO,"m",nN).call(this,i,r)}else{const{width:e,height:t}=n.contentRect;sN(this,qO,"m",nN).call(this,e,t)}})),"f"),sN(this,QO,"f").observe(e)},tN=function(){var e;null===(e=sN(this,QO,"f"))||void 0===e||e.disconnect(),oN(this,QO,null,"f")},nN=function(e,t){const n=this.__elementParentSize;n.x==e&&n.y==t||(n.x=e,n.y=t,this.__elementParentSize=n)},aN.css=`\n\t\t${zL.css}\n\t\t.vrButton {\n\t\t\tcolor: black;\n\t\t\tborder-color: black;\n\t\t}\n\t`,aN.observedAttributes=["slot"],rN([U("propertychange"),Xn(!0),iN("design:type",Object)],aN.prototype,"enableCss",void 0),rN([U("propertychange"),Xn(!1),iN("design:type",Object)],aN.prototype,"webgl",void 0),rN([U("propertychange"),Xn(!1),iN("design:type",Object)],aN.prototype,"swapLayers",void 0),rN([U("propertychange"),jn,iN("design:type",Object)],aN.prototype,"shadowmapType",void 0),rN([U("propertychange"),Xn(!1),iN("design:type",Object)],aN.prototype,"vr",void 0),rN([U("propertychange"),jn,iN("design:type",Object)],aN.prototype,"backgroundColor",void 0),rN([U("propertychange"),qn(0),iN("design:type",Object)],aN.prototype,"backgroundOpacity",void 0),rN([U("propertychange"),jn,iN("design:type",Object)],aN.prototype,"background",void 0),rN([U("propertychange"),Xn(!1),iN("design:type",Object)],aN.prototype,"equirectangularBackground",void 0),rN([U("propertychange"),jn,iN("design:type",Object)],aN.prototype,"environment",void 0),rN([Wn("none"),iN("design:type",String)],aN.prototype,"fogMode",void 0),rN([qn(0),iN("design:type",Object)],aN.prototype,"fogNear",void 0),rN([qn(1e3),iN("design:type",Object)],aN.prototype,"fogFar",void 0),rN([Wn("gray"),iN("design:type",String)],aN.prototype,"fogColor",void 0),rN([qn(.0025),iN("design:type",Object)],aN.prototype,"fogDensity",void 0),rN([qn(.1),iN("design:type",Object)],aN.prototype,"cameraNear",void 0),rN([qn(1e4),iN("design:type",Object)],aN.prototype,"cameraFar",void 0),rN([qn(400),iN("design:type",Object),iN("design:paramtypes",[Object])],aN.prototype,"perspective",null),rN([In,iN("design:type",Object)],aN.prototype,"__localClipping",void 0),rN([In,iN("design:type",Object)],aN.prototype,"__elementParentSize",void 0),aN=rN([Yn("lume-scene",Hh),iN("design:paramtypes",[])],aN),aN.prototype.isScene=!0;var cN=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},lN=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let uN=class extends Vh{constructor(){super(...arguments),this.color="royalblue",this.intensity=1.3,this.shadowBias=0,this.template=()=>br`
		<lume-point-light
			ref=${e=>this.light=e}
			attr:color=${()=>this.color}
			attr:intensity=${()=>this.intensity}
			attr:shadow-bias=${()=>this.shadowBias}
			distance="10000"
		>
			<lume-sphere
				ref=${e=>this.sphere=e}
				has="basic-material"
				attr:color=${()=>this.color}
				opacity="0.5"
				mount-point="0.5 0.5 0.5"
				size="10 10 10"
				cast-shadow="false"
				receive-shadow="false"
			></lume-sphere>
		</lume-point-light>
	`}connectedCallback(){super.connectedCallback();const e=this.intensity,t=this.opacity,n=()=>{const r=.4*(Math.random()-1);this.light.intensity=e+r,this.sphere.opacity=t+r,setTimeout((()=>_s.once(n)),100*Math.random())};_s.once(n)}};cN([Wn("royalblue"),lN("design:type",Object)],uN.prototype,"color",void 0),cN([qn(1.3),lN("design:type",Object)],uN.prototype,"intensity",void 0),cN([qn(0),lN("design:type",Object)],uN.prototype,"shadowBias",void 0),uN=cN([Yn("flickering-orb",Hh)],uN);var hN=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let dN=class extends Vh{constructor(){super(...arguments),this.shadowBias=0,this.template=()=>br`
		<>
			<flickering-orb color="yellow" position="500 0 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="deeppink" position="-500 0 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="cyan" position="0 0 500" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="limegreen" position="0 0 -500" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="white" position="0 -500 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
			<flickering-orb color="white" position="0 250 0" attr:shadow-bias=${()=>this.shadowBias}></flickering-orb>
		</>
	`}};hN([qn(0),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],dN.prototype,"shadowBias",void 0),dN=hN([Yn("flickering-orbs",Hh)],dN);var pN=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};const fN="120,130,140";let mN=class extends rn{constructor(){super(...arguments),this.color=fN,this.template=()=>br`
		<>
			<div class="top"></div>
			<div class="right"></div>
			<div class="bottom"></div>
			<div class="left"></div>
		</>
	`,this.css=`\n\t\t:host {\n\t\t\t--loading-icon-color: ${this.color};\n\t\t}\n\n\t\t.top, .right, .bottom, .left {\n\t\t\tposition: absolute;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tborder-radius: 50%;\n\t\t\topacity: 0;\n\t\t\tborder: 8px solid rgba(var(--loading-icon-color), 0);\n\t\t}\n\t\t.top {\n\t\t\tborder-top-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0s infinite;\n\t\t}\n\t\t.right {\n\t\t\tborder-right-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0.25s infinite;\n\t\t}\n\t\t.bottom {\n\t\t\tborder-bottom-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0.5s infinite;\n\t\t}\n\t\t.left {\n\t\t\tborder-left-color: rgba(var(--loading-icon-color), 1);\n\t\t\tanimation: fade 1s 0.75s infinite;\n\t\t}\n\t\t@keyframes fade {\n\t\t\t0% { opacity: 0; }\n\t\t\t50% { opacity: 1; }\n\t\t\t100% { opacity: 0; }\n\t\t}\n\t`}};pN([Wn(fN),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],mN.prototype,"color",void 0),mN=pN([Yn("loading-icon",Hh)],mN);const gN={CONST:"const",NOTANATTRIBUTE:"const",VARIABLE:"var",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",WIDTH:"width",HEIGHT:"height",CENTERX:"centerX",CENTERY:"centerY",ZINDEX:"zIndex"},vN={LEQ:"leq",EQU:"equ",GEQ:"geq"},yN=function(){function e(e,t,n,r,i,o){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=o,this.name="SyntaxError"}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var n,r=arguments.length>1?arguments[1]:{},i={},o={visualFormatString:_e},s=_e,a=i,c=null,l=":",u={type:"literal",value:":",description:'":"'},h=function(e,t,n,r,i){return{orientation:e?e[0]:"horizontal",cascade:(t||[]).concat([n],[].concat.apply([],r),i||[])}},d="H",p={type:"literal",value:"H",description:'"H"'},f="V",m={type:"literal",value:"V",description:'"V"'},g=function(e){return"H"==e?"horizontal":"vertical"},v="|",y={type:"literal",value:"|",description:'"|"'},b=function(){return{view:null}},x="[",_={type:"literal",value:"[",description:'"["'},w="]",M={type:"literal",value:"]",description:'"]"'},T=function(e,t){return ke(e,t?{constraints:t}:{})},S="-",E={type:"literal",value:"-",description:'"-"'},A=function(e){return e},R=function(){return[{relation:"equ",constant:"default",$parserOffset:ve()}]},L="",C=function(){return[{relation:"equ",constant:0,$parserOffset:ve()}]},P=function(e){return[{relation:"equ",constant:e,$parserOffset:ve()}]},O="(",N={type:"literal",value:"(",description:'"("'},I=",",D={type:"literal",value:",",description:'","'},k=")",B={type:"literal",value:")",description:'")"'},U=function(e,t){return[e].concat(t.map((function(e){return e[1]})))},F="@",z={type:"literal",value:"@",description:'"@"'},H=function(e,t,n){return ke({relation:"equ"},e||{},t,n?n[1]:{})},G="==",j={type:"literal",value:"==",description:'"=="'},V=function(){return{relation:"equ",$parserOffset:ve()}},W="<=",q={type:"literal",value:"<=",description:'"<="'},X=function(){return{relation:"leq",$parserOffset:ve()}},Y=">=",Z={type:"literal",value:">=",description:'">="'},J=function(){return{relation:"geq",$parserOffset:ve()}},$=/^[0-9]/,K={type:"class",value:"[0-9]",description:"[0-9]"},Q=function(e){return{priority:parseInt(e.join(""),10)}},ee=function(e){return{constant:e}},te=/^[a-zA-Z_]/,ne={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},re=/^[a-zA-Z0-9_]/,ie={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},oe=function(e,t){return{view:e+t}},se=".",ae={type:"literal",value:".",description:'"."'},ce=function(e,t){return parseFloat(e.concat(".").concat(t).join(""))},le=function(e){return parseInt(e.join(""),10)},ue=0,he=0,de=0,pe={line:1,column:1,seenCR:!1},fe=0,me=[],ge=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=o[r.startRule]}function ve(){return he}function ye(e){return de!==e&&(de>e&&(de=0,pe={line:1,column:1,seenCR:!1}),function(e,n,r){var i,o;for(i=n;i<r;i++)"\n"===(o=t.charAt(i))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(pe,de,e),de=e),pe}function be(e){ue<fe||(ue>fe&&(fe=ue,me=[]),me.push(e))}function xe(n,r,i){var o=ye(i),s=i<t.length?t.charAt(i):null;return null!==r&&function(e){var t=1;for(e.sort((function(e,t){return e.description<t.description?-1:e.description>t.description?1:0}));t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(r),new e(null!==n?n:function(e,t){var n,r=new Array(e.length);for(n=0;n<e.length;n++)r[n]=e[n].description;return"Expected "+(e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(e){return"\\x0"+t(e)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(e){return"\\x"+t(e)})).replace(/[\u0180-\u0FFF]/g,(function(e){return"\\u0"+t(e)})).replace(/[\u1080-\uFFFF]/g,(function(e){return"\\u"+t(e)}))}(t)+'"':"end of input")+" found."}(r,s),r,s,i,o.line,o.column)}function _e(){var e,n,r,o,s,d,p,f;if(e=ue,n=ue,(r=we())!==i?(58===t.charCodeAt(ue)?(o=l,ue++):(o=i,0===ge&&be(u)),o!==i?n=r=[r,o]:(ue=n,n=a)):(ue=n,n=a),n===i&&(n=c),n!==i)if(r=ue,(o=Me())!==i&&(s=Se())!==i?r=o=[o,s]:(ue=r,r=a),r===i&&(r=c),r!==i)if((o=Te())!==i){for(s=[],d=ue,(p=Se())!==i&&(f=Te())!==i?d=p=[p,f]:(ue=d,d=a);d!==i;)s.push(d),d=ue,(p=Se())!==i&&(f=Te())!==i?d=p=[p,f]:(ue=d,d=a);s!==i?(d=ue,(p=Se())!==i&&(f=Me())!==i?d=p=[p,f]:(ue=d,d=a),d===i&&(d=c),d!==i?(he=e,e=n=h(n,r,o,s,d)):(ue=e,e=a)):(ue=e,e=a)}else ue=e,e=a;else ue=e,e=a;else ue=e,e=a;return e}function we(){var e,n;return e=ue,72===t.charCodeAt(ue)?(n=d,ue++):(n=i,0===ge&&be(p)),n===i&&(86===t.charCodeAt(ue)?(n=f,ue++):(n=i,0===ge&&be(m))),n!==i&&(he=e,n=g(n)),n}function Me(){var e,n;return e=ue,124===t.charCodeAt(ue)?(n=v,ue++):(n=i,0===ge&&be(y)),n!==i&&(he=e,n=b()),n}function Te(){var e,n,r,o,s;return e=ue,91===t.charCodeAt(ue)?(n=x,ue++):(n=i,0===ge&&be(_)),n!==i&&(r=Ie())!==i?((o=Re())===i&&(o=c),o!==i?(93===t.charCodeAt(ue)?(s=w,ue++):(s=i,0===ge&&be(M)),s!==i?(he=e,e=n=T(r,o)):(ue=e,e=a)):(ue=e,e=a)):(ue=e,e=a),e}function Se(){var e,n,r,o;return e=ue,45===t.charCodeAt(ue)?(n=S,ue++):(n=i,0===ge&&be(E)),n!==i&&(r=Ee())!==i?(45===t.charCodeAt(ue)?(o=S,ue++):(o=i,0===ge&&be(E)),o!==i?(he=e,e=n=A(r)):(ue=e,e=a)):(ue=e,e=a),e===i&&(e=ue,45===t.charCodeAt(ue)?(n=S,ue++):(n=i,0===ge&&be(E)),n!==i&&(he=e,n=R()),(e=n)===i&&(e=ue,(n=L)!==i&&(he=e,n=C()),e=n)),e}function Ee(){var e;return(e=Ae())===i&&(e=Re()),e}function Ae(){var e,t;return e=ue,(t=De())!==i&&(he=e,t=P(t)),t}function Re(){var e,n,r,o,s,c,l;if(e=ue,40===t.charCodeAt(ue)?(n=O,ue++):(n=i,0===ge&&be(N)),n!==i)if((r=Le())!==i){for(o=[],s=ue,44===t.charCodeAt(ue)?(c=I,ue++):(c=i,0===ge&&be(D)),c!==i&&(l=Le())!==i?s=c=[c,l]:(ue=s,s=a);s!==i;)o.push(s),s=ue,44===t.charCodeAt(ue)?(c=I,ue++):(c=i,0===ge&&be(D)),c!==i&&(l=Le())!==i?s=c=[c,l]:(ue=s,s=a);o!==i?(41===t.charCodeAt(ue)?(s=k,ue++):(s=i,0===ge&&be(B)),s!==i?(he=e,e=n=U(r,o)):(ue=e,e=a)):(ue=e,e=a)}else ue=e,e=a;else ue=e,e=a;return e}function Le(){var e,n,r,o,s,l;return e=ue,(n=Ce())===i&&(n=c),n!==i&&(r=Pe())!==i?(o=ue,64===t.charCodeAt(ue)?(s=F,ue++):(s=i,0===ge&&be(z)),s!==i&&(l=Oe())!==i?o=s=[s,l]:(ue=o,o=a),o===i&&(o=c),o!==i?(he=e,e=n=H(n,r,o)):(ue=e,e=a)):(ue=e,e=a),e}function Ce(){var e,n;return e=ue,t.substr(ue,2)===G?(n=G,ue+=2):(n=i,0===ge&&be(j)),n!==i&&(he=e,n=V()),(e=n)===i&&(e=ue,t.substr(ue,2)===W?(n=W,ue+=2):(n=i,0===ge&&be(q)),n!==i&&(he=e,n=X()),(e=n)===i&&(e=ue,t.substr(ue,2)===Y?(n=Y,ue+=2):(n=i,0===ge&&be(Z)),n!==i&&(he=e,n=J()),e=n)),e}function Pe(){var e;return(e=Ne())===i&&(e=Ie()),e}function Oe(){var e,n,r;if(e=ue,n=[],$.test(t.charAt(ue))?(r=t.charAt(ue),ue++):(r=i,0===ge&&be(K)),r!==i)for(;r!==i;)n.push(r),$.test(t.charAt(ue))?(r=t.charAt(ue),ue++):(r=i,0===ge&&be(K));else n=a;return n!==i&&(he=e,n=Q(n)),n}function Ne(){var e,t;return e=ue,(t=De())!==i&&(he=e,t=ee(t)),t}function Ie(){var e,n,r,o,s;if(e=ue,n=ue,r=[],te.test(t.charAt(ue))?(o=t.charAt(ue),ue++):(o=i,0===ge&&be(ne)),o!==i)for(;o!==i;)r.push(o),te.test(t.charAt(ue))?(o=t.charAt(ue),ue++):(o=i,0===ge&&be(ne));else r=a;if(r!==i&&(r=t.substring(n,ue)),(n=r)!==i){for(r=ue,o=[],re.test(t.charAt(ue))?(s=t.charAt(ue),ue++):(s=i,0===ge&&be(ie));s!==i;)o.push(s),re.test(t.charAt(ue))?(s=t.charAt(ue),ue++):(s=i,0===ge&&be(ie));o!==i&&(o=t.substring(r,ue)),(r=o)!==i?(he=e,e=n=oe(n,r)):(ue=e,e=a)}else ue=e,e=a;return e}function De(){var e,n,r,o,s;if(e=ue,n=[],$.test(t.charAt(ue))?(r=t.charAt(ue),ue++):(r=i,0===ge&&be(K)),r!==i)for(;r!==i;)n.push(r),$.test(t.charAt(ue))?(r=t.charAt(ue),ue++):(r=i,0===ge&&be(K));else n=a;if(n!==i)if(46===t.charCodeAt(ue)?(r=se,ue++):(r=i,0===ge&&be(ae)),r!==i){if(o=[],$.test(t.charAt(ue))?(s=t.charAt(ue),ue++):(s=i,0===ge&&be(K)),s!==i)for(;s!==i;)o.push(s),$.test(t.charAt(ue))?(s=t.charAt(ue),ue++):(s=i,0===ge&&be(K));else o=a;o!==i?(he=e,e=n=ce(n,o)):(ue=e,e=a)}else ue=e,e=a;else ue=e,e=a;if(e===i){if(e=ue,n=[],$.test(t.charAt(ue))?(r=t.charAt(ue),ue++):(r=i,0===ge&&be(K)),r!==i)for(;r!==i;)n.push(r),$.test(t.charAt(ue))?(r=t.charAt(ue),ue++):(r=i,0===ge&&be(K));else n=a;n!==i&&(he=e,n=le(n)),e=n}return e}function ke(e,...t){for(var n=1;n<arguments.length;n++)for(var r in arguments[n])e[r]=arguments[n][r];return e}if((n=s())!==i&&ue===t.length)return n;throw n!==i&&ue<t.length&&be({type:"end",description:"end of input"}),xe(null,me,fe)}}}(),bN=function(){function e(e,t,n,r,i,o){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=o,this.name="SyntaxError"}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var n,r=arguments.length>1?arguments[1]:{},i={},o={visualFormatStringExt:Wt},s=Wt,a=i,c="C:",l={type:"literal",value:"C:",description:'"C:"'},u=null,h=function(e,t,n,r){return{type:"attribute",view:e.view,attributes:[t].concat(n)}},d=function(e,t){return{attr:e,predicates:t}},p=":",f={type:"literal",value:":",description:'":"'},m=function(e,t,n,r,i,o){return{type:"vfl",orientation:e?e[0]:"horizontal",cascade:(t||[]).concat(n,[].concat.apply([],r),i||[])}},g="HV",v={type:"literal",value:"HV",description:'"HV"'},y=function(){return"horzvert"},b="H",x={type:"literal",value:"H",description:'"H"'},_=function(){return"horizontal"},w="V",M={type:"literal",value:"V",description:'"V"'},T=function(){return"vertical"},S="Z",E={type:"literal",value:"Z",description:'"Z"'},A=function(){return"zIndex"},R=" ",L={type:"literal",value:" ",description:'" "'},C="//",P={type:"literal",value:"//",description:'"//"'},O={type:"any",description:"any character"},N="|",I={type:"literal",value:"|",description:'"|"'},D=function(){return{view:null}},k="[",B={type:"literal",value:"[",description:'"["'},U=",",F={type:"literal",value:",",description:'","'},z="]",H={type:"literal",value:"]",description:'"]"'},G=function(e,t){return t.length?[e].concat([].concat.apply([],t)):e},j=function(e,t,n){return wn(wn(e,t?{constraints:t}:{}),n?{cascade:n}:{})},V=function(e,t){return[].concat([].concat.apply([],e),[t])},W="->",q={type:"literal",value:"->",description:'"->"'},X=function(){return[{relation:"none"}]},Y="-",Z={type:"literal",value:"-",description:'"-"'},J=function(e){return e},$=function(){return[{relation:"equ",constant:"default"}]},K="~",Q={type:"literal",value:"~",description:'"~"'},ee=function(){return[{relation:"equ",equalSpacing:!0}]},te="",ne=function(){return[{relation:"equ",constant:0}]},re=function(e){return[{relation:"equ",multiplier:e.multiplier}]},ie=function(e){return[{relation:"equ",constant:e}]},oe="(",se={type:"literal",value:"(",description:'"("'},ae=")",ce={type:"literal",value:")",description:'")"'},le=function(e,t){return[e].concat(t.map((function(e){return e[1]})))},ue="@",he={type:"literal",value:"@",description:'"@"'},de=function(e,t,n){return wn({relation:"equ"},e||{},t,n?n[1]:{})},pe=function(e,t,n){return wn({relation:"equ",equalSpacing:!0},e||{},t,n?n[1]:{})},fe="==",me={type:"literal",value:"==",description:'"=="'},ge=function(){return{relation:"equ"}},ve="<=",ye={type:"literal",value:"<=",description:'"<="'},be=function(){return{relation:"leq"}},xe=">=",_e={type:"literal",value:">=",description:'">="'},we=function(){return{relation:"geq"}},Me=/^[0-9]/,Te={type:"class",value:"[0-9]",description:"[0-9]"},Se=function(e){return{priority:parseInt(e.join(""),10)}},Ee=function(e){return{constant:e}},Ae=function(e){return{constant:-e}},Re="+",Le={type:"literal",value:"+",description:'"+"'},Ce="%",Pe={type:"literal",value:"%",description:'"%"'},Oe=function(e){return{view:null,multiplier:e/100}},Ne=function(e){return{view:null,multiplier:e/-100}},Ie=function(e,t,n,r){return{view:e.view,attribute:t||void 0,multiplier:n||1,constant:r||void 0}},De=".left",ke={type:"literal",value:".left",description:'".left"'},Be=function(){return"left"},Ue=".right",Fe={type:"literal",value:".right",description:'".right"'},ze=function(){return"right"},He=".top",Ge={type:"literal",value:".top",description:'".top"'},je=function(){return"top"},Ve=".bottom",We={type:"literal",value:".bottom",description:'".bottom"'},qe=function(){return"bottom"},Xe=".width",Ye={type:"literal",value:".width",description:'".width"'},Ze=function(){return"width"},Je=".height",$e={type:"literal",value:".height",description:'".height"'},Ke=function(){return"height"},Qe=".centerX",et={type:"literal",value:".centerX",description:'".centerX"'},tt=function(){return"centerX"},nt=".centerY",rt={type:"literal",value:".centerY",description:'".centerY"'},it=function(){return"centerY"},ot="/",st={type:"literal",value:"/",description:'"/"'},at=function(e){return 1/e},ct="/+",lt={type:"literal",value:"/+",description:'"/+"'},ut="/-",ht={type:"literal",value:"/-",description:'"/-"'},dt=function(e){return-1/e},pt="*",ft={type:"literal",value:"*",description:'"*"'},mt=function(e){return e},gt="*+",vt={type:"literal",value:"*+",description:'"*+"'},yt="*-",bt={type:"literal",value:"*-",description:'"*-"'},xt=function(e){return-e},_t=/^[a-zA-Z_]/,wt={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},Mt=/^[a-zA-Z0-9_]/,Tt={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},St=function(e,t,n){return{view:e+t,range:n,$parserOffset:Ht()}},Et=function(e,t){return{view:e+t,$parserOffset:Ht()}},At="..",Rt={type:"literal",value:"..",description:'".."'},Lt=function(e){return parseInt(e)},Ct=".",Pt={type:"literal",value:".",description:'"."'},Ot=function(e,t){return parseFloat(e.concat(".").concat(t).join(""))},Nt=function(e){return parseInt(e.join(""),10)},It=0,Dt=0,kt=0,Bt={line:1,column:1,seenCR:!1},Ut=0,Ft=[],zt=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=o[r.startRule]}function Ht(){return Dt}function Gt(e){return kt!==e&&(kt>e&&(kt=0,Bt={line:1,column:1,seenCR:!1}),function(e,n,r){var i,o;for(i=n;i<r;i++)"\n"===(o=t.charAt(i))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(Bt,kt,e),kt=e),Bt}function jt(e){It<Ut||(It>Ut&&(Ut=It,Ft=[]),Ft.push(e))}function Vt(n,r,i){var o=Gt(i),s=i<t.length?t.charAt(i):null;return null!==r&&function(e){var t=1;for(e.sort((function(e,t){return e.description<t.description?-1:e.description>t.description?1:0}));t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(r),new e(null!==n?n:function(e,t){var n,r=new Array(e.length);for(n=0;n<e.length;n++)r[n]=e[n].description;return"Expected "+(e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(e){return"\\x0"+t(e)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(e){return"\\x"+t(e)})).replace(/[\u0180-\u0FFF]/g,(function(e){return"\\u0"+t(e)})).replace(/[\u1080-\uFFFF]/g,(function(e){return"\\u"+t(e)}))}(t)+'"':"end of input")+" found."}(r,s),r,s,i,o.line,o.column)}function Wt(){var e;return(e=Yt())===i&&(e=qt()),e}function qt(){var e,n,r,o,s,d;if(e=It,t.substr(It,2)===c?(n=c,It+=2):(n=i,0===zt&&jt(l)),n!==i)if((r=bn())!==i)if((o=Xt())!==i){for(s=[],d=Xt();d!==i;)s.push(d),d=Xt();s!==i?((d=Jt())===i&&(d=u),d!==i?(Dt=e,e=n=h(r,o,s,d)):(It=e,e=a)):(It=e,e=a)}else It=e,e=a;else It=e,e=a;else It=e,e=a;return e}function Xt(){var e,t,n;return e=It,(t=mn())!==i&&(n=on())!==i?(Dt=e,e=t=d(t,n)):(It=e,e=a),e}function Yt(){var e,n,r,o,s,c,l,h;if(e=It,n=It,(r=Zt())!==i?(58===t.charCodeAt(It)?(o=p,It++):(o=i,0===zt&&jt(f)),o!==i?n=r=[r,o]:(It=n,n=a)):(It=n,n=a),n===i&&(n=u),n!==i)if(r=It,(o=$t())!==i&&(s=tn())!==i?r=o=[o,s]:(It=r,r=a),r===i&&(r=u),r!==i)if((o=Kt())!==i){for(s=[],c=It,(l=tn())!==i&&(h=Kt())!==i?c=l=[l,h]:(It=c,c=a);c!==i;)s.push(c),c=It,(l=tn())!==i&&(h=Kt())!==i?c=l=[l,h]:(It=c,c=a);s!==i?(c=It,(l=tn())!==i&&(h=$t())!==i?c=l=[l,h]:(It=c,c=a),c===i&&(c=u),c!==i?((l=Jt())===i&&(l=u),l!==i?(Dt=e,e=n=m(n,r,o,s,c,l)):(It=e,e=a)):(It=e,e=a)):(It=e,e=a)}else It=e,e=a;else It=e,e=a;else It=e,e=a;return e}function Zt(){var e,n;return e=It,t.substr(It,2)===g?(n=g,It+=2):(n=i,0===zt&&jt(v)),n!==i&&(Dt=e,n=y()),(e=n)===i&&(e=It,72===t.charCodeAt(It)?(n=b,It++):(n=i,0===zt&&jt(x)),n!==i&&(Dt=e,n=_()),(e=n)===i&&(e=It,86===t.charCodeAt(It)?(n=w,It++):(n=i,0===zt&&jt(M)),n!==i&&(Dt=e,n=T()),(e=n)===i&&(e=It,90===t.charCodeAt(It)?(n=S,It++):(n=i,0===zt&&jt(E)),n!==i&&(Dt=e,n=A()),e=n))),e}function Jt(){var e,n,r,o,s;for(e=It,n=[],32===t.charCodeAt(It)?(r=R,It++):(r=i,0===zt&&jt(L));r!==i;)n.push(r),32===t.charCodeAt(It)?(r=R,It++):(r=i,0===zt&&jt(L));if(n!==i)if(t.substr(It,2)===C?(r=C,It+=2):(r=i,0===zt&&jt(P)),r!==i){for(o=[],t.length>It?(s=t.charAt(It),It++):(s=i,0===zt&&jt(O));s!==i;)o.push(s),t.length>It?(s=t.charAt(It),It++):(s=i,0===zt&&jt(O));o!==i?e=n=[n,r,o]:(It=e,e=a)}else It=e,e=a;else It=e,e=a;return e}function $t(){var e,n;return e=It,124===t.charCodeAt(It)?(n=N,It++):(n=i,0===zt&&jt(I)),n!==i&&(Dt=e,n=D()),n}function Kt(){var e,n,r,o,s,c,l;if(e=It,91===t.charCodeAt(It)?(n=k,It++):(n=i,0===zt&&jt(B)),n!==i)if((r=Qt())!==i){for(o=[],s=It,44===t.charCodeAt(It)?(c=U,It++):(c=i,0===zt&&jt(F)),c!==i&&(l=Qt())!==i?s=c=[c,l]:(It=s,s=a);s!==i;)o.push(s),s=It,44===t.charCodeAt(It)?(c=U,It++):(c=i,0===zt&&jt(F)),c!==i&&(l=Qt())!==i?s=c=[c,l]:(It=s,s=a);o!==i?(93===t.charCodeAt(It)?(s=z,It++):(s=i,0===zt&&jt(H)),s!==i?(Dt=e,e=n=G(r,o)):(It=e,e=a)):(It=e,e=a)}else It=e,e=a;else It=e,e=a;return e}function Qt(){var e,t,n,r;return e=It,(t=yn())!==i?((n=on())===i&&(n=u),n!==i?((r=en())===i&&(r=u),r!==i?(Dt=e,e=t=j(t,n,r)):(It=e,e=a)):(It=e,e=a)):(It=e,e=a),e}function en(){var e,n,r,o,s,c;if(e=It,58===t.charCodeAt(It)?(n=p,It++):(n=i,0===zt&&jt(f)),n!==i){if(r=[],o=It,(s=tn())!==i&&(c=Kt())!==i?o=s=[s,c]:(It=o,o=a),o!==i)for(;o!==i;)r.push(o),o=It,(s=tn())!==i&&(c=Kt())!==i?o=s=[s,c]:(It=o,o=a);else r=a;r!==i&&(o=tn())!==i?(Dt=e,e=n=V(r,o)):(It=e,e=a)}else It=e,e=a;return e}function tn(){var e,n,r,o;return e=It,t.substr(It,2)===W?(n=W,It+=2):(n=i,0===zt&&jt(q)),n!==i&&(Dt=e,n=X()),(e=n)===i&&(e=It,45===t.charCodeAt(It)?(n=Y,It++):(n=i,0===zt&&jt(Z)),n!==i&&(r=nn())!==i?(45===t.charCodeAt(It)?(o=Y,It++):(o=i,0===zt&&jt(Z)),o!==i?(Dt=e,e=n=J(r)):(It=e,e=a)):(It=e,e=a),e===i&&(e=It,45===t.charCodeAt(It)?(n=Y,It++):(n=i,0===zt&&jt(Z)),n!==i&&(Dt=e,n=$()),(e=n)===i&&(e=It,126===t.charCodeAt(It)?(n=K,It++):(n=i,0===zt&&jt(Q)),n!==i&&(r=an())!==i?(126===t.charCodeAt(It)?(o=K,It++):(o=i,0===zt&&jt(Q)),o!==i?(Dt=e,e=n=J(r)):(It=e,e=a)):(It=e,e=a),e===i&&(e=It,126===t.charCodeAt(It)?(n=K,It++):(n=i,0===zt&&jt(Q)),n!==i&&(Dt=e,n=ee()),(e=n)===i&&(e=It,(n=te)!==i&&(Dt=e,n=ne()),e=n))))),e}function nn(){var e;return(e=rn())===i&&(e=on()),e}function rn(){var e,t;return e=It,(t=pn())!==i&&(Dt=e,t=re(t)),(e=t)===i&&(e=It,(t=_n())!==i&&(Dt=e,t=ie(t)),e=t),e}function on(){var e,n,r,o,s,c,l;if(e=It,40===t.charCodeAt(It)?(n=oe,It++):(n=i,0===zt&&jt(se)),n!==i)if((r=sn())!==i){for(o=[],s=It,44===t.charCodeAt(It)?(c=U,It++):(c=i,0===zt&&jt(F)),c!==i&&(l=sn())!==i?s=c=[c,l]:(It=s,s=a);s!==i;)o.push(s),s=It,44===t.charCodeAt(It)?(c=U,It++):(c=i,0===zt&&jt(F)),c!==i&&(l=sn())!==i?s=c=[c,l]:(It=s,s=a);o!==i?(41===t.charCodeAt(It)?(s=ae,It++):(s=i,0===zt&&jt(ce)),s!==i?(Dt=e,e=n=le(r,o)):(It=e,e=a)):(It=e,e=a)}else It=e,e=a;else It=e,e=a;return e}function sn(){var e,n,r,o,s,c;return e=It,(n=ln())===i&&(n=u),n!==i&&(r=un())!==i?(o=It,64===t.charCodeAt(It)?(s=ue,It++):(s=i,0===zt&&jt(he)),s!==i&&(c=hn())!==i?o=s=[s,c]:(It=o,o=a),o===i&&(o=u),o!==i?(Dt=e,e=n=de(n,r,o)):(It=e,e=a)):(It=e,e=a),e}function an(){var e,n,r,o,s,c,l;if(e=It,40===t.charCodeAt(It)?(n=oe,It++):(n=i,0===zt&&jt(se)),n!==i)if((r=cn())!==i){for(o=[],s=It,44===t.charCodeAt(It)?(c=U,It++):(c=i,0===zt&&jt(F)),c!==i&&(l=cn())!==i?s=c=[c,l]:(It=s,s=a);s!==i;)o.push(s),s=It,44===t.charCodeAt(It)?(c=U,It++):(c=i,0===zt&&jt(F)),c!==i&&(l=cn())!==i?s=c=[c,l]:(It=s,s=a);o!==i?(41===t.charCodeAt(It)?(s=ae,It++):(s=i,0===zt&&jt(ce)),s!==i?(Dt=e,e=n=le(r,o)):(It=e,e=a)):(It=e,e=a)}else It=e,e=a;else It=e,e=a;return e}function cn(){var e,n,r,o,s,c;return e=It,(n=ln())===i&&(n=u),n!==i&&(r=un())!==i?(o=It,64===t.charCodeAt(It)?(s=ue,It++):(s=i,0===zt&&jt(he)),s!==i&&(c=hn())!==i?o=s=[s,c]:(It=o,o=a),o===i&&(o=u),o!==i?(Dt=e,e=n=pe(n,r,o)):(It=e,e=a)):(It=e,e=a),e}function ln(){var e,n;return e=It,t.substr(It,2)===fe?(n=fe,It+=2):(n=i,0===zt&&jt(me)),n!==i&&(Dt=e,n=ge()),(e=n)===i&&(e=It,t.substr(It,2)===ve?(n=ve,It+=2):(n=i,0===zt&&jt(ye)),n!==i&&(Dt=e,n=be()),(e=n)===i&&(e=It,t.substr(It,2)===xe?(n=xe,It+=2):(n=i,0===zt&&jt(_e)),n!==i&&(Dt=e,n=we()),e=n)),e}function un(){var e;return(e=pn())===i&&(e=dn())===i&&(e=fn()),e}function hn(){var e,n,r;if(e=It,n=[],Me.test(t.charAt(It))?(r=t.charAt(It),It++):(r=i,0===zt&&jt(Te)),r!==i)for(;r!==i;)n.push(r),Me.test(t.charAt(It))?(r=t.charAt(It),It++):(r=i,0===zt&&jt(Te));else n=a;return n!==i&&(Dt=e,n=Se(n)),n}function dn(){var e,n,r;return e=It,(n=_n())!==i&&(Dt=e,n=Ee(n)),(e=n)===i&&(e=It,45===t.charCodeAt(It)?(n=Y,It++):(n=i,0===zt&&jt(Z)),n!==i&&(r=_n())!==i?(Dt=e,e=n=Ae(r)):(It=e,e=a),e===i&&(e=It,43===t.charCodeAt(It)?(n=Re,It++):(n=i,0===zt&&jt(Le)),n!==i&&(r=_n())!==i?(Dt=e,e=n=Ee(r)):(It=e,e=a))),e}function pn(){var e,n,r,o;return e=It,(n=_n())!==i?(37===t.charCodeAt(It)?(r=Ce,It++):(r=i,0===zt&&jt(Pe)),r!==i?(Dt=e,e=n=Oe(n)):(It=e,e=a)):(It=e,e=a),e===i&&(e=It,45===t.charCodeAt(It)?(n=Y,It++):(n=i,0===zt&&jt(Z)),n!==i&&(r=_n())!==i?(37===t.charCodeAt(It)?(o=Ce,It++):(o=i,0===zt&&jt(Pe)),o!==i?(Dt=e,e=n=Ne(r)):(It=e,e=a)):(It=e,e=a),e===i&&(e=It,43===t.charCodeAt(It)?(n=Re,It++):(n=i,0===zt&&jt(Le)),n!==i&&(r=_n())!==i?(37===t.charCodeAt(It)?(o=Ce,It++):(o=i,0===zt&&jt(Pe)),o!==i?(Dt=e,e=n=Oe(r)):(It=e,e=a)):(It=e,e=a))),e}function fn(){var e,t,n,r,o;return e=It,(t=bn())!==i?((n=mn())===i&&(n=u),n!==i?((r=gn())===i&&(r=u),r!==i?((o=vn())===i&&(o=u),o!==i?(Dt=e,e=t=Ie(t,n,r,o)):(It=e,e=a)):(It=e,e=a)):(It=e,e=a)):(It=e,e=a),e}function mn(){var e,n;return e=It,t.substr(It,5)===De?(n=De,It+=5):(n=i,0===zt&&jt(ke)),n!==i&&(Dt=e,n=Be()),(e=n)===i&&(e=It,t.substr(It,6)===Ue?(n=Ue,It+=6):(n=i,0===zt&&jt(Fe)),n!==i&&(Dt=e,n=ze()),(e=n)===i&&(e=It,t.substr(It,4)===He?(n=He,It+=4):(n=i,0===zt&&jt(Ge)),n!==i&&(Dt=e,n=je()),(e=n)===i&&(e=It,t.substr(It,7)===Ve?(n=Ve,It+=7):(n=i,0===zt&&jt(We)),n!==i&&(Dt=e,n=qe()),(e=n)===i&&(e=It,t.substr(It,6)===Xe?(n=Xe,It+=6):(n=i,0===zt&&jt(Ye)),n!==i&&(Dt=e,n=Ze()),(e=n)===i&&(e=It,t.substr(It,7)===Je?(n=Je,It+=7):(n=i,0===zt&&jt($e)),n!==i&&(Dt=e,n=Ke()),(e=n)===i&&(e=It,t.substr(It,8)===Qe?(n=Qe,It+=8):(n=i,0===zt&&jt(et)),n!==i&&(Dt=e,n=tt()),(e=n)===i&&(e=It,t.substr(It,8)===nt?(n=nt,It+=8):(n=i,0===zt&&jt(rt)),n!==i&&(Dt=e,n=it()),e=n))))))),e}function gn(){var e,n,r;return e=It,47===t.charCodeAt(It)?(n=ot,It++):(n=i,0===zt&&jt(st)),n!==i&&(r=_n())!==i?(Dt=e,e=n=at(r)):(It=e,e=a),e===i&&(e=It,t.substr(It,2)===ct?(n=ct,It+=2):(n=i,0===zt&&jt(lt)),n!==i&&(r=_n())!==i?(Dt=e,e=n=at(r)):(It=e,e=a),e===i&&(e=It,t.substr(It,2)===ut?(n=ut,It+=2):(n=i,0===zt&&jt(ht)),n!==i&&(r=_n())!==i?(Dt=e,e=n=dt(r)):(It=e,e=a),e===i&&(e=It,42===t.charCodeAt(It)?(n=pt,It++):(n=i,0===zt&&jt(ft)),n!==i&&(r=_n())!==i?(Dt=e,e=n=mt(r)):(It=e,e=a),e===i&&(e=It,t.substr(It,2)===gt?(n=gt,It+=2):(n=i,0===zt&&jt(vt)),n!==i&&(r=_n())!==i?(Dt=e,e=n=mt(r)):(It=e,e=a),e===i&&(e=It,t.substr(It,2)===yt?(n=yt,It+=2):(n=i,0===zt&&jt(bt)),n!==i&&(r=_n())!==i?(Dt=e,e=n=xt(r)):(It=e,e=a)))))),e}function vn(){var e,n,r;return e=It,45===t.charCodeAt(It)?(n=Y,It++):(n=i,0===zt&&jt(Z)),n!==i&&(r=_n())!==i?(Dt=e,e=n=xt(r)):(It=e,e=a),e===i&&(e=It,43===t.charCodeAt(It)?(n=Re,It++):(n=i,0===zt&&jt(Le)),n!==i&&(r=_n())!==i?(Dt=e,e=n=mt(r)):(It=e,e=a)),e}function yn(){var e,n,r,o,s;if(e=It,n=It,r=[],_t.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(wt)),o!==i)for(;o!==i;)r.push(o),_t.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(wt));else r=a;if(r!==i&&(r=t.substring(n,It)),(n=r)!==i){for(r=It,o=[],Mt.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Tt));s!==i;)o.push(s),Mt.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Tt));o!==i&&(o=t.substring(r,It)),(r=o)!==i&&(o=xn())!==i?(Dt=e,e=n=St(n,r,o)):(It=e,e=a)}else It=e,e=a;if(e===i){if(e=It,n=It,r=[],_t.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(wt)),o!==i)for(;o!==i;)r.push(o),_t.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(wt));else r=a;if(r!==i&&(r=t.substring(n,It)),(n=r)!==i){for(r=It,o=[],Mt.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Tt));s!==i;)o.push(s),Mt.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Tt));o!==i&&(o=t.substring(r,It)),(r=o)!==i?(Dt=e,e=n=Et(n,r)):(It=e,e=a)}else It=e,e=a}return e}function bn(){var e,n,r,o,s;if(e=It,n=It,r=[],_t.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(wt)),o!==i)for(;o!==i;)r.push(o),_t.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(wt));else r=a;if(r!==i&&(r=t.substring(n,It)),(n=r)!==i){for(r=It,o=[],Mt.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Tt));s!==i;)o.push(s),Mt.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Tt));o!==i&&(o=t.substring(r,It)),(r=o)!==i?(Dt=e,e=n=Et(n,r)):(It=e,e=a)}else It=e,e=a;return e}function xn(){var e,n,r,o;if(e=It,t.substr(It,2)===At?(n=At,It+=2):(n=i,0===zt&&jt(Rt)),n!==i){if(r=[],Me.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(Te)),o!==i)for(;o!==i;)r.push(o),Me.test(t.charAt(It))?(o=t.charAt(It),It++):(o=i,0===zt&&jt(Te));else r=a;r!==i?(Dt=e,e=n=Lt(r)):(It=e,e=a)}else It=e,e=a;return e}function _n(){var e,n,r,o,s;if(e=It,n=[],Me.test(t.charAt(It))?(r=t.charAt(It),It++):(r=i,0===zt&&jt(Te)),r!==i)for(;r!==i;)n.push(r),Me.test(t.charAt(It))?(r=t.charAt(It),It++):(r=i,0===zt&&jt(Te));else n=a;if(n!==i)if(46===t.charCodeAt(It)?(r=Ct,It++):(r=i,0===zt&&jt(Pt)),r!==i){if(o=[],Me.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Te)),s!==i)for(;s!==i;)o.push(s),Me.test(t.charAt(It))?(s=t.charAt(It),It++):(s=i,0===zt&&jt(Te));else o=a;o!==i?(Dt=e,e=n=Ot(n,o)):(It=e,e=a)}else It=e,e=a;else It=e,e=a;if(e===i){if(e=It,n=[],Me.test(t.charAt(It))?(r=t.charAt(It),It++):(r=i,0===zt&&jt(Te)),r!==i)for(;r!==i;)n.push(r),Me.test(t.charAt(It))?(r=t.charAt(It),It++):(r=i,0===zt&&jt(Te));else n=a;n!==i&&(Dt=e,n=Nt(n)),e=n}return e}function wn(e,...t){for(var n=1;n<arguments.length;n++)for(var r in arguments[n])e[r]=arguments[n][r];return e}if((n=s())!==i&&It===t.length)return n;throw n!==i&&It<t.length&&jt({type:"end",description:"end of input"}),Vt(null,Ft,Ut)}}}();function xN(e,t){e.equalSpacerIndex=e.equalSpacerIndex||1;const n="_~"+e.lineIndex+":"+e.equalSpacerIndex+"~";e.equalSpacerIndex>1&&e.constraints.push({view1:"_~"+e.lineIndex+":1~",attr1:e.horizontal?gN.WIDTH:gN.HEIGHT,relation:e.relation.relation||vN.EQU,view2:n,attr2:e.horizontal?gN.WIDTH:gN.HEIGHT,priority:e.relation.priority}),e.equalSpacerIndex++,e.relation.view||e.relation.multiplier&&1!==e.relation.multiplier?(e.constraints.push({view1:n,attr1:e.horizontal?gN.WIDTH:gN.HEIGHT,relation:e.relation.relation||vN.EQU,view2:e.relation.view,attr2:e.horizontal?gN.WIDTH:gN.HEIGHT,priority:e.relation.priority,multiplier:e.relation.multiplier}),e.relation.multiplier=void 0):e.relation.constant&&(e.constraints.push({view1:n,attr1:e.horizontal?gN.WIDTH:gN.HEIGHT,relation:vN.EQU,view2:null,attr2:gN.CONST,priority:e.relation.priority,constant:e.relation.constant}),e.relation.constant=void 0);for(var r=0;r<e.prevViews.length;r++){const i=e.prevViews[r];switch(e.orientation){case 1:e.prevAttr=i!==t?gN.RIGHT:gN.LEFT,e.curAttr=gN.LEFT;break;case 2:e.prevAttr=i!==t?gN.BOTTOM:gN.TOP,e.curAttr=gN.TOP;break;case 4:e.prevAttr=gN.ZINDEX,e.curAttr=gN.ZINDEX,e.relation.constant=i!==t?"default":0}e.constraints.push({view1:i,attr1:e.prevAttr,relation:e.relation.relation,view2:n,attr2:e.curAttr,priority:e.relation.priority})}e.prevViews=[n]}function _N(e,t){e.proportionalSpacerIndex=e.proportionalSpacerIndex||1;const n="_-"+e.lineIndex+":"+e.proportionalSpacerIndex+"-";e.proportionalSpacerIndex++,e.constraints.push({view1:n,attr1:e.horizontal?gN.WIDTH:gN.HEIGHT,relation:e.relation.relation||vN.EQU,view2:e.relation.view,attr2:e.horizontal?gN.WIDTH:gN.HEIGHT,priority:e.relation.priority,multiplier:e.relation.multiplier}),e.relation.multiplier=void 0;for(var r=0;r<e.prevViews.length;r++){const i=e.prevViews[r];switch(e.orientation){case 1:e.prevAttr=i!==t?gN.RIGHT:gN.LEFT,e.curAttr=gN.LEFT;break;case 2:e.prevAttr=i!==t?gN.BOTTOM:gN.TOP,e.curAttr=gN.TOP;break;case 4:e.prevAttr=gN.ZINDEX,e.curAttr=gN.ZINDEX,e.relation.constant=i!==t?"default":0}e.constraints.push({view1:i,attr1:e.prevAttr,relation:e.relation.relation,view2:n,attr2:e.curAttr,priority:e.relation.priority})}e.prevViews=[n]}function wN(e,t,n){let r;for(var i=1;i<=4;i*=2)if(n.orientations&i&&n.stack.orientation!==i&&!(n.stack.processedOrientations&i)){n.stack.processedOrientations=n.stack.processedOrientations|i,r=r||{name:t,type:"stack"};for(var o=0,s=n.stack.subViews.length;o<s;o++)4===i?e.constraints.push({view1:r,attr1:gN.ZINDEX,relation:vN.EQU,view2:n.stack.subViews[o],attr2:gN.ZINDEX}):(e.constraints.push({view1:r,attr1:2===i?gN.HEIGHT:gN.WIDTH,relation:vN.EQU,view2:n.stack.subViews[o],attr2:2===i?gN.HEIGHT:gN.WIDTH}),e.constraints.push({view1:r,attr1:2===i?gN.TOP:gN.LEFT,relation:vN.EQU,view2:n.stack.subViews[o],attr2:2===i?gN.TOP:gN.LEFT}))}}function MN(e,t){if(!0===t&&(t=e.match(/\.\.\d+$/))&&(e=e.substring(0,e.length-t[0].length),t=parseInt(t[0].substring(2))),!t)return[e];var n,r=e.match(/\d+$/),i=[];if(r)for(e=e.substring(0,e.length-r[0].length),n=parseInt(r);n<=t;n++)i.push(e+n);else for(i.push(e),n=2;n<=t;n++)i.push(e+n);return i}function TN(e,t,n){const r=n?n.view:null,i=[];let o,s=[];r&&(t.push({view:r}),s.push(r));for(var a=0;a<t.length;a++){let n=t[a];if(!Array.isArray(n)&&n.hasOwnProperty("view")||Array.isArray(n)&&n[0].view&&!n[0].relation){const t=Array.isArray(n)?n:[n];for(var c=0;c<t.length;c++){n=t[c];const a=","===n?[]:n.view?MN(n.view,n.range):[null];for(var l=0;l<a.length;l++){const t=a[l];if(s.push(t),t!==r&&(i.push(t),o=e.subViews[t],o||(o={orientations:0},e.subViews[t]=o),o.orientations=o.orientations|e.orientation,o.stack&&wN(e,t,o)),void 0!==e.prevViews&&void 0!==t&&e.relation&&"none"!==e.relation.relation)for(var u=0;u<e.prevViews.length;u++){const n=e.prevViews[u];switch(e.orientation){case 1:e.prevAttr=n!==r?gN.RIGHT:gN.LEFT,e.curAttr=t!==r?gN.LEFT:gN.RIGHT;break;case 2:e.prevAttr=n!==r?gN.BOTTOM:gN.TOP,e.curAttr=t!==r?gN.TOP:gN.BOTTOM;break;case 4:e.prevAttr=gN.ZINDEX,e.curAttr=gN.ZINDEX,e.relation.constant=n?e.relation.constant||"default":0}e.constraints.push({view1:n,attr1:e.prevAttr,relation:e.relation.relation,view2:t,attr2:e.curAttr,multiplier:e.relation.multiplier,constant:"default"!==e.relation.constant&&e.relation.constant?-e.relation.constant:e.relation.constant,priority:e.relation.priority})}const c=n.constraints;if(c)for(var h=0;h<c.length;h++)e.prevAttr=e.horizontal?gN.WIDTH:gN.HEIGHT,e.curAttr=c[h].view||c[h].multiplier?c[h].attribute||e.prevAttr:c[h].variable?gN.VARIABLE:gN.CONST,e.constraints.push({view1:t,attr1:e.prevAttr,relation:c[h].relation,view2:c[h].view,attr2:e.curAttr,multiplier:c[h].multiplier,constant:c[h].constant,priority:c[h].priority});n.cascade&&TN(e,n.cascade,n)}}}else","!==n&&(e.prevViews=s,s=[],e.relation=n[0],void 0!==e.prevViews&&(e.relation.equalSpacing&&xN(e,r),e.relation.multiplier&&_N(e,r)))}if(r){if(o=e.subViews[r],o){if(o.stack){const e=new Error('A stack named "'+r+'" has already been created');throw e.column=n.$parserOffset+1,e}}else o={orientations:e.orientation},e.subViews[r]=o;o.stack={orientation:e.orientation,processedOrientations:e.orientation,subViews:i},wN(e,r,o)}}const SN=["viewport","spacing","colors","shapes","widths","heights"];function EN(){return new AN}var AN=function(){function e(){this.index={},this.array=[]}return e.prototype.size=function(){return this.array.length},e.prototype.empty=function(){return 0===this.array.length},e.prototype.itemAt=function(e){return this.array[e]},e.prototype.contains=function(e){return void 0!==this.index[e.id()]},e.prototype.find=function(e){var t=this.index[e.id()];return void 0===t?void 0:this.array[t]},e.prototype.setDefault=function(e,t){var n=this.index[e.id()];if(void 0===n){var r=new RN(e,t());return this.index[e.id()]=this.array.length,this.array.push(r),r}return this.array[n]},e.prototype.insert=function(e,t){var n=new RN(e,t),r=this.index[e.id()];return void 0===r?(this.index[e.id()]=this.array.length,this.array.push(n)):this.array[r]=n,n},e.prototype.erase=function(e){var t=this.index[e.id()];if(void 0!==t){this.index[e.id()]=void 0;var n=this.array[t],r=this.array.pop();return n!==r&&(this.array[t]=r,this.index[r.first.id()]=t),n}},e.prototype.copy=function(){for(var t=new e,n=0;n<this.array.length;n++){var r=this.array[n].copy();t.array[n]=r,t.index[r.first.id()]=n}return t},e}(),RN=function(){function e(e,t){this.first=e,this.second=t}return e.prototype.copy=function(){return new e(this.first,this.second)},e}(),LN=function(){function e(e){void 0===e&&(e=""),this._value=0,this._context=null,this._id=CN++,this._name=e}return e.prototype.id=function(){return this._id},e.prototype.name=function(){return this._name},e.prototype.setName=function(e){this._name=e},e.prototype.context=function(){return this._context},e.prototype.setContext=function(e){this._context=e},e.prototype.value=function(){return this._value},e.prototype.setValue=function(e){this._value=e},e.prototype.plus=function(e){return new PN(this,e)},e.prototype.minus=function(e){return new PN(this,"number"==typeof e?-e:[-1,e])},e.prototype.multiply=function(e){return new PN([e,this])},e.prototype.divide=function(e){return new PN([1/e,this])},e.prototype.toJSON=function(){return{name:this._name,value:this._value}},e.prototype.toString=function(){return this._context+"["+this._name+":"+this._value+"]"},e}(),CN=0,PN=function(){function e(){var e=ON(arguments);this._terms=e.terms,this._constant=e.constant}return e.prototype.terms=function(){return this._terms},e.prototype.constant=function(){return this._constant},e.prototype.value=function(){for(var e=this._constant,t=0,n=this._terms.size();t<n;t++){var r=this._terms.itemAt(t);e+=r.first.value()*r.second}return e},e.prototype.plus=function(t){return new e(this,t)},e.prototype.minus=function(t){return new e(this,"number"==typeof t?-t:[-1,t])},e.prototype.multiply=function(t){return new e([t,this])},e.prototype.divide=function(t){return new e([1/t,this])},e.prototype.isConstant=function(){return 0==this._terms.size()},e.prototype.toString=function(){var e=this._terms.array.map((function(e){return e.second+"*"+e.first.toString()})).join(" + ");return this.isConstant()||0===this._constant||(e+=" + "),e+this._constant},e}();function ON(e){for(var t=0,n=function(){return 0},r=EN(),i=0,o=e.length;i<o;++i){var s=e[i];if("number"==typeof s)t+=s;else if(s instanceof LN)r.setDefault(s,n).second+=1;else if(s instanceof PN){t+=s.constant();for(var a=0,c=(d=s.terms()).size();a<c;a++){var l=d.itemAt(a);r.setDefault(l.first,n).second+=l.second}}else{if(!(s instanceof Array))throw new Error("invalid Expression argument: "+s);if(2!==s.length)throw new Error("array must have length 2");var u=s[0],h=s[1];if("number"!=typeof u)throw new Error("array item 0 must be a number");if(h instanceof LN)r.setDefault(h,n).second+=u;else{if(!(h instanceof PN))throw new Error("array item 1 must be a variable or expression");var d;for(t+=h.constant()*u,a=0,c=(d=h.terms()).size();a<c;a++)l=d.itemAt(a),r.setDefault(l.first,n).second+=l.second*u}}}return{terms:r,constant:t}}var NN,IN=function(){function e(){}return e.create=function(e,t,n,r){void 0===r&&(r=1);var i=0;return i+=1e6*Math.max(0,Math.min(1e3,e*r)),(i+=1e3*Math.max(0,Math.min(1e3,t*r)))+Math.max(0,Math.min(1e3,n*r))},e.clip=function(t){return Math.max(0,Math.min(e.required,t))},e.required=e.create(1e3,1e3,1e3),e.strong=e.create(1,0,0),e.medium=e.create(0,1,0),e.weak=e.create(0,0,1),e}();!function(e){e[e.Le=0]="Le",e[e.Ge=1]="Ge",e[e.Eq=2]="Eq"}(NN||(NN={}));var DN,kN=function(){function e(e,t,n,r){void 0===r&&(r=IN.required),this._id=BN++,this._operator=t,this._strength=IN.clip(r),this._expression=void 0===n&&e instanceof PN?e:e.minus(n)}return e.prototype.id=function(){return this._id},e.prototype.expression=function(){return this._expression},e.prototype.op=function(){return this._operator},e.prototype.strength=function(){return this._strength},e.prototype.toString=function(){return this._expression.toString()+" "+["<=",">=","="][this._operator]+" 0 ("+this._strength.toString()+")"},e}(),BN=0,UN=function(){function e(){this._cnMap=EN(),this._rowMap=EN(),this._varMap=EN(),this._editMap=EN(),this._infeasibleRows=[],this._objective=new GN,this._artificial=null,this._idTick=0}return e.prototype.createConstraint=function(e,t,n,r){void 0===r&&(r=IN.required);var i=new kN(e,t,n,r);return this.addConstraint(i),i},e.prototype.addConstraint=function(e){if(void 0!==this._cnMap.find(e))throw new Error("duplicate constraint");var t=this._createRow(e),n=t.row,r=t.tag,i=this._chooseSubject(n,r);if(i.type()===DN.Invalid&&n.allDummies()){if(!FN(n.constant()))throw new Error("unsatisfiable constraint");i=r.marker}if(i.type()===DN.Invalid){if(!this._addWithArtificialVariable(n))throw new Error("unsatisfiable constraint")}else n.solveFor(i),this._substitute(i,n),this._rowMap.insert(i,n);this._cnMap.insert(e,r),this._optimize(this._objective)},e.prototype.removeConstraint=function(e){var t=this._cnMap.erase(e);if(void 0===t)throw new Error("unknown constraint");this._removeConstraintEffects(e,t.second);var n=t.second.marker,r=this._rowMap.erase(n);if(void 0===r){var i=this._getMarkerLeavingSymbol(n);if(i.type()===DN.Invalid)throw new Error("failed to find leaving row");(r=this._rowMap.erase(i)).second.solveForEx(i,n),this._substitute(n,r.second)}this._optimize(this._objective)},e.prototype.hasConstraint=function(e){return this._cnMap.contains(e)},e.prototype.addEditVariable=function(e,t){if(void 0!==this._editMap.find(e))throw new Error("duplicate edit variable");if((t=IN.clip(t))===IN.required)throw new Error("bad required strength");var n=new PN(e),r=new kN(n,NN.Eq,void 0,t);this.addConstraint(r);var i={tag:this._cnMap.find(r).second,constraint:r,constant:0};this._editMap.insert(e,i)},e.prototype.removeEditVariable=function(e){var t=this._editMap.erase(e);if(void 0===t)throw new Error("unknown edit variable");this.removeConstraint(t.second.constraint)},e.prototype.hasEditVariable=function(e){return this._editMap.contains(e)},e.prototype.suggestValue=function(e,t){var n=this._editMap.find(e);if(void 0===n)throw new Error("unknown edit variable");var r=this._rowMap,i=n.second,o=t-i.constant;i.constant=t;var s=i.tag.marker,a=r.find(s);if(void 0!==a)return a.second.add(-o)<0&&this._infeasibleRows.push(s),void this._dualOptimize();var c=i.tag.other;if(void 0!==(a=r.find(c)))return a.second.add(o)<0&&this._infeasibleRows.push(c),void this._dualOptimize();for(var l=0,u=r.size();l<u;++l){var h=r.itemAt(l),d=h.second,p=d.coefficientFor(s);0!==p&&d.add(o*p)<0&&h.first.type()!==DN.External&&this._infeasibleRows.push(h.first)}this._dualOptimize()},e.prototype.updateVariables=function(){for(var e=this._varMap,t=this._rowMap,n=0,r=e.size();n<r;++n){var i=e.itemAt(n),o=t.find(i.second);void 0!==o?i.first.setValue(o.second.constant()):i.first.setValue(0)}},e.prototype._getVarSymbol=function(e){var t=this;return this._varMap.setDefault(e,(function(){return t._makeSymbol(DN.External)})).second},e.prototype._createRow=function(e){for(var t=e.expression(),n=new GN(t.constant()),r=t.terms(),i=0,o=r.size();i<o;++i){var s=r.itemAt(i);if(!FN(s.second)){var a=this._getVarSymbol(s.first),c=this._rowMap.find(a);void 0!==c?n.insertRow(c.second,s.second):n.insertSymbol(a,s.second)}}var l=this._objective,u=e.strength(),h={marker:HN,other:HN};switch(e.op()){case NN.Le:case NN.Ge:var d=e.op()===NN.Le?1:-1,p=this._makeSymbol(DN.Slack);if(h.marker=p,n.insertSymbol(p,d),u<IN.required){var f=this._makeSymbol(DN.Error);h.other=f,n.insertSymbol(f,-d),l.insertSymbol(f,u)}break;case NN.Eq:if(u<IN.required){var m=this._makeSymbol(DN.Error),g=this._makeSymbol(DN.Error);h.marker=m,h.other=g,n.insertSymbol(m,-1),n.insertSymbol(g,1),l.insertSymbol(m,u),l.insertSymbol(g,u)}else{var v=this._makeSymbol(DN.Dummy);h.marker=v,n.insertSymbol(v)}}return n.constant()<0&&n.reverseSign(),{row:n,tag:h}},e.prototype._chooseSubject=function(e,t){for(var n=e.cells(),r=0,i=n.size();r<i;++r){var o=n.itemAt(r);if(o.first.type()===DN.External)return o.first}var s=t.marker.type();return(s===DN.Slack||s===DN.Error)&&e.coefficientFor(t.marker)<0?t.marker:((s=t.other.type())===DN.Slack||s===DN.Error)&&e.coefficientFor(t.other)<0?t.other:HN},e.prototype._addWithArtificialVariable=function(e){var t=this._makeSymbol(DN.Slack);this._rowMap.insert(t,e.copy()),this._artificial=e.copy(),this._optimize(this._artificial);var n=FN(this._artificial.constant());this._artificial=null;var r=this._rowMap.erase(t);if(void 0!==r){var i=r.second;if(i.isConstant())return n;var o=this._anyPivotableSymbol(i);if(o.type()===DN.Invalid)return!1;i.solveForEx(t,o),this._substitute(o,i),this._rowMap.insert(o,i)}for(var s=this._rowMap,a=0,c=s.size();a<c;++a)s.itemAt(a).second.removeSymbol(t);return this._objective.removeSymbol(t),n},e.prototype._substitute=function(e,t){for(var n=this._rowMap,r=0,i=n.size();r<i;++r){var o=n.itemAt(r);o.second.substitute(e,t),o.second.constant()<0&&o.first.type()!==DN.External&&this._infeasibleRows.push(o.first)}this._objective.substitute(e,t),this._artificial&&this._artificial.substitute(e,t)},e.prototype._optimize=function(e){for(;;){var t=this._getEnteringSymbol(e);if(t.type()===DN.Invalid)return;var n=this._getLeavingSymbol(t);if(n.type()===DN.Invalid)throw new Error("the objective is unbounded");var r=this._rowMap.erase(n).second;r.solveForEx(n,t),this._substitute(t,r),this._rowMap.insert(t,r)}},e.prototype._dualOptimize=function(){for(var e=this._rowMap,t=this._infeasibleRows;0!==t.length;){var n=t.pop(),r=e.find(n);if(void 0!==r&&r.second.constant()<0){var i=this._getDualEnteringSymbol(r.second);if(i.type()===DN.Invalid)throw new Error("dual optimize failed");var o=r.second;e.erase(n),o.solveForEx(n,i),this._substitute(i,o),e.insert(i,o)}}},e.prototype._getEnteringSymbol=function(e){for(var t=e.cells(),n=0,r=t.size();n<r;++n){var i=t.itemAt(n),o=i.first;if(i.second<0&&o.type()!==DN.Dummy)return o}return HN},e.prototype._getDualEnteringSymbol=function(e){for(var t=Number.MAX_VALUE,n=HN,r=e.cells(),i=0,o=r.size();i<o;++i){var s=r.itemAt(i),a=s.first,c=s.second;if(c>0&&a.type()!==DN.Dummy){var l=this._objective.coefficientFor(a)/c;l<t&&(t=l,n=a)}}return n},e.prototype._getLeavingSymbol=function(e){for(var t=Number.MAX_VALUE,n=HN,r=this._rowMap,i=0,o=r.size();i<o;++i){var s=r.itemAt(i),a=s.first;if(a.type()!==DN.External){var c=s.second,l=c.coefficientFor(e);if(l<0){var u=-c.constant()/l;u<t&&(t=u,n=a)}}}return n},e.prototype._getMarkerLeavingSymbol=function(e){for(var t=Number.MAX_VALUE,n=t,r=t,i=HN,o=i,s=i,a=i,c=this._rowMap,l=0,u=c.size();l<u;++l){var h=c.itemAt(l),d=h.second,p=d.coefficientFor(e);if(0!==p){var f=h.first;if(f.type()===DN.External)a=f;else if(p<0)(m=-d.constant()/p)<n&&(n=m,o=f);else{var m;(m=d.constant()/p)<r&&(r=m,s=f)}}}return o!==i?o:s!==i?s:a},e.prototype._removeConstraintEffects=function(e,t){t.marker.type()===DN.Error&&this._removeMarkerEffects(t.marker,e.strength()),t.other.type()===DN.Error&&this._removeMarkerEffects(t.other,e.strength())},e.prototype._removeMarkerEffects=function(e,t){var n=this._rowMap.find(e);void 0!==n?this._objective.insertRow(n.second,-t):this._objective.insertSymbol(e,-t)},e.prototype._anyPivotableSymbol=function(e){for(var t=e.cells(),n=0,r=t.size();n<r;++n){var i=t.itemAt(n),o=i.first.type();if(o===DN.Slack||o===DN.Error)return i.first}return HN},e.prototype._makeSymbol=function(e){return new zN(e,this._idTick++)},e}();function FN(e){return e<0?-e<1e-8:e<1e-8}!function(e){e[e.Invalid=0]="Invalid",e[e.External=1]="External",e[e.Slack=2]="Slack",e[e.Error=3]="Error",e[e.Dummy=4]="Dummy"}(DN||(DN={}));var zN=function(){function e(e,t){this._id=t,this._type=e}return e.prototype.id=function(){return this._id},e.prototype.type=function(){return this._type},e}(),HN=new zN(DN.Invalid,-1),GN=function(){function e(e){void 0===e&&(e=0),this._cellMap=EN(),this._constant=e}return e.prototype.cells=function(){return this._cellMap},e.prototype.constant=function(){return this._constant},e.prototype.isConstant=function(){return this._cellMap.empty()},e.prototype.allDummies=function(){for(var e=this._cellMap,t=0,n=e.size();t<n;++t)if(e.itemAt(t).first.type()!==DN.Dummy)return!1;return!0},e.prototype.copy=function(){var t=new e(this._constant);return t._cellMap=this._cellMap.copy(),t},e.prototype.add=function(e){return this._constant+=e},e.prototype.insertSymbol=function(e,t){void 0===t&&(t=1),FN(this._cellMap.setDefault(e,(function(){return 0})).second+=t)&&this._cellMap.erase(e)},e.prototype.insertRow=function(e,t){void 0===t&&(t=1),this._constant+=e._constant*t;for(var n=e._cellMap,r=0,i=n.size();r<i;++r){var o=n.itemAt(r);this.insertSymbol(o.first,o.second*t)}},e.prototype.removeSymbol=function(e){this._cellMap.erase(e)},e.prototype.reverseSign=function(){this._constant=-this._constant;for(var e=this._cellMap,t=0,n=e.size();t<n;++t){var r=e.itemAt(t);r.second=-r.second}},e.prototype.solveFor=function(e){var t=this._cellMap,n=-1/t.erase(e).second;this._constant*=n;for(var r=0,i=t.size();r<i;++r)t.itemAt(r).second*=n},e.prototype.solveForEx=function(e,t){this.insertSymbol(e,-1),this.solveFor(t)},e.prototype.coefficientFor=function(e){var t=this._cellMap.find(e);return void 0!==t?t.second:0},e.prototype.substitute=function(e,t){var n=this._cellMap.erase(e);void 0!==n&&this.insertRow(t,n.second)},e}();const jN=class{constructor(e){this._name=e.name,this._type=e.type,this._solver=e.solver,this._attr={},e.name||(this._attr[gN.LEFT]=new LN,this._solver.addConstraint(new kN(this._attr[gN.LEFT],NN.Eq,0)),this._attr[gN.TOP]=new LN,this._solver.addConstraint(new kN(this._attr[gN.TOP],NN.Eq,0)),this._attr[gN.ZINDEX]=new LN,this._solver.addConstraint(new kN(this._attr[gN.ZINDEX],NN.Eq,0)))}toJSON(){return{name:this.name,left:this.left,top:this.top,width:this.width,height:this.height}}toString(){JSON.stringify(this.toJSON(),void 0,2)}get name(){return this._name}get left(){return this._getAttrValue(gN.LEFT)}get right(){return this._getAttrValue(gN.RIGHT)}get width(){return this._getAttrValue(gN.WIDTH)}get height(){return this._getAttrValue(gN.HEIGHT)}get intrinsicWidth(){return this._intrinsicWidth}set intrinsicWidth(e){if(void 0!==e&&e!==this._intrinsicWidth){const t=this._getAttr(gN.WIDTH);void 0===this._intrinsicWidth&&this._solver.addEditVariable(t,IN.create(this._name?998:999,1e3,1e3)),this._intrinsicWidth=e,this._solver.suggestValue(t,e),this._solver.updateVariables()}}get intrinsicHeight(){return this._intrinsicHeight}set intrinsicHeight(e){if(void 0!==e&&e!==this._intrinsicHeight){const t=this._getAttr(gN.HEIGHT);void 0===this._intrinsicHeight&&this._solver.addEditVariable(t,IN.create(this._name?998:999,1e3,1e3)),this._intrinsicHeight=e,this._solver.suggestValue(t,e),this._solver.updateVariables()}}get top(){return this._getAttrValue(gN.TOP)}get bottom(){return this._getAttrValue(gN.BOTTOM)}get centerX(){return this._getAttrValue(gN.CENTERX)}get centerY(){return this._getAttrValue(gN.CENTERY)}get zIndex(){return this._getAttrValue(gN.ZINDEX)}get type(){return this._type}getValue(e){return this._attr[e]?this._attr[e].value():void 0}_getAttr(e){if(this._attr[e])return this._attr[e];switch(this._attr[e]=new LN,e){case gN.RIGHT:this._getAttr(gN.LEFT),this._getAttr(gN.WIDTH),this._solver.addConstraint(new kN(this._attr[e],NN.Eq,this._attr[gN.LEFT].plus(this._attr[gN.WIDTH])));break;case gN.BOTTOM:this._getAttr(gN.TOP),this._getAttr(gN.HEIGHT),this._solver.addConstraint(new kN(this._attr[e],NN.Eq,this._attr[gN.TOP].plus(this._attr[gN.HEIGHT])));break;case gN.CENTERX:this._getAttr(gN.LEFT),this._getAttr(gN.WIDTH),this._solver.addConstraint(new kN(this._attr[e],NN.Eq,this._attr[gN.LEFT].plus(this._attr[gN.WIDTH].divide(2))));break;case gN.CENTERY:this._getAttr(gN.TOP),this._getAttr(gN.HEIGHT),this._solver.addConstraint(new kN(this._attr[e],NN.Eq,this._attr[gN.TOP].plus(this._attr[gN.HEIGHT].divide(2))))}return this._solver.updateVariables(),this._attr[e]}_getAttrValue(e){return this._getAttr(e).value()}},VN=IN.create(0,1e3,1e3),WN={Attribute:gN,Relation:vN,Priority:{REQUIRED:1e3,DEFAULTHIGH:750,DEFAULTLOW:250},VisualFormat:class{static parseLine(e,t){if(0===e.length||t&&t.extended&&0===e.indexOf("//"))return[];const n=t&&t.extended?bN.parse(e):yN.parse(e);if(t&&"raw"===t.outFormat)return[n];let r={constraints:[],lineIndex:(t?t.lineIndex:void 0)||1,subViews:(t?t.subViews:void 0)||{}};if("attribute"===n.type)for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e];for(let e=0;e<t.predicates.length;e++){const i=t.predicates[e];r.constraints.push({view1:n.view,attr1:t.attr,relation:i.relation,view2:i.view,attr2:i.attribute||t.attr,multiplier:i.multiplier,constant:i.constant,priority:i.priority})}}else switch(n.orientation){case"horizontal":r.orientation=1,r.horizontal=!0,TN(r,n.cascade,null);break;case"vertical":r.orientation=2,TN(r,n.cascade,null);break;case"horzvert":r.orientation=1,r.horizontal=!0,TN(r,n.cascade,null),r={constraints:r.constraints,lineIndex:r.lineIndex,subViews:r.subViews,orientation:2},TN(r,n.cascade,null);break;case"zIndex":r.orientation=4,TN(r,n.cascade,null)}return r.constraints}static parse(e,t){const n=t&&t.lineSeparator?t.lineSeparator:"\n";if(!Array.isArray(e)&&e.indexOf(n)<0)try{return this.parseLine(e,t)}catch(t){throw t.source=e,t}let r;e=Array.isArray(e)?e:[e];let i,o=[],s=0;const a={lineIndex:s,extended:t&&t.extended,strict:!t||void 0===t.strict||t.strict,outFormat:t?t.outFormat:void 0,subViews:{}};try{for(var c=0;c<e.length;c++){r=e[c].split(n);for(var l=0;l<r.length;l++)i=r[l],s++,a.lineIndex=s,a.strict||(i=i.trim()),(a.strict||i.length)&&(o=o.concat(this.parseLine(i,a)))}}catch(e){throw e.source=i,e.line=s,e}return o}static parseMetaInfo(e,t){const n=t&&t.lineSeparator?t.lineSeparator:"\n",r=t?t.prefix:void 0;e=Array.isArray(e)?e:[e];const i={};for(var o,s=0;s<e.length;s++){const t=e[s].split(n);for(var a=0;a<t.length;a++){const e=t[a];for(var c=0;c<SN.length;c++)for(var l=0;l<(r?2:1);l++){const t=SN[c],n=(0===l?"":r)+t;if(0===e.indexOf("//"+n+" ")){const r=e.substring(3+n.length).split(" ");for(var u=0;u<r.length;u++){i[t]=i[t]||{};const e=r[u].split(":"),n=MN(e[0],!0);for(var h=0;h<n.length;h++)i[t][n[h]]=e.length>1?e[1]:""}}else 0===e.indexOf("//"+n+":")&&(i[t]=e.substring(3+n.length))}}}if(i.viewport){const e=i.viewport;var d=e["aspect-ratio"];d&&(d=d.split("/"),e["aspect-ratio"]=parseInt(d[0])/parseInt(d[1])),void 0!==e.height&&(e.height="intrinsic"===e.height||parseInt(e.height)),void 0!==e.width&&(e.width="intrinsic"===e.width||parseInt(e.width)),void 0!==e["max-height"]&&(e["max-height"]=parseInt(e["max-height"])),void 0!==e["max-width"]&&(e["max-width"]=parseInt(e["max-width"])),void 0!==e["min-height"]&&(e["min-height"]=parseInt(e["min-height"])),void 0!==e["min-width"]&&(e["min-width"]=parseInt(e["min-width"]))}if(i.widths)for(o in i.widths){const e="intrinsic"===i.widths[o]||parseInt(i.widths[o]);i.widths[o]=e,(void 0===e||isNaN(e))&&delete i.widths[o]}if(i.heights)for(o in i.heights){const e="intrinsic"===i.heights[o]||parseInt(i.heights[o]);i.heights[o]=e,(void 0===e||isNaN(e))&&delete i.heights[o]}if(i.spacing){const e=JSON.parse(i.spacing);if(i.spacing=e,Array.isArray(e)){for(var p=0,f=e.length;p<f;p++)if(isNaN(e[p])){delete i.spacing;break}}else(void 0===e||isNaN(e))&&delete i.spacing}return i}},View:class{constructor(e){this._solver=new UN,this._subViews={},this._parentSubView=new jN({solver:this._solver}),this.setSpacing(e&&void 0!==e.spacing?e.spacing:8),e&&(void 0===e.width&&void 0===e.height||this.setSize(e.width,e.height),e.constraints&&this.addConstraints(e.constraints))}setSize(e,t){return this._parentSubView.intrinsicWidth=e,this._parentSubView.intrinsicHeight=t,this}get width(){return this._parentSubView.intrinsicWidth}get height(){return this._parentSubView.intrinsicHeight}get fittingWidth(){return this._parentSubView.width}get fittingHeight(){return this._parentSubView.height}setSpacing(e){if(Array.isArray(e))switch(e.length){case 1:e=[e[0],e[0],e[0],e[0],e[0],e[0],1];break;case 2:e=[e[1],e[0],e[1],e[0],e[0],e[1],1];break;case 3:e=[e[1],e[0],e[1],e[0],e[0],e[1],e[2]];break;case 6:e=[e[0],e[1],e[2],e[3],e[4],e[5],1];break;case 7:break;default:throw"Invalid spacing syntax"}else e=[e,e,e,e,e,e,1];if(!this._compareSpacing(this._spacing,e)&&(this._spacing=e,this._spacingVars)){for(var t=0;t<this._spacingVars.length;t++)this._spacingVars[t]&&this._solver.suggestValue(this._spacingVars[t],this._spacing[t]);this._solver.updateVariables()}return this}_compareSpacing(e,t){if(e===t)return!0;if(!e||!t)return!1;for(var n=0;n<7;n++)if(e[n]!==t[n])return!1;return!0}addConstraint(e){return this._addConstraint(e),this._solver.updateVariables(),this}addConstraints(e){for(var t=0;t<e.length;t++)this._addConstraint(e[t]);return this._solver.updateVariables(),this}_addConstraint(e){let t;const n=void 0!==e.multiplier?e.multiplier:1;let r=void 0!==e.constant?e.constant:0;"default"===r&&(r=this._getSpacing(e));const i=this._getSubView(e.view1)._getAttr(e.attr1);let o;e.attr2===gN.CONST?o=this._getConst(void 0,e.constant):(o=this._getSubView(e.view2)._getAttr(e.attr2),1!==n&&r?o=o.multiply(n).plus(r):r?o=o.plus(r):1!==n&&(o=o.multiply(n)));const s=void 0!==e.priority&&e.priority<1e3?IN.create(0,e.priority,1e3):VN;switch(e.relation){case vN.EQU:t=new kN(i,NN.Eq,o,s);break;case vN.GEQ:t=new kN(i,NN.Ge,o,s);break;case vN.LEQ:t=new kN(i,NN.Le,o,s);break;default:throw"Invalid relation specified: "+e.relation}this._solver.addConstraint(t)}_getSpacing(e){let t=4;if(e.view1||"left"!==e.attr1)if(e.view1||"top"!==e.attr1)if(e.view2||"right"!==e.attr2)if(e.view2||"bottom"!==e.attr2)switch(e.attr1){case"left":case"right":case"centerX":case"leading":case"trailing":t=4;break;case"zIndex":t=6;break;default:t=5}else t=2;else t=1;else t=0;else t=3;return this._spacingVars=this._spacingVars||new Array(7),this._spacingExpr=this._spacingExpr||new Array(7),this._spacingVars[t]||(this._spacingVars[t]=new LN,this._solver.addEditVariable(this._spacingVars[t],IN.create(999,1e3,1e3)),this._spacingExpr[t]=this._spacingVars[t].multiply(-1),this._solver.suggestValue(this._spacingVars[t],this._spacing[t])),this._spacingExpr[t]}_getSubView(e){return e?e.name?(this._subViews[e.name]=this._subViews[e.name]||new jN({name:e.name,solver:this._solver}),this._subViews[e.name]._type=this._subViews[e.name]._type||e.type,this._subViews[e.name]):(this._subViews[e]=this._subViews[e]||new jN({name:e,solver:this._solver}),this._subViews[e]):this._parentSubView}_getConst(e,t){const n=new LN;return this._solver.addConstraint(new kN(n,NN.Eq,t)),n}get subViews(){return this._subViews}},SubView:jN};var qN,XN,YN,ZN,JN,$N,KN,QN,eI,tI,nI,rI,iI,oI,sI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},aI=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cI=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},lI=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};let uI=oI=class extends Vh{constructor(e){super(),qN.add(this),this.visualFormat="",XN.set(this,void 0),YN.set(this,{}),ZN.set(this,{}),JN.set(this,!1),$N.set(this,void 0),tI.set(this,(()=>{if(cI(this,XN,"f")){var e,t,n=this.size.toArray();(cI(this,YN,"f").spacing||cI(this,$N,"f").spacing)&&cI(this,XN,"f").setSpacing(cI(this,YN,"f").spacing||cI(this,$N,"f").spacing);var r=cI(this,YN,"f").widths||cI(this,$N,"f").widths;r&&cI(this,qN,"m",KN).call(this,r);var i=cI(this,YN,"f").heights||cI(this,$N,"f").heights;if(i&&cI(this,qN,"m",QN).call(this,i),cI(this,YN,"f").viewport||cI(this,$N,"f").viewport){var o=cI(this,qN,"m",eI).call(this,n,cI(this,YN,"f").viewport||cI(this,$N,"f").viewport);e=(n[0]-o[0])/2,t=(n[1]-o[1])/2}else cI(this,XN,"f").setSize(n[0],n[1]),e=0,t=0;for(var s in cI(this,XN,"f").subViews){var a=cI(this,XN,"f").subViews[s];if(0!==s.indexOf("_")&&"stack"!==a.type){var c=cI(this,ZN,"f")[s];c&&cI(this,qN,"m",nI).call(this,c,a,e,t,r,i)}}cI(this,JN,"f")&&lI(this,JN,!1,"f")}})),this.on("sizechange",cI(this,tI,"f")),this.on("reflow",cI(this,tI,"f")),e&&(e.visualFormat&&this.setVisualFormat(e.visualFormat),e.layoutOptions&&this.setLayoutOptions(e.layoutOptions))}connectedCallback(){super.connectedCallback(),this._stopFns.push(Nn((()=>{this.setVisualFormat(this.visualFormat||"")})))}childConnectedCallback(e){if(!(e instanceof Vh))throw new Error("Child elements of AutoLayoutNode must be instances of LUME.Node.");super.childConnectedCallback(e),cI(this,XN,"f")&&cI(this,qN,"m",rI).call(this)}childDisconnectedCallback(e){if(!(e instanceof Vh))throw new Error("Child elements of AutoLayoutNode must be instances of LUME.Node.");if(super.childDisconnectedCallback(e),!cI(this,XN,"f"))return;const t=cI(this,ZN,"f");for(const n in t)if(t[n]===e){delete t[n];break}cI(this,qN,"m",rI).call(this)}reflowLayout(){return cI(this,JN,"f")||(lI(this,JN,!0,"f"),_s.once((()=>this.emit("reflow")))),this}setVisualFormat(e,t){this._visualFormat=e;var n=WN.VisualFormat.parse(e,t||oI.DEFAULT_PARSE_OPTIONS);return lI(this,$N,WN.VisualFormat.parseMetaInfo(e),"f"),lI(this,XN,new WN.View({constraints:n}),"f"),cI(this,qN,"m",rI).call(this),this.reflowLayout(),this}setLayoutOptions(e){return lI(this,YN,e||{},"f"),this.reflowLayout(),this}addToLayout(e,t){return this.append(e),t&&(cI(this,ZN,"f")[t]=e),this.reflowLayout(),e}removeFromLayout(e,t){if(e&&t)this.removeChild(e),delete cI(this,ZN,"f")[t];else if(e){for(t in cI(this,ZN,"f"))if(cI(this,ZN,"f")[t]===e){delete cI(this,ZN,"f")[t];break}this.removeChild(e)}else t&&(this.removeChild(cI(this,ZN,"f")[t]),delete cI(this,ZN,"f")[t]);this.reflowLayout()}};XN=new WeakMap,YN=new WeakMap,ZN=new WeakMap,JN=new WeakMap,$N=new WeakMap,tI=new WeakMap,qN=new WeakSet,KN=function(e){for(var t in e){var n=cI(this,XN,"f").subViews[t],r=cI(this,ZN,"f")[t];n&&r&&(n.intrinsicWidth=r.calculatedSize.x)}},QN=function(e){for(var t in e){var n=cI(this,XN,"f").subViews[t],r=cI(this,ZN,"f")[t];n&&r&&(n.intrinsicHeight=r.calculatedSize.y)}},eI=function(e,t){return e=[void 0!==t.width&&!0!==t.width?t.width:Math.max(Math.min(e[0],t["max-width"]||e[0]),t["min-width"]||0),void 0!==t.height&&!0!==t.height?t.height:Math.max(Math.min(e[1],t["max-height"]||e[1]),t["min-height"]||0)],!0===t.width&&!0===t.height?(e[0]=cI(this,XN,"f").fittingWidth,e[1]=cI(this,XN,"f").fittingHeight):!0===t.width?(cI(this,XN,"f").setSize(void 0,e[1]),e[0]=cI(this,XN,"f").fittingWidth):!0===t.height?(cI(this,XN,"f").setSize(e[0],void 0),e[1]=cI(this,XN,"f").fittingHeight):(e=t["aspect-ratio"]?[Math.min(e[0],e[1]*t["aspect-ratio"]),Math.min(e[1],e[0]/t["aspect-ratio"])]:e,cI(this,XN,"f").setSize(e[0],e[1])),e},nI=function(e,t,n,r,i,o){e.sizeMode=[i&&!0===i[key]?"proportional":"literal",o&&!0===o[key]?"proportional":"literal"],e.size=[i&&!0===i[key]?1:t.width,o&&!0===o[key]?1:t.height],e.position=[n+t.left,r+t.top,5*t.zIndex]},rI=function(){const e=cI(this,XN,"f").subViews,t=Object.keys(e),n=cI(this,ZN,"f");for(var r of t){var i=e[r];if(0!==r.indexOf("_")&&"stack"!==i.type){var o=n[r];o||(o=this.querySelector("."+r))&&o.parentElement===this&&(n[r]=o)}}cI(this,qN,"m",iI).call(this)},iI=function(){const e=cI(this,XN,"f").subViews,t=Object.keys(e),n=cI(this,ZN,"f"),r=Object.keys(n);for(const e of r)t.includes(e)?n[e].visible=!0:n[e].visible=!1},uI.DEFAULT_PARSE_OPTIONS={extended:!0,strict:!1},sI([jn,U("propertychange"),aI("design:type",Object)],uI.prototype,"visualFormat",void 0),uI=oI=sI([Yn("lume-autolayout-node",Hh),aI("design:paramtypes",[Object])],uI);var hI,dI,pI,fI,mI=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};let gI=class extends Vh{constructor(){super(...arguments),hI.add(this),dI.set(this,[]),this.hasShadow=!0,pI.set(this,!1)}connectedCallback(){if(super.connectedCallback(),mI(this,pI,"f"))return;for(let e=0;e<6;e+=1)mI(this,hI,"m",fI).call(this,e);const e=document.createElement("slot");this.root.appendChild(e)}setContent(e){for(let t=0;t<6;t+=1)mI(this,dI,"f")[t].innerHTML="",mI(this,dI,"f")[t].append(e[t]);return this}};dI=new WeakMap,pI=new WeakMap,hI=new WeakSet,fI=function(e){const t=(new Vh).set({alignPoint:new qo(.5,.5,.5)}),n=(new Vh).set({mountPoint:new qo(.5,.5),size:new os(this.size.x,this.size.x)});mI(this,dI,"f").push(n),t.append(n);const r=document.createElement("slot");n.append(r),r.name=0===e?"front":1===e?"right":2===e?"back":3===e?"left":4===e?"top":"bottom",e<4?t.rotation.y=90*e:t.rotation.x=90*(e%2?-1:1),n.position.z=this.size.x/2,this.root.appendChild(t)},gI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-cube-layout",Hh)],gI);let vI=class extends Vh{constructor(){super(),console.log(" -- PushPaneLayout created (TODO)")}};function yI(e,t=1){Ro.call(this),this.type="Light",this.color=new Xu(e),this.intensity=t}vI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-push-pane-layout",Hh),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[])],vI),yI.prototype=Object.assign(Object.create(Ro.prototype),{constructor:yI,isLight:!0,copy:function(e){return Ro.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=Ro.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}});var bI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},xI=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let _I=class extends Vh{constructor(){super(...arguments),this.color="white",this.intensity=1}makeThreeObject3d(){return new yI}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Nn((()=>{"object"==typeof this.color&&(this.three.color=this.color),this.three.color=new Xu(this.color),this.needsUpdate()})),Nn((()=>{this.three.intensity=this.intensity,this.needsUpdate()}))),!0)}};function wI(e,t){yI.call(this,e,t),this.type="AmbientLight"}bI([jn,U("propertychange"),xI("design:type",Object)],_I.prototype,"color",void 0),bI([qn(1),U("propertychange"),xI("design:type",Number)],_I.prototype,"intensity",void 0),_I=bI([Yn],_I),wI.prototype=Object.assign(Object.create(yI.prototype),{constructor:wI,isAmbientLight:!0});let MI=class extends _I{makeThreeObject3d(){return new wI}};function TI(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new zu(512,512),this.map=null,this.mapPass=null,this.matrix=new eo,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new qL,this._frameExtents=new zu(1,1),this._viewportCount=1,this._viewports=[new Ud(0,0,1,1)]}function SI(){TI.call(this,new hA(90,1,.5,500)),this._frameExtents=new zu(4,2),this._viewportCount=6,this._viewports=[new Ud(2,1,1,1),new Ud(0,1,1,1),new Ud(3,1,1,1),new Ud(1,1,1,1),new Ud(3,0,1,1),new Ud(1,0,1,1)],this._cubeDirections=[new $i(1,0,0),new $i(-1,0,0),new $i(0,0,1),new $i(0,0,-1),new $i(0,1,0),new $i(0,-1,0)],this._cubeUps=[new $i(0,1,0),new $i(0,1,0),new $i(0,1,0),new $i(0,1,0),new $i(0,0,1),new $i(0,0,-1)]}function EI(e,t,n,r){yI.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new SI}MI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-ambient-light",Hh)],MI),Object.assign(TI.prototype,{_projScreenMatrix:new eo,_lightPositionWorld:new $i,_lookTarget:new $i,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),SI.prototype=Object.assign(Object.create(TI.prototype),{constructor:SI,isPointLightShadow:!0,updateMatrices:function(e,t=0){const n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),EI.prototype=Object.assign(Object.create(yI.prototype),{constructor:EI,isPointLight:!0,copy:function(e){return yI.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}});var AI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},RI=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let LI=class extends _I{constructor(){super(...arguments),this.distance=0,this.decay=1,this.castShadow=!0,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowRadius=3,this.shadowBias=0,this.shadowCameraNear=1,this.shadowCameraFar=2e3}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Nn((()=>{const e=this.three;e.distance=this.distance,e.decay=this.decay,e.castShadow=this.castShadow;const t=this.three.shadow;t.mapSize.width=this.shadowMapWidth,t.mapSize.height=this.shadowMapHeight,t.radius=this.shadowRadius,t.bias=this.shadowBias,t.camera.near=this.shadowCameraNear,t.camera.far=this.shadowCameraFar,t.needsUpdate=!0,this.needsUpdate()}))),!0)}makeThreeObject3d(){return new EI}};function CI(){TI.call(this,new iO(-5,5,5,-5,.5,500))}function PI(e,t){yI.call(this,e,t),this.type="DirectionalLight",this.position.copy(Ro.DefaultUp),this.updateMatrix(),this.target=new Ro,this.shadow=new CI}AI([qn(0),U("propertychange"),RI("design:type",Object)],LI.prototype,"distance",void 0),AI([qn(1),U("propertychange"),RI("design:type",Object)],LI.prototype,"decay",void 0),AI([Xn(!0),U("propertychange"),RI("design:type",Object)],LI.prototype,"castShadow",void 0),AI([qn(512),U("propertychange"),RI("design:type",Object)],LI.prototype,"shadowMapWidth",void 0),AI([qn(512),U("propertychange"),RI("design:type",Object)],LI.prototype,"shadowMapHeight",void 0),AI([qn(3),U("propertychange"),RI("design:type",Object)],LI.prototype,"shadowRadius",void 0),AI([qn(0),U("propertychange"),RI("design:type",Object)],LI.prototype,"shadowBias",void 0),AI([qn(1),U("propertychange"),RI("design:type",Object)],LI.prototype,"shadowCameraNear",void 0),AI([qn(2e3),U("propertychange"),RI("design:type",Object)],LI.prototype,"shadowCameraFar",void 0),LI=AI([Yn("lume-point-light",Hh)],LI),CI.prototype=Object.assign(Object.create(TI.prototype),{constructor:CI,isDirectionalLightShadow:!0,updateMatrices:function(e){TI.prototype.updateMatrices.call(this,e)}}),PI.prototype=Object.assign(Object.create(yI.prototype),{constructor:PI,isDirectionalLight:!0,copy:function(e){return yI.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});var OI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},NI=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let II=class extends _I{constructor(){super(...arguments),this.castShadow=!0,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowRadius=3,this.shadowBias=0,this.shadowCameraNear=1,this.shadowCameraFar=2e3,this.shadowCameraTop=1e3,this.shadowCameraRight=1e3,this.shadowCameraBottom=-1e3,this.shadowCameraLeft=-1e3}_loadGL(){return!!super._loadGL()&&(this._glStopFns.push(Nn((()=>{this.three.castShadow=this.castShadow;const e=this.three.shadow;e.mapSize.width=this.shadowMapWidth,e.mapSize.height=this.shadowMapHeight,e.radius=this.shadowRadius,e.bias=this.shadowBias,e.camera.near=this.shadowCameraNear,e.camera.far=this.shadowCameraFar,e.camera.top=this.shadowCameraTop,e.camera.right=this.shadowCameraRight,e.camera.bottom=this.shadowCameraBottom,e.camera.left=this.shadowCameraLeft,e.needsUpdate=!0,this.needsUpdate()}))),!0)}makeThreeObject3d(){return new PI}};OI([Xn(!0),NI("design:type",Object)],II.prototype,"castShadow",void 0),OI([qn(512),NI("design:type",Object)],II.prototype,"shadowMapWidth",void 0),OI([qn(512),NI("design:type",Object)],II.prototype,"shadowMapHeight",void 0),OI([qn(3),NI("design:type",Object)],II.prototype,"shadowRadius",void 0),OI([qn(0),NI("design:type",Object)],II.prototype,"shadowBias",void 0),OI([qn(1),NI("design:type",Object)],II.prototype,"shadowCameraNear",void 0),OI([qn(2e3),NI("design:type",Object)],II.prototype,"shadowCameraFar",void 0),OI([qn(1),NI("design:type",Object)],II.prototype,"shadowCameraTop",void 0),OI([qn(1),NI("design:type",Object)],II.prototype,"shadowCameraRight",void 0),OI([qn(1),NI("design:type",Object)],II.prototype,"shadowCameraBottom",void 0),OI([qn(1),NI("design:type",Object)],II.prototype,"shadowCameraLeft",void 0),II=OI([Yn("lume-directional-light",Hh)],II);let DI=class extends Op{};DI.defaultBehaviors={"box-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},DI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-box",Hh)],DI);let kI=class extends Op{get isMixedPlane(){return!0}};kI.defaultBehaviors={"mixedplane-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"mixedplane-material":e=>!e.some((e=>e.endsWith("-material")))},kI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-mixed-plane",Hh)],kI);let BI=class extends Op{};BI.defaultBehaviors={"plane-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},BI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-plane",Hh)],BI);let UI=class extends Op{};UI.defaultBehaviors={"rounded-rectangle-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},UI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-rounded-rectangle",Hh)],UI);let FI=class extends Op{};FI.defaultBehaviors={"shape-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},FI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-shape",Hh)],FI);let zI=class extends Op{};zI.defaultBehaviors={"sphere-geometry":e=>!e.some((e=>e.endsWith("-geometry"))),"phong-material":e=>!e.some((e=>e.endsWith("-material")))},zI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-sphere",Hh)],zI);let HI=class extends Vh{};HI.defaultBehaviors=["collada-model"],HI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-collada-model",Hh)],HI);let GI=class extends Vh{};GI.defaultBehaviors=["fbx-model"],GI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-fbx-model",Hh)],GI);let jI=class extends Vh{};jI.defaultBehaviors=["gltf-model"],jI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-gltf-model",Hh)],jI);let VI=class extends Vh{};function WI(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:Function("return this")()}VI.defaultBehaviors=["obj-model"],VI=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}([Yn("lume-obj-model",Hh)],VI);class qI extends Wo{get default(){return{x:void 0,y:void 0,z:void 0}}}let XI=!1;function YI(){var e;if(!Hh&&!XI){XI=!0;for(const t in i){const n=i[t];(null==n?void 0:n.elementName)&&(null===(e=n.defineElement)||void 0===e||e.call(n))}}}const ZI=YI;function JI(e,t,n){rC.call(this,e,t,n),this.samples=4}function $I(e){rO.call(this,e)}function KI(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Au,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Zi.generateUUID()}JI.prototype=Object.assign(Object.create(rC.prototype),{constructor:JI,isWebGLMultisampleRenderTarget:!0,copy:function(e){return rC.prototype.copy.call(this,e),this.samples=e.samples,this}}),$I.prototype=Object.assign(Object.create(rO.prototype),{constructor:$I,isWebGL1Renderer:!0}),Object.defineProperty(KI.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(KI.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Zi.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new KI(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Zi.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const QI=new $i;function eD(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function tD(e){Fu.call(this),this.type="SpriteMaterial",this.color=new Xu(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let nD;Object.defineProperties(eD.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(eD.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,n=this.data.count;t<n;t++)QI.x=this.getX(t),QI.y=this.getY(t),QI.z=this.getZ(t),QI.applyMatrix4(e),this.setXYZ(t,QI.x,QI.y,QI.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Hd(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new eD(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),tD.prototype=Object.create(Fu.prototype),tD.prototype.constructor=tD,tD.prototype.isSpriteMaterial=!0,tD.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const rD=new $i,iD=new $i,oD=new $i,sD=new zu,aD=new zu,cD=new eo,lD=new $i,uD=new $i,hD=new $i,dD=new zu,pD=new zu,fD=new zu;function mD(e){if(Ro.call(this),this.type="Sprite",void 0===nD){nD=new lp;const e=new KI(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);nD.setIndex([0,1,2,0,2,3]),nD.setAttribute("position",new eD(e,3,0,!1)),nD.setAttribute("uv",new eD(e,2,3,!1))}this.geometry=nD,this.material=void 0!==e?e:new tD,this.center=new zu(.5,.5)}function gD(e,t,n,r,i,o){sD.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(aD.x=o*sD.x-i*sD.y,aD.y=i*sD.x+o*sD.y):aD.copy(sD),e.copy(t),e.x+=aD.x,e.y+=aD.y,e.applyMatrix4(cD)}mD.prototype=Object.assign(Object.create(Ro.prototype),{constructor:mD,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),iD.setFromMatrixScale(this.matrixWorld),cD.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),oD.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&iD.multiplyScalar(-oD.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;gD(lD.set(-.5,-.5,0),oD,o,iD,r,i),gD(uD.set(.5,-.5,0),oD,o,iD,r,i),gD(hD.set(.5,.5,0),oD,o,iD,r,i),dD.set(0,0),pD.set(1,0),fD.set(1,1);let s=e.ray.intersectTriangle(lD,uD,hD,!1,rD);if(null===s&&(gD(uD.set(-.5,.5,0),oD,o,iD,r,i),pD.set(0,1),s=e.ray.intersectTriangle(lD,hD,uD,!1,rD),null===s))return;const a=e.ray.origin.distanceTo(rD);a<e.near||a>e.far||t.push({distance:a,point:rD.clone(),uv:Dd.getUV(rD,lD,uD,hD,dD,pD,fD,new zu),face:null,object:this})},copy:function(e){return Ro.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const vD=new $i,yD=new $i;function bD(){Ro.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}bD.prototype=Object.assign(Object.create(Ro.prototype),{constructor:bD,isLOD:!0,copy:function(e){Ro.prototype.copy.call(this,e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){vD.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(vD);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){vD.setFromMatrixPosition(e.matrixWorld),yD.setFromMatrixPosition(this.matrixWorld);const n=vD.distanceTo(yD)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){const t=Ro.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}});const xD=new $i,_D=new Ud,wD=new Ud,MD=new $i,TD=new eo;function SD(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ap.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new eo,this.bindMatrixInverse=new eo}function ED(){Ro.call(this),this.type="Bone"}SD.prototype=Object.assign(Object.create(Ap.prototype),{constructor:SD,isSkinnedMesh:!0,copy:function(e){return Ap.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new Ud,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Ap.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const n=this.skeleton,r=this.geometry;_D.fromBufferAttribute(r.attributes.skinIndex,e),wD.fromBufferAttribute(r.attributes.skinWeight,e),xD.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=wD.getComponent(e);if(0!==r){const i=_D.getComponent(e);TD.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(MD.copy(xD).applyMatrix4(TD),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}),ED.prototype=Object.assign(Object.create(Ro.prototype),{constructor:ED,isBone:!0});const AD=new eo,RD=new eo;function LD(e=[],t=[]){this.uuid=Zi.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}function CD(e){Fu.call(this),this.type="LineBasicMaterial",this.color=new Xu(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Object.assign(LD.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new eo)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new eo;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:RD;AD.multiplyMatrices(i,t[r]),AD.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new LD(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new ED),this.bones.push(i),this.boneInverses.push((new eo).fromArray(e.boneInverses[n]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}}),CD.prototype=Object.create(Fu.prototype),CD.prototype.constructor=CD,CD.prototype.isLineBasicMaterial=!0,CD.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const PD=new $i,OD=new $i,ND=new eo,ID=new xd,DD=new dd;function kD(e=new lp,t=new CD){Ro.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}kD.prototype=Object.assign(Object.create(Ro.prototype),{constructor:kD,isLine:!0,copy:function(e){return Ro.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)PD.fromBufferAttribute(t,e-1),OD.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=PD.distanceTo(OD);e.setAttribute("lineDistance",new Jd(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;n[0]=0;for(let e=1,r=t.length;e<r;e++)n[e]=n[e-1],n[e]+=t[e-1].distanceTo(t[e])}return this},raycast:function(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),DD.copy(n.boundingSphere),DD.applyMatrix4(r),DD.radius+=i,!1===e.ray.intersectsSphere(DD))return;ND.copy(r).invert(),ID.copy(e.ray).applyMatrix4(ND);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new $i,c=new $i,l=new $i,u=new $i,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){const n=r.array;for(let r=0,o=n.length-1;r<o;r+=h){const o=n[r],h=n[r+1];if(a.fromBufferAttribute(i,o),c.fromBufferAttribute(i,h),ID.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:l.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(let n=0,r=i.count-1;n<r;n+=h){if(a.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),ID.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const r=n.vertices,i=r.length;for(let n=0;n<i-1;n+=h){if(ID.distanceSqToSegment(r[n],r[n+1],u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const BD=new $i,UD=new $i;function FD(e,t){kD.call(this,e,t),this.type="LineSegments"}function zD(e,t){kD.call(this,e,t),this.type="LineLoop"}function HD(e,t,n,r,i,o,s,a,c){bE.call(this,e,t,n,r,i,o,s,a,c),this.format=void 0!==s?s:zc,this.minFilter=void 0!==o?o:wc,this.magFilter=void 0!==i?i:wc,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){l.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function GD(e,t,n,r,i,o,s,a,c,l,u,h){bE.call(this,null,o,s,a,c,l,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function jD(e,t,n,r,i,o,s,a,c){bE.call(this,e,t,n,r,i,o,s,a,c),this.needsUpdate=!0}function VD(e,t,n,r,i,o,s,a,c,l){if((l=void 0!==l?l:Wc)!==Wc&&l!==qc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===Wc&&(n=Cc),void 0===n&&l===qc&&(n=Uc),bE.call(this,null,r,i,o,s,a,l,n,c),this.image={width:e,height:t},this.magFilter=void 0!==s?s:vc,this.minFilter=void 0!==a?a:vc,this.flipY=!1,this.generateMipmaps=!1}FD.prototype=Object.assign(Object.create(kD.prototype),{constructor:FD,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)BD.fromBufferAttribute(t,e),UD.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+BD.distanceTo(UD);e.setAttribute("lineDistance",new Jd(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;for(let e=0,r=t.length;e<r;e+=2)BD.copy(t[e]),UD.copy(t[e+1]),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+BD.distanceTo(UD)}return this}}),zD.prototype=Object.assign(Object.create(kD.prototype),{constructor:zD,isLineLoop:!0}),HD.prototype=Object.assign(Object.create(bE.prototype),{constructor:HD,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),GD.prototype=Object.create(bE.prototype),GD.prototype.constructor=GD,GD.prototype.isCompressedTexture=!0,jD.prototype=Object.create(bE.prototype),jD.prototype.constructor=jD,jD.prototype.isCanvasTexture=!0,VD.prototype=Object.create(bE.prototype),VD.prototype.constructor=VD,VD.prototype.isDepthTexture=!0;class WD extends lp{constructor(e=1,t=8,n=0,r=2*Math.PI){super(),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],s=[],a=[],c=new $i,l=new zu;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;c.x=e*Math.cos(h),c.y=e*Math.sin(h),o.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(o[u]/e+1)/2,l.y=(o[u+1]/e+1)/2,a.push(l.x,l.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new Jd(o,3)),this.setAttribute("normal",new Jd(s,3)),this.setAttribute("uv",new Jd(a,2))}}class qD extends Jp{constructor(e,t,n,r){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new WD(e,t,n,r)),this.mergeVertices()}}class XD extends lp{constructor(e=1,t=1,n=1,r=8,i=1,o=!1,s=0,a=2*Math.PI){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const c=this;r=Math.floor(r),i=Math.floor(i);const l=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,o=new zu,f=new $i;let v=0;const y=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*b,0),h.push(0,b,0),d.push(.5,.5),p++;const x=p;for(let e=0;e<=r;e++){const t=e/r*a+s,n=Math.cos(t),i=Math.sin(t);f.x=y*i,f.y=m*b,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,b,0),o.x=.5*n+.5,o.y=.5*i*b+.5,d.push(o.x,o.y),p++}for(let e=0;e<r;e++){const t=i+e,r=x+e;!0===n?l.push(r,r+1,t):l.push(r+1,r,t),v+=3}c.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new $i,v=new $i;let y=0;const b=(t-e)/n;for(let c=0;c<=i;c++){const l=[],g=c/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*a+s,c=Math.sin(i),f=Math.cos(i);v.x=y*c,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(c,b,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),l.push(p++)}f.push(l)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],o=f[t][e+1];l.push(n,r,o),l.push(r,i,o),y+=6}c.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new Jd(u,3)),this.setAttribute("normal",new Jd(h,3)),this.setAttribute("uv",new Jd(d,2))}}class YD extends Jp{constructor(e,t,n,r,i,o,s,a){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new XD(e,t,n,r,i,o,s,a)),this.mergeVertices()}}class ZD extends YD{constructor(e,t,n,r,i,o,s){super(0,e,t,n,r,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}}class JD extends XD{constructor(e=1,t=1,n=8,r=1,i=!1,o=0,s=2*Math.PI){super(0,e,t,n,r,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}}class $D extends lp{constructor(e,t,n=1,r=0){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];function s(e,t,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const s=e.clone().lerp(n,r/i),a=t.clone().lerp(n,r/i),c=i-r;for(let e=0;e<=c;e++)o[r][e]=0===e&&r===i?s:s.clone().lerp(a,e/c)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(o[e][n+1]),a(o[e+1][n]),a(o[e][n])):(a(o[e][n+1]),a(o[e+1][n+1]),a(o[e+1][n]))}}function a(e){i.push(e.x,e.y,e.z)}function c(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function l(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new $i,r=new $i,i=new $i;for(let o=0;o<t.length;o+=3)c(t[o+0],n),c(t[o+1],r),c(t[o+2],i),s(n,r,i,e)}(r),function(e){const t=new $i;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new $i;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(r,1-s)}var t;(function(){const e=new $i,t=new $i,n=new $i,r=new $i,s=new zu,a=new zu,c=new zu;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),c.set(o[d+4],o[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const p=u(r);l(s,d+0,e,p),l(a,d+2,t,p),l(c,d+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new Jd(i,3)),this.setAttribute("normal",new Jd(i.slice(),3)),this.setAttribute("uv",new Jd(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}}class KD extends $D{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class QD extends Jp{constructor(e,t){super(),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new KD(e,t)),this.mergeVertices()}}const ek=new $i,tk=new $i,nk=new $i,rk=new Dd;class ik extends lp{constructor(e,t){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,e.isGeometry&&(e=(new lp).fromGeometry(e));const n=Math.pow(10,4),r=Math.cos(Zi.DEG2RAD*t),i=e.getIndex(),o=e.getAttribute("position"),s=i?i.count:o.count,a=[0,0,0],c=["a","b","c"],l=new Array(3),u={},h=[];for(let e=0;e<s;e+=3){i?(a[0]=i.getX(e),a[1]=i.getX(e+1),a[2]=i.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:s,c:d}=rk;if(t.fromBufferAttribute(o,a[0]),s.fromBufferAttribute(o,a[1]),d.fromBufferAttribute(o,a[2]),rk.getNormal(nk),l[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,l[1]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,l[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=l[e],i=l[t],o=rk[c[e]],s=rk[c[t]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(nk.dot(u[p].normal)<=r&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),u[p]=null):d in u||(u[d]={index0:a[e],index1:a[t],normal:nk.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];ek.fromBufferAttribute(o,t),tk.fromBufferAttribute(o,n),h.push(ek.x,ek.y,ek.z),h.push(tk.x,tk.y,tk.z)}this.setAttribute("position",new Jd(h,3))}}class ok extends $D{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class sk extends Jp{constructor(e,t){super(),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ok(e,t)),this.mergeVertices()}}class ak extends lp{constructor(e,t=12,n=0,r=2*Math.PI){super(),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Zi.clamp(r,0,2*Math.PI);const i=[],o=[],s=[],a=1/t,c=new $i,l=new zu;for(let i=0;i<=t;i++){const u=n+i*a*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=e.length-1;n++)c.x=e[n].x*h,c.y=e[n].y,c.z=e[n].x*d,o.push(c.x,c.y,c.z),l.x=i/t,l.y=n/(e.length-1),s.push(l.x,l.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,o=r,s=r+e.length,a=r+e.length+1,c=r+1;i.push(o,s,c),i.push(s,a,c)}if(this.setIndex(i),this.setAttribute("position",new Jd(o,3)),this.setAttribute("uv",new Jd(s,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new $i,i=new $i,o=new $i,s=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[s+a+0],i.y=n[s+a+1],i.z=n[s+a+2],o.addVectors(r,i).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}}class ck extends Jp{constructor(e,t,n,r){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new ak(e,t,n,r)),this.mergeVertices()}}class lk extends $D{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class uk extends Jp{constructor(e,t){super(),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new lk(e,t)),this.mergeVertices()}}function hk(e,t,n){lp.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,c=new $i,l=new $i,u=new $i,h=new $i,d=new $i;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,p,l),i.push(l.x,l.y,l.z),r-a>=0?(e(r-a,p,u),h.subVectors(l,u)):(e(r+a,p,u),h.subVectors(u,l)),p-a>=0?(e(r,p-a,u),d.subVectors(l,u)):(e(r,p+a,u),d.subVectors(u,l)),c.crossVectors(h,d).normalize(),o.push(c.x,c.y,c.z),s.push(r,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,i=e*p+n+1,o=(e+1)*p+n+1,s=(e+1)*p+n;r.push(t,i,s),r.push(i,o,s)}this.setIndex(r),this.setAttribute("position",new Jd(i,3)),this.setAttribute("normal",new Jd(o,3)),this.setAttribute("uv",new Jd(s,2))}function dk(e,t,n){Jp.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new hk(e,t,n)),this.mergeVertices()}hk.prototype=Object.create(lp.prototype),hk.prototype.constructor=hk,dk.prototype=Object.create(Jp.prototype),dk.prototype.constructor=dk;class pk extends Jp{constructor(e,t,n,r){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new $D(e,t,n,r)),this.mergeVertices()}}class fk extends lp{constructor(e=.5,t=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const s=[],a=[],c=[],l=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),d=new $i,p=new zu;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*o;d.x=u*Math.cos(r),d.y=u*Math.sin(r),a.push(d.x,d.y,d.z),c.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,l.push(p.x,p.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,a=r+n+2,c=r+1;s.push(i,o,c),s.push(o,a,c)}}this.setIndex(s),this.setAttribute("position",new Jd(a,3)),this.setAttribute("normal",new Jd(c,3)),this.setAttribute("uv",new Jd(l,2))}}class mk extends Jp{constructor(e,t,n,r,i,o){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new fk(e,t,n,r,i,o)),this.mergeVertices()}}class gk extends $D{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class vk extends Jp{constructor(e,t){super(),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new gk(e,t)),this.mergeVertices()}}class yk extends HS{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new lp;const r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t),this.type="TextBufferGeometry"}}class bk extends Jp{constructor(e,t){super(),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new yk(e,t)),this.mergeVertices()}}class xk extends lp{constructor(e=1,t=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],a=[],c=[],l=new $i,u=new $i,h=new $i;for(let o=0;o<=n;o++)for(let d=0;d<=r;d++){const p=d/r*i,f=o/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),l.x=e*Math.cos(p),l.y=e*Math.sin(p),h.subVectors(u,l).normalize(),a.push(h.x,h.y,h.z),c.push(d/r),c.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,a=(r+1)*e+t;o.push(n,i,a),o.push(i,s,a)}this.setIndex(o),this.setAttribute("position",new Jd(s,3)),this.setAttribute("normal",new Jd(a,3)),this.setAttribute("uv",new Jd(c,2))}}class _k extends Jp{constructor(e,t,n,r,i){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new xk(e,t,n,r,i)),this.mergeVertices()}}class wk extends lp{constructor(e=1,t=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],c=[],l=[],u=new $i,h=new $i,d=new $i,p=new $i,f=new $i,m=new $i,g=new $i;for(let s=0;s<=n;++s){const y=s/n*i*Math.PI*2;v(y,i,o,e,d),v(y+.01,i,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,o=-t*Math.cos(i),p=t*Math.sin(i);u.x=d.x+(o*g.x+p*f.x),u.y=d.y+(o*g.y+p*f.y),u.z=d.z+(o*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),c.push(h.x,h.y,h.z),l.push(s/n),l.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;s.push(n,i,a),s.push(i,o,a)}function v(e,t,n,r,i){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,c=Math.cos(a);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Jd(a,3)),this.setAttribute("normal",new Jd(c,3)),this.setAttribute("uv",new Jd(l,2))}}class Mk extends Jp{constructor(e,t,n,r,i,o,s){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new wk(e,t,n,r,i,o)),this.mergeVertices()}}class Tk extends lp{constructor(e,t=64,n=1,r=8,i=!1){super(),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new $i,a=new $i,c=new zu;let l=new $i;const u=[],h=[],d=[],p=[];function f(i){l=e.getPointAt(i/t,l);const c=o.normals[i],d=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);a.x=o*c.x+i*d.x,a.y=o*c.y+i*d.y,a.z=o*c.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=l.x+n*a.x,s.y=l.y+n*a.y,s.z=l.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)c.x=e/t,c.y=n/r,d.push(c.x,c.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;p.push(n,i,s),p.push(i,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new Jd(u,3)),this.setAttribute("normal",new Jd(h,3)),this.setAttribute("uv",new Jd(d,2))}toJSON(){const e=lp.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class Sk extends Jp{constructor(e,t,n,r,i,o){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new Tk(e,t,n,r,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}}class Ek extends lp{constructor(e){super(),this.type="WireframeGeometry";const t=[],n=[0,0],r={},i=["a","b","c"];if(e&&e.isGeometry){const o=e.faces;for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0;e<3;e++){const o=t[i[e]],s=t[i[(e+1)%3]];n[0]=Math.min(o,s),n[1]=Math.max(o,s);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const n in r){const i=r[n];let o=e.vertices[i.index1];t.push(o.x,o.y,o.z),o=e.vertices[i.index2],t.push(o.x,o.y,o.z)}}else if(e&&e.isBufferGeometry){const i=new $i;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],i=t.start;for(let e=i,o=i+t.count;e<o;e+=3)for(let t=0;t<3;t++){const i=s.getX(e+t),o=s.getX(e+(t+1)%3);n[0]=Math.min(i,o),n[1]=Math.max(i,o);const a=n[0]+","+n[1];void 0===r[a]&&(r[a]={index1:n[0],index2:n[1]})}}for(const e in r){const n=r[e];i.fromBufferAttribute(o,n.index1),t.push(i.x,i.y,i.z),i.fromBufferAttribute(o,n.index2),t.push(i.x,i.y,i.z)}}else{const n=e.attributes.position;for(let e=0,r=n.count/3;e<r;e++)for(let r=0;r<3;r++){const o=3*e+r;i.fromBufferAttribute(n,o),t.push(i.x,i.y,i.z);const s=3*e+(r+1)%3;i.fromBufferAttribute(n,s),t.push(i.x,i.y,i.z)}}}this.setAttribute("position",new Jd(t,3))}}function Ak(e){Fu.call(this),this.type="ShadowMaterial",this.color=new Xu(0),this.transparent=!0,this.setValues(e)}function Rk(e){Fu.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Xu(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xu(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lu,this.normalScale=new zu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Lk(e){Fu.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lu,this.normalScale=new zu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ck(e){Fu.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Xu(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lu,this.normalScale=new zu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Pk(e){CD.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Ak.prototype=Object.create(Fu.prototype),Ak.prototype.constructor=Ak,Ak.prototype.isShadowMaterial=!0,Ak.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this},Rk.prototype=Object.create(Fu.prototype),Rk.prototype.constructor=Rk,Rk.prototype.isMeshToonMaterial=!0,Rk.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Lk.prototype=Object.create(Fu.prototype),Lk.prototype.constructor=Lk,Lk.prototype.isMeshNormalMaterial=!0,Lk.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ck.prototype=Object.create(Fu.prototype),Ck.prototype.constructor=Ck,Ck.prototype.isMeshMatcapMaterial=!0,Ck.prototype.copy=function(e){return Fu.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Pk.prototype=Object.create(CD.prototype),Pk.prototype.constructor=Pk,Pk.prototype.isLineDashedMaterial=!0,Pk.prototype.copy=function(e){return CD.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};const Ok={arraySlice:function(e,t,n){return Ok.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(t.push(o.time),n.push(s)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),c=[],l=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){c.push(t.times[e]);for(let n=0;n<a;++n)l.push(t.values[e*a+n])}}0!==c.length&&(t.times=Ok.convertArray(c,t.times.constructor),t.values=Ok.convertArray(l,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let a=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const e=a,t=c-a;d=Ok.arraySlice(r.values,e,t)}else if(o>=r.times[h]){const e=h*c+a,t=e+c-a;d=Ok.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=a,n=c-a;e.evaluate(o),d=Ok.arraySlice(e.resultBuffer,t,n)}"quaternion"===i&&(new Ji).fromArray(d).normalize().conjugate().toArray(d);const p=s.times.length;for(let e=0;e<p;++e){const t=e*u+l;if("quaternion"===i)Ji.multiplyQuaternionsFlat(s.values,t,d,0,s.values,t);else{const e=u-2*l;for(let n=0;n<e;++n)s.values[t+n]-=d[n]}}}return e.blendMode=Zl,e}};function Nk(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Ik(e,t,n,r){Nk.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Dk(e,t,n,r){Nk.call(this,e,t,n,r)}function kk(e,t,n,r){Nk.call(this,e,t,n,r)}function Bk(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ok.convertArray(t,this.TimeBufferType),this.values=Ok.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Uk(e,t,n){Bk.call(this,e,t,n)}function Fk(e,t,n,r){Bk.call(this,e,t,n,r)}function zk(e,t,n,r){Bk.call(this,e,t,n,r)}function Hk(e,t,n,r){Nk.call(this,e,t,n,r)}function Gk(e,t,n,r){Bk.call(this,e,t,n,r)}function jk(e,t,n,r){Bk.call(this,e,t,n,r)}function Vk(e,t,n,r){Bk.call(this,e,t,n,r)}function Wk(e,t=-1,n,r=Yl){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Zi.generateUUID(),this.duration<0&&this.resetDuration()}function qk(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zk;case"vector":case"vector2":case"vector3":case"vector4":return Vk;case"color":return Fk;case"quaternion":return Gk;case"bool":case"boolean":return Uk;case"string":return jk}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Ok.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Nk.prototype,{evaluate:function(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Nk.prototype,{beforeStart_:Nk.prototype.copySampleValue_,afterEnd_:Nk.prototype.copySampleValue_}),Ik.prototype=Object.assign(Object.create(Nk.prototype),{constructor:Ik,DefaultSettings_:{endingStart:Wl,endingEnd:Wl},intervalChanged_:function(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case ql:i=e,s=2*t-n;break;case Xl:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case ql:o=e,a=2*n-t;break;case Xl:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}const c=.5*(n-t),l=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(a-n),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let e=0;e!==s;++e)i[e]=g*o[l+e]+v*o[c+e]+y*o[a+e]+b*o[u+e];return i}}),Dk.prototype=Object.assign(Object.create(Nk.prototype),{constructor:Dk,interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=(n-t)/(r-t),u=1-l;for(let e=0;e!==s;++e)i[e]=o[c+e]*u+o[a+e]*l;return i}}),kk.prototype=Object.assign(Object.create(Nk.prototype),{constructor:kk,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Bk,{toJSON:function(e){const t=e.constructor;let n;if(void 0!==t.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Ok.convertArray(e.times,Array),values:Ok.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}}),Object.assign(Bk.prototype,{constructor:Bk,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:jl,InterpolantFactoryMethodDiscrete:function(e){return new kk(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Dk(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Ik(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case Gl:t=this.InterpolantFactoryMethodDiscrete;break;case jl:t=this.InterpolantFactoryMethodLinear;break;case Vl:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gl;case this.InterpolantFactoryMethodLinear:return jl;case this.InterpolantFactoryMethodSmooth:return Vl}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this},trim:function(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=Ok.arraySlice(n,i,o),this.values=Ok.arraySlice(this.values,i*e,o*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&Ok.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e},optimize:function(){const e=Ok.arraySlice(this.times),t=Ok.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Vl,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==a[0]))if(r)i=!0;else{const e=s*n,r=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const r=s*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,s=0;s!==n;++s)t[r+s]=t[e+s];++o}return o!==e.length?(this.times=Ok.arraySlice(e,0,o),this.values=Ok.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){const e=Ok.arraySlice(this.times,0),t=Ok.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Uk.prototype=Object.assign(Object.create(Bk.prototype),{constructor:Uk,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Gl,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Fk.prototype=Object.assign(Object.create(Bk.prototype),{constructor:Fk,ValueTypeName:"color"}),zk.prototype=Object.assign(Object.create(Bk.prototype),{constructor:zk,ValueTypeName:"number"}),Hk.prototype=Object.assign(Object.create(Nk.prototype),{constructor:Hk,interpolate_:function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(r-t);let c=e*s;for(let e=c+s;c!==e;c+=4)Ji.slerpFlat(i,0,o,c-s,o,c,a);return i}}),Gk.prototype=Object.assign(Object.create(Bk.prototype),{constructor:Gk,ValueTypeName:"quaternion",DefaultInterpolation:jl,InterpolantFactoryMethodLinear:function(e){return new Hk(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),jk.prototype=Object.assign(Object.create(Bk.prototype),{constructor:jk,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Gl,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Vk.prototype=Object.assign(Object.create(Bk.prototype),{constructor:Vk,ValueTypeName:"vector"}),Object.assign(Wk,{parse:function(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(qk(n[e]).scale(r));const i=new Wk(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i},toJSON:function(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Bk.toJSON(n[e]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let s=[],a=[];s.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const c=Ok.getKeyframeOrder(s);s=Ok.sortedArray(s,1,c),a=Ok.sortedArray(a,1,c),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new zk(".morphTargetInfluences["+t[e].name+"]",s,a).scale(1/n))}return new Wk(e,-1,o)},findByName:function(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(Wk.CreateFromMorphTargetSequence(e,r[e],t,n));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],s=[];Ok.flattenJSON(n,o,s,r),0!==o.length&&i.push(new e(t,o,s))}},r=[],i=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let e=0;e<c.length;e++){const i=c[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new zk(".morphTargetInfluence["+n+"]",e,o))}a=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";n(Vk,o+".position",i,"pos",r),n(Gk,o+".quaternion",i,"rot",r),n(Vk,o+".scale",i,"scl",r)}}return 0===r.length?null:new Wk(i,a,r,s)}}),Object.assign(Wk.prototype,{resetDuration:function(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Wk(this.name,this.duration,e,this.blendMode)},toJSON:function(){return Wk.toJSON(this)}});const Xk={};function Yk(e){fE.call(this,e)}function Zk(e){fE.call(this,e)}function Jk(e){fE.call(this,e)}function $k(e){fE.call(this,e)}function Kk(e){fE.call(this,e)}function Qk(e,t,n){yI.call(this,e,n),this.type="HemisphereLight",this.position.copy(Ro.DefaultUp),this.updateMatrix(),this.groundColor=new Xu(t)}function eB(){TI.call(this,new hA(50,1,.5,500)),this.focus=1}function tB(e,t,n,r,i,o){yI.call(this,e,t),this.type="SpotLight",this.position.copy(Ro.DefaultUp),this.updateMatrix(),this.target=new Ro,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new eB}function nB(e,t,n,r){yI.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}Yk.prototype=Object.assign(Object.create(fE.prototype),{constructor:Yk,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=hE.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0!==Xk[e])return void Xk[e].push({onLoad:t,onProgress:n,onError:r});const s=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);r="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{Xk[e]=[],Xk[e].push({onLoad:t,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const n=this.response,r=Xk[e];if(delete Xk[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),hE.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const n=Xk[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const n=Xk[e];delete Xk[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const n=Xk[e];delete Xk[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return i.manager.itemStart(e),a},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Zk.prototype=Object.assign(Object.create(fE.prototype),{constructor:Zk,load:function(e,t,n,r){const i=this,o=new Yk(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t=[];for(let n=0;n<e.length;n++){const r=Wk.parse(e[n]);t.push(r)}return t}}),Jk.prototype=Object.assign(Object.create(fE.prototype),{constructor:Jk,load:function(e,t,n,r){const i=this,o=[],s=new GD,a=new Yk(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let c=0;function l(l){a.load(e[l],(function(e){const n=i.parse(e,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(s.minFilter=wc),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)l(t);else a.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=wc),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}}),$k.prototype=Object.assign(Object.create(fE.prototype),{constructor:$k,load:function(e,t,n,r){const i=new sC,o=new mE(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)a(t);return i}}),Kk.prototype=Object.assign(Object.create(fE.prototype),{constructor:Kk,load:function(e,t,n,r){const i=this,o=new jL,s=new Yk(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:mc,o.wrapT=void 0!==n.wrapT?n.wrapT:mc,o.magFilter=void 0!==n.magFilter?n.magFilter:wc,o.minFilter=void 0!==n.minFilter?n.minFilter:wc,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=Sc),1===n.mipmapCount&&(o.minFilter=wc),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),Qk.prototype=Object.assign(Object.create(yI.prototype),{constructor:Qk,isHemisphereLight:!0,copy:function(e){return yI.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),eB.prototype=Object.assign(Object.create(TI.prototype),{constructor:eB,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,n=2*Zi.RAD2DEG*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),TI.prototype.updateMatrices.call(this,e)}}),tB.prototype=Object.assign(Object.create(yI.prototype),{constructor:tB,isSpotLight:!0,copy:function(e){return yI.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),nB.prototype=Object.assign(Object.create(yI.prototype),{constructor:nB,isRectAreaLight:!0,copy:function(e){return yI.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=yI.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class rB{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new $i)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}function iB(e,t){yI.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new rB}function oB(e){fE.call(this,e),this.textures={}}iB.prototype=Object.assign(Object.create(yI.prototype),{constructor:iB,isLightProbe:!0,copy:function(e){return yI.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=yI.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),oB.prototype=Object.assign(Object.create(fE.prototype),{constructor:oB,load:function(e,t,n,r){const i=this,o=new Yk(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=new n[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new Xu).setHex(e.sheen)),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.vertexTangents&&(i.vertexTangents=e.vertexTangents),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const n=e.uniforms[t];switch(i.uniforms[t]={},n.type){case"t":i.uniforms[t].value=r(n.value);break;case"c":i.uniforms[t].value=(new Xu).setHex(n.value);break;case"v2":i.uniforms[t].value=(new zu).fromArray(n.value);break;case"v3":i.uniforms[t].value=(new $i).fromArray(n.value);break;case"v4":i.uniforms[t].value=(new Ud).fromArray(n.value);break;case"m3":i.uniforms[t].value=(new fo).fromArray(n.value);break;case"m4":i.uniforms[t].value=(new eo).fromArray(n.value);break;default:i.uniforms[t].value=n.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=r(e.map)),void 0!==e.matcap&&(i.matcap=r(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new zu).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=r(e.specularMap)),void 0!==e.envMap&&(i.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new zu).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.transmissionMap&&(i.transmissionMap=r(e.transmissionMap)),i},setTextures:function(e){return this.textures=e,this}});const sB={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function aB(){lp.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function cB(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Hd.call(this,e,t,n),this.meshPerAttribute=r||1}function lB(e){fE.call(this,e)}aB.prototype=Object.assign(Object.create(lp.prototype),{constructor:aB,isInstancedBufferGeometry:!0,copy:function(e){return lp.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=lp.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),cB.prototype=Object.assign(Object.create(Hd.prototype),{constructor:cB,isInstancedBufferAttribute:!0,copy:function(e){return Hd.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=Hd.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),lB.prototype=Object.assign(Object.create(fE.prototype),{constructor:lB,load:function(e,t,n,r){const i=this,o=new Yk(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=new KI(tp(i.type,o),i.stride);return s.uuid=i.uuid,t[r]=s,s}const i=e.isInstancedBufferGeometry?new aB:new lp,o=e.data.index;if(void 0!==o){const e=tp(o.type,o.array);i.setIndex(new Hd(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let o;if(n.isInterleavedBufferAttribute)o=new eD(r(e.data,n.data),n.itemSize,n.offset,n.normalized);else{const e=tp(n.type,n.array);o=new(n.isInstancedBufferAttribute?cB:Hd)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),i.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let s;s=i.isInterleavedBufferAttribute?new eD(r(e.data,i.data),i.itemSize,i.offset,i.normalized):new Hd(tp(i.type,i.array),i.itemSize,i.normalized),void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){const t=c[e];i.addGroup(t.start,t.count,t.materialIndex)}const l=e.data.boundingSphere;if(void 0!==l){const e=new $i;void 0!==l.center&&e.fromArray(l.center),i.boundingSphere=new dd(e,l.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}});class uB extends fE{constructor(e){super(e)}load(e,t,n,r){const i=this,o=""===this.path?sB.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Yk(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(c)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),c=this.parseObject(e.object,i,a,n),l=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,l),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(c)}return c}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new pS).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new LD).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(n,r){const i={};let o;if(void 0!==n){const s=new lB;for(let a=0,c=n.length;a<c;a++){let c;const l=n[a];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":c=new t[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":c=new t[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":c=new t[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":c=new t[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":c=new t[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":c=new t[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":c=new t[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":c=new t[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":c=new t[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":c=new t[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":c=new t[l.type]((new e[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":c=new t[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":c=new t[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":o=[];for(let e=0,t=l.shapes.length;e<t;e++){const t=r[l.shapes[e]];o.push(t)}c=new t[l.type](o,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":o=[];for(let e=0,t=l.shapes.length;e<t;e++){const t=r[l.shapes[e]];o.push(t)}const n=l.options.extrudePath;void 0!==n&&(l.options.extrudePath=(new e[n.type]).fromJSON(n)),c=new t[l.type](o,l.options);break;case"BufferGeometry":case"InstancedBufferGeometry":c=s.parse(l);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}c.uuid=l.uuid,void 0!==l.name&&(c.name=l.name),!0===c.isBufferGeometry&&void 0!==l.userData&&(c.userData=l.userData),i[l.uuid]=c}}return i}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new oB;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const r=o.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Wk.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function o(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:tp(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new dE(t);i=new mE(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let e=0,t=i.length;e<t;e++){const t=o(i[e]);null!==t&&(t instanceof HTMLImageElement?r[n.uuid].push(t):r[n.uuid].push(new jL(t.data,t.width,t.height)))}}else{const e=o(n.url);null!==e&&(r[n.uuid]=e)}}}return r}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=t[o.image];Array.isArray(a)?(s=new sC(a),6===a.length&&(s.needsUpdate=!0)):(s=a&&a.data?new jL(a.data,a.width,a.height):new bE(a),a&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,hB)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],dB),s.wrapT=n(o.wrap[1],dB)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,pB)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,pB)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r}parseObject(e,t,n,r){let i,o,s;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":i=new IR,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Xu(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new HL(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new GL(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new hA(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new iO(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new wI(e.color,e.intensity);break;case"DirectionalLight":i=new PI(e.color,e.intensity);break;case"PointLight":i=new EI(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new nB(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new tB(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Qk(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new iB).fromJSON(e);break;case"SkinnedMesh":o=a(e.geometry),s=c(e.material),i=new SD(o,s),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":o=a(e.geometry),s=c(e.material),i=new Ap(o,s);break;case"InstancedMesh":o=a(e.geometry),s=c(e.material);const t=e.count,n=e.instanceMatrix;i=new Wp(o,s,t),i.instanceMatrix=new Hd(new Float32Array(n.array),16);break;case"LOD":i=new bD;break;case"Line":i=new kD(a(e.geometry),c(e.material));break;case"LineLoop":i=new zD(a(e.geometry),c(e.material));break;case"LineSegments":i=new FD(a(e.geometry),c(e.material));break;case"PointCloud":case"Points":i=new Up(a(e.geometry),c(e.material));break;case"Sprite":i=new mD(c(e.material));break;case"Group":i=new QP;break;case"Bone":i=new ED;break;default:i=new Ro}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)i.add(this.parseObject(o[e],t,n,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];i.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const hB={UVMapping:ac,CubeReflectionMapping:cc,CubeRefractionMapping:lc,EquirectangularReflectionMapping:uc,EquirectangularRefractionMapping:hc,CubeUVReflectionMapping:dc,CubeUVRefractionMapping:pc},dB={RepeatWrapping:fc,ClampToEdgeWrapping:mc,MirroredRepeatWrapping:gc},pB={NearestFilter:vc,NearestMipmapNearestFilter:yc,NearestMipmapLinearFilter:xc,LinearFilter:wc,LinearMipmapNearestFilter:Mc,LinearMipmapLinearFilter:Sc};function fB(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),fE.call(this,e),this.options={premultiplyAlpha:"none"}}function mB(e){this.type="Font",this.data=e}function gB(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const s=new $S;let a,c,l,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;)switch(e[i++]){case"m":a=e[i++]*t+n,c=e[i++]*t+r,s.moveTo(a,c);break;case"l":a=e[i++]*t+n,c=e[i++]*t+r,s.lineTo(a,c);break;case"q":l=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,s.quadraticCurveTo(h,d,l,u);break;case"b":l=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,p=e[i++]*t+n,f=e[i++]*t+r,s.bezierCurveTo(h,d,p,f,l,u)}}return{offsetX:o.ha*t,path:s}}function vB(e){fE.call(this,e)}let yB;fB.prototype=Object.assign(Object.create(fE.prototype),{constructor:fB,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=hE.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,i.options)})).then((function(n){hE.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(mB.prototype,{isFont:!0,generateShapes:function(e,t=100){const n=[],r=function(e,t,n){const r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,c=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)a=0,c-=o;else{const e=gB(t,i,a,c,n);a+=e.offsetX,s.push(e.path)}}return s}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}),vB.prototype=Object.assign(Object.create(fE.prototype),{constructor:vB,load:function(e,t,n,r){const i=this,o=new Yk(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new mB(e)}});const bB={getContext:function(){return void 0===yB&&(yB=new(window.AudioContext||window.webkitAudioContext)),yB},setContext:function(e){yB=e}};function xB(e){fE.call(this,e)}function _B(e,t,n){iB.call(this,void 0,n);const r=(new Xu).set(e),i=(new Xu).set(t),o=new $i(r.r,r.g,r.b),s=new $i(i.r,i.g,i.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}function wB(e,t){iB.call(this,void 0,t);const n=(new Xu).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}xB.prototype=Object.assign(Object.create(fE.prototype),{constructor:xB,load:function(e,t,n,r){const i=this,o=new Yk(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);bB.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}),_B.prototype=Object.assign(Object.create(iB.prototype),{constructor:_B,isHemisphereLightProbe:!0,copy:function(e){return iB.prototype.copy.call(this,e),this},toJSON:function(e){return iB.prototype.toJSON.call(this,e)}}),wB.prototype=Object.assign(Object.create(iB.prototype),{constructor:wB,isAmbientLightProbe:!0,copy:function(e){return iB.prototype.copy.call(this,e),this},toJSON:function(e){return iB.prototype.toJSON.call(this,e)}});const MB=new eo,TB=new eo;function SB(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new hA,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new hA,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(SB.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,o=t.near*Math.tan(Zi.DEG2RAD*t.fov*.5)/t.zoom;let s,a;TB.elements[12]=-r,MB.elements[12]=r,s=-o*t.aspect+i,a=o*t.aspect+i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-i,a=o*t.aspect-i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(TB),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(MB)}});class EB{constructor(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=AB(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=AB();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function AB(){return("undefined"==typeof performance?Date:performance).now()}const RB=new $i,LB=new Ji,CB=new $i,PB=new $i;class OB extends Ro{constructor(){super(),this.type="AudioListener",this.context=bB.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new EB}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(RB,LB,CB),PB.set(0,0,-1).applyQuaternion(LB),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(RB.x,e),t.positionY.linearRampToValueAtTime(RB.y,e),t.positionZ.linearRampToValueAtTime(RB.z,e),t.forwardX.linearRampToValueAtTime(PB.x,e),t.forwardY.linearRampToValueAtTime(PB.y,e),t.forwardZ.linearRampToValueAtTime(PB.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(RB.x,RB.y,RB.z),t.setOrientation(PB.x,PB.y,PB.z,n.x,n.y,n.z)}}class NB extends Ro{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const IB=new $i,DB=new Ji,kB=new $i,BB=new $i;class UB extends NB{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(IB,DB,kB),BB.set(0,0,1).applyQuaternion(DB);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(IB.x,e),t.positionY.linearRampToValueAtTime(IB.y,e),t.positionZ.linearRampToValueAtTime(IB.z,e),t.orientationX.linearRampToValueAtTime(BB.x,e),t.orientationY.linearRampToValueAtTime(BB.y,e),t.orientationZ.linearRampToValueAtTime(BB.z,e)}else t.setPosition(IB.x,IB.y,IB.z),t.setOrientation(BB.x,BB.y,BB.z)}}class FB{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}function zB(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(zB.prototype,{accumulate:function(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]},_slerp:function(e,t,n,r){Ji.slerpFlat(e,t,e,t,e,n,r)},_slerpAdditive:function(e,t,n,r,i){const o=this._workIndex*i;Ji.multiplyQuaternionsFlat(e,o,e,t,e,n),Ji.slerpFlat(e,t,e,t,e,o,r)},_lerp:function(e,t,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*o+e[n+s]*r}},_lerpAdditive:function(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}});const HB=new RegExp("[\\[\\]\\.:\\/]","g"),GB="[^\\[\\]\\.:\\/]",jB="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",VB=/((?:WC+[\/:])*)/.source.replace("WC",GB),WB=/(WCOD+)?/.source.replace("WCOD",jB),qB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",GB),XB=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",GB),YB=new RegExp("^"+VB+WB+qB+XB+"$"),ZB=["material","materials","bones"];function JB(e,t,n){const r=n||$B.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function $B(e,t,n){this.path=t,this.parsedPath=n||$B.parseTrackName(t),this.node=$B.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function KB(){this.uuid=Zi.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}Object.assign(JB.prototype,{getValue:function(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign($B,{Composite:JB,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new $B.Composite(e,t,n):new $B(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(HB,"")},parseTrackName:function(e){const t=YB.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==ZB.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}}),Object.assign($B.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=$B.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign($B.prototype,{_getValue_unbound:$B.prototype.getValue,_setValue_unbound:$B.prototype.setValue}),Object.assign(KB.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s,a=e.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const u=arguments[l],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new $B(u,n[e],r[e]))}else if(d<c){s=e[d];const a=--c,l=e[a];t[l.uuid]=d,e[d]=l,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new $B(u,n[e],r[e])),t[a]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=t[a];if(void 0!==c&&c>=i){const o=i++,l=e[o];t[l.uuid]=c,e[c]=l,t[a]=o,e[o]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[c]=r,t[o]=i}}}this.nCachedObjects_=i},uncache:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=t[a];if(void 0!==c)if(delete t[a],c<i){const s=--i,a=e[s],l=--o,u=e[l];t[a.uuid]=c,e[c]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[l];t[c]=r,t[s]=i,t.pop()}}else{const i=--o,s=e[i];i>0&&(t[s.uuid]=c),e[c]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[c]=t[i],t.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);r=i.length,n[e]=r,o.push(e),s.push(t),i.push(u);for(let n=l,r=a.length;n!==r;++n){const r=a[n];u[n]=new $B(r,e,t)}return u},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}});class QB{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,s=new Array(o),a={endingStart:Wl,endingEnd:Wl};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=zl,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Zl)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=n===Hl;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(n===Fl){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=ql,r.endingEnd=ql):(r.endingStart=e?this.zeroSlopeAtStart?ql:Wl:Xl,r.endingEnd=t?this.zeroSlopeAtEnd?ql:Wl:Xl)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=n,this}}function eU(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}eU.prototype=Object.assign(Object.create(co.prototype),{constructor:eU,_bindAction:function(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let e=0;e!==i;++e){const i=r[e],c=i.name;let u=l[c];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new zB($B.create(n,c,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),o[e]=u}s[e].resultBuffer=u.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,c=a[a.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]},_lendBinding:function(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Dk(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?Wk.findByName(r,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let c=null;if(void 0===n&&(n=null!==o?o.blendMode:Yl),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const l=new QB(this,o,t,n);return this._bindAction(l,c),this._addInactiveAction(l,s,i),l},existingAction:function(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?Wk.findByName(n,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==n;++s)t[s]._update(r,e,i,o);const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this},setTime:function(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}},uncacheRoot:function(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});class tU{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new tU(void 0===this.value.clone?this.value:this.value.clone())}}function nU(e,t,n){KI.call(this,e,t),this.meshPerAttribute=n||1}function rU(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function iU(e,t,n,r){this.ray=new xd(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new po,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function oU(e,t){return e.distance-t.distance}function sU(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)sU(r[e],t,n,!0)}}nU.prototype=Object.assign(Object.create(KI.prototype),{constructor:nU,isInstancedInterleavedBuffer:!0,copy:function(e){return KI.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=KI.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=KI.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(rU.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(rU.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(iU.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,n){const r=n||[];return sU(e,this,r,t),r.sort(oU),r},intersectObjects:function(e,t,n){const r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=e.length;n<i;n++)sU(e[n],this,r,t);return r.sort(oU),r}});class aU{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Zi.clamp(t/this.radius,-1,1))),this}}class cU{constructor(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}}const lU=new zu;class uU{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new zu(1/0,1/0),this.max=void 0!==t?t:new zu(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=lU.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new zu),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new zu),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new zu),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new zu),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return lU.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const hU=new $i,dU=new $i;class pU{constructor(e,t){this.start=void 0!==e?e:new $i,this.end=void 0!==t?t:new $i}set(e,t){return this.start.copy(e),this.end.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new $i),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new $i),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new $i),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){hU.subVectors(e,this.start),dU.subVectors(this.end,this.start);const n=dU.dot(dU);let r=dU.dot(hU)/n;return t&&(r=Zi.clamp(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new $i),this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}function fU(e){Ro.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}fU.prototype=Object.create(Ro.prototype),fU.prototype.constructor=fU,fU.prototype.isImmediateRenderObject=!0;const mU=new $i;class gU extends Ro{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new lp,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,o=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new Jd(r,3));const i=new CD({fog:!1,toneMapped:!1});this.cone=new FD(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),mU.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(mU),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const vU=new $i,yU=new eo,bU=new eo;class xU extends FD{constructor(e){const t=_U(e),n=new lp,r=[],i=[],o=new Xu(0,0,1),s=new Xu(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new Jd(r,3)),n.setAttribute("color",new Jd(i,3)),super(n,new CD({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");bU.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(yU.multiplyMatrices(bU,i.matrixWorld),vU.setFromMatrixPosition(yU),r.setXYZ(n,vU.x,vU.y,vU.z),yU.multiplyMatrices(bU,i.parent.matrixWorld),vU.setFromMatrixPosition(yU),r.setXYZ(n+1,vU.x,vU.y,vU.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function _U(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,_U(e.children[n]));return t}class wU extends Ap{constructor(e,t,n){super(new cE(t,4,2),new Bd({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const MU=new $i,TU=new Xu,SU=new Xu;class EU extends Ro{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new lk(t);r.rotateY(.5*Math.PI),this.material=new Bd({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new Hd(o,3)),this.add(new Ap(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");TU.copy(this.light.color),SU.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?TU:SU;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(MU.setFromMatrixPosition(this.light.matrixWorld).negate())}}class AU extends FD{constructor(e=10,t=10,n=4473924,r=8947848){n=new Xu(n),r=new Xu(r);const i=t/2,o=e/t,s=e/2,a=[],c=[];for(let e=0,l=0,u=-s;e<=t;e++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const t=e===i?n:r;t.toArray(c,l),l+=3,t.toArray(c,l),l+=3,t.toArray(c,l),l+=3,t.toArray(c,l),l+=3}const l=new lp;l.setAttribute("position",new Jd(a,3)),l.setAttribute("color",new Jd(c,3)),super(l,new CD({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class RU extends FD{constructor(e=10,t=16,n=8,r=64,i=4473924,o=8947848){i=new Xu(i),o=new Xu(o);const s=[],a=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),c=Math.sin(r)*e,l=Math.cos(r)*e;s.push(0,0,0),s.push(c,0,l);const u=1&n?i:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let t=0;t<=n;t++){const c=1&t?i:o,l=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*l,i=Math.cos(t)*l;s.push(n,0,i),a.push(c.r,c.g,c.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*l,i=Math.cos(t)*l,s.push(n,0,i),a.push(c.r,c.g,c.b)}}const c=new lp;c.setAttribute("position",new Jd(s,3)),c.setAttribute("color",new Jd(a,3)),super(c,new CD({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const LU=new $i,CU=new $i,PU=new $i;class OU extends Ro{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new lp;r.setAttribute("position",new Jd([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new CD({fog:!1,toneMapped:!1});this.lightPlane=new kD(r,i),this.add(this.lightPlane),r=new lp,r.setAttribute("position",new Jd([0,0,0,0,0,1],3)),this.targetLine=new kD(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){LU.setFromMatrixPosition(this.light.matrixWorld),CU.setFromMatrixPosition(this.light.target.matrixWorld),PU.subVectors(CU,LU),this.lightPlane.lookAt(CU),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(CU),this.targetLine.scale.z=PU.length()}}const NU=new $i,IU=new uA;class DU extends FD{constructor(e){const t=new lp,n=new CD({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},s=new Xu(16755200),a=new Xu(16711680),c=new Xu(43775),l=new Xu(16777215),u=new Xu(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",l),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.setAttribute("position",new Jd(r,3)),t.setAttribute("color",new Jd(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;IU.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),kU("c",t,e,IU,0,0,-1),kU("t",t,e,IU,0,0,1),kU("n1",t,e,IU,-1,-1,-1),kU("n2",t,e,IU,1,-1,-1),kU("n3",t,e,IU,-1,1,-1),kU("n4",t,e,IU,1,1,-1),kU("f1",t,e,IU,-1,-1,1),kU("f2",t,e,IU,1,-1,1),kU("f3",t,e,IU,-1,1,1),kU("f4",t,e,IU,1,1,1),kU("u1",t,e,IU,.7,1.1,-1),kU("u2",t,e,IU,-.7,1.1,-1),kU("u3",t,e,IU,0,2,-1),kU("cf1",t,e,IU,-1,0,1),kU("cf2",t,e,IU,1,0,1),kU("cf3",t,e,IU,0,-1,1),kU("cf4",t,e,IU,0,1,1),kU("cn1",t,e,IU,-1,0,-1),kU("cn2",t,e,IU,1,0,-1),kU("cn3",t,e,IU,0,-1,-1),kU("cn4",t,e,IU,0,1,-1),e.getAttribute("position").needsUpdate=!0}}function kU(e,t,n,r,i,o,s){NU.set(i,o,s).unproject(r);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],NU.x,NU.y,NU.z)}}const BU=new Jh;class UU extends FD{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new lp;i.setIndex(new Hd(n,1)),i.setAttribute("position",new Hd(r,3)),super(i,new CD({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&BU.setFromObject(this.object),BU.isEmpty())return;const t=BU.min,n=BU.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return FD.prototype.copy.call(this,e),this.object=e.object,this}}class FU extends FD{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new lp;r.setIndex(new Hd(n,1)),r.setAttribute("position",new Jd([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new CD({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class zU extends kD{constructor(e,t=1,n=16776960){const r=n,i=new lp;i.setAttribute("position",new Jd([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new CD({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new lp;o.setAttribute("position",new Jd([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Ap(o,new Bd({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?ya:va,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const HU=new $i;let GU,jU;class VU extends Ro{constructor(e,t,n,r,i,o){super(),this.type="ArrowHelper",void 0===e&&(e=new $i(0,0,1)),void 0===t&&(t=new $i(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===GU&&(GU=new lp,GU.setAttribute("position",new Jd([0,0,0,0,1,0],3)),jU=new XD(0,.5,1,5,1),jU.translate(0,-.5,0)),this.position.copy(t),this.line=new kD(GU,new CD({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ap(jU,new Bd({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{HU.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(HU,t)}}setLength(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class WU extends FD{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new lp;n.setAttribute("position",new Jd(t,3)),n.setAttribute("color",new Jd([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new CD({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const qU=new Float32Array(1),XU=new Int32Array(qU.buffer),YU={toHalfFloat:function(e){qU[0]=e;const t=XU[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}};function ZU(e,t,n,r,i,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new kd(e,t,n,i,o,s)}const JU=0,$U=1,KU=0,QU=1,eF=2;function tF(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function nF(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function rF(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Up(e,t)}function iF(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new mD(e)}function oF(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Up(e,t)}function sF(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Np(e)}function aF(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Np(e)}function cF(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Np(e)}function lF(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new $i(e,t,n)}function uF(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Hd(e,t).setUsage(Ru)}function hF(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Gd(e,t)}function dF(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new jd(e,t)}function pF(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Vd(e,t)}function fF(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Wd(e,t)}function mF(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new qd(e,t)}function gF(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Xd(e,t)}function vF(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Yd(e,t)}function yF(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Jd(e,t)}function bF(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new $d(e,t)}function xF(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),eS.call(this,e),this.type="catmullrom",this.closed=!0}function _F(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),eS.call(this,e),this.type="catmullrom"}function wF(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),eS.call(this,e),this.type="catmullrom"}function MF(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new WU(e)}function TF(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new UU(e,t)}function SF(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new FD(new ik(e.geometry),new CD({color:void 0!==t?t:16777215}))}function EF(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new FD(new Ek(e.geometry),new CD({color:void 0!==t?t:16777215}))}function AF(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Yk(e)}function RF(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Kk(e)}function LF(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new aC(e,n)}qT.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(qT.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(hS.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new Jp;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.vertices.push(new $i(r.x,r.y,r.z||0))}return t}}),Object.assign(dS.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),xF.prototype=Object.create(eS.prototype),_F.prototype=Object.create(eS.prototype),wF.prototype=Object.create(eS.prototype),Object.assign(wF.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),AU.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},xU.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(fE.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),sB.extractUrlBase(e)}}),fE.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(uU.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Jh.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(dd.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),qL.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},pU.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Zi,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Zi.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Zi.ceilPowerOfTwo(e)}}),Object.assign(fo.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign(eo.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new $i).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Td.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(Ji.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(xd.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Dd.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Dd,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Dd.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Dd.getNormal(e,t,n,r)}}),Object.assign(pS.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new jS(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new WS(this,e)}}),Object.assign(zu.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign($i.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ud.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Jp.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(Ro.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Ro.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Ap.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Ap.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Jl},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(bD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(LD.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SD.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(qT.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),hA.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(yI.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Hd.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ru},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ru)}}}),Object.assign(Hd.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ru:Au),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(lp.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Hd(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(lp.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(aB.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(iU.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(KI.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Ru},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(KI.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ru:Au),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(HS.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(IR.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(tU.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Fu.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Xu}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===xa}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Yu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(jE.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(xA.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(rO.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(rO.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?eu:Ql}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(YP.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(rC.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(NB.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new xB).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),FB.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},oC.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},oC.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)};const CF={merge:function(e,t,n){let r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function PF(){console.error("THREE.CanvasRenderer has been removed")}function OF(){console.error("THREE.JSONLoader has been removed.")}vE.crossOrigin=void 0,vE.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new _E;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},vE.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new $k;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},vE.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},vE.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const NF={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function IF(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:sa}}));var DF=function(e,t){var n,r,i,o,s,a;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new Bm,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(l),c.update(),p=d.NONE},this.update=(n=new Bm,r=(new km).setFromUnitVectors(e.up,new Bm(0,1,0)),i=r.clone().invert(),o=new Bm,s=new km,a=2*Math.PI,function(){var e=c.object.position;n.copy(e).sub(c.target),n.applyQuaternion(r),m.setFromVector3(n),c.autoRotate&&p===d.NONE&&C(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(m.theta+=g.theta*c.dampingFactor,m.phi+=g.phi*c.dampingFactor):(m.theta+=g.theta,m.phi+=g.phi);var t=c.minAzimuthAngle,u=c.maxAzimuthAngle;return isFinite(t)&&isFinite(u)&&(t<-Math.PI?t+=a:t>Math.PI&&(t-=a),u<-Math.PI?u+=a:u>Math.PI&&(u-=a),m.theta=t<=u?Math.max(t,Math.min(u,m.theta)):m.theta>(t+u)/2?Math.max(t,m.theta):Math.min(u,m.theta)),m.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=v,m.radius=Math.max(c.minDistance,Math.min(c.maxDistance,m.radius)),!0===c.enableDamping?c.target.addScaledVector(y,c.dampingFactor):c.target.add(y),n.setFromSpherical(m),n.applyQuaternion(i),e.copy(c.target).add(n),c.object.lookAt(c.target),!0===c.enableDamping?(g.theta*=1-c.dampingFactor,g.phi*=1-c.dampingFactor,y.multiplyScalar(1-c.dampingFactor)):(g.set(0,0,0),y.set(0,0,0)),v=1,!!(b||o.distanceToSquared(c.object.position)>f||8*(1-s.dot(c.object.quaternion))>f)&&(c.dispatchEvent(l),o.copy(c.object.position),s.copy(c.object.quaternion),b=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",Q,!1),c.domElement.removeEventListener("pointerdown",W,!1),c.domElement.removeEventListener("wheel",Y,!1),c.domElement.removeEventListener("touchstart",J,!1),c.domElement.removeEventListener("touchend",K,!1),c.domElement.removeEventListener("touchmove",$,!1),c.domElement.ownerDocument.removeEventListener("pointermove",q,!1),c.domElement.ownerDocument.removeEventListener("pointerup",X,!1),c.domElement.removeEventListener("keydown",Z,!1)};var c=this,l={type:"change"},u={type:"start"},h={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=d.NONE,f=1e-6,m=new vT,g=new vT,v=1,y=new Bm,b=!1,x=new Em,_=new Em,w=new Em,M=new Em,T=new Em,S=new Em,E=new Em,A=new Em,R=new Em;function L(){return Math.pow(.95,c.zoomSpeed)}function C(e){g.theta-=e}function P(e){g.phi-=e}var O=function(){var e=new Bm;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),y.add(e)}}(),N=function(){var e=new Bm;return function(t,n){!0===c.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(c.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),I=function(){var e=new Bm;return function(t,n){var r=c.domElement;if(c.object.isPerspectiveCamera){var i=c.object.position;e.copy(i).sub(c.target);var o=e.length();o*=Math.tan(c.object.fov/2*Math.PI/180),O(2*t*o/r.clientHeight,c.object.matrix),N(2*n*o/r.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(O(t*(c.object.right-c.object.left)/c.object.zoom/r.clientWidth,c.object.matrix),N(n*(c.object.top-c.object.bottom)/c.object.zoom/r.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function D(e){c.object.isPerspectiveCamera?v/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function k(e){c.object.isPerspectiveCamera?v*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function B(e){x.set(e.clientX,e.clientY)}function U(e){M.set(e.clientX,e.clientY)}function F(e){if(1==e.touches.length)x.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(t,n)}}function z(e){if(1==e.touches.length)M.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(t,n)}}function H(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);E.set(0,r)}function G(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,n)}w.subVectors(_,x).multiplyScalar(c.rotateSpeed);var r=c.domElement;C(2*Math.PI*w.x/r.clientHeight),P(2*Math.PI*w.y/r.clientHeight),x.copy(_)}function j(e){if(1==e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(t,n)}S.subVectors(T,M).multiplyScalar(c.panSpeed),I(S.x,S.y),M.copy(T)}function V(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);A.set(0,r),R.set(0,Math.pow(A.y/E.y,c.zoomSpeed)),D(R.y),E.copy(A)}function W(e){if(!1!==c.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case 1:if(!1===c.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),p=d.DOLLY;break;case 0:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;U(e),p=d.PAN}else{if(!1===c.enableRotate)return;B(e),p=d.ROTATE}break;case 2:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;B(e),p=d.ROTATE}else{if(!1===c.enablePan)return;U(e),p=d.PAN}break;default:p=d.NONE}p!==d.NONE&&(c.domElement.ownerDocument.addEventListener("pointermove",q,!1),c.domElement.ownerDocument.addEventListener("pointerup",X,!1),c.dispatchEvent(u))}(e)}}function q(e){if(!1!==c.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1!==c.enabled)switch(e.preventDefault(),p){case d.ROTATE:if(!1===c.enableRotate)return;!function(e){_.set(e.clientX,e.clientY),w.subVectors(_,x).multiplyScalar(c.rotateSpeed);var t=c.domElement;C(2*Math.PI*w.x/t.clientHeight),P(2*Math.PI*w.y/t.clientHeight),x.copy(_),c.update()}(e);break;case d.DOLLY:if(!1===c.enableZoom)return;!function(e){A.set(e.clientX,e.clientY),R.subVectors(A,E),R.y>0?D(L()):R.y<0&&k(L()),E.copy(A),c.update()}(e);break;case d.PAN:if(!1===c.enablePan)return;!function(e){T.set(e.clientX,e.clientY),S.subVectors(T,M).multiplyScalar(c.panSpeed),I(S.x,S.y),M.copy(T),c.update()}(e)}}(e)}}function X(e){switch(e.pointerType){case"mouse":case"pen":c.domElement.ownerDocument.removeEventListener("pointermove",q,!1),c.domElement.ownerDocument.removeEventListener("pointerup",X,!1),!1!==c.enabled&&(c.dispatchEvent(h),p=d.NONE)}}function Y(e){!1===c.enabled||!1===c.enableZoom||p!==d.NONE&&p!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),c.dispatchEvent(u),function(e){e.deltaY<0?k(L()):e.deltaY>0&&D(L()),c.update()}(e),c.dispatchEvent(h))}function Z(e){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(e){var t=!1;switch(e.keyCode){case c.keys.UP:I(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:I(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:I(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT:I(-c.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),c.update())}(e)}function J(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(c.touches.ONE){case 0:if(!1===c.enableRotate)return;F(e),p=d.TOUCH_ROTATE;break;case 1:if(!1===c.enablePan)return;z(e),p=d.TOUCH_PAN;break;default:p=d.NONE}break;case 2:switch(c.touches.TWO){case 2:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&H(e),c.enablePan&&z(e)}(e),p=d.TOUCH_DOLLY_PAN;break;case 3:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&H(e),c.enableRotate&&F(e)}(e),p=d.TOUCH_DOLLY_ROTATE;break;default:p=d.NONE}break;default:p=d.NONE}p!==d.NONE&&c.dispatchEvent(u)}}function $(e){if(!1!==c.enabled)switch(e.preventDefault(),e.stopPropagation(),p){case d.TOUCH_ROTATE:if(!1===c.enableRotate)return;G(e),c.update();break;case d.TOUCH_PAN:if(!1===c.enablePan)return;j(e),c.update();break;case d.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&V(e),c.enablePan&&j(e)}(e),c.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&V(e),c.enableRotate&&G(e)}(e),c.update();break;default:p=d.NONE}}function K(e){!1!==c.enabled&&(c.dispatchEvent(h),p=d.NONE)}function Q(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener("contextmenu",Q,!1),c.domElement.addEventListener("pointerdown",W,!1),c.domElement.addEventListener("wheel",Y,!1),c.domElement.addEventListener("touchstart",J,!1),c.domElement.addEventListener("touchend",K,!1),c.domElement.addEventListener("touchmove",$,!1),c.domElement.addEventListener("keydown",Z,!1),this.update()};(DF.prototype=Object.create(wm.prototype)).constructor=DF;var kF=function(e,t){DF.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=2,this.mouseButtons.RIGHT=0,this.touches.ONE=1,this.touches.TWO=3};(kF.prototype=Object.create(wm.prototype)).constructor=kF;var BF,UF,FF,zF,HF,GF,jF,VF,WF,qF,XF,YF,ZF,JF,$F,KF,QF,ez=function(e){Gw.call(this,e),this.defaultDPI=90,this.defaultUnit="px"};ez.prototype=Object.assign(Object.create(Gw.prototype),{constructor:ez,load:function(e,t,n,r){var i=this,o=new Vw(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)},parse:function(e){var t=this;function n(e,t,n,i,o,s,a,c){if(0!=t&&0!=n){i=i*Math.PI/180,t=Math.abs(t),n=Math.abs(n);var l=(a.x-c.x)/2,u=(a.y-c.y)/2,h=Math.cos(i)*l+Math.sin(i)*u,d=-Math.sin(i)*l+Math.cos(i)*u,p=t*t,f=n*n,m=h*h,g=d*d,v=m/p+g/f;if(v>1){var y=Math.sqrt(v);p=(t*=y)*t,f=(n*=y)*n}var b=p*g+f*m,x=(p*f-b)/b,_=Math.sqrt(Math.max(0,x));o===s&&(_=-_);var w=_*t*d/n,M=-_*n*h/t,T=Math.cos(i)*w-Math.sin(i)*M+(a.x+c.x)/2,S=Math.sin(i)*w+Math.cos(i)*M+(a.y+c.y)/2,E=r(1,0,(h-w)/t,(d-M)/n),A=r((h-w)/t,(d-M)/n,(-h-w)/t,(-d-M)/n)%(2*Math.PI);e.currentPath.absellipse(T,S,t,n,E,E+A,0===s,i)}else e.lineTo(c.x,c.y)}function r(e,t,n,r){var i=e*n+t*r,o=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r),s=Math.acos(Math.max(-1,Math.min(1,i/o)));return e*r-t*n<0&&(s=-s),s}function i(e,t){t=Object.assign({},t);var n={};if(e.hasAttribute("class"))for(var r=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim())),i=0;i<r.length;i++)n=Object.assign(n,p["."+r[i]]);function o(r,i,o){void 0===o&&(o=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[i]=o(e.getAttribute(r))),n[r]&&(t[i]=o(n[r])),e.style&&""!==e.style[r]&&(t[i]=o(e.style[r]))}function s(e){return Math.max(0,Math.min(1,l(e)))}function a(e){return Math.max(0,l(e))}return e.hasAttribute("id")&&(n=Object.assign(n,p["#"+e.getAttribute("id")])),o("fill","fill"),o("fill-opacity","fillOpacity",s),o("opacity","opacity",s),o("stroke","stroke"),o("stroke-opacity","strokeOpacity",s),o("stroke-width","strokeWidth",a),o("stroke-linejoin","strokeLineJoin"),o("stroke-linecap","strokeLineCap"),o("stroke-miterlimit","strokeMiterLimit",a),o("visibility","visibility"),t}function o(e,t){return e-(t-e)}function s(e){for(var t=e.split(/[\s,]+|(?=\s?[+\-])/),n=0;n<t.length;n++){var r=t[n];if(r.indexOf(".")!==r.lastIndexOf("."))for(var i=r.split("."),o=2;o<i.length;o++)t.splice(n+o-1,0,"0."+i[o]);t[n]=l(r)}return t}var a=["mm","cm","in","pt","pc","px"],c={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function l(e){var n="px";if("string"==typeof e||e instanceof String)for(var r=0,i=a.length;r<i;r++){var o=a[r];if(e.endsWith(o)){n=o,e=e.substring(0,e.length-o.length);break}}var s=void 0;return"px"===n&&"px"!==t.defaultUnit?s=c.in[t.defaultUnit]/t.defaultDPI:(s=c[n][t.defaultUnit])<0&&(s=c[n].in*t.defaultDPI),s*parseFloat(e)}function u(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var d=[],p={},f=[],m=new Am,g=new Am,v=new Am,y=new Am,b=new Em,x=new Bm,_=new Am,w=(new DOMParser).parseFromString(e,"image/svg+xml");return function e(t,r){if(1===t.nodeType){var a=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;var t=function(e){var t=new Am,n=m;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){var r=l(e.getAttribute("x")),i=l(e.getAttribute("y"));t.translate(r,i)}if(e.hasAttribute("transform"))for(var o=e.getAttribute("transform").split(")"),a=o.length-1;a>=0;a--){var c=o[a].trim();if(""!==c){var u=c.indexOf("("),h=c.length;if(u>0&&u<h){var d=c.substr(0,u),p=s(c.substr(u+1,h-u-1));switch(n.identity(),d){case"translate":p.length>=1&&(i=r=p[0],p.length>=2&&(i=p[1]),n.translate(r,i));break;case"rotate":if(p.length>=1){var f,b=0,x=0;f=-p[0]*Math.PI/180,p.length>=3&&(b=p[1],x=p[2]),g.identity().translate(-b,-x),v.identity().rotate(f),y.multiplyMatrices(v,g),g.identity().translate(b,x),n.multiplyMatrices(g,y)}break;case"scale":if(p.length>=1){var _=p[0],w=_;p.length>=2&&(w=p[1]),n.scale(_,w)}break;case"skewX":1===p.length&&n.set(1,Math.tan(p[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===p.length&&n.set(1,0,0,Math.tan(p[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===p.length&&n.set(p[0],p[2],p[4],p[1],p[3],p[5],0,0,1)}}t.premultiply(n)}}return t}(e);return f.length>0&&t.premultiply(f[f.length-1]),_.copy(t),f.push(t),t}(t),c=!0,w=null;switch(t.nodeName){case"svg":break;case"style":!function(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(var t=0;t<e.sheet.cssRules.length;t++){var n=e.sheet.cssRules[t];if(1===n.type)for(var r=n.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim())),i=0;i<r.length;i++)p[r[i]]=Object.assign(p[r[i]]||{},n.style)}}(t);break;case"g":r=i(t,r);break;case"path":r=i(t,r),t.hasAttribute("d")&&(w=function(e){for(var t=new HM,r=new Em,i=new Em,a=new Em,c=!0,l=!1,u=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),h=0,d=u.length;h<d;h++){var p=u[h],f=p.charAt(0),m=p.substr(1).trim();switch(!0===c&&(l=!0,c=!1),f){case"M":for(var g=0,v=(_=s(m)).length;g<v;g+=2)r.x=_[g+0],r.y=_[g+1],i.x=r.x,i.y=r.y,0===g?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"H":for(g=0,v=(_=s(m)).length;g<v;g++)r.x=_[g],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"V":for(g=0,v=(_=s(m)).length;g<v;g++)r.y=_[g],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"L":for(g=0,v=(_=s(m)).length;g<v;g+=2)r.x=_[g+0],r.y=_[g+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"C":for(g=0,v=(_=s(m)).length;g<v;g+=6)t.bezierCurveTo(_[g+0],_[g+1],_[g+2],_[g+3],_[g+4],_[g+5]),i.x=_[g+2],i.y=_[g+3],r.x=_[g+4],r.y=_[g+5],0===g&&!0===l&&a.copy(r);break;case"S":for(g=0,v=(_=s(m)).length;g<v;g+=4)t.bezierCurveTo(o(r.x,i.x),o(r.y,i.y),_[g+0],_[g+1],_[g+2],_[g+3]),i.x=_[g+0],i.y=_[g+1],r.x=_[g+2],r.y=_[g+3],0===g&&!0===l&&a.copy(r);break;case"Q":for(g=0,v=(_=s(m)).length;g<v;g+=4)t.quadraticCurveTo(_[g+0],_[g+1],_[g+2],_[g+3]),i.x=_[g+0],i.y=_[g+1],r.x=_[g+2],r.y=_[g+3],0===g&&!0===l&&a.copy(r);break;case"T":for(g=0,v=(_=s(m)).length;g<v;g+=2){var y=o(r.x,i.x),b=o(r.y,i.y);t.quadraticCurveTo(y,b,_[g+0],_[g+1]),i.x=y,i.y=b,r.x=_[g+0],r.y=_[g+1],0===g&&!0===l&&a.copy(r)}break;case"A":for(g=0,v=(_=s(m)).length;g<v;g+=7)if(_[g+5]!=r.x||_[g+6]!=r.y){var x=r.clone();r.x=_[g+5],r.y=_[g+6],i.x=r.x,i.y=r.y,n(t,_[g],_[g+1],_[g+2],_[g+3],_[g+4],x,r),0===g&&!0===l&&a.copy(r)}break;case"m":for(g=0,v=(_=s(m)).length;g<v;g+=2)r.x+=_[g+0],r.y+=_[g+1],i.x=r.x,i.y=r.y,0===g?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"h":for(g=0,v=(_=s(m)).length;g<v;g++)r.x+=_[g],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"v":for(g=0,v=(_=s(m)).length;g<v;g++)r.y+=_[g],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"l":for(g=0,v=(_=s(m)).length;g<v;g+=2)r.x+=_[g+0],r.y+=_[g+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===g&&!0===l&&a.copy(r);break;case"c":for(g=0,v=(_=s(m)).length;g<v;g+=6)t.bezierCurveTo(r.x+_[g+0],r.y+_[g+1],r.x+_[g+2],r.y+_[g+3],r.x+_[g+4],r.y+_[g+5]),i.x=r.x+_[g+2],i.y=r.y+_[g+3],r.x+=_[g+4],r.y+=_[g+5],0===g&&!0===l&&a.copy(r);break;case"s":for(g=0,v=(_=s(m)).length;g<v;g+=4)t.bezierCurveTo(o(r.x,i.x),o(r.y,i.y),r.x+_[g+0],r.y+_[g+1],r.x+_[g+2],r.y+_[g+3]),i.x=r.x+_[g+0],i.y=r.y+_[g+1],r.x+=_[g+2],r.y+=_[g+3],0===g&&!0===l&&a.copy(r);break;case"q":for(g=0,v=(_=s(m)).length;g<v;g+=4)t.quadraticCurveTo(r.x+_[g+0],r.y+_[g+1],r.x+_[g+2],r.y+_[g+3]),i.x=r.x+_[g+0],i.y=r.y+_[g+1],r.x+=_[g+2],r.y+=_[g+3],0===g&&!0===l&&a.copy(r);break;case"t":for(g=0,v=(_=s(m)).length;g<v;g+=2)y=o(r.x,i.x),b=o(r.y,i.y),t.quadraticCurveTo(y,b,r.x+_[g+0],r.y+_[g+1]),i.x=y,i.y=b,r.x=r.x+_[g+0],r.y=r.y+_[g+1],0===g&&!0===l&&a.copy(r);break;case"a":var _;for(g=0,v=(_=s(m)).length;g<v;g+=7)0==_[g+5]&&0==_[g+6]||(x=r.clone(),r.x+=_[g+5],r.y+=_[g+6],i.x=r.x,i.y=r.y,n(t,_[g],_[g+1],_[g+2],_[g+3],_[g+4],x,r),0===g&&!0===l&&a.copy(r));break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(a),t.currentPath.currentPoint.copy(r),c=!0);break;default:console.warn(p)}l=!1}return t}(t));break;case"rect":r=i(t,r),w=function(e){var t=l(e.getAttribute("x")||0),n=l(e.getAttribute("y")||0),r=l(e.getAttribute("rx")||0),i=l(e.getAttribute("ry")||0),o=l(e.getAttribute("width")),s=l(e.getAttribute("height")),a=new HM;return a.moveTo(t+2*r,n),a.lineTo(t+o-2*r,n),(0!==r||0!==i)&&a.bezierCurveTo(t+o,n,t+o,n,t+o,n+2*i),a.lineTo(t+o,n+s-2*i),(0!==r||0!==i)&&a.bezierCurveTo(t+o,n+s,t+o,n+s,t+o-2*r,n+s),a.lineTo(t+2*r,n+s),(0!==r||0!==i)&&a.bezierCurveTo(t,n+s,t,n+s,t,n+s-2*i),a.lineTo(t,n+2*i),(0!==r||0!==i)&&a.bezierCurveTo(t,n,t,n,t+2*r,n),a}(t);break;case"polygon":r=i(t,r),w=function(e){var t=new HM,n=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,(function(e,r,i){var o=l(r),s=l(i);0===n?t.moveTo(o,s):t.lineTo(o,s),n++})),t.currentPath.autoClose=!0,t}(t);break;case"polyline":r=i(t,r),w=function(e){var t=new HM,n=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,(function(e,r,i){var o=l(r),s=l(i);0===n?t.moveTo(o,s):t.lineTo(o,s),n++})),t.currentPath.autoClose=!1,t}(t);break;case"circle":r=i(t,r),w=function(e){var t=l(e.getAttribute("cx")),n=l(e.getAttribute("cy")),r=l(e.getAttribute("r")),i=new yM;i.absarc(t,n,r,0,2*Math.PI);var o=new HM;return o.subPaths.push(i),o}(t);break;case"ellipse":r=i(t,r),w=function(e){var t=l(e.getAttribute("cx")),n=l(e.getAttribute("cy")),r=l(e.getAttribute("rx")),i=l(e.getAttribute("ry")),o=new yM;o.absellipse(t,n,r,i,0,2*Math.PI);var s=new HM;return s.subPaths.push(o),s}(t);break;case"line":r=i(t,r),w=function(e){var t=l(e.getAttribute("x1")),n=l(e.getAttribute("y1")),r=l(e.getAttribute("x2")),i=l(e.getAttribute("y2")),o=new HM;return o.moveTo(t,n),o.lineTo(r,i),o.currentPath.autoClose=!1,o}(t);break;case"defs":c=!1;break;case"use":r=i(t,r);var M=t.href.baseVal.substring(1),T=t.viewportElement.getElementById(M);T?e(T,r):console.warn("SVGLoader: 'use node' references non-existent node id: "+M)}if(w&&(void 0!==r.fill&&"none"!==r.fill&&w.color.setStyle(r.fill),function(e,t){function n(e){x.set(e.x,e.y,1).applyMatrix3(t),e.set(x.x,x.y)}for(var r=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths,o=0,s=i.length;o<s;o++)for(var a=i[o].curves,c=0;c<a.length;c++){var l=a[c];l.isLineCurve?(n(l.v1),n(l.v2)):l.isCubicBezierCurve?(n(l.v0),n(l.v1),n(l.v2),n(l.v3)):l.isQuadraticBezierCurve?(n(l.v0),n(l.v1),n(l.v2)):l.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),b.set(l.aX,l.aY),n(b),l.aX=b.x,l.aY=b.y,l.xRadius*=u(t),l.yRadius*=h(t))}}(w,_),d.push(w),w.userData={node:t,style:r}),c)for(var S=t.childNodes,E=0;E<S.length;E++)e(S[E],r);a&&(f.pop(),f.length>0?_.copy(f[f.length-1]):_.identity())}}(w.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:d,xml:w.documentElement}}}),ez.getStrokeStyle=function(e,t,n,r,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:n=void 0!==n?n:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:i=void 0!==i?i:4}},ez.pointsToStroke=function(e,t,n,r){var i=[],o=[],s=[];if(0===ez.pointsToStrokeWithBuffers(e,t,n,r,i,o,s))return null;var a=new Nv;return a.setAttribute("position",new xv(i,3)),a.setAttribute("normal",new xv(o,3)),a.setAttribute("uv",new xv(s,2)),a},ez.pointsToStrokeWithBuffers=(BF=new Em,UF=new Em,FF=new Em,zF=new Em,HF=new Em,GF=new Em,jF=new Em,VF=new Em,WF=new Em,qF=new Em,XF=new Em,YF=new Em,ZF=new Em,JF=new Em,$F=new Em,KF=new Em,QF=new Em,function(e,t,n,r,i,o,s,a){n=void 0!==n?n:12,r=void 0!==r?r:.001,a=void 0!==a?a:0,e=function(e){for(var t=!1,n=1,i=e.length-1;n<i;n++)if(e[n].distanceTo(e[n+1])<r){t=!0;break}if(!t)return e;var o=[];for(o.push(e[0]),n=1,i=e.length-1;n<i;n++)e[n].distanceTo(e[n+1])>=r&&o.push(e[n]);return o.push(e[e.length-1]),o}(e);var c=e.length;if(c<2)return 0;var l,u,h,d,p,f=e[0].equals(e[c-1]),m=e[0],g=t.strokeWidth/2,v=1/(c-1),y=0,b=!1,x=0,_=3*a,w=2*a;I(e[0],e[1],BF).multiplyScalar(g),VF.copy(e[0]).sub(BF),WF.copy(e[0]).add(BF),qF.copy(VF),XF.copy(WF);for(var M=1;M<c;M++){l=e[M],u=M===c-1?f?e[1]:void 0:e[M+1];var T=BF;I(m,l,T),FF.copy(T).multiplyScalar(g),YF.copy(l).sub(FF),ZF.copy(l).add(FF);var S=y+v;if(h=!1,void 0!==u){I(l,u,UF),FF.copy(UF).multiplyScalar(g),JF.copy(l).sub(FF),$F.copy(l).add(FF),d=!0,FF.subVectors(u,m),T.dot(FF)<0&&(d=!1),1===M&&(b=d),FF.subVectors(u,l),FF.normalize();var E=Math.abs(T.dot(FF));if(0!==E){var A=g/E;FF.multiplyScalar(-A),zF.subVectors(l,m),HF.copy(zF).setLength(A).add(FF),KF.copy(HF).negate();var R=HF.length(),L=zF.length();zF.divideScalar(L),GF.subVectors(u,l);var C=GF.length();switch(GF.divideScalar(C),zF.dot(KF)<L&&GF.dot(KF)<C&&(h=!0),QF.copy(HF).add(l),KF.add(l),p=!1,h?d?($F.copy(KF),ZF.copy(KF)):(JF.copy(KF),YF.copy(KF)):B(),t.strokeLineJoin){case"bevel":U(d,h,S);break;case"round":F(d,h),d?k(l,YF,JF,S,0):k(l,$F,ZF,S,1);break;default:var P=g*t.strokeMiterLimit/R;if(P<1){if("miter-clip"!==t.strokeLineJoin){U(d,h,S);break}F(d,h),d?(GF.subVectors(QF,YF).multiplyScalar(P).add(YF),jF.subVectors(QF,JF).multiplyScalar(P).add(JF),D(YF,S,0),D(GF,S,0),D(l,S,.5),D(l,S,.5),D(GF,S,0),D(jF,S,0),D(l,S,.5),D(jF,S,0),D(JF,S,0)):(GF.subVectors(QF,ZF).multiplyScalar(P).add(ZF),jF.subVectors(QF,$F).multiplyScalar(P).add($F),D(ZF,S,1),D(GF,S,1),D(l,S,.5),D(l,S,.5),D(GF,S,1),D(jF,S,1),D(l,S,.5),D(jF,S,1),D($F,S,1))}else h?(d?(D(WF,y,1),D(VF,y,0),D(QF,S,0),D(WF,y,1),D(QF,S,0),D(KF,S,1)):(D(WF,y,1),D(VF,y,0),D(QF,S,1),D(VF,y,0),D(KF,S,0),D(QF,S,1)),d?JF.copy(QF):$F.copy(QF)):d?(D(YF,S,0),D(QF,S,0),D(l,S,.5),D(l,S,.5),D(QF,S,0),D(JF,S,0)):(D(ZF,S,1),D(QF,S,1),D(l,S,.5),D(l,S,.5),D(QF,S,1),D($F,S,1)),p=!0}}else B()}else B();f||M!==c-1||z(e[0],qF,XF,d,!0,y),y=S,m=l,VF.copy(JF),WF.copy($F)}if(f){if(h&&i){var O=QF,N=KF;b!==d&&(O=KF,N=QF),d?(p||b)&&(N.toArray(i,0),N.toArray(i,9),p&&O.toArray(i,3)):!p&&b||(N.toArray(i,3),N.toArray(i,9),p&&O.toArray(i,0))}}else z(l,YF,ZF,d,!1,S);return x;function I(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function D(e,t,n){i&&(i[_]=e.x,i[_+1]=e.y,i[_+2]=0,o&&(o[_]=0,o[_+1]=0,o[_+2]=1),_+=3,s&&(s[w]=t,s[w+1]=n,w+=2)),x+=3}function k(e,t,r,i,o){BF.copy(t).sub(e).normalize(),UF.copy(r).sub(e).normalize();var s=Math.PI,a=BF.dot(UF);Math.abs(a)<1&&(s=Math.abs(Math.acos(a))),s/=n,FF.copy(t);for(var c=0,l=n-1;c<l;c++)zF.copy(FF).rotateAround(e,s),D(FF,i,o),D(zF,i,o),D(e,i,.5),FF.copy(zF);D(zF,i,o),D(r,i,o),D(e,i,.5)}function B(){D(WF,y,1),D(VF,y,0),D(YF,S,0),D(WF,y,1),D(YF,S,1),D(ZF,S,0)}function U(e,t,n){t?e?(D(WF,y,1),D(VF,y,0),D(YF,S,0),D(WF,y,1),D(YF,S,0),D(KF,S,1),D(YF,n,0),D(JF,n,0),D(KF,n,.5)):(D(WF,y,1),D(VF,y,0),D(ZF,S,1),D(VF,y,0),D(KF,S,0),D(ZF,S,1),D(ZF,n,1),D($F,n,0),D(KF,n,.5)):e?(D(YF,n,0),D(JF,n,0),D(l,n,.5)):(D(ZF,n,1),D($F,n,0),D(l,n,.5))}function F(e,t){t&&(e?(D(WF,y,1),D(VF,y,0),D(YF,S,0),D(WF,y,1),D(YF,S,0),D(KF,S,1),D(YF,y,0),D(l,S,.5),D(KF,S,1),D(l,S,.5),D(JF,y,0),D(KF,S,1)):(D(WF,y,1),D(VF,y,0),D(ZF,S,1),D(VF,y,0),D(KF,S,0),D(ZF,S,1),D(ZF,y,1),D(KF,S,0),D(l,S,.5),D(l,S,.5),D(KF,S,0),D($F,y,1)))}function z(e,n,r,o,s,a){switch(t.strokeLineCap){case"round":s?k(e,r,n,a,.5):k(e,n,r,a,.5);break;case"square":if(s)BF.subVectors(n,e),UF.set(BF.y,-BF.x),FF.addVectors(BF,UF).add(e),zF.subVectors(UF,BF).add(e),o?(FF.toArray(i,3),zF.toArray(i,0),zF.toArray(i,9)):(FF.toArray(i,3),FF.toArray(i,9),zF.toArray(i,0));else{BF.subVectors(r,e),UF.set(BF.y,-BF.x),FF.addVectors(BF,UF).add(e),zF.subVectors(UF,BF).add(e);var c=i.length;o?(FF.toArray(i,c-3),zF.toArray(i,c-6),zF.toArray(i,c-12)):(FF.toArray(i,c-6),zF.toArray(i,c-3),zF.toArray(i,c-12))}}}});const tz={...r,OrbitControls:DF,SVGLoader:ez},nz="0.3.0-alpha.9"})();var __webpack_export_target__=LUME="undefined"==typeof LUME?{}:LUME;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
//# sourceMappingURL=global.js.map